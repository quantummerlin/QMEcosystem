<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Quantum Birth Sigil Generator | Quantum Merlin</title>
    <meta name="description" content="Generate a unique quantum birth sigil based on your exact birth date, time, and location. Discover your cosmic signature through lunar phase and stellar alignment.">
    <meta name="keywords" content="lunar sigil, star date sigil, moon phase art, celestial signature, astrology art, birth sigil, tattoo design">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Quantum Birth Sigil Generator | Quantum Merlin">
    <meta property="og:description" content="Generate a unique sigil for any date, time, and place based on lunar and stellar alignment">
    <meta property="og:type" content="website">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&family=Cinzel:wght@400;500;600;700&family=Space+Mono&display=swap" rel="stylesheet">
    
    <!-- Quantum Core Styles -->
    <link rel="stylesheet" href="./shared/css/quantum-core.css">
    <link rel="stylesheet" href="./shared/css/quantum-animations.css">
    <link rel="stylesheet" href="./shared/css/quantum-backgrounds.css">
    
    <style>
        /* Page-Specific Quantum Styles */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        html {
            overflow-x: hidden;
            max-width: 100vw;
        }
        body {
            background: #0a0a0f;
            color: #fff;
            overflow-x: hidden;
            padding-top: 90px;
            max-width: 100vw;
            width: 100%;
        }

        /* World-Class Header Styling */
        .qrc-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 18px 40px;
            background: rgba(10, 10, 15, 0.92);
            backdrop-filter: blur(25px) saturate(180%);
            border-bottom: 1px solid rgba(0, 245, 255, 0.15);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .qrc-header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1600px;
            margin: 0 auto;
        }

        .qrc-logo {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .qrc-logo:hover {
            transform: translateY(-2px);
        }

        .qrc-logo-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #00f5ff 0%, #9d00ff 100%);
            border-radius: 14px;
            font-size: 1.8rem;
            box-shadow: 0 0 25px rgba(0, 245, 255, 0.5), 0 0 50px rgba(157, 0, 255, 0.3);
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 0 25px rgba(0, 245, 255, 0.5), 0 0 50px rgba(157, 0, 255, 0.3); }
            50% { box-shadow: 0 0 35px rgba(0, 245, 255, 0.7), 0 0 70px rgba(157, 0, 255, 0.5); }
        }

        .qrc-logo-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, #00f5ff 0%, #ff00ff 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
            line-height: 1.3;
        }

        .qrc-logo-text span {
            display: block;
            font-size: 0.65rem;
            font-weight: 400;
            font-family: 'Exo 2', sans-serif;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
            -webkit-text-fill-color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }

        .qrc-nav-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .qrc-support-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            color: rgba(255, 215, 0, 0.8);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .qrc-support-btn:hover {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.5);
            opacity: 1;
            transform: translateY(-1px);
        }

        .qrc-nav-menu {
            position: relative;
        }

        .qrc-nav-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.15), rgba(157, 0, 255, 0.1));
            border: 2px solid rgba(0, 245, 255, 0.4);
            border-radius: 50px;
            color: #00f5ff;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 245, 255, 0.2);
        }

        .qrc-nav-toggle:hover {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.25), rgba(157, 0, 255, 0.2));
            border-color: rgba(0, 245, 255, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 245, 255, 0.4);
        }

        .qrc-nav-toggle-icon {
            display: flex;
            flex-direction: column;
            gap: 4px;
            width: 20px;
        }

        .qrc-nav-toggle-icon span {
            display: block;
            height: 2px;
            background: #00f5ff;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .qrc-nav-dropdown {
            position: absolute;
            top: calc(100% + 12px);
            right: 0;
            min-width: 680px;
            background: rgba(10, 10, 25, 0.98);
            backdrop-filter: blur(30px) saturate(180%);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 60px rgba(0, 245, 255, 0.3), 0 5px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-15px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
        }

        .qrc-nav-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .qrc-nav-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .qrc-nav-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .qrc-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.1), rgba(157, 0, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .qrc-nav-link:hover::before {
            opacity: 1;
        }

        .qrc-nav-link:hover {
            border-color: rgba(0, 245, 255, 0.4);
            transform: translateX(4px);
            box-shadow: 0 4px 20px rgba(0, 245, 255, 0.2);
        }

        .qrc-nav-link.active {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.15), rgba(157, 0, 255, 0.1));
            border-color: rgba(0, 245, 255, 0.5);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
        }

        .qrc-nav-link .nav-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 10px rgba(0, 245, 255, 0.5));
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .qrc-nav-link:hover .nav-icon {
            transform: scale(1.15) rotate(5deg);
        }

        .qrc-nav-link .nav-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .qrc-nav-link .nav-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 2px;
        }

        .qrc-nav-link .nav-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Exo 2', sans-serif;
        }

        .qrc-coffee-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 221, 0, 0.5) !important;
            background: linear-gradient(135deg, #FFE44D, #FFB84D) !important;
        }

        @media (max-width: 1024px) {
            .qrc-logo-text {
                display: none;
            }
            .qrc-nav-dropdown {
                min-width: 480px;
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .qrc-header {
                padding: 14px 20px;
            }
            .qrc-support-btn .btn-text {
                display: none;
            }
            .qrc-nav-dropdown {
                min-width: calc(100vw - 40px);
                right: -20px;
                left: auto;
            }
            .qrc-nav-grid {
                grid-template-columns: 1fr;
            }
            body {
                padding-top: 75px;
            }
            .generator-container {
                padding: 8px;
                max-width: 100%;
            }
            .page-header h1 {
                font-size: 1.8rem;
            }
            .generator-section {
                padding: 20px 15px;
                border-radius: 16px;
            }
            .input-group {
                margin-bottom: 15px;
            }
            .input-group label {
                font-size: 0.8rem;
                margin-bottom: 6px;
            }
            .input-group input,
            .input-group select {
                padding: 12px 14px;
                font-size: 1rem;
                border-radius: 10px;
            }
            .input-row {
                flex-wrap: wrap;
                justify-content: center;
            }
            .input-group input,
            .input-group select {
                width: 100%;
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .qrc-logo-icon {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            .page-header {
                padding: 50px 15px 30px;
            }
            .page-header h1 {
                font-size: 1.6rem;
            }
            .header-stats {
                flex-direction: column;
                gap: 10px;
            }
            .stat-item {
                width: 100%;
            }
        }

        .generator-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
            text-align: center;
        }

        /* Reset text alignment for specific elements that need left alignment */
        .input-group,
        .testimonial-text,
        .education-card p,
        .about-section p {
            text-align: left;
        }

        .input-row {
            justify-content: center;
        }

        /* Quantum Hero Section */
        .page-header {
            text-align: center;
            margin-bottom: 50px;
            padding: 80px 20px 50px;
            position: relative;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 245, 255, 0.15) 0%, transparent 70%);
            pointer-events: none;
            animation: cosmicPulse 6s ease-in-out infinite;
        }

        /* About Section */
        .about-section {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.1) 0%, rgba(0, 245, 255, 0.1) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 0, 255, 0.3);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(255, 0, 255, 0.2), inset 0 0 50px rgba(255, 0, 255, 0.05);
        }

        .about-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff00ff, #00f5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px rgba(255, 0, 255, 0.6));
        }

        .about-section p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .about-section strong {
            color: #00f5ff;
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
        }

        /* Footer Links Grid */
        .footer-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .footer-links-grid a {
            background: rgba(0, 245, 255, 0.05);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 8px;
            padding: 10px 15px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: center;
            display: block;
        }

        .footer-links-grid a:hover {
            background: rgba(0, 245, 255, 0.15);
            border-color: rgba(0, 245, 255, 0.5);
            color: #00f5ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 245, 255, 0.3);
        }

        @keyframes cosmicPulse {
            0%, 100% { opacity: 0.3; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.6; transform: translateX(-50%) scale(1.1); }
        }

        .page-header h1 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2rem, 6vw, 3.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, #00f5ff 0%, #ff00ff 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 30px rgba(0, 245, 255, 0.6)) drop-shadow(0 0 60px rgba(255, 0, 255, 0.4));
            animation: titleGlow 4s ease-in-out infinite;
            position: relative;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 245, 255, 0.6)); }
            50% { filter: drop-shadow(0 0 40px rgba(0, 245, 255, 0.9)) drop-shadow(0 0 60px rgba(255, 0, 255, 0.6)); }
        }

        .page-header .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .stat-item {
            background: rgba(0, 245, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.4);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            color: #00f5ff;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.3), inset 0 0 15px rgba(0, 245, 255, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.5), inset 0 0 20px rgba(0, 245, 255, 0.2);
            border-color: rgba(0, 245, 255, 0.7);
        }

        /* Quantum Generator Section */
        .generator-section {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.08) 0%, rgba(157, 0, 255, 0.08) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 245, 255, 0.4);
            border-radius: 25px;
            padding: 40px 25px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.2), inset 0 0 50px rgba(0, 245, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .generator-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00f5ff, #ff00ff, #ffd700, #00f5ff);
            border-radius: 25px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
            animation: borderRotate 8s linear infinite;
            background-size: 400% 400%;
        }

        .generator-section:hover::before {
            opacity: 0.3;
        }

        @keyframes borderRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .generator-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            text-align: center;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
        }

        .generator-section > p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            color: var(--neon-cyan);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-group input,
        .input-group select {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(0, 245, 255, 0.4);
            border-radius: 12px;
            padding: 14px 12px;
            color: #fff;
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            min-width: 0;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.05);
            box-shadow: 0 0 25px rgba(0, 245, 255, 0.5), inset 0 0 15px rgba(0, 245, 255, 0.1);
            transform: translateY(-1px);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .input-group input[type="number"] {
            width: 80px;
        }

        .input-group select {
            min-width: 120px;
            cursor: pointer;
        }

        .input-group select option {
            background: #1a1a2e;
            color: white;
        }

        /* Location Search */
        #locationInput {
            position: relative;
            width: 100%;
        }

        #locationSearch {
            width: 100%;
        }

        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(20, 20, 40, 0.98);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            margin-top: 5px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        #suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: rgba(0, 245, 255, 0.1);
            color: var(--neon-cyan);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* Style Selector */
        .style-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .style-option {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .style-option::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, transparent, rgba(0, 245, 255, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            border-radius: 15px;
        }

        .style-option:hover {
            border-color: rgba(0, 245, 255, 0.7);
            background: rgba(0, 245, 255, 0.1);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.3);
        }

        .style-option:hover::before {
            opacity: 1;
        }

        .style-option.active {
            border-color: #00f5ff;
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(157, 0, 255, 0.2));
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.5), inset 0 0 30px rgba(0, 245, 255, 0.1);
            transform: scale(1.08);
        }

        .style-option.active .icon {
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .style-option .icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .style-option .name {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Quantum Generate Button */
        .generate-btn {
            width: 100%;
            padding: 22px 40px;
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #00f5ff 0%, #ff00ff 50%, #ffd700 100%);
            border: 3px solid rgba(0, 245, 255, 0.5);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 245, 255, 0.4), inset 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 50px rgba(0, 245, 255, 0.6), 0 0 60px rgba(255, 0, 255, 0.4), inset 0 0 30px rgba(255, 255, 255, 0.2);
            border-color: #00f5ff;
        }

        .generate-btn:active {
            transform: translateY(-2px) scale(1);
        }

        .regenerate-btn {
            display: none;
            width: 100%;
            padding: 12px 20px;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            background: linear-gradient(135deg, var(--neon-magenta), var(--neon-purple));
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .regenerate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 0, 255, 0.3);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            font-family: 'Exo 2', sans-serif;
            max-width: 350px;
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.9), rgba(0, 200, 255, 0.9));
            color: #000;
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 180, 0, 0.9));
            color: #000;
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(255, 0, 100, 0.9), rgba(200, 0, 80, 0.9));
            color: white;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .generator-section {
                padding: 20px 15px;
            }

            .input-row {
                flex-direction: column;
                align-items: stretch;
            }

            .input-group input[type="number"] {
                width: 100%;
            }

            .header-stats {
                gap: 10px;
            }

            .stat-item {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Quantum Education Section */
        .education-section {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.08) 0%, rgba(157, 0, 255, 0.08) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.2), inset 0 0 50px rgba(0, 245, 255, 0.05);
        }

        .education-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffd700, #00f5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 35px;
            filter: drop-shadow(0 0 20px rgba(0, 245, 255, 0.6));
        }

        .education-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .education-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 18px;
            padding: 25px;
            transition: all 0.4s ease;
        }

        .education-card:hover {
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 245, 255, 0.3), inset 0 0 20px rgba(0, 245, 255, 0.1);
        }

        .education-card h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.15rem;
            font-weight: 600;
            color: #00f5ff;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.6);
        }

        .education-card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            line-height: 1.7;
        }

        /* Quantum Style Preview Section */
        .style-preview-section {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.08) 0%, rgba(255, 0, 255, 0.08) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(255, 215, 0, 0.05);
        }

        .style-preview-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 35px;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
        }

        .style-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .style-preview-card {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 18px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .style-preview-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255, 215, 0, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .style-preview-card:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.4), inset 0 0 30px rgba(255, 215, 0, 0.1);
        }

        .style-preview-card:hover::before {
            opacity: 1;
        }

        .style-preview-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
            transition: transform 0.3s ease;
        }

        .style-preview-card:hover .style-preview-icon {
            transform: scale(1.15) rotate(5deg);
        }

        .style-preview-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        .style-preview-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Quantum Cross-Tool Suggestions */
        .cross-tools-section {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.15), rgba(255, 0, 255, 0.15));
            border: 3px solid;
            border-image: linear-gradient(135deg, rgba(157, 0, 255, 0.6), rgba(255, 0, 255, 0.6)) 1;
            border-radius: 25px;
            padding: 50px 35px;
            margin: 50px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(157, 0, 255, 0.3), inset 0 0 60px rgba(157, 0, 255, 0.1);
        }

        .cross-tools-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(157, 0, 255, 0.2) 0%, transparent 70%);
            animation: portalPulse 8s ease-in-out infinite;
        }

        @keyframes portalPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
        }

        .cross-tools-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff00ff, #ff66ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 25px rgba(255, 0, 255, 0.7));
            position: relative;
            z-index: 1;
        }

        .cross-tools-section p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cross-tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            max-width: 900px;
            margin: 0 auto;
        }

        .cross-tool-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 18px;
            padding: 25px;
            text-decoration: none;
            transition: all 0.4s ease;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .cross-tool-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255, 0, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cross-tool-card:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: #ff00ff;
            background: rgba(255, 0, 255, 0.15);
            box-shadow: 0 15px 40px rgba(255, 0, 255, 0.5), inset 0 0 30px rgba(255, 0, 255, 0.2);
        }

        .cross-tool-card:hover::before {
            opacity: 1;
        }

        .cross-tool-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(255, 0, 255, 0.7));
            transition: transform 0.3s ease;
        }

        .cross-tool-card:hover .cross-tool-icon {
            transform: scale(1.2) rotate(10deg);
        }

        .cross-tool-name {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 600;
            color: #ff00ff;
            display: block;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.6);
        }

        .cross-tool-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Gallery Link Button */
        .gallery-link-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 16px 30px;
            margin-top: 15px;
            background: rgba(255, 0, 255, 0.1);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 15px;
            color: #ff00ff;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .gallery-link-btn:hover {
            background: rgba(255, 0, 255, 0.2);
            border-color: rgba(255, 0, 255, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(255, 0, 255, 0.3);
        }

        /* Saved Sigils History */
        .saved-sigils-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
        }

        .saved-sigils-section.has-sigils {
            display: block;
        }

        .saved-sigils-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-gold);
            margin-bottom: 20px;
            text-align: center;
        }

        .saved-sigils-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .saved-sigil-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .saved-sigil-card:hover {
            border-color: rgba(0, 245, 255, 0.5);
            transform: translateY(-3px);
        }

        .saved-sigil-thumbnail {
            width: 100%;
            height: 100px;
            background: radial-gradient(circle, rgba(20, 20, 50, 0.9), rgba(10, 10, 25, 0.95));
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .saved-sigil-info {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Quantum Testimonials Section */
        .testimonials-section {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.1) 0%, rgba(157, 0, 255, 0.1) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 25px;
            padding: 50px 35px;
            margin: 50px 0;
            box-shadow: 0 10px 40px rgba(255, 0, 255, 0.3), inset 0 0 60px rgba(255, 0, 255, 0.05);
        }

        .testimonials-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff00ff, #ff66ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 20px rgba(255, 0, 255, 0.7));
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .testimonial-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 0, 255, 0.3);
            border-radius: 18px;
            padding: 28px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .testimonial-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255, 0, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .testimonial-card:hover {
            border-color: #ff00ff;
            background: rgba(255, 0, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 0, 255, 0.4), inset 0 0 30px rgba(255, 0, 255, 0.1);
        }

        .testimonial-card:hover::before {
            opacity: 1;
        }

        .testimonial-text {
            color: rgba(255, 255, 255, 0.85);
            font-style: italic;
            line-height: 1.7;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .testimonial-author {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 600;
            color: #00f5ff;
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.6);
            position: relative;
            z-index: 1;
        }

        .testimonial-stars {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 12px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.6));
            position: relative;
            z-index: 1;
        }
            margin-bottom: 5px;
        }

        /* ==========================================
           QUANTUM MERLIN INTRO ANIMATION
           ========================================== */
        #intro-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease;
        }

        #intro-container.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        #lines-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .emoji-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .intro-emoji {
            position: absolute;
            font-size: 60px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center;
            will-change: transform, opacity;
            opacity: 0;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        #intro-quantum {
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        #intro-wizard {
            color: #00F0FF;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
        }

        #intro-rose {
            color: #FF0066;
            text-shadow: 0 0 20px rgba(255, 0, 102, 0.8);
        }

        #singularity {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #FFD700, #00F0FF, #FF0066);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            z-index: 3;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        #intro-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 1px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #00F0FF 0%, #FFD700 50%, #FF0066 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            white-space: nowrap;
            opacity: 0;
            z-index: 4;
            letter-spacing: 0.1em;
        }

        #app-content {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #app-content.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- QUANTUM MERLIN INTRO ANIMATION -->
    <div id="intro-container">
        <canvas id="lines-canvas"></canvas>
        
        <div class="emoji-layer">
            <div class="intro-emoji" id="intro-quantum">‚öõÔ∏è</div>
            <div class="intro-emoji" id="intro-wizard">üßô‚Äç‚ôÇÔ∏è</div>
            <div class="intro-emoji" id="intro-rose">üåπ</div>
        </div>

        <div id="singularity"></div>
        <div id="intro-title">QUANTUM MERLIN</div>
    </div>

    <!-- APP CONTENT WRAPPER -->
    <div id="app-content">
    <!-- Quantum Background -->
    <div class="quantum-bg">
        <div class="quantum-grid"></div>
        <div class="energy-orb energy-orb-1"></div>
        <div class="energy-orb energy-orb-2"></div>
        <div class="energy-orb energy-orb-3"></div>
    </div>

    <!-- Starfield -->
    <div class="starfield" id="starfield"></div>

    <!-- Header -->
    <header class="qrc-header">
        <div class="qrc-header-inner">
            <a href="/index.html" class="qrc-logo">
                <div class="qrc-logo-icon">üßô‚Äç‚ôÇÔ∏è</div>
                <div class="qrc-logo-text">
                    Quantum Merlin
                    <span>Mystical Tools & Sacred Frequencies</span>
                </div>
            </a>
            <nav class="qrc-nav-actions">
                <a href="https://buymeacoffee.com/quantummerlin" target="_blank" class="qrc-coffee-btn" style="display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, #FFDD00, #FFA500); color: #000; font-family: 'Orbitron', sans-serif; font-weight: 600; border-radius: 20px; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 221, 0, 0.3);">
                    <span style="font-size: 1.2rem;">‚òï</span>
                    <span>Buy Me a Coffee</span>
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="generator-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>‚ú® Quantum Birth Sigil Generator</h1>
            <p class="subtitle">Create a unique sigil for any date, time, and place based on lunar and stellar alignment</p>
            <div class="header-stats">
                <span class="stat-item">üåç 195+ Countries</span>
                <span class="stat-item">üåü 15,847 Sigils Created</span>
                <span class="stat-item">‚≠ê 4.9/5 Rating</span>
            </div>
        </div>

        <!-- About Section -->
        <section class="about-section">
            <h2>üåü About This Tool</h2>
            <p>
                The <strong>Quantum Birth Sigil Generator</strong> creates a unique visual symbol for any moment in time‚Äîwhether it's your birth, a special anniversary, a wedding date, or any meaningful moment you want to commemorate.
            </p>
            <p>
                Each sigil is generated using <strong>real astronomical data</strong> from that exact date, time, and location: the moon's phase and illumination, the density of visible stars, the celestial quadrant, and time-based geometries. This ensures every sigil is mathematically unique and cosmically accurate.
            </p>
            <p>
                <strong>Perfect for:</strong> Birth dates, wedding anniversaries, memorial dates, tattoo designs, meditation focal points, or as a gift that honors someone's unique cosmic moment.
            </p>
        </section>

        <!-- Generator Section -->
        <section class="generator-section">
            <h2>Create Your Cosmic Sigil</h2>
            <p>Enter your birth details to generate your unique celestial signature</p>
            
            <div class="input-group">
                <label>Birth Date</label>
                <div class="input-row" style="display: flex; gap: 10px; max-width: 360px; margin: 0 auto; justify-content: center;">
                    <input type="number" id="day" min="1" max="31" placeholder="Day" style="width: 70px; text-align: center; flex-shrink: 0;">
                    <select id="month" style="flex: 1; min-width: 100px;">
                        <option value="">Month</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <input type="number" id="year" min="1900" max="2025" placeholder="Year" style="width: 85px; text-align: center; flex-shrink: 0;">
                </div>
            </div>
            
            <div class="input-group">
                <label>Birth Time (optional)</label>
                <div class="input-row" style="display: flex; gap: 8px; max-width: 280px; margin: 0 auto; align-items: center; justify-content: center;">
                    <input type="number" id="hour" min="1" max="12" placeholder="Hr" style="width: 60px; text-align: center; flex-shrink: 0;">
                    <span style="color: var(--text-secondary); font-size: 1.2rem;">:</span>
                    <input type="number" id="minute" min="0" max="59" placeholder="Min" style="width: 60px; text-align: center; flex-shrink: 0;">
                    <select id="ampm" style="width: 75px; flex-shrink: 0;">
                        <option value="AM">AM</option>
                        <option value="PM" selected>PM</option>
                    </select>
                </div>
            </div>
            
            <div class="input-group">
                <label>Location (optional)</label>
                <div id="locationInput" style="max-width: 360px; margin: 0 auto;">
                    <input type="text" id="locationSearch" placeholder="Start typing city name" autocomplete="off" style="width: 100%;">
                    <div id="suggestions"></div>
                </div>
            </div>

            <div class="input-group">
                <label>Sigil Style</label>
                <div class="style-selector">
                    <div class="style-option active" data-style="cosmic" onclick="selectStyle('cosmic')">
                        <div class="icon">üåå</div>
                        <div class="name">Cosmic</div>
                    </div>
                    <div class="style-option" data-style="organic" onclick="selectStyle('organic')">
                        <div class="icon">üåø</div>
                        <div class="name">Organic</div>
                    </div>
                    <div class="style-option" data-style="geometric" onclick="selectStyle('geometric')">
                        <div class="icon">üíé</div>
                        <div class="name">Geometric</div>
                    </div>
                    <div class="style-option" data-style="mystical" onclick="selectStyle('mystical')">
                        <div class="icon">üîÆ</div>
                        <div class="name">Mystical</div>
                    </div>
                </div>
                <input type="hidden" id="style" value="cosmic">
            </div>
            
            <button class="generate-btn" onclick="generateCosmicSigil()">
                ‚ú® Generate Cosmic Sigil
            </button>
            <button id="regenerateBtn" class="regenerate-btn" onclick="regenerateStyle()">
                üîÑ Try Different Style
            </button>
            
            <a href="/birth-sigil-gallery" class="gallery-link-btn" id="galleryLinkBtn" style="display: none;">
                üé® View Your Gallery
            </a>
        </section>

        <!-- Results will be added here dynamically -->
        <section id="sigilDisplay" class="sigil-display" style="display: none;">
            <!-- Sigil canvas and reading will appear here -->
        </section>

        <!-- Education Section -->
        <section class="education-section">
            <h2>üåå About Cosmic Sigils</h2>
            
            <div class="education-grid">
                <div class="education-card">
                    <h3>‚ú® What Are Cosmic Sigils?</h3>
                    <p>Cosmic sigils are personal symbolic marks generated from the exact position of the moon and stars at a specific moment in time. Each sigil is a unique visual representation of the celestial energies present during that moment ‚Äî whether it's your birth, a significant life event, or a moment of intention.</p>
                </div>
                
                <div class="education-card">
                    <h3>üîÆ How They Work</h3>
                    <p>The sigil generation process uses real astronomical data to create a deterministic visual pattern. The moon phase, stellar density, celestial quadrants, and time-based geometries all influence the final design. This ensures that every sigil is both mathematically precise and symbolically meaningful.</p>
                </div>
                
                <div class="education-card">
                    <h3>üí´ Personal Meaning & Use</h3>
                    <p>Your cosmic sigil serves as a focal point for reflection, intention, and personal connection. Many people use their sigils as meditation objects, personal logos, or symbols of significant life moments. The meaning comes from the personal significance you assign to it.</p>
                </div>
                
                <div class="education-card">
                    <h3>üéÅ Gift Sigils</h3>
                    <p>Creating sigils for others is a beautiful way to acknowledge their unique journey. Each gifted sigil represents the universe's configuration at that person's birth moment ‚Äî a truly unique and personal gift that honors their individual place in the cosmos.</p>
                </div>
                
                <div class="education-card">
                    <h3>üåë Lunar Phase</h3>
                    <p>The specific phase of the moon on your date determines the core energy of the sigil. New Moons represent beginnings, while Full Moons amplify power and manifestation.</p>
                </div>
                
                <div class="education-card">
                    <h3>‚ú® Stellar Alignment</h3>
                    <p>The generator calculates the density of visible stars and planetary positions to create the unique constellations and nodes within your sigil's geometry.</p>
                </div>
                
                <div class="education-card">
                    <h3>üìê Sacred Geometry</h3>
                    <p>Time and location data are converted into geometric angles. The intersection of these lines creates a unique "fingerprint" of that specific moment in spacetime.</p>
                </div>
            </div>
        </section>

        <!-- Cross-Tool Suggestions -->
        <section class="cross-tools-section">
            <h2>‚ú® Continue Your Cosmic Journey</h2>
            <p>Enhance your sigil work with these complementary Quantum Merlin tools</p>
            <div class="cross-tools-grid">
                <a href="/sigils" class="cross-tool-card">
                    <div class="cross-tool-icon">üîØ</div>
                    <div class="cross-tool-name">Sigil Creator</div>
                    <div class="cross-tool-desc">Create intention-based sigils from text</div>
                </a>
                <a href="/astrology" class="cross-tool-card">
                    <div class="cross-tool-icon">‚≠ê</div>
                    <div class="cross-tool-name">Astrology</div>
                    <div class="cross-tool-desc">Deep dive into your birth chart</div>
                </a>
                <a href="/angels" class="cross-tool-card">
                    <div class="cross-tool-icon">üëº</div>
                    <div class="cross-tool-name">Angel Numbers</div>
                    <div class="cross-tool-desc">Discover your birth numbers</div>
                </a>
                <a href="/frequencies" class="cross-tool-card">
                    <div class="cross-tool-icon">üéµ</div>
                    <div class="cross-tool-name">Frequencies</div>
                    <div class="cross-tool-desc">Meditate with your sigil</div>
                </a>
                <a href="/tarot" class="cross-tool-card">
                    <div class="cross-tool-icon">üÉè</div>
                    <div class="cross-tool-name">Quantum Tarot</div>
                    <div class="cross-tool-desc">Guidance for using your sigil</div>
                </a>
                <a href="/library" class="cross-tool-card">
                    <div class="cross-tool-icon">üìö</div>
                    <div class="cross-tool-name">My Library</div>
                    <div class="cross-tool-desc">View all your saved sigils</div>
                </a>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials-section">
            <h2>üí´ What People Are Saying</h2>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"The level of detail is incredible! Seeing my birth moon phase and star alignment visualized was profound. I use my sigil in daily meditation now."</p>
                    <div class="testimonial-author">‚Äî Sarah M.</div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"I've generated sigils for my entire family. Each one is unique and meaningful. The geometric style is my favorite‚Äîit's like pure mathematical art."</p>
                    <div class="testimonial-author">‚Äî David L.</div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="testimonial-text">"As someone interested in astrology and sacred geometry, this tool is perfect. The fact that it uses real astronomical data makes it even more special."</p>
                    <div class="testimonial-author">‚Äî Amara K.</div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>Quantum Merlin</h4>
                    <p>Bridging ancient wisdom with quantum possibilities through sacred frequencies and mystical tools.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <div class="footer-links-grid">
                        <a href="/frequencies">üéµ Frequencies</a>
                        <a href="/codes">üîÆ Reality Codes</a>
                        <a href="/tarot">üÉè Tarot</a>
                        <a href="/gematria">üî¢ Gematria</a>
                        <a href="/sigils">üîØ Sigil Creator</a>
                        <a href="/birth-sigil">üåô Birth Sigil</a>
                        <a href="/astrology">‚≠ê Astrology</a>
                        <a href="/chinese-zodiac">üêâ Chinese Zodiac</a>
                        <a href="/crystals">üíé Crystals</a>
                        <a href="/water">üíß Water Charging</a>
                        <a href="/forecasts">üåå Forecasts</a>
                        <a href="/angels">üëº Angel Numbers</a>
                        <a href="/library">üìö My Library</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="https://buymeacoffee.com/quantummerlin" target="_blank">Buy Me a Coffee</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Quantum Merlin. For entertainment and spiritual exploration.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->

    
    <script>
        // ==========================================
        // PART 1: Core Variables & Initialization
        // ==========================================
        
        let selectedLocation = null;
        let searchTimeout = null;
        let currentSigilData = null;
        
        // Scroll to top on page load
        window.addEventListener('load', function() {
            window.scrollTo({ top: 0, behavior: 'instant' });
            // Reset navigation state
            const dropdown = document.getElementById('navDropdown');
            const toggle = document.querySelector('.qrc-nav-toggle');
            dropdown?.classList.remove('active');
            toggle?.classList.remove('active');
        });

        // Also scroll to top on page show (back button)
        window.addEventListener('pageshow', function(event) {
            window.scrollTo({ top: 0, behavior: 'instant' });
            // Reset navigation state
            const dropdown = document.getElementById('navDropdown');
            const toggle = document.querySelector('.qrc-nav-toggle');
            dropdown?.classList.remove('active');
            toggle?.classList.remove('active');
        });

        // Navigation toggle
        function toggleNav() {
            const dropdown = document.getElementById('navDropdown');
            const toggle = document.querySelector('.qrc-nav-toggle');
            dropdown.classList.toggle('active');
            toggle.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const navMenu = document.querySelector('.qrc-nav-menu');
            const dropdown = document.getElementById('navDropdown');
            const toggle = document.querySelector('.qrc-nav-toggle');
            
            if (navMenu && !navMenu.contains(event.target)) {
                dropdown?.classList.remove('active');
                toggle?.classList.remove('active');
            }
        });

        // Style selector
        function selectStyle(style) {
            console.log('selectStyle called with:', style);
            document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('active'));
            const selected = document.querySelector(`[data-style="${style}"]`);
            if (selected) selected.classList.add('active');
            const styleInput = document.getElementById('style');
            if (styleInput) styleInput.value = style;
            console.log('Style changed to:', style);
        }

        // Create starfield background
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            if (!starfield) return;
            
            const starCount = 80;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.cssText = `
                    position: absolute;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    width: ${Math.random() * 3 + 1}px;
                    height: ${Math.random() * 3 + 1}px;
                    background: white;
                    border-radius: 50%;
                    opacity: ${Math.random() * 0.8 + 0.2};
                    animation: twinkle ${Math.random() * 3 + 2}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 3}s;
                `;
                starfield.appendChild(star);
            }
            
            // Add twinkle animation
            if (!document.getElementById('twinkleStyle')) {
                const style = document.createElement('style');
                style.id = 'twinkleStyle';
                style.textContent = `
                    .starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
                    @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
                `;
                document.head.appendChild(style);
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 4000);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded fired');
            createStarfield();
            initLocationSearch();
            checkGalleryExists();
            loadSavedSigils();
            
            // Auto-fill form with saved profile data
            if (window.QuantumMerlinProfile) {
                const personal = QuantumMerlinProfile.getPersonalInfo();
                
                // Auto-fill birth date if available
                if (personal.birthDate) {
                    const dateParts = personal.birthDate.split('-');
                    if (dateParts.length === 3) {
                        const yearInput = document.getElementById('year');
                        const monthInput = document.getElementById('month');
                        const dayInput = document.getElementById('day');
                        
                        if (yearInput && !yearInput.value) yearInput.value = dateParts[0];
                        if (monthInput && !monthInput.value) monthInput.value = parseInt(dateParts[1]);
                        if (dayInput && !dayInput.value) dayInput.value = parseInt(dateParts[2]);
                    }
                }
                
                // Auto-fill birth time if available
                if (personal.birthTime) {
                    const timeParts = personal.birthTime.split(':');
                    if (timeParts.length === 2) {
                        let hour = parseInt(timeParts[0]);
                        const minute = timeParts[1];
                        
                        const hourInput = document.getElementById('hour');
                        const minuteInput = document.getElementById('minute');
                        const ampmSelect = document.getElementById('ampm');
                        
                        // Convert 24-hour to 12-hour format
                        let ampm = 'AM';
                        if (hour >= 12) {
                            ampm = 'PM';
                            if (hour > 12) hour -= 12;
                        }
                        if (hour === 0) hour = 12;
                        
                        if (hourInput && !hourInput.value) hourInput.value = hour;
                        if (minuteInput && !minuteInput.value) minuteInput.value = minute;
                        if (ampmSelect && !ampmSelect.value) ampmSelect.value = ampm;
                    }
                }
                
                // Auto-fill location if available
                if (personal.birthPlace && personal.latitude && personal.longitude) {
                    selectedLocation = {
                        city: personal.birthPlace,
                        lat: personal.latitude,
                        lon: personal.longitude
                    };
                    const locationInput = document.getElementById('locationSearchInput');
                    if (locationInput && !locationInput.value) {
                        locationInput.value = personal.birthPlace;
                    }
                }
                
                console.log('‚ú® Auto-filled form with saved profile data');
            }
            
            // Check if loading sigil from gallery page
            const loadIndex = sessionStorage.getItem('loadSigilIndex');
            if (loadIndex !== null) {
                sessionStorage.removeItem('loadSigilIndex');
                setTimeout(() => loadGallerySigil(parseInt(loadIndex)), 500);
            }
            
            const dayInput = document.getElementById('day');
            if (dayInput) dayInput.focus();
            console.log('Initialization complete');
        });

        // Check if gallery has sigils and show button
        function checkGalleryExists() {
            const gallery = JSON.parse(localStorage.getItem('sigilGallery') || '[]');
            const galleryBtn = document.getElementById('galleryLinkBtn');
            if (galleryBtn) {
                galleryBtn.style.display = gallery.length > 0 ? 'inline-flex' : 'none';
            }
        }
        function saveToGallery(sigilData) {
            const gallery = JSON.parse(localStorage.getItem('sigilGallery') || '[]');
            gallery.push({
                dateTime: sigilData.dateTime.toISOString(),
                location: sigilData.location,
                moonPhase: sigilData.moonPhase,
                starDensity: sigilData.starDensity,
                quadrant: sigilData.quadrant,
                style: sigilData.style,
                timestamp: new Date().toISOString()
            });
            if (gallery.length > 50) gallery.shift();
            localStorage.setItem('sigilGallery', JSON.stringify(gallery));
            checkGalleryExists();
        }
        
        function loadGallerySigil(index) {
            const gallery = JSON.parse(localStorage.getItem('sigilGallery') || '[]');
            const item = gallery[index];
            if (!item) return;
            
            const birthDateTime = new Date(item.dateTime);
            currentSigilData = {
                dateTime: birthDateTime,
                location: item.location,
                moonPhase: item.moonPhase,
                moonInfo: getMoonPhaseInfo(item.moonPhase),
                starDensity: item.starDensity,
                quadrant: item.quadrant,
                style: item.style
            };
            selectedLocation = item.location;
            buildResultsDisplay();
            drawCosmicSigil(item.moonPhase, item.starDensity, item.quadrant, item.style, birthDateTime);
            displayAstronomicalData(currentSigilData.dateTime, currentSigilData.moonInfo, item.starDensity, item.quadrant, item.location);
            displayReading(currentSigilData.dateTime, currentSigilData.moonInfo, item.starDensity, item.quadrant, item.location);
            
            const display = document.getElementById('sigilDisplay');
            display.style.display = 'block';
            setTimeout(() => display.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
            showNotification('‚ú® Sigil loaded from gallery!', 'success');
        }

        // ==========================================
        // PART 2: Location Search & Autocomplete
        // ==========================================
        
        function initLocationSearch() {
            console.log('initLocationSearch called');
            const searchInput = document.getElementById('locationSearch');
            const suggestionsDiv = document.getElementById('suggestions');
            
            if (!searchInput || !suggestionsDiv) {
                console.error('Location search elements not found');
                return;
            }
            
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value;
                
                if (query.length < 2) {
                    suggestionsDiv.innerHTML = '';
                    suggestionsDiv.classList.remove('active');
                    return;
                }
                
                // Debounce API calls
                if (searchTimeout) clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => searchLocations(query), 400);
            });

            // Hide suggestions on outside click
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#locationInput')) {
                    suggestionsDiv.innerHTML = '';
                    suggestionsDiv.classList.remove('active');
                }
            });

            // Enter key support
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const firstSuggestion = suggestionsDiv.querySelector('.suggestion-item');
                    if (firstSuggestion) firstSuggestion.click();
                }
            });
        }

        async function searchLocations(query) {
            const suggestionsDiv = document.getElementById('suggestions');
            
            try {
                // Case-insensitive search - convert to lowercase
                const searchQuery = query.toLowerCase();
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&limit=20&addressdetails=1`,
                    {
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'QuantumMerlinSigilGenerator/1.0'
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const locations = await response.json();
                
                // Filter to exclude streets and buildings, but allow cities, towns, states, countries
                const filteredLocations = locations.filter(loc => {
                    const type = loc.type;
                    const addressType = loc.addresstype;
                    const placeType = loc.class;
                    
                    // Exclude specific unwanted types
                    const excludeTypes = ['road', 'highway', 'building', 'house', 'residential'];
                    if (excludeTypes.includes(type) || excludeTypes.includes(addressType)) {
                        return false;
                    }
                    
                    // Include place-related results
                    return placeType === 'place' || placeType === 'boundary' || 
                           type === 'city' || type === 'town' || type === 'village' || 
                           type === 'state' || type === 'administrative';
                });
                
                // If no results after filtering, show all results (user can pick)
                displaySuggestions(filteredLocations.length > 0 ? filteredLocations : locations.slice(0, 10));
            } catch (error) {
                console.error('Location search error:', error);
                displayFallbackSuggestions(query);
            }
        }

        function displaySuggestions(locations) {
            const suggestionsDiv = document.getElementById('suggestions');
            
            if (locations.length === 0) {
                suggestionsDiv.innerHTML = '<div class="suggestion-item">No locations found</div>';
                suggestionsDiv.classList.add('active');
                return;
            }
            
            suggestionsDiv.innerHTML = locations.map(loc => 
                `<div class="suggestion-item" onclick="selectLocation('${loc.display_name.replace(/'/g, "\\'")}', ${loc.lat}, ${loc.lon})">
                    üìç ${loc.display_name}
                </div>`
            ).join('');
            suggestionsDiv.classList.add('active');
        }

        function displayFallbackSuggestions(query) {
            const cities = [
                { name: 'Abu Dhabi, UAE', lat: 24.4539, lon: 54.3773 },
                { name: 'Dubai, UAE', lat: 25.2048, lon: 55.2708 },
                { name: 'New York, USA', lat: 40.7128, lon: -74.0060 },
                { name: 'London, UK', lat: 51.5074, lon: -0.1278 },
                { name: 'Tokyo, Japan', lat: 35.6762, lon: 139.6503 },
                { name: 'Paris, France', lat: 48.8566, lon: 2.3522 },
                { name: 'Sydney, Australia', lat: -33.8688, lon: 151.2093 },
                { name: 'Singapore', lat: 1.3521, lon: 103.8198 },
                { name: 'Mumbai, India', lat: 19.0760, lon: 72.8777 },
                { name: 'Los Angeles, USA', lat: 34.0522, lon: -118.2437 },
                { name: 'Berlin, Germany', lat: 52.5200, lon: 13.4050 }
            ];
            
            const filtered = cities.filter(city => 
                city.name.toLowerCase().includes(query.toLowerCase())
            );
            
            const suggestionsDiv = document.getElementById('suggestions');
            if (filtered.length > 0) {
                suggestionsDiv.innerHTML = filtered.map(city => 
                    `<div class="suggestion-item" onclick="selectLocation('${city.name}', ${city.lat}, ${city.lon})">
                        üìç ${city.name}
                    </div>`
                ).join('');
            } else {
                suggestionsDiv.innerHTML = '<div class="suggestion-item">Type more to search...</div>';
            }
            suggestionsDiv.classList.add('active');
        }

        function selectLocation(displayName, lat, lon) {
            selectedLocation = {
                city: displayName.split(',')[0],
                displayName: displayName,
                lat: parseFloat(lat),
                lon: parseFloat(lon)
            };
            
            document.getElementById('locationSearch').value = displayName;
            document.getElementById('suggestions').innerHTML = '';
            document.getElementById('suggestions').classList.remove('active');
            
            showNotification(`üìç Location set: ${selectedLocation.city}`, 'success');
        }

        // ==========================================
        // PART 3: Astronomical Calculations
        // ==========================================
        
        function calculateJulianDate(date) {
            const a = Math.floor((14 - (date.getMonth() + 1)) / 12);
            const y = date.getFullYear() + 4800 - a;
            const m = (date.getMonth() + 1) + 12 * a - 3;
            
            return date.getDate() + Math.floor((153 * m + 2) / 5) + 365 * y + 
                   Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045 +
                   (date.getHours() - 12) / 24 + date.getMinutes() / 1440 + date.getSeconds() / 86400;
        }

        function calculateMoonPhase(date) {
            const jd = calculateJulianDate(date);
            
            // More accurate moon phase calculation using multiple known new moons
            // Using J2000.0 epoch: Jan 6, 2000, 18:14 UTC
            const knownNewMoon = 2451550.1;
            const synodicMonth = 29.53058867; // More precise value
            
            // Calculate days since known new moon
            let daysSinceNew = jd - knownNewMoon;
            
            // Normalize to current lunation
            const lunations = Math.floor(daysSinceNew / synodicMonth);
            const moonAge = daysSinceNew - (lunations * synodicMonth);
            
            // Ensure positive value
            const normalizedAge = ((moonAge % synodicMonth) + synodicMonth) % synodicMonth;
            
            // Calculate phase (0 to 1)
            const phase = normalizedAge / synodicMonth;
            
            // Convert to 8 phases (0-7)
            // 0: New Moon (0-0.0625), 1: Waxing Crescent (0.0625-0.25)
            // 2: First Quarter (0.25-0.375), 3: Waxing Gibbous (0.375-0.5)
            // 4: Full Moon (0.5-0.625), 5: Waning Gibbous (0.625-0.75)
            // 6: Last Quarter (0.75-0.875), 7: Waning Crescent (0.875-1.0)
            return Math.floor(phase * 8) % 8;
        }

        function calculateMoonIllumination(date) {
            const jd = calculateJulianDate(date);
            // Using more accurate known new moon reference
            const knownNewMoon = 2451550.1;
            const synodicMonth = 29.53058867;
            
            // Calculate days since known new moon
            let daysSinceNew = jd - knownNewMoon;
            
            // Normalize to current lunation
            const lunations = Math.floor(daysSinceNew / synodicMonth);
            const moonAge = daysSinceNew - (lunations * synodicMonth);
            
            // Ensure positive value
            const normalizedAge = ((moonAge % synodicMonth) + synodicMonth) % synodicMonth;
            
            // Calculate phase (0 to 1)
            const phase = normalizedAge / synodicMonth;
            
            // Calculate illumination percentage
            // Phase 0 = New (0%), 0.25 = First Quarter (50%), 0.5 = Full (100%), 0.75 = Last Quarter (50%)
            const illumination = (1 - Math.cos(2 * Math.PI * phase)) / 2;
            
            return Math.round(illumination * 100);
        }

        function calculateLocalSiderealTime(date, longitude) {
            const jd = calculateJulianDate(date);
            const jd0 = Math.floor(jd - 0.5) + 0.5;
            
            const T = (jd0 - 2451545.0) / 36525;
            const theta0 = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 
                          0.000387933 * T * T - T * T * T / 38710000;
            
            let lst = (theta0 + longitude) % 360;
            if (lst < 0) lst += 360;
            
            return lst / 15; // Convert to hours
        }

        function calculateSunAltitude(date, location) {
            const jd = calculateJulianDate(date);
            const n = jd - 2451545.0;
            
            const L = (280.460 + 0.9856474 * n) % 360;
            const g = (357.528 + 0.9856003 * n) % 360;
            let lambda = L + 1.915 * Math.sin(g * Math.PI / 180) + 
                       0.020 * Math.sin(2 * g * Math.PI / 180);
            
            const epsilon = 23.439 - 0.0000004 * n;
            const delta = Math.asin(Math.sin(epsilon * Math.PI / 180) * 
                                   Math.sin(lambda * Math.PI / 180)) * 180 / Math.PI;
            
            const hourAngle = (date.getHours() + date.getMinutes() / 60) * 15 - 180;
            
            const altitude = Math.asin(
                Math.sin(location.lat * Math.PI / 180) * Math.sin(delta * Math.PI / 180) +
                Math.cos(location.lat * Math.PI / 180) * Math.cos(delta * Math.PI / 180) * 
                Math.cos(hourAngle * Math.PI / 180)
            ) * 180 / Math.PI;
            
            return altitude;
        }

        function calculateStarDensity(date, location) {
            const hour = date.getHours();
            const month = date.getMonth() + 1;
            const lat = Math.abs(location.lat);
            
            const latitudeFactor = Math.cos(lat * Math.PI / 180);
            let baseDensity = 4 + latitudeFactor * 2;
            
            const isNorthernHemisphere = location.lat > 0;
            const isWinter = (month >= 11 || month <= 2);
            if (isNorthernHemisphere && isWinter) baseDensity += 1;
            if (!isNorthernHemisphere && (month >= 5 && month <= 8)) baseDensity += 1;
            
            let timeFactor = 1;
            if (hour >= 6 && hour <= 18) {
                timeFactor = 0.3;
            } else if (hour >= 20 || hour <= 4) {
                timeFactor = 1.2;
            }
            
            const moonIllumination = calculateMoonIllumination(date);
            const moonFactor = 1 - (moonIllumination / 200);
            
            const finalDensity = baseDensity * timeFactor * moonFactor;
            return Math.max(1, Math.min(8, Math.round(finalDensity)));
        }

        function calculateCelestialQuadrant(date, location) {
            const lst = calculateLocalSiderealTime(date, location.lon);
            const quadrant = Math.floor(lst / 6) % 4;
            const isSouthernHemisphere = location.lat < 0;
            
            switch(quadrant) {
                case 0: return isSouthernHemisphere ? 'south' : 'north';
                case 1: return isSouthernHemisphere ? 'west' : 'east';
                case 2: return isSouthernHemisphere ? 'north' : 'south';
                case 3: return isSouthernHemisphere ? 'east' : 'west';
                default: return 'north';
            }
        }

        function getMoonPhaseInfo(phase) {
            const phases = [
                { name: 'New Moon', age: 0, meaning: 'New beginnings and fresh starts', icon: 'üåë' },
                { name: 'Waxing Crescent', age: 1, meaning: 'Growth and intention setting', icon: 'üåí' },
                { name: 'First Quarter', age: 2, meaning: 'Action and decision making', icon: 'üåì' },
                { name: 'Waxing Gibbous', age: 3, meaning: 'Refinement and adjustment', icon: 'üåî' },
                { name: 'Full Moon', age: 4, meaning: 'Culmination and illumination', icon: 'üåï' },
                { name: 'Waning Gibbous', age: 5, meaning: 'Gratitude and sharing', icon: 'üåñ' },
                { name: 'Last Quarter', age: 6, meaning: 'Release and letting go', icon: 'üåó' },
                { name: 'Waning Crescent', age: 7, meaning: 'Rest and reflection', icon: 'üåò' }
            ];
            return phases[phase] || phases[0];
        }

        function getQuadrantInfo(quadrant) {
            const info = {
                north: { meaning: 'Wisdom, intuition, and spiritual guidance', icon: '‚¨ÜÔ∏è' },
                east: { meaning: 'New beginnings, opportunities, and growth', icon: '‚û°Ô∏è' },
                south: { meaning: 'Passion, creativity, and emotional expression', icon: '‚¨áÔ∏è' },
                west: { meaning: 'Completion, transformation, and inner wisdom', icon: '‚¨ÖÔ∏è' }
            };
            return info[quadrant] || info.north;
        }

        // ==========================================
        // PART 4: Main Generation & Display
        // ==========================================
        
        function generateCosmicSigil() {
            console.log('generateCosmicSigil called');
            // Get form inputs
            const day = document.getElementById('day').value;
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            console.log('Date inputs:', { day, month, year });
            let hour = parseInt(document.getElementById('hour').value) || 12;
            const minute = document.getElementById('minute').value || 0;
            const ampm = document.getElementById('ampm').value;
            const style = document.getElementById('style').value;
            
            // Convert 12-hour to 24-hour format
            if (ampm === 'AM' && hour === 12) {
                hour = 0;
            } else if (ampm === 'PM' && hour !== 12) {
                hour += 12;
            }
            
            // Validate inputs
            if (!day || !month || !year) {
                showNotification('Please enter your complete birth date', 'error');
                return;
            }
            
            // Save user's birth data to profile for cross-tool usage
            if (window.QuantumMerlinProfile) {
                const birthDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const birthTime = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                
                QuantumMerlinProfile.updateProfile({
                    personal: {
                        birthDate: birthDate,
                        birthTime: birthTime,
                        birthPlace: selectedLocation ? selectedLocation.city : 'London, UK',
                        latitude: selectedLocation ? selectedLocation.lat : 51.5074,
                        longitude: selectedLocation ? selectedLocation.lon : -0.1278
                    }
                });
                console.log('‚ú® Birth data saved to profile for cross-tool usage');
            }
            
            // Use default location if none selected (London, UK)
            const location = selectedLocation || {
                city: 'London, UK',
                lat: 51.5074,
                lon: -0.1278
            };
            
            // Create date object
            const birthDateTime = new Date(year, month - 1, day, hour, minute);
            
            if (isNaN(birthDateTime.getTime())) {
                showNotification('Please enter a valid date', 'error');
                return;
            }
            
            // Track analytics
            if (window.trackEvent) {
                trackEvent('birth_sigil', 'generate', location.city);
            }
            
            // Calculate astronomical data
            const moonPhase = calculateMoonPhase(birthDateTime);
            const moonInfo = getMoonPhaseInfo(moonPhase);
            const starDensity = calculateStarDensity(birthDateTime, location);
            const quadrant = calculateCelestialQuadrant(birthDateTime, location);
            
            // Store data
            currentSigilData = {
                dateTime: birthDateTime,
                location: location,
                moonPhase,
                moonInfo,
                starDensity,
                quadrant,
                style
            };
            
            // Build results display
            buildResultsDisplay();
            
            // Draw sigil with birth datetime for unique seed generation
            drawCosmicSigil(moonPhase, starDensity, quadrant, style, birthDateTime);
            
            // Display astronomical data
            displayAstronomicalData(birthDateTime, moonInfo, starDensity, quadrant, location);
            
            // Display reading
            displayReading(birthDateTime, moonInfo, starDensity, quadrant, location);
            
            // Show results
            const display = document.getElementById('sigilDisplay');
            display.style.display = 'block';
            document.getElementById('regenerateBtn').style.display = 'block';
            
            // Save to gallery
            saveToGallery(currentSigilData);
            
            // Scroll to results
            setTimeout(() => {
                display.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            
            showNotification('‚ú® Your cosmic sigil has been generated!', 'success');
        }

        function buildResultsDisplay() {
            const display = document.getElementById('sigilDisplay');
            display.innerHTML = `
                <style>
                    .sigil-display {
                        background: var(--glass-bg);
                        backdrop-filter: blur(20px);
                        border: 1px solid var(--glass-border);
                        border-radius: 20px;
                        padding: 30px;
                        margin-bottom: 30px;
                        text-align: center;
                    }
                    
                    .sigil-display h2 {
                        font-family: 'Orbitron', monospace;
                        font-size: 1.5rem;
                        color: var(--neon-gold);
                        margin-bottom: 20px;
                    }
                    
                    #sigilCanvas {
                        max-width: 100%;
                        width: 400px;
                        height: 400px;
                        display: block;
                        margin: 0 auto;
                        border-radius: 15px;
                        background: radial-gradient(circle at center, rgba(20, 20, 40, 0.9), rgba(10, 10, 20, 0.95));
                        box-shadow: 0 0 40px rgba(0, 245, 255, 0.2);
                    }
                    
                    @media (max-width: 480px) {
                        #sigilCanvas {
                            width: 100%;
                            height: auto;
                            aspect-ratio: 1;
                        }
                    }
                    
                    .action-buttons {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 10px;
                        justify-content: center;
                        margin-top: 25px;
                    }
                    
                    .action-btn {
                        padding: 12px 20px;
                        background: rgba(0, 245, 255, 0.1);
                        border: 1px solid rgba(0, 245, 255, 0.3);
                        border-radius: 10px;
                        color: var(--neon-cyan);
                        font-family: 'Exo 2', sans-serif;
                        font-size: 0.9rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .action-btn:hover {
                        background: rgba(0, 245, 255, 0.2);
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0, 245, 255, 0.3);
                    }
                    
                    .data-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                        margin: 25px auto;
                        max-width: 800px;
                    }
                    
                    .data-item {
                        background: rgba(0, 0, 0, 0.3);
                        border: 1px solid rgba(255, 215, 0, 0.2);
                        border-radius: 12px;
                        padding: 15px;
                        text-align: center;
                    }
                    
                    .data-icon {
                        font-size: 1.5rem;
                        display: block;
                        margin-bottom: 8px;
                    }
                    
                    .data-label {
                        font-size: 0.75rem;
                        color: var(--text-muted);
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        margin-bottom: 5px;
                    }
                    
                    .data-value {
                        font-family: 'Orbitron', monospace;
                        font-size: 1rem;
                        color: var(--neon-gold);
                    }
                    
                    .data-detail {
                        font-size: 0.75rem;
                        color: var(--text-secondary);
                        margin-top: 3px;
                    }
                    
                    .reading-section {
                        background: rgba(0, 0, 0, 0.3);
                        border: 1px solid rgba(157, 0, 255, 0.3);
                        border-radius: 15px;
                        padding: 15px 10px;
                        margin-top: 20px;
                        text-align: left;
                        width: 100%;
                        box-sizing: border-box;
                    }
                    
                    .reading-section h3 {
                        font-family: 'Orbitron', monospace;
                        color: var(--neon-purple);
                        margin-bottom: 15px;
                        font-size: 1.2rem;
                    }
                    
                    .reading-section p {
                        margin-bottom: 12px;
                        line-height: 1.7;
                        color: var(--text-secondary);
                    }
                    
                    .reading-section strong {
                        color: var(--neon-cyan);
                    }
                    
                    .education-section {
                        background: var(--glass-bg);
                        backdrop-filter: blur(20px);
                        border: 1px solid var(--glass-border);
                        border-radius: 20px;
                        padding: 30px;
                        margin-top: 30px;
                        text-align: left;
                    }
                    
                    .education-section h2 {
                        font-family: 'Orbitron', monospace;
                        color: var(--neon-gold);
                        margin-bottom: 20px;
                        text-align: center;
                    }
                    
                    .education-section p {
                        margin-bottom: 15px;
                        line-height: 1.7;
                        color: var(--text-secondary);
                    }
                    
                    .education-section strong {
                        color: var(--neon-cyan);
                    }
                </style>
                
                <h2>‚ú® Your Cosmic Sigil</h2>
                <canvas id="sigilCanvas" width="400" height="400"></canvas>
                
                <div class="action-buttons">
                    <button class="action-btn" onclick="replayAnimation()" title="Replay the generation animation">üîÑ Replay</button>
                    <button class="action-btn" onclick="saveSigil()">üíæ Save Sigil</button>
                    <button class="action-btn" onclick="saveSigilHighRes()" title="Export 2000x2000 high resolution">üñºÔ∏è High-Res</button>
                    <button class="action-btn" onclick="saveToJukebox()">üìö Add to Library</button>
                    <button class="action-btn" onclick="shareSocial()">üì§ Share</button>
                    <button class="action-btn" onclick="generateNew()">‚ú® Create Another</button>
                </div>
                
                <div id="astronomicalData"></div>
                <div id="readingContent" class="reading-section" style="display: none;"></div>
            `;
        }

        function displayAstronomicalData(dateTime, moonInfo, starDensity, quadrant, location) {
            const container = document.getElementById('astronomicalData');
            const moonIllumination = calculateMoonIllumination(dateTime);
            const lst = calculateLocalSiderealTime(dateTime, location.lon);
            const sunAltitude = calculateSunAltitude(dateTime, location);
            const isDaytime = sunAltitude > 0;
            const quadrantInfo = getQuadrantInfo(quadrant);
            
            container.innerHTML = `
                <div class="data-grid">
                    <div class="data-item">
                        <span class="data-icon">üåç</span>
                        <div class="data-label">Location</div>
                        <div class="data-value">${location.city}</div>
                        <div class="data-detail">${location.lat.toFixed(2)}¬∞, ${location.lon.toFixed(2)}¬∞</div>
                    </div>
                    <div class="data-item">
                        <span class="data-icon">${moonInfo.icon}</span>
                        <div class="data-label">Moon Phase</div>
                        <div class="data-value">${moonInfo.name}</div>
                        <div class="data-detail">${moonIllumination}% illuminated</div>
                    </div>
                    <div class="data-item">
                        <span class="data-icon">‚≠ê</span>
                        <div class="data-label">Star Density</div>
                        <div class="data-value">${starDensity}/8</div>
                        <div class="data-detail">${starDensity > 5 ? 'High visibility' : 'Focused view'}</div>
                    </div>
                    <div class="data-item">
                        <span class="data-icon">${quadrantInfo.icon}</span>
                        <div class="data-label">Celestial Quadrant</div>
                        <div class="data-value">${quadrant.charAt(0).toUpperCase() + quadrant.slice(1)}</div>
                        <div class="data-detail">${quadrantInfo.meaning.split(',')[0]}</div>
                    </div>
                    <div class="data-item">
                        <span class="data-icon">${isDaytime ? '‚òÄÔ∏è' : 'üåô'}</span>
                        <div class="data-label">Birth Time</div>
                        <div class="data-value">${isDaytime ? 'Daytime' : 'Nighttime'}</div>
                        <div class="data-detail">Sun alt: ${sunAltitude.toFixed(1)}¬∞</div>
                    </div>
                    <div class="data-item">
                        <span class="data-icon">üïê</span>
                        <div class="data-label">Sidereal Time</div>
                        <div class="data-value">${lst.toFixed(2)}h</div>
                        <div class="data-detail">Star clock position</div>
                    </div>
                </div>
            `;
        }

        function displayReading(dateTime, moonInfo, starDensity, quadrant, location) {
            const readingContent = document.getElementById('readingContent');
            const quadrantInfo = getQuadrantInfo(quadrant);
            const dateStr = dateTime.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = dateTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const dayOfWeek = dateTime.toLocaleDateString('en-US', { weekday: 'long' });
            
            // Calculate additional cosmic data
            const moonIllumination = calculateMoonIllumination(dateTime);
            const sunAltitude = calculateSunAltitude(dateTime, location);
            const isDaytime = sunAltitude > 0;
            const lst = calculateLocalSiderealTime(dateTime, location.lon);
            
            // NEW: Get zodiac sign and related data
            const birthMonth = dateTime.getMonth() + 1;
            const birthDay = dateTime.getDate();
            const zodiac = getZodiacSign(birthMonth, birthDay);
            const constellation = getZodiacConstellation(zodiac.name);
            const personalYear = getPersonalYear(birthMonth, birthDay);
            const personalYearInfo = getPersonalYearMeaning(personalYear);
            const elementalDom = getElementalDominance(zodiac.element, moonInfo.age, quadrant);
            
            // Determine cosmic archetype based on moon phase and star density
            const archetypes = [
                { name: 'The Seeker', desc: 'Beginning a new cycle of discovery' },
                { name: 'The Builder', desc: 'Laying foundations for growth' },
                { name: 'The Warrior', desc: 'Taking decisive action' },
                { name: 'The Nurturer', desc: 'Cultivating what you have planted' },
                { name: 'The Illuminator', desc: 'Shining light on truth' },
                { name: 'The Teacher', desc: 'Sharing wisdom with others' },
                { name: 'The Alchemist', desc: 'Transforming challenges into gold' },
                { name: 'The Mystic', desc: 'Accessing ancient wisdom' }
            ];
            const archetype = archetypes[moonInfo.age] || archetypes[0];
            
            // Determine energy signature
            const energyLevel = starDensity > 5 ? 'Expansive' : 'Concentrated';
            const energyType = isDaytime ? 'Solar (External)' : 'Lunar (Internal)';
            
            // Generate unique record ID
            const recordId = dateTime.getFullYear().toString() + 
                           (dateTime.getMonth() + 1).toString().padStart(2, '0') +
                           dateTime.getDate().toString().padStart(2, '0') +
                           '-' + location.city.substring(0, 3).toUpperCase();
            
            // Get style-specific sigil explanation
            const style = currentSigilData?.style || 'cosmic';
            const sigilExplanations = {
                cosmic: {
                    geometry: 'Orbital rings and stellar nodes',
                    meaning: 'Your energy radiates outward like celestial bodies in orbit, influencing all within your gravitational field.',
                    element: 'Ether/Space'
                },
                organic: {
                    geometry: 'Flowing spirals and natural curves',
                    meaning: 'Your energy grows and adapts like living systems, finding paths of least resistance toward your goals.',
                    element: 'Water/Growth'
                },
                geometric: {
                    geometry: 'Sacred polygons and precise angles',
                    meaning: 'Your energy operates through structure and pattern, creating order from chaos through mathematical harmony.',
                    element: 'Earth/Foundation'
                },
                mystical: {
                    geometry: 'Pentagonal forms and crescent arcs',
                    meaning: 'Your energy bridges the seen and unseen worlds, channeling ancient wisdom into present action.',
                    element: 'Spirit/Mystery'
                }
            };
            const sigilInfo = sigilExplanations[style] || sigilExplanations.cosmic;
            
            // Generate mantra based on moon phase and quadrant
            const mantras = {
                'new moon-north': 'I plant seeds of wisdom in the darkness, knowing they will bloom.',
                'new moon-east': 'I embrace the void as the birthplace of all creation.',
                'new moon-south': 'In stillness, I discover the fire within.',
                'new moon-west': 'I release the old to make space for transformation.',
                'waxing crescent-north': 'I nurture my vision with patience and trust.',
                'waxing crescent-east': 'Each small step carries me toward my destiny.',
                'waxing crescent-south': 'My intentions grow stronger with each breath.',
                'waxing crescent-west': 'I build upon the wisdom of those who came before.',
                'first quarter-north': 'I take action guided by inner knowing.',
                'first quarter-east': 'Challenges are doorways to my greatest growth.',
                'first quarter-south': 'My passion fuels decisive movement forward.',
                'first quarter-west': 'I honor both action and reflection.',
                'waxing gibbous-north': 'I refine my path with wisdom and precision.',
                'waxing gibbous-east': 'Patience and persistence are my allies.',
                'waxing gibbous-south': 'My light grows as I align with my purpose.',
                'waxing gibbous-west': 'I trust the process of becoming.',
                'full moon-north': 'I stand in my full power, illuminated by truth.',
                'full moon-east': 'All that I have cultivated now comes to fruition.',
                'full moon-south': 'I celebrate the fullness of my journey.',
                'full moon-west': 'I release what no longer serves my highest good.',
                'waning gibbous-north': 'I share my gifts freely with the world.',
                'waning gibbous-east': 'Gratitude multiplies my blessings.',
                'waning gibbous-south': 'I integrate the lessons of my experience.',
                'waning gibbous-west': 'Wisdom flows through me like water.',
                'last quarter-north': 'I release with grace and trust.',
                'last quarter-east': 'Letting go creates space for miracles.',
                'last quarter-south': 'I honor the completion of this cycle.',
                'last quarter-west': 'I prepare the soil for new beginnings.',
                'waning crescent-north': 'I rest in the wisdom of the void.',
                'waning crescent-east': 'In surrender, I find my greatest strength.',
                'waning crescent-south': 'I trust the darkness before the dawn.',
                'waning crescent-west': 'I am the silence between breaths.'
            };
            const mantraKey = moonInfo.name.toLowerCase().replace(' ', '-') + '-' + quadrant;
            const mantra = mantras[mantraKey] || 'I am aligned with the cosmic rhythm of the universe.';
            
            readingContent.innerHTML = `
                <style>
                    .grimoire-card {
                        background: rgba(20, 20, 20, 0.9);
                        border: 1px solid #333;
                        padding: 16px;
                        margin-bottom: 16px;
                        border-radius: 16px;
                        position: relative;
                        overflow: hidden;
                        word-wrap: break-word;
                        overflow-wrap: break-word;
                        width: 100%;
                        box-sizing: border-box;
                    }
                    .grimoire-card.glow {
                        box-shadow: 0 0 20px rgba(0, 245, 255, 0.15);
                    }
                    .grimoire-card h2 {
                        border-bottom: 1px solid #333;
                        padding-bottom: 12px;
                        margin-bottom: 16px;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        font-size: 0.9rem;
                        word-wrap: break-word;
                        text-align: center;
                    }
                    .grimoire-gold { color: #D4AF37; }
                    .grimoire-cyan { color: #00f5ff; }
                    .grimoire-emerald { color: #50C878; }
                    .grimoire-silver { color: #A0A0A0; }
                    .cosmic-tension-box {
                        background: #111;
                        padding: 12px;
                        border-radius: 12px;
                        border: 1px dashed #444;
                        margin-top: 12px;
                    }
                    .cosmic-tension-box .label {
                        text-transform: uppercase;
                        font-size: 0.7rem;
                        color: #666;
                        letter-spacing: 2px;
                        margin-bottom: 10px;
                    }
                    .sigil-decoded-grid {
                        display: grid;
                        grid-template-columns: 1fr;
                        gap: 16px;
                        margin-top: 16px;
                    }
                    @media (min-width: 600px) {
                        .sigil-decoded-grid {
                            grid-template-columns: repeat(2, 1fr);
                        }
                    }
                    .decode-item h3 {
                        font-size: 0.95rem;
                        margin-bottom: 8px;
                    }
                    .decode-item p {
                        font-size: 0.85rem;
                        color: #aaa;
                        line-height: 1.5;
                    }
                    .mantra-section {
                        text-align: center;
                        padding: 30px 15px;
                        border-top: 1px solid #222;
                        margin-top: 30px;
                    }
                    .mantra-section .label {
                        font-size: 0.75rem;
                        letter-spacing: 3px;
                        color: #666;
                        margin-bottom: 15px;
                    }
                    .mantra-text {
                        font-size: 1.2rem;
                        line-height: 1.5;
                        color: #e0e0e0;
                        font-style: italic;
                        max-width: 100%;
                        margin: 0 auto;
                    }
                    .archive-header {
                        text-align: center;
                        margin-bottom: 20px;
                        padding: 16px 12px;
                        border-bottom: 1px solid #222;
                        background: rgba(20, 20, 20, 0.9);
                        border-radius: 16px;
                    }
                    .archive-id {
                        font-size: 0.6rem;
                        color: #555;
                        letter-spacing: 1px;
                        margin-bottom: 12px;
                        word-wrap: break-word;
                    }
                    .archive-title {
                        font-family: 'Cinzel', 'Georgia', serif;
                        font-size: 1.4rem;
                        letter-spacing: 2px;
                        color: #fff;
                        margin-bottom: 12px;
                    }
                    .archive-subtitle {
                        font-size: 0.95rem;
                    }
                    .data-row {
                        display: flex;
                        flex-direction: column;
                        gap: 4px;
                        padding: 10px 0;
                        border-bottom: 1px solid rgba(255,255,255,0.05);
                    }
                    @media (min-width: 480px) {
                        .data-row {
                            flex-direction: row;
                            justify-content: space-between;
                            gap: 10px;
                        }
                    }
                    .data-row .label { color: #666; font-size: 0.85rem; }
                    .data-row .value { color: #fff; font-size: 0.9rem; word-wrap: break-word; }
                </style>
                
                <!-- ARCHIVE HEADER -->
                <div class="archive-header">
                    <div class="archive-id">QUANTUM ARCHIVE // RECORD #${recordId}</div>
                    <h1 class="archive-title">üèõ THE CHRONICLE OF ORIGIN üèõ</h1>
                    <div class="archive-subtitle grimoire-gold">${dateStr} ‚Ä¢ ${timeStr} ‚Ä¢ ${location.city}</div>
                </div>
                
                <!-- SECTION 1: THE COSMIC EVENT -->
                <div class="grimoire-card glow">
                    <h2 class="grimoire-cyan">üåå The Sky Architecture üåå</h2>
                    <p style="text-align: center; margin-bottom: 15px;">At the precise moment of <strong>${timeStr}</strong> on <strong>${dateStr}</strong>, the celestial bodies aligned in a unique configuration that would never repeat in exactly the same way.</p>
                    
                    <div style="margin-top: 20px;">
                        <div class="data-row">
                            <span class="label">Sun Sign</span>
                            <span class="value">${zodiac.symbol} ${zodiac.name} (${zodiac.element})</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Moon Phase</span>
                            <span class="value">${moonInfo.icon} ${moonInfo.name} (${moonIllumination}% illuminated)</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Stellar Density</span>
                            <span class="value">‚≠ê ${starDensity}/8 ‚Äî ${energyLevel} Energy Field</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Celestial Quadrant</span>
                            <span class="value">${quadrantInfo.icon} ${quadrant.charAt(0).toUpperCase() + quadrant.slice(1)} ‚Äî ${quadrantInfo.meaning.split(',')[0]}</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Energy Type</span>
                            <span class="value">${isDaytime ? '‚òÄÔ∏è' : 'üåô'} ${energyType}</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Elemental Dominance</span>
                            <span class="value" style="color: ${elementalDom.dominant === 'Fire' ? '#ff6b4a' : elementalDom.dominant === 'Earth' ? '#8B7355' : elementalDom.dominant === 'Air' ? '#87CEEB' : '#4169E1'};">${elementalDom.dominant} / ${elementalDom.secondary}</span>
                        </div>
                        <div class="data-row">
                            <span class="label">Cosmic Archetype</span>
                            <span class="value">‚ú® ${archetype.name}</span>
                        </div>
                    </div>
                    
                    <div class="cosmic-tension-box">
                        <div class="label">The Implication</div>
                        <p style="color: #ddd;">${archetype.desc}. This cosmic configuration grants you ${starDensity > 5 ? 'an expansive vision and the ability to see connections others miss. Your energy radiates outward, naturally attracting opportunities and people aligned with your path.' : 'a focused intensity and the power of deep concentration. Your energy draws inward, giving you mastery over detail and the patience for profound work.'}</p>
                    </div>
                </div>
                
                <!-- SECTION 2: THE LUNAR DEPTH -->
                <div class="grimoire-card" style="border-color: #444;">
                    <h2 class="grimoire-silver">üåë The Lunar Texture üåë</h2>
                    <p style="text-align: center; margin-bottom: 10px;"><strong>${moonInfo.name}</strong></p>
                    <div style="display: flex; gap: 25px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 280px;">
                            <p><strong>Phase:</strong> ${moonInfo.name} (${moonIllumination}% Illumination)<br>
                            <strong>Archetype:</strong> ${archetype.name} ‚Äî ${archetype.desc}</p>
                            
                            <p>${isDaytime ? 
                                `While the Sun was ${sunAltitude > 45 ? 'high and brilliant' : 'present in the sky'}, your Moon was in its ${moonInfo.name} phase. This creates a dynamic tension between your visible, external self and your hidden, internal depths.` :
                                `Born under the cover of night with a ${moonInfo.name} moon, your soul resonates with the mysteries of the dark. You are naturally attuned to the unseen currents that flow beneath the surface of everyday life.`
                            }</p>
                            
                            <p><strong>Lunar Gift:</strong> ${moonInfo.meaning}. This phase infuses your being with ${moonIllumination > 50 ? 'the energy of manifestation and visibility. What you create tends to be seen and recognized.' : 'the wisdom of the inner world. You possess insight that comes from contemplation rather than action.'}</p>
                        </div>
                        <div class="cosmic-tension-box" style="flex: 1; min-width: 280px; margin-top: 0;">
                            <div class="label">Cosmic Tension</div>
                            <p style="font-style: italic; color: #ddd; margin-bottom: 15px;">"${isDaytime ? 'The Sun illuminates, but the Moon knows.' : 'In darkness, the soul remembers what daylight forgets.'}"</p>
                            <p style="color: #aaa;">Your challenge is to honor both ${isDaytime ? 'your visible accomplishments and your private wisdom' : 'your nocturnal insights and your need to share them with the waking world'}.</p>
                        </div>
                    </div>
                </div>
                
                <!-- SECTION 3: THE CELESTIAL ALIGNMENT -->
                <div class="grimoire-card glow" style="background: linear-gradient(135deg, rgba(20,20,20,0.95), rgba(10,30,30,0.95));">
                    <h2 class="grimoire-gold">‚ú® The Celestial Quadrant ‚ú®</h2>
                    <p style="text-align: center; margin-bottom: 10px;"><strong>${quadrant.charAt(0).toUpperCase() + quadrant.slice(1)}</strong></p>
                    <p>Your birth moment was anchored in the <strong>${quadrant.toUpperCase()}</strong> quadrant of the celestial sphere, a direction that carries profound meaning across cultures and traditions.</p>
                    
                    <p><strong>Quadrant Meaning:</strong> ${quadrantInfo.meaning}. This directional energy influences the way you naturally approach challenges, relationships, and personal growth.</p>
                    
                    <p>Combined with your ${moonInfo.name} moon and ${energyLevel.toLowerCase()} stellar pattern, your celestial configuration suggests that ${
                        quadrant === 'north' ? 'wisdom and intuition guide your path. Trust the quiet voice within.' :
                        quadrant === 'east' ? 'new beginnings and fresh starts are your domain. You are a natural initiator.' :
                        quadrant === 'south' ? 'passion and creative expression fuel your journey. Let your heart lead.' :
                        'completion and transformation are your gifts. You excel at bringing things to their proper end.'
                    }</p>
                </div>
                
                <!-- SECTION 4: SIGIL DECODED -->
                <div class="grimoire-card">
                    <h2 style="color: #fff; text-align: center; border: none; font-size: 1.1rem; margin-bottom: 20px;">üîÆ YOUR QUANTUM SIGNATURE DECODED üîÆ</h2>
                    <p style="text-align: center; color: #888; margin-bottom: 30px;">This sigil is not random art. It is a data visualization of your cosmic moment.</p>
                    
                    <div class="sigil-decoded-grid">
                        <div class="decode-item">
                            <h3 class="grimoire-emerald">The Geometry: ${sigilInfo.geometry}</h3>
                            <p><strong>Why:</strong> Your ${moonInfo.name} phase and ${quadrant} quadrant alignment.</p>
                            <p>${sigilInfo.meaning}</p>
                        </div>
                        
                        <div class="decode-item">
                            <h3 class="grimoire-gold">The Density: ${starDensity}/8</h3>
                            <p><strong>Why:</strong> Your stellar density rating.</p>
                            <p>${starDensity > 6 ? 'The sigil is rich with detail and complexity, reflecting your expansive cosmic energy. Many paths radiate from your center.' : starDensity > 3 ? 'The sigil balances complexity with clarity, reflecting your ability to navigate between expansion and focus.' : 'The sigil is clean and precise, reflecting your concentrated energy. Every line carries weight and purpose.'}</p>
                        </div>
                        
                        <div class="decode-item">
                            <h3 class="grimoire-cyan">The Element: ${sigilInfo.element}</h3>
                            <p><strong>Why:</strong> Your ${currentSigilData?.style || 'cosmic'} style selection.</p>
                            <p>This elemental resonance amplifies your natural ${quadrantInfo.meaning.split(',')[0].toLowerCase()}, grounding your cosmic signature in tangible form.</p>
                        </div>
                        
                        <div class="decode-item">
                            <h3 style="color: #fff;">The Frequency: ${isDaytime ? 'Solar' : 'Lunar'} Burn</h3>
                            <p><strong>Why:</strong> Your ${timeStr} birth time.</p>
                            <p>${isDaytime ? 'The laser burns with the intensity of daylight, creating clear, defined edges. Your sigil is meant to be seen and displayed openly.' : 'The laser burns with the subtlety of starlight, creating depth and shadow. Your sigil holds secrets visible only to those who look closely.'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- SECTION 5: THE SHADOW PROTOCOL -->
                <div class="grimoire-card" style="background: #0a0a0a; border: 1px solid #800000; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; right: 0; background: #800000; color: #fff; font-size: 0.65rem; padding: 3px 8px; letter-spacing: 1px;">SYSTEM WARNING</div>
                    
                    <h2 style="color: #ff4444; border-bottom: 1px solid #333;">‚ö†Ô∏è The Shadow Frequency ‚ö†Ô∏è</h2>
                    <p style="text-align: center; margin-bottom: 10px;"><strong>${getShadowName(moonInfo.age, quadrant)}</strong></p>
                    
                    <div style="display: flex; gap: 30px; align-items: flex-start; flex-wrap: wrap;">
                        <div style="font-size: 4rem; opacity: 0.3; min-width: 80px; text-align: center;">${getShadowIcon(moonInfo.age)}</div>
                        <div style="flex: 1; min-width: 280px;">
                            <p>Every cosmic gift carries a shadow. With your <strong>${moonInfo.name}</strong> moon and <strong>${quadrant}</strong> quadrant alignment, your greatest challenge is <strong>${getShadowChallenge(moonInfo.age, quadrant)}</strong>.</p>
                            
                            <p>${getShadowDescription(moonInfo.age, starDensity, isDaytime)}</p>
                            
                            <p style="color: #ff8888; font-style: italic;">"${getShadowQuote(moonInfo.age)}"</p>
                            
                            <p><strong>The Antidote:</strong> ${getShadowAntidote(moonInfo.age, isDaytime, quadrant)}</p>
                        </div>
                    </div>
                </div>
                
                <!-- SECTION 6: ESOTERIC DATA GRID -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                    
                    <!-- Sun Sign -->
                    <div class="grimoire-card" style="text-align: center; border-top: 3px solid #ff6b4a; padding: 20px;">
                        <div style="font-size: 0.75rem; color: #666; letter-spacing: 2px; margin-bottom: 10px;">SUN SIGN</div>
                        <h3 style="color: #ff6b4a; margin: 0;">${zodiac.name}</h3>
                        <div style="font-size: 2.5rem; margin: 15px 0;">${zodiac.symbol}</div>
                        <p style="font-size: 0.85rem; line-height: 1.5; color: #aaa;">${zodiac.element} Element ‚Ä¢ Your core identity and life force expression.</p>
                    </div>
                    
                    <!-- Personal Year -->
                    <div class="grimoire-card" style="text-align: center; border-top: 3px solid #9370DB; padding: 20px;">
                        <div style="font-size: 0.75rem; color: #666; letter-spacing: 2px; margin-bottom: 10px;">PERSONAL YEAR ${new Date().getFullYear()}</div>
                        <h3 style="color: #9370DB; margin: 0;">${personalYearInfo.theme}</h3>
                        <div style="font-size: 2.5rem; margin: 15px 0;">${personalYear}</div>
                        <p style="font-size: 0.85rem; line-height: 1.5; color: #aaa;">${personalYearInfo.desc}</p>
                    </div>
                    
                    <!-- Tarot Card -->
                    <div class="grimoire-card" style="text-align: center; border-top: 3px solid #D4AF37; padding: 20px;">
                        <div style="font-size: 0.75rem; color: #666; letter-spacing: 2px; margin-bottom: 10px;">TAROT CORRESPONDENCE</div>
                        <h3 class="grimoire-gold" style="margin: 0;">${getTarotCard(moonInfo.age, quadrant).name}</h3>
                        <div style="font-size: 2.5rem; margin: 15px 0;">${getTarotCard(moonInfo.age, quadrant).symbol}</div>
                        <p style="font-size: 0.85rem; line-height: 1.5; color: #aaa;">${getTarotCard(moonInfo.age, quadrant).meaning}</p>
                    </div>
                    
                    <!-- Life Path -->
                    <div class="grimoire-card" style="text-align: center; border-top: 3px solid #50C878; padding: 20px;">
                        <div style="font-size: 0.75rem; color: #666; letter-spacing: 2px; margin-bottom: 10px;">NUMEROLOGY</div>
                        <h3 class="grimoire-emerald" style="margin: 0;">Life Path ${getLifePathNumber(dateTime)}</h3>
                        <div style="font-size: 2.5rem; margin: 15px 0;">${getLifePathSymbol(getLifePathNumber(dateTime))}</div>
                        <p style="font-size: 0.85rem; line-height: 1.5; color: #aaa;">${getLifePathMeaning(getLifePathNumber(dateTime))}</p>
                    </div>
                    
                    <!-- Element Balance -->
                    <div class="grimoire-card" style="text-align: center; border-top: 3px solid #A0A0A0; padding: 20px;">
                        <div style="font-size: 0.75rem; color: #666; letter-spacing: 2px; margin-bottom: 10px;">ELEMENTAL DOMINANCE</div>
                        <h3 style="color: #fff; margin: 0;">${elementalDom.dominant} / ${elementalDom.secondary}</h3>
                        <div style="font-size: 2.5rem; margin: 15px 0;">${elementalDom.dominant === 'Fire' ? 'üî•' : elementalDom.dominant === 'Earth' ? '‚õ∞Ô∏è' : elementalDom.dominant === 'Air' ? 'üí®' : 'üíß'}</div>
                        <p style="font-size: 0.85rem; line-height: 1.5; color: #aaa;">Combined from ${zodiac.name} (${zodiac.element}), ${moonInfo.name} moon, and ${quadrant} quadrant.</p>
                    </div>
                </div>
                
                <!-- SECTION 7: ACTIVATION RITUAL -->
                <div class="grimoire-card" style="background: linear-gradient(180deg, rgba(20,20,20,0) 0%, rgba(20,40,30,0.5) 100%); border-radius: 20px;">
                    <h2 style="text-align: center; font-family: 'Cinzel', serif; margin-bottom: 10px;">‚ö° SIGIL ACTIVATION PROTOCOL ‚ö°</h2>
                    <p style="text-align: center; color: #888; max-width: 600px; margin: 0 auto 30px auto;">
                        Your sigil is a capacitor. It holds energy until you choose to release it.
                        Based on your <strong>${moonInfo.name}</strong> signature, use this method:
                    </p>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                        <div style="background: #50C878; color: #000; min-width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; font-size: 1.1rem;">1</div>
                        <div style="flex: 1; min-width: 250px;">
                            <strong class="grimoire-emerald">The Grounding (${getActivationElement(quadrant)})</strong>
                            <p style="margin-top: 8px; color: #ccc;">${getActivationStep1(quadrant, isDaytime)}</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                        <div style="background: #50C878; color: #000; min-width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; font-size: 1.1rem;">2</div>
                        <div style="flex: 1; min-width: 250px;">
                            <strong class="grimoire-emerald">The Visual Trace (Focus)</strong>
                            <p style="margin-top: 8px; color: #ccc;">${getActivationStep2(moonInfo.age, style)}</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="background: #50C878; color: #000; min-width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; font-size: 1.1rem;">3</div>
                        <div style="flex: 1; min-width: 250px;">
                            <strong class="grimoire-emerald">The Sonic Key (Vibration)</strong>
                            <p style="margin-top: 8px; color: #ccc;">${getActivationStep3(moonInfo.age)}</p>
                        </div>
                    </div>
                </div>
                
                <!-- SECTION 8: CHRONO-MAP (Current Transits) -->
                ${getChronoMapSection(dateTime)}
                
                <!-- SECTION 9: ALCHEMICAL SIGNATURE -->
                <div class="grimoire-card" style="text-align: center; margin-top: 40px;">
                    <div style="font-size: 0.75rem; color: #666; letter-spacing: 3px; margin-bottom: 20px;">ALCHEMICAL LOADOUT</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 25px; max-width: 700px; margin: 0 auto;">
                        <div>
                            <span class="grimoire-gold">‚ú¶ Metal:</span> ${getAlchemicalMetal(quadrant)}
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">(${getAlchemicalMetalMeaning(quadrant)})</div>
                        </div>
                        <div>
                            <span class="grimoire-emerald">‚ú¶ Stone:</span> ${getAlchemicalStone(moonInfo.age)}
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">(${getAlchemicalStoneMeaning(moonInfo.age)})</div>
                        </div>
                        <div>
                            <span style="color: #fff;">‚ú¶ Direction:</span> ${quadrant.charAt(0).toUpperCase() + quadrant.slice(1)}
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">(${quadrantInfo.meaning.split(',')[0]})</div>
                        </div>
                        <div>
                            <span class="grimoire-cyan">‚ú¶ Power Hour:</span> ${timeStr}
                            <div style="font-size: 0.75rem; color: #666; margin-top: 5px;">(${isDaytime ? 'Solar Zenith' : 'Lunar Depth'})</div>
                        </div>
                    </div>
                </div>
                
                <!-- MANTRA SECTION -->
                <div class="mantra-section">
                    <div class="label">YOUR COSMIC MANTRA</div>
                    <p class="mantra-text">"${mantra}"</p>
                    <div style="margin-top: 30px; color: #555; font-size: 0.85rem;">
                        ‚Äî Generated from ${moonInfo.name} √ó ${quadrant.charAt(0).toUpperCase() + quadrant.slice(1)} Quadrant ‚Äî
                    </div>
                </div>
            `;
            readingContent.style.display = 'block';
        }
        
        // ==========================================
        // READING HELPER FUNCTIONS
        // ==========================================
        
        function getShadowName(moonAge, quadrant) {
            const shadows = {
                0: 'Void Trap', 1: 'Impatience', 2: 'Conflict', 3: 'Overextension',
                4: 'Ego Inflation', 5: 'Perfectionism', 6: 'Resistance', 7: 'Isolation'
            };
            return shadows[moonAge] || 'Unknown Shadow';
        }
        
        function getShadowIcon(moonAge) {
            const icons = ['üï≥Ô∏è', '‚ö°', '‚öîÔ∏è', 'üåä', 'üëë', 'üîç', '‚öì', 'üåë'];
            return icons[moonAge] || '‚ö†Ô∏è';
        }
        
        function getShadowChallenge(moonAge, quadrant) {
            const challenges = {
                0: 'paralysis before new beginnings',
                1: 'rushing before roots are established',
                2: 'conflict between action and patience',
                3: 'taking on more than you can sustain',
                4: 'attachment to outcomes and recognition',
                5: 'over-giving until depletion',
                6: 'holding on past the time of release',
                7: 'withdrawing too deeply into solitude'
            };
            return challenges[moonAge] || 'unknown challenge';
        }
        
        function getShadowDescription(moonAge, starDensity, isDaytime) {
            if (moonAge <= 1) {
                return 'Because you carry the energy of beginnings, you may struggle with the patience required to see things through. The temptation is to start many projects but finish few.';
            } else if (moonAge <= 3) {
                return 'Your growth-oriented energy can lead to overcommitment. You may say yes to everything, spreading yourself thin until your resources are depleted.';
            } else if (moonAge === 4) {
                return 'The full moon energy wants to be seen and recognized. Your shadow is becoming too attached to external validation and losing touch with your internal compass.';
            } else if (moonAge <= 6) {
                return 'Your generous nature can become a trap. You may give and give until there is nothing left, confusing self-sacrifice with love.';
            } else {
                return 'Your deep, introspective nature can become isolation. You may retreat so far into your inner world that you lose connection with those who need you.';
            }
        }
        
        function getShadowQuote(moonAge) {
            const quotes = [
                'The void is not empty‚Äîit is pregnant with possibility.',
                'Patience is not passive; it is concentrated strength.',
                'The warrior who fights every battle wins none.',
                'Even the ocean must respect the shore.',
                'The brightest light casts the darkest shadow.',
                'You cannot pour from an empty vessel.',
                'What you resist, persists.',
                'Solitude is medicine, but isolation is poison.'
            ];
            return quotes[moonAge] || 'Know thyself.';
        }
        
        function getShadowAntidote(moonAge, isDaytime, quadrant) {
            if (moonAge <= 1) {
                return 'Practice completion rituals. Before starting anything new, finish one small thing. Build the muscle of follow-through.';
            } else if (moonAge <= 3) {
                return 'Learn the sacred no. Before saying yes, ask: "Does this align with my core purpose?" Protect your energy like the treasure it is.';
            } else if (moonAge === 4) {
                return 'Create something with no audience in mind. Remember that your worth is not determined by applause.';
            } else if (moonAge <= 6) {
                return 'Schedule rest as seriously as you schedule work. Receiving is also a form of giving‚Äîit allows others to experience the joy of generosity.';
            } else {
                return 'Commit to one small act of connection each day. Share something‚Äîa thought, a meal, a moment‚Äîwith another soul.';
            }
        }
        
        function getTarotCard(moonAge, quadrant) {
            const cards = [
                { name: 'THE FOOL', symbol: 'üÉè', meaning: 'New beginnings, innocence, and the courage to leap into the unknown.' },
                { name: 'THE MAGICIAN', symbol: 'ü™Ñ', meaning: 'Manifestation power, resourcefulness, and inspired action.' },
                { name: 'THE CHARIOT', symbol: 'üèõÔ∏è', meaning: 'Willpower, determination, and victory through focused effort.' },
                { name: 'THE EMPRESS', symbol: 'üëë', meaning: 'Abundance, nurturing, and creative fertility.' },
                { name: 'THE SUN', symbol: '‚òÄÔ∏è', meaning: 'Joy, success, and the radiance of your true self.' },
                { name: 'THE HIEROPHANT', symbol: 'üóùÔ∏è', meaning: 'Wisdom, tradition, and the bridge between worlds.' },
                { name: 'THE HERMIT', symbol: 'üèîÔ∏è', meaning: 'Inner guidance, solitude, and soul-searching.' },
                { name: 'THE MOON', symbol: 'üåô', meaning: 'Intuition, mystery, and the wisdom of the unconscious.' }
            ];
            return cards[moonAge] || cards[0];
        }
        
        function getLifePathNumber(dateTime) {
            const day = dateTime.getDate();
            const month = dateTime.getMonth() + 1;
            const year = dateTime.getFullYear();
            
            let sum = 0;
            const dateStr = '' + day + month + year;
            for (let char of dateStr) {
                sum += parseInt(char) || 0;
            }
            
            while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                let newSum = 0;
                while (sum > 0) {
                    newSum += sum % 10;
                    sum = Math.floor(sum / 10);
                }
                sum = newSum;
            }
            
            return sum;
        }
        
        function getLifePathSymbol(num) {
            const symbols = { 1: '‚òâ', 2: '‚òΩ', 3: '‚ñ≥', 4: '‚ñ°', 5: '‚òÜ', 6: '‚ô°', 7: 'üîÆ', 8: '‚àû', 9: '‚ôæÔ∏è', 11: '‚ö°', 22: 'üèõÔ∏è', 33: '‚ú°Ô∏è' };
            return symbols[num] || '‚úß';
        }
        
        function getLifePathMeaning(num) {
            const meanings = {
                1: 'The Leader. Independent, pioneering, and destined to forge new paths.',
                2: 'The Peacemaker. Diplomatic, intuitive, and skilled at harmonizing opposites.',
                3: 'The Creator. Expressive, artistic, and blessed with the gift of communication.',
                4: 'The Builder. Practical, reliable, and capable of creating lasting structures.',
                5: 'The Freedom Seeker. Adventurous, versatile, and embracing constant change.',
                6: 'The Nurturer. Responsible, loving, and called to serve family and community.',
                7: 'The Seeker. Analytical, spiritual, and driven to understand life\'s mysteries.',
                8: 'The Powerhouse. Ambitious, authoritative, and destined for material mastery.',
                9: 'The Humanitarian. Compassionate, wise, and here to serve the greater good.',
                11: 'Master Number: The Intuitive. Visionary insight and spiritual illumination.',
                22: 'Master Number: The Architect. Ability to turn dreams into reality on a grand scale.',
                33: 'Master Number: The Master Teacher. Embodiment of unconditional love and healing.'
            };
            return meanings[num] || 'A unique path of discovery.';
        }
        
        function getElementBalance(moonAge, starDensity) {
            if (moonAge <= 1) {
                return { primary: 'Fire + Air', icons: 'üî•üí®', description: 'High initiative, may lack grounding. Consciously connect with Earth energy.' };
            } else if (moonAge <= 3) {
                return { primary: 'Earth + Water', icons: '‚õ∞Ô∏èüíß', description: 'Strong foundation and emotional depth. Cultivate Fire for motivation.' };
            } else if (moonAge === 4) {
                return { primary: 'Fire + Spirit', icons: 'üî•‚ú®', description: 'Radiant and visible. Balance with Water for emotional intelligence.' };
            } else if (moonAge <= 6) {
                return { primary: 'Water + Earth', icons: 'üíß‚õ∞Ô∏è', description: 'Nurturing and stable. Add Air for mental clarity and perspective.' };
            } else {
                return { primary: 'Spirit + Water', icons: '‚ú®üíß', description: 'Deep and intuitive. Ground yourself with Earth practices.' };
            }
        }
        
        function getActivationElement(quadrant) {
            const elements = { north: 'Earth', east: 'Air', south: 'Fire', west: 'Water' };
            return elements[quadrant] || 'Spirit';
        }
        
        function getActivationStep1(quadrant, isDaytime) {
            if (quadrant === 'north') {
                return 'Sit or lie on the floor. Your energy requires physical contact with a solid surface. Place the sigil image flat on the ground or hold a printed copy.';
            } else if (quadrant === 'east') {
                return 'Face a window or open door. Your energy thrives with fresh air and the sense of openness. Take three deep breaths before beginning.';
            } else if (quadrant === 'south') {
                return 'Light a candle nearby. Your energy responds to flame and warmth. Position the sigil so the candlelight dances across its surface.';
            } else {
                return 'Have water present‚Äîa glass, a bowl, or position near a bathroom. Your energy flows with water. Dip your fingertips before touching the sigil.';
            }
        }
        
        function getActivationStep2(moonAge, style) {
            if (moonAge <= 3) {
                return 'With your eyes, trace the sigil from the center moving outward. Follow the lines as they expand, mimicking your waxing moon energy of growth and manifestation.';
            } else if (moonAge === 4) {
                return 'Gaze at the sigil as a whole, taking in its complete form. Do not trace individual lines‚Äîabsorb the totality. This matches your full moon energy of completion.';
            } else {
                return 'With your eyes, trace the thickest lines of the sigil from the outside moving inward. Follow the path toward the center, mimicking your waning moon energy of gathering wisdom.';
            }
        }
        
        function getActivationStep3(moonAge) {
            if (moonAge <= 1) {
                return 'Hum a rising tone (starting low, ending high). Feel the vibration move from your belly to your crown. This activates the ascending energy of new beginnings.';
            } else if (moonAge <= 4) {
                return 'Hum a steady, sustained tone (the vowel "AH"). Feel the vibration in your heart center. Maintain it for 7 breaths.';
            } else {
                return 'Hum a low, descending tone (the vowel "OH" or "UH"). Feel the vibration sink into your chest and belly. This activates the grounding energy of release.';
            }
        }
        
        function getChronoMapSection(dateTime) {
            const birthYear = dateTime.getFullYear();
            const currentYear = new Date().getFullYear();
            const age = currentYear - birthYear;
            
            let transitName, transitDescription, transitQuote;
            
            if (age < 28) {
                transitName = 'Saturn Pre-Return';
                transitDescription = 'You are in the building phase of life, establishing the foundations that will support your future. This is the time of exploration, learning, and discovering who you are.';
                transitQuote = 'The structures you build now become the platform you launch from later.';
            } else if (age < 31) {
                transitName = 'The Saturn Return';
                transitDescription = 'You are in (or recently completed) the most significant astrological transit of early adulthood. Saturn has returned to where it was at your birth, demanding you take full responsibility for your life path.';
                transitQuote = 'Childhood ends not by age, but by choice. Choose now.';
            } else if (age < 40) {
                transitName = 'Post-Saturn Integration';
                transitDescription = 'You have passed through the crucible of your Saturn Return. This is the time of implementation‚Äîbuilding the career, relationships, and life structures that reflect your authentic self.';
                transitQuote = 'You now know who you are. The question is: what will you build?';
            } else if (age < 45) {
                transitName = 'The Uranus Opposition';
                transitDescription = 'The planet of Radical Change (Uranus) is now opposite where it was at your birth. This is the famous "midlife awakening"‚Äîa cosmic permission slip to reinvent yourself.';
                transitQuote = 'The structures you built for safety must now be rebuilt for truth.';
            } else if (age < 50) {
                transitName = 'The Chiron Return';
                transitDescription = 'You are approaching or in the Chiron Return‚Äîthe healing crisis of midlife. Old wounds resurface not to hurt you, but to finally be healed and transformed into wisdom.';
                transitQuote = 'Your deepest wound becomes your greatest medicine.';
            } else if (age < 60) {
                transitName = 'The Second Saturn Return Approach';
                transitDescription = 'You are in the mastery phase. The lessons of the first half of life are being consolidated. You are becoming an elder, whether you realize it or not.';
                transitQuote = 'Experience becomes wisdom only when it is reflected upon and shared.';
            } else {
                transitName = 'Elder Wisdom Phase';
                transitDescription = 'You have completed your Second Saturn Return. You are now in the phase of legacy‚Äîwhat you teach, what you leave behind, what you have come to understand about this human journey.';
                transitQuote = 'The greatest gift is not what you have done, but what you have become.';
            }
            
            return `
                <div class="grimoire-card" style="border-top: 1px solid #333; margin-top: 40px; padding-top: 40px;">
                    <h2 style="text-align: right; font-size: 1.2rem; color: #666; margin-bottom: 0;">‚è≥ TEMPORAL COORDINATES: THE NOW</h2>
                    
                    <div style="display: flex; gap: 40px; align-items: center; margin-top: 30px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 280px;">
                            <h3 class="grimoire-emerald" style="font-size: 1.5rem;">${transitName}</h3>
                            <p style="color: #aaa; margin-bottom: 15px;">Current Age: <strong>${age}</strong> ‚Ä¢ Status: <span style="color: #50C878;">ACTIVE</span></p>
                            
                            <p>${transitDescription}</p>
                            
                            <div style="background: #111; padding: 15px; border-left: 3px solid #50C878; margin-top: 20px;">
                                <p style="font-style: italic; margin: 0;">"${transitQuote}"</p>
                            </div>
                        </div>
                        
                        <!-- Timeline Visual -->
                        <div style="flex: 0 0 100px; height: 200px; position: relative; display: flex; align-items: center; justify-content: center;">
                            <div style="width: 2px; height: 100%; background: linear-gradient(to bottom, #333, #50C878, #333);"></div>
                            <div style="position: absolute; width: 16px; height: 16px; background: #50C878; border-radius: 50%; box-shadow: 0 0 15px #50C878;"></div>
                            <div style="position: absolute; left: 25px; font-size: 0.8rem; color: #50C878; white-space: nowrap;">YOU ARE HERE</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getAlchemicalMetal(quadrant) {
            const metals = { north: 'Lead', east: 'Mercury', south: 'Iron', west: 'Copper' };
            return metals[quadrant] || 'Silver';
        }
        
        function getAlchemicalMetalMeaning(quadrant) {
            const meanings = { north: 'Transformation & Patience', east: 'Communication & Speed', south: 'Strength & Courage', west: 'Conductivity & Love' };
            return meanings[quadrant] || 'Reflection & Intuition';
        }
        
        function getAlchemicalStone(moonAge) {
            const stones = ['Obsidian', 'Moonstone', 'Citrine', 'Emerald', 'Diamond', 'Rose Quartz', 'Amethyst', 'Labradorite'];
            return stones[moonAge] || 'Clear Quartz';
        }
        
        function getAlchemicalStoneMeaning(moonAge) {
            const meanings = ['Protection & Grounding', 'Intuition & New Beginnings', 'Manifestation & Will', 'Growth & Heart Opening', 'Clarity & Illumination', 'Unconditional Love', 'Spiritual Wisdom', 'Magic & Transformation'];
            return meanings[moonAge] || 'Amplification';
        }

        // Get zodiac sign from birth date
        function getZodiacSign(month, day) {
            const signs = [
                { name: 'Capricorn', symbol: '‚ôë', element: 'Earth', dates: [12, 22, 1, 19] },
                { name: 'Aquarius', symbol: '‚ôí', element: 'Air', dates: [1, 20, 2, 18] },
                { name: 'Pisces', symbol: '‚ôì', element: 'Water', dates: [2, 19, 3, 20] },
                { name: 'Aries', symbol: '‚ôà', element: 'Fire', dates: [3, 21, 4, 19] },
                { name: 'Taurus', symbol: '‚ôâ', element: 'Earth', dates: [4, 20, 5, 20] },
                { name: 'Gemini', symbol: '‚ôä', element: 'Air', dates: [5, 21, 6, 20] },
                { name: 'Cancer', symbol: '‚ôã', element: 'Water', dates: [6, 21, 7, 22] },
                { name: 'Leo', symbol: '‚ôå', element: 'Fire', dates: [7, 23, 8, 22] },
                { name: 'Virgo', symbol: '‚ôç', element: 'Earth', dates: [8, 23, 9, 22] },
                { name: 'Libra', symbol: '‚ôé', element: 'Air', dates: [9, 23, 10, 22] },
                { name: 'Scorpio', symbol: '‚ôè', element: 'Water', dates: [10, 23, 11, 21] },
                { name: 'Sagittarius', symbol: '‚ôê', element: 'Fire', dates: [11, 22, 12, 21] }
            ];
            
            for (const sign of signs) {
                const [startMonth, startDay, endMonth, endDay] = sign.dates;
                if ((month === startMonth && day >= startDay) || (month === endMonth && day <= endDay)) {
                    return sign;
                }
            }
            return signs[0]; // Default to Capricorn
        }
        
        // Get constellation pattern for zodiac sign
        function getZodiacConstellation(signName) {
            // Simplified constellation star positions (normalized 0-1 coordinates)
            const constellations = {
                'Aries': [[0.3, 0.2], [0.4, 0.3], [0.5, 0.4], [0.6, 0.5]],
                'Taurus': [[0.2, 0.3], [0.35, 0.35], [0.5, 0.3], [0.4, 0.5], [0.45, 0.6], [0.55, 0.55]],
                'Gemini': [[0.3, 0.2], [0.3, 0.4], [0.3, 0.6], [0.7, 0.2], [0.7, 0.4], [0.7, 0.6]],
                'Cancer': [[0.35, 0.35], [0.45, 0.4], [0.55, 0.4], [0.65, 0.35], [0.4, 0.55], [0.6, 0.55]],
                'Leo': [[0.2, 0.3], [0.35, 0.25], [0.5, 0.3], [0.55, 0.45], [0.45, 0.55], [0.55, 0.7]],
                'Virgo': [[0.3, 0.2], [0.4, 0.35], [0.5, 0.3], [0.55, 0.45], [0.45, 0.6], [0.6, 0.7]],
                'Libra': [[0.3, 0.35], [0.5, 0.3], [0.7, 0.35], [0.4, 0.5], [0.6, 0.5]],
                'Scorpio': [[0.2, 0.4], [0.3, 0.35], [0.4, 0.4], [0.5, 0.45], [0.6, 0.5], [0.7, 0.55], [0.75, 0.65]],
                'Sagittarius': [[0.3, 0.6], [0.4, 0.5], [0.5, 0.4], [0.6, 0.3], [0.5, 0.5], [0.5, 0.6]],
                'Capricorn': [[0.3, 0.3], [0.4, 0.35], [0.5, 0.4], [0.6, 0.5], [0.55, 0.6], [0.45, 0.65]],
                'Aquarius': [[0.25, 0.4], [0.35, 0.35], [0.45, 0.4], [0.55, 0.35], [0.65, 0.4], [0.75, 0.35]],
                'Pisces': [[0.25, 0.4], [0.35, 0.45], [0.45, 0.4], [0.55, 0.5], [0.65, 0.55], [0.75, 0.5]]
            };
            return constellations[signName] || [[0.5, 0.5]];
        }
        
        // Calculate Personal Year Number
        function getPersonalYear(birthMonth, birthDay) {
            const currentYear = new Date().getFullYear();
            let sum = 0;
            const dateStr = '' + birthMonth + birthDay + currentYear;
            for (let char of dateStr) {
                sum += parseInt(char) || 0;
            }
            while (sum > 9 && sum !== 11 && sum !== 22) {
                let newSum = 0;
                while (sum > 0) {
                    newSum += sum % 10;
                    sum = Math.floor(sum / 10);
                }
                sum = newSum;
            }
            return sum;
        }
        
        function getPersonalYearMeaning(num) {
            const meanings = {
                1: { theme: 'New Beginnings', desc: 'A year for planting seeds, starting fresh projects, and asserting your independence.' },
                2: { theme: 'Partnership & Patience', desc: 'Focus on relationships, cooperation, and developing patience. Things grow quietly.' },
                3: { theme: 'Expression & Creativity', desc: 'Your creative energy is heightened. Express yourself, socialize, and embrace joy.' },
                4: { theme: 'Building Foundations', desc: 'Hard work and discipline pay off. Create structures that will support your future.' },
                5: { theme: 'Change & Freedom', desc: 'Expect the unexpected. Travel, take risks, and embrace transformation.' },
                6: { theme: 'Home & Responsibility', desc: 'Focus on family, domestic matters, and nurturing those you love.' },
                7: { theme: 'Reflection & Spirituality', desc: 'A year for inner work, study, and spiritual development. Seek truth.' },
                8: { theme: 'Power & Abundance', desc: 'Material success is favored. Step into your authority and manifest prosperity.' },
                9: { theme: 'Completion & Release', desc: 'Endings make way for new beginnings. Let go of what no longer serves you.' },
                11: { theme: 'Spiritual Awakening', desc: 'Master Number year. Heightened intuition and spiritual downloads. Trust your vision.' },
                22: { theme: 'Master Building', desc: 'Master Number year. Potential for significant achievement. Build something lasting.' }
            };
            return meanings[num] || { theme: 'Discovery', desc: 'A year of unique personal growth.' };
        }
        
        // Calculate elemental dominance from multiple factors
        function getElementalDominance(zodiacElement, moonAge, quadrant) {
            const elements = { Fire: 0, Earth: 0, Air: 0, Water: 0 };
            
            // Add zodiac element (strongest weight)
            elements[zodiacElement] += 3;
            
            // Add quadrant element
            const quadrantElements = { north: 'Earth', east: 'Air', south: 'Fire', west: 'Water' };
            elements[quadrantElements[quadrant] || 'Spirit'] += 2;
            
            // Add moon phase element
            if (moonAge <= 1) elements['Fire'] += 1;
            else if (moonAge <= 3) elements['Earth'] += 1;
            else if (moonAge === 4) elements['Fire'] += 1;
            else if (moonAge <= 6) elements['Water'] += 1;
            else elements['Water'] += 1;
            
            // Find dominant and secondary
            const sorted = Object.entries(elements).sort((a, b) => b[1] - a[1]);
            return {
                dominant: sorted[0][0],
                secondary: sorted[1][0],
                scores: elements
            };
        }

        function regenerateStyle() {
            if (!currentSigilData) {
                showNotification('Please generate a sigil first', 'error');
                return;
            }
            
            const styles = ['cosmic', 'organic', 'geometric', 'mystical'];
            const currentIndex = styles.indexOf(currentSigilData.style);
            const nextStyle = styles[(currentIndex + 1) % styles.length];
            
            currentSigilData.style = nextStyle;
            selectStyle(nextStyle);
            
            drawCosmicSigil(
                currentSigilData.moonPhase,
                currentSigilData.starDensity,
                currentSigilData.quadrant,
                nextStyle,
                currentSigilData.dateTime
            );
            
            showNotification(`Style changed to ${nextStyle}!`, 'info');
        }

        // ==========================================
        // PART 5: Canvas Drawing - Sigil Styles
        // ==========================================
        
        // Extract unique seeds from birth datetime for truly unique sigils
        function extractSeeds(birthDateTime) {
            const timestamp = birthDateTime.getTime();
            const year = birthDateTime.getFullYear();
            const month = birthDateTime.getMonth() + 1;
            const day = birthDateTime.getDate();
            const hour = birthDateTime.getHours();
            const minute = birthDateTime.getMinutes();
            
            // Create multiple hash-like seeds from different combinations
            const seed1 = ((year * 31 + month * 17 + day * 7) % 1000) / 1000;
            const seed2 = ((hour * 23 + minute * 13 + day * 11) % 1000) / 1000;
            const seed3 = ((timestamp % 100000) / 100000);
            const seed4 = Math.sin(timestamp * 0.0001) * 0.5 + 0.5;
            const seed5 = ((year + month * day + hour * minute) % 360) / 360;
            const seed6 = ((day * hour + minute * month + year % 100) % 1000) / 1000;
            const seed7 = Math.abs(Math.sin(year * 0.1) * Math.cos(month * day * 0.2)) * 0.5 + 0.25;
            const seed8 = ((year % 12 + month + day % 7 + hour % 6) % 30) / 30;
            
            return {
                primary: seed1,        // Main structural variation (0-1)
                secondary: seed2,      // Secondary patterns (0-1)
                complexity: seed3,     // How complex/detailed (0-1)
                rotation: seed4,       // Rotation offset (0-1)
                symmetry: Math.floor(seed5 * 6) + 3,  // Symmetry order (3-8)
                density: seed6,        // Line/point density (0-1)
                colorShift: seed7,     // Hue shift (0-1)
                pattern: Math.floor(seed8 * 5)  // Pattern variant (0-4)
            };
        }
        
        // Seeded pseudo-random number generator for consistent randomness
        function seededRandom(seed) {
            const x = Math.sin(seed * 9999) * 10000;
            return x - Math.floor(x);
        }
        
        function drawCosmicSigil(moonPhase, starDensity, quadrant, style, birthDateTime) {
            const canvas = document.getElementById('sigilCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Extract unique seeds from birth datetime
            const seeds = birthDateTime ? extractSeeds(birthDateTime) : {
                primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5,
                symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0
            };
            
            // Clear canvas with gradient background
            const bgGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 200);
            bgGradient.addColorStop(0, 'rgba(20, 20, 50, 1)');
            bgGradient.addColorStop(1, 'rgba(10, 10, 25, 1)');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Start Quantum Merlin intro animation on canvas
            playCanvasIntroAnimation(ctx, canvas, centerX, centerY, moonPhase, starDensity, quadrant, style, seeds, birthDateTime);
        }
        
        // ==========================================
        // QUANTUM MERLIN CANVAS INTRO ANIMATION
        // ==========================================
        
        function playCanvasIntroAnimation(ctx, canvas, centerX, centerY, moonPhase, starDensity, quadrant, style, seeds, birthDateTime) {
            let time = 0;
            let isRunning = true;
            let wizardOrbitStart = Math.PI;
            let roseOrbitStart = 0;
            
            const width = canvas.width;
            const height = canvas.height;
            const scale = Math.min(width, height) / 400; // Scale based on canvas size
            
            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
            
            function clamp(value, min, max) {
                return Math.max(min, Math.min(max, value));
            }
            
            function drawBackground() {
                const bgGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 200);
                bgGradient.addColorStop(0, 'rgba(20, 20, 50, 1)');
                bgGradient.addColorStop(1, 'rgba(10, 10, 25, 1)');
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, width, height);
            }
            
            function drawEmoji(emoji, x, y, opacity, emojiScale) {
                if (opacity <= 0) return;
                ctx.save();
                ctx.globalAlpha = opacity;
                ctx.font = `${40 * scale * emojiScale}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(emoji, x, y);
                ctx.restore();
            }
            
            function drawSingularity(x, y, singularityScale, opacity) {
                if (opacity <= 0) return;
                ctx.save();
                ctx.globalAlpha = opacity;
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, 6 * singularityScale * scale);
                gradient.addColorStop(0, '#FFD700');
                gradient.addColorStop(0.5, '#00F0FF');
                gradient.addColorStop(1, '#FF0066');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, 4 * singularityScale * scale, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#FFD700';
                ctx.restore();
            }
            
            function drawTitle(text, fontSize, opacity) {
                if (opacity <= 0 || fontSize <= 0) return;
                ctx.save();
                ctx.globalAlpha = opacity;
                ctx.font = `900 ${fontSize}px Orbitron, sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Create gradient for text
                const textGradient = ctx.createLinearGradient(centerX - 100, centerY, centerX + 100, centerY);
                textGradient.addColorStop(0, '#00F0FF');
                textGradient.addColorStop(0.5, '#FFD700');
                textGradient.addColorStop(1, '#FF0066');
                ctx.fillStyle = textGradient;
                ctx.fillText(text, centerX, centerY);
                ctx.restore();
            }
            
            function drawOrbitRings(rotation, opacity, radius) {
                if (opacity <= 0) return;
                ctx.save();
                ctx.globalAlpha = opacity;
                ctx.lineWidth = 2 * scale;
                
                // Cyan ring
                ctx.strokeStyle = 'rgba(0, 240, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius * scale, rotation, rotation + Math.PI);
                ctx.stroke();
                
                // Magenta ring
                ctx.strokeStyle = 'rgba(255, 0, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius * scale, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                ctx.stroke();
                
                // Purple ring
                ctx.strokeStyle = 'rgba(157, 0, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius * scale, rotation + Math.PI, rotation + Math.PI * 2);
                ctx.stroke();
                
                ctx.restore();
            }
            
            function updateAnimation() {
                const t = time / 60; // seconds at 60fps
                const totalDuration = 7; // Shortened for in-canvas use
                
                drawBackground();
                
                // PHASE 1: Quantum Emergence (0-0.6s)
                if (t < 0.6) {
                    const progress = clamp(t / 0.6, 0, 1);
                    const ease = easeInOutCubic(progress);
                    drawEmoji('‚öõÔ∏è', centerX, centerY, ease, ease);
                }
                
                // PHASE 2: Wizard & Rose Arrival (0.6-1.2s)
                else if (t < 1.2) {
                    const progress = clamp((t - 0.6) / 0.6, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    drawEmoji('‚öõÔ∏è', centerX, centerY, 1, 1);
                    
                    const wizardX = centerX - ease * (60 * scale);
                    drawEmoji('üßô‚Äç‚ôÇÔ∏è', wizardX, centerY, ease, 1);
                    
                    const roseX = centerX + ease * (60 * scale);
                    drawEmoji('üåπ', roseX, centerY, ease, 1);
                }
                
                // PHASE 3: Quiet Float (1.2-1.8s)
                else if (t < 1.8) {
                    drawEmoji('‚öõÔ∏è', centerX, centerY, 1, 1);
                    drawEmoji('üßô‚Äç‚ôÇÔ∏è', centerX - 60 * scale, centerY, 1, 1);
                    drawEmoji('üåπ', centerX + 60 * scale, centerY, 1, 1);
                }
                
                // PHASE 4: Lines Emerge (1.8-2.7s)
                else if (t < 2.7) {
                    const progress = clamp((t - 1.8) / 0.9, 0, 1);
                    const rotation = progress * Math.PI;
                    
                    drawOrbitRings(rotation, progress, 60);
                    drawEmoji('‚öõÔ∏è', centerX, centerY, 1, 1);
                    drawEmoji('üßô‚Äç‚ôÇÔ∏è', centerX - 60 * scale, centerY, 1, 1);
                    drawEmoji('üåπ', centerX + 60 * scale, centerY, 1, 1);
                }
                
                // PHASE 5: Acceleration + Orbit (2.7-4.2s)
                else if (t < 4.2) {
                    const progress = clamp((t - 2.7) / 1.5, 0, 1);
                    const speedMultiplier = 1 + progress * 6;
                    const rotation = ((t - 1.8) * speedMultiplier) * Math.PI;
                    
                    drawOrbitRings(rotation, 1, 60);
                    drawEmoji('‚öõÔ∏è', centerX, centerY, 1, 1);
                    
                    const orbitProgress = (t - 2.7) * speedMultiplier * 0.5;
                    const orbitRadius = 60 * scale;
                    
                    const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                    drawEmoji('üßô‚Äç‚ôÇÔ∏è', wizardX, wizardY, 1, 1);
                    
                    const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                    drawEmoji('üåπ', roseX, roseY, 1, 1);
                }
                
                // PHASE 6: Quantum Collapse (4.2-5s)
                else if (t < 5) {
                    const progress = clamp((t - 4.2) / 0.8, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    const rotation = ((t - 1.8) * 7) * Math.PI;
                    const lineRadius = 60 * (1 - ease);
                    
                    drawOrbitRings(rotation, 1 - ease, lineRadius);
                    
                    const orbitProgress = (t - 2.7) * 7 * 0.5;
                    const orbitRadius = 60 * scale * (1 - ease);
                    
                    const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                    
                    const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                    
                    const emojiScale = 1 - ease * 0.9;
                    
                    drawEmoji('üßô‚Äç‚ôÇÔ∏è', wizardX, wizardY, 1 - ease, emojiScale);
                    drawEmoji('üåπ', roseX, roseY, 1 - ease, emojiScale);
                    
                    const quantumScale = 1 + (ease < 0.3 ? ease * 0.5 : (1 - ease) * 1.5);
                    drawEmoji('‚öõÔ∏è', centerX, centerY, 1 - ease, quantumScale);
                    
                    drawSingularity(centerX, centerY, ease, ease);
                }
                
                // PHASE 7: Singularity Pulse (5-5.3s)
                else if (t < 5.3) {
                    const pulse = Math.sin((t - 5) * Math.PI * 8) * 0.3 + 1;
                    drawSingularity(centerX, centerY, pulse, 1);
                }
                
                // PHASE 8: Singularity Fade + Sigil Reveal (5.3-6.3s)
                else if (t < 6.3) {
                    const progress = clamp((t - 5.3) / 1.0, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    // Fade out singularity in first half
                    if (progress < 0.3) {
                        const singFade = 1 - (progress / 0.3);
                        drawSingularity(centerX, centerY, 1, singFade);
                    }
                    
                    // Fade in the sigil
                    ctx.save();
                    ctx.globalAlpha = ease;
                    
                    switch(style) {
                        case 'cosmic':
                            drawCosmicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                            break;
                        case 'organic':
                            drawOrganicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                            break;
                        case 'geometric':
                            drawGeometricStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                            break;
                        case 'mystical':
                            drawMysticalStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                            break;
                        default:
                            drawCosmicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                    }
                    // Draw zodiac constellation during fade-in too
                    drawZodiacConstellation(ctx, centerX, centerY, birthDateTime, 0.35);
                    ctx.restore();
                }
                
                // COMPLETE - Sigil fully revealed
                else {
                    if (isRunning) {
                        isRunning = false;
                        // Draw final sigil at full opacity
                        drawBackground();
                        switch(style) {
                            case 'cosmic':
                                drawCosmicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                                break;
                            case 'organic':
                                drawOrganicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                                break;
                            case 'geometric':
                                drawGeometricStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                                break;
                            case 'mystical':
                                drawMysticalStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                                break;
                            default:
                                drawCosmicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds);
                        }
                        // Draw zodiac constellation overlay
                        drawZodiacConstellation(ctx, centerX, centerY, birthDateTime, 0.35);
                        animateSigil();
                        return;
                    }
                }
                
                time++;
                if (isRunning) {
                    requestAnimationFrame(updateAnimation);
                }
            }
            
            updateAnimation();
        }
        
        function getLaserColors(moonPhase) {
            const palettes = [
                { primary: '#00f5ff', secondary: '#0080ff', glow: '#00f5ff', core: '#ffffff' }, // New Moon - Cyan
                { primary: '#a855f7', secondary: '#7c3aed', glow: '#c084fc', core: '#f0abfc' }, // Waxing Crescent - Purple
                { primary: '#00f5ff', secondary: '#06b6d4', glow: '#22d3ee', core: '#ffffff' }, // First Quarter - Bright Cyan
                { primary: '#10b981', secondary: '#059669', glow: '#34d399', core: '#6ee7b7' }, // Waxing Gibbous - Emerald
                { primary: '#fbbf24', secondary: '#f59e0b', glow: '#fcd34d', core: '#ffffff' }, // Full Moon - Gold
                { primary: '#ec4899', secondary: '#db2777', glow: '#f472b6', core: '#fbcfe8' }, // Waning Gibbous - Pink
                { primary: '#8b5cf6', secondary: '#7c3aed', glow: '#a78bfa', core: '#ddd6fe' }, // Last Quarter - Violet
                { primary: '#6366f1', secondary: '#4f46e5', glow: '#818cf8', core: '#c7d2fe' }  // Waning Crescent - Indigo
            ];
            return palettes[moonPhase] || palettes[0];
        }
        
        // Draw zodiac constellation overlay on sigil
        function drawZodiacConstellation(ctx, centerX, centerY, birthDateTime, opacity = 0.4) {
            if (!birthDateTime) return;
            
            const month = birthDateTime.getMonth() + 1;
            const day = birthDateTime.getDate();
            const zodiac = getZodiacSign(month, day);
            const constellation = getZodiacConstellation(zodiac.name);
            
            // Scale constellation to fit in a circle around the sigil
            const radius = 100; // Constellation area radius
            
            ctx.save();
            ctx.globalAlpha = opacity;
            
            // Draw constellation stars
            const starPositions = [];
            constellation.forEach((star, idx) => {
                const x = centerX + (star[0] - 0.5) * radius * 2;
                const y = centerY + (star[1] - 0.5) * radius * 2;
                starPositions.push({ x, y });
                
                // Draw star glow
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, 6);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                gradient.addColorStop(0.5, 'rgba(200, 220, 255, 0.5)');
                gradient.addColorStop(1, 'rgba(100, 150, 255, 0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw star point
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw constellation lines connecting stars
            if (starPositions.length > 1) {
                ctx.strokeStyle = 'rgba(150, 180, 255, 0.35)';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(starPositions[0].x, starPositions[0].y);
                for (let i = 1; i < starPositions.length; i++) {
                    ctx.lineTo(starPositions[i].x, starPositions[i].y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Removed zodiac symbol from sigil - kept in reading section only
            
            ctx.restore();
        }

        function drawCosmicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds) {
            // Use seeds for unique variations
            seeds = seeds || { primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5, symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0 };
            
            const moonRadius = 30 + (moonPhase * 5) + (seeds.primary * 15);
            const rotationOffset = seeds.rotation * Math.PI * 2;
            const symmetryOrder = seeds.symmetry;
            
            // Thicker lines for tattoo/logo quality
            const baseLineWidth = 3 + seeds.complexity * 1.5;
            
            // Enhanced color palette based on moon phase with seed-based hue shift
            const moonColorPalettes = [
                { name: 'New Moon', primary: '#4a5568', secondary: '#718096', glow: '#a0aec0', accent: '#cbd5e0' },
                { name: 'Waxing Crescent', primary: '#667eea', secondary: '#764ba2', glow: '#9f7aea', accent: '#e9d8fd' },
                { name: 'First Quarter', primary: '#00f5ff', secondary: '#0ea5e9', glow: '#38bdf8', accent: '#7dd3fc' },
                { name: 'Waxing Gibbous', primary: '#10b981', secondary: '#14b8a6', glow: '#2dd4bf', accent: '#5eead4' },
                { name: 'Full Moon', primary: '#fbbf24', secondary: '#f59e0b', glow: '#fcd34d', accent: '#fef3c7' },
                { name: 'Waning Gibbous', primary: '#f472b6', secondary: '#ec4899', glow: '#f9a8d4', accent: '#fbcfe8' },
                { name: 'Last Quarter', primary: '#8b5cf6', secondary: '#7c3aed', glow: '#a78bfa', accent: '#c4b5fd' },
                { name: 'Waning Crescent', primary: '#6366f1', secondary: '#4f46e5', glow: '#818cf8', accent: '#a5b4fc' }
            ];
            
            const palette = moonColorPalettes[moonPhase] || moonColorPalettes[0];
            
            // Apply hue shift based on colorShift seed
            function shiftHue(hexColor, shift) {
                const r = parseInt(hexColor.slice(1, 3), 16) / 255;
                const g = parseInt(hexColor.slice(3, 5), 16) / 255;
                const b = parseInt(hexColor.slice(5, 7), 16) / 255;
                
                const max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                
                if (max === min) {
                    h = s = 0;
                } else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                        case g: h = ((b - r) / d + 2) / 6; break;
                        case b: h = ((r - g) / d + 4) / 6; break;
                    }
                }
                
                h = (h + shift) % 1;
                if (h < 0) h += 1;
                
                function hue2rgb(p, q, t) {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                }
                
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                const rr = Math.round(hue2rgb(p, q, h + 1/3) * 255);
                const gg = Math.round(hue2rgb(p, q, h) * 255);
                const bb = Math.round(hue2rgb(p, q, h - 1/3) * 255);
                
                return '#' + [rr, gg, bb].map(x => x.toString(16).padStart(2, '0')).join('');
            }
            
            const hueShift = (seeds.colorShift - 0.5) * 0.3;
            const color1 = shiftHue(palette.primary, hueShift);
            const color2 = shiftHue(palette.secondary, hueShift);
            const colorGlow = shiftHue(palette.glow, hueShift);
            const colorAccent = shiftHue(palette.accent, hueShift);
            
            // Outer glow ring with shimmer - radius varies by seed
            const outerRadius = 140 + seeds.primary * 20;
            ctx.beginPath();
            ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
            const glowGradient = ctx.createRadialGradient(centerX, centerY, outerRadius - 5, centerX, centerY, outerRadius + 5);
            glowGradient.addColorStop(0, colorGlow + '80');
            glowGradient.addColorStop(0.5, colorGlow + '40');
            glowGradient.addColorStop(1, 'transparent');
            ctx.strokeStyle = glowGradient;
            ctx.lineWidth = 6 + seeds.complexity * 4;
            ctx.stroke();
            
            // Add inner glow ring at unique position
            const innerGlowRadius = outerRadius - 15 - seeds.secondary * 10;
            ctx.beginPath();
            ctx.arc(centerX, centerY, innerGlowRadius, 0, 2 * Math.PI);
            ctx.strokeStyle = colorAccent + '60';
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.6;
            ctx.stroke();
            ctx.globalAlpha = 1;
            
            // Central moon circle with gradient
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, moonRadius);
            gradient.addColorStop(0, color2);
            gradient.addColorStop(1, color1);
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, moonRadius, 0, 2 * Math.PI);
            ctx.fillStyle = gradient;
            ctx.globalAlpha = 0.7;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.strokeStyle = color2;
            ctx.lineWidth = baseLineWidth;
            ctx.stroke();
            
            // Star constellation based on density and seeds
            const starCount = Math.floor(starDensity * 2 + seeds.density * 8 + 4);
            ctx.fillStyle = colorAccent;
            ctx.shadowColor = colorGlow;
            ctx.shadowBlur = 8;
            
            for (let i = 0; i < starCount; i++) {
                const seedAngle = seededRandom(seeds.primary * 1000 + i) * 2 * Math.PI;
                const angle = seedAngle + rotationOffset;
                const distanceVariation = seededRandom(seeds.secondary * 1000 + i);
                const distance = 70 + distanceVariation * 50;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                const starSize = 3 + seededRandom(seeds.complexity * 1000 + i) * 4;
                const starGradient = ctx.createRadialGradient(x, y, 0, x, y, starSize);
                starGradient.addColorStop(0, colorAccent);
                starGradient.addColorStop(0.7, color2);
                starGradient.addColorStop(1, color2 + '00');
                
                ctx.beginPath();
                ctx.arc(x, y, starSize, 0, 2 * Math.PI);
                ctx.fillStyle = starGradient;
                ctx.fill();
                
                // Connect based on pattern seed
                if ((i + seeds.pattern) % 3 === 0) {
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    const lineGradient = ctx.createLinearGradient(centerX, centerY, x, y);
                    lineGradient.addColorStop(0, color1 + '00');
                    lineGradient.addColorStop(0.5, color2 + '40');
                    lineGradient.addColorStop(1, colorAccent + '60');
                    ctx.strokeStyle = lineGradient;
                    ctx.lineWidth = 1.5 + seeds.complexity;
                    ctx.stroke();
                }
            }
            
            ctx.shadowBlur = 0;
            
            // Directional lines - number based on symmetry seed
            const numDirections = symmetryOrder;
            const quadrantAngles = { north: -Math.PI/2, east: 0, south: Math.PI/2, west: Math.PI };
            const baseAngle = (quadrantAngles[quadrant] || 0) + rotationOffset;
            
            for (let i = 0; i < numDirections; i++) {
                const angle = baseAngle + (i * 2 * Math.PI / numDirections);
                const innerR = moonRadius + 10 + seeds.secondary * 10;
                const lineLength = 80 + seeds.primary * 40;
                const outerR = innerR + lineLength;
                
                const lineGradient = ctx.createLinearGradient(
                    centerX + Math.cos(angle) * innerR,
                    centerY + Math.sin(angle) * innerR,
                    centerX + Math.cos(angle) * outerR,
                    centerY + Math.sin(angle) * outerR
                );
                lineGradient.addColorStop(0, color1);
                lineGradient.addColorStop(0.5, color2);
                lineGradient.addColorStop(1, colorAccent);
                
                ctx.beginPath();
                ctx.moveTo(centerX + Math.cos(angle) * innerR, centerY + Math.sin(angle) * innerR);
                ctx.lineTo(centerX + Math.cos(angle) * outerR, centerY + Math.sin(angle) * outerR);
                ctx.strokeStyle = lineGradient;
                ctx.lineWidth = baseLineWidth;
                ctx.stroke();
                
                // Endpoint decorations
                ctx.shadowColor = colorGlow;
                ctx.shadowBlur = 15;
                const endSize = 4 + seeds.complexity * 4;
                ctx.beginPath();
                ctx.arc(centerX + Math.cos(angle) * outerR, centerY + Math.sin(angle) * outerR, endSize, 0, 2 * Math.PI);
                const endGradient = ctx.createRadialGradient(
                    centerX + Math.cos(angle) * outerR,
                    centerY + Math.sin(angle) * outerR,
                    0,
                    centerX + Math.cos(angle) * outerR,
                    centerY + Math.sin(angle) * outerR,
                    endSize
                );
                endGradient.addColorStop(0, colorAccent);
                endGradient.addColorStop(0.7, color2);
                endGradient.addColorStop(1, color1 + '00');
                ctx.fillStyle = endGradient;
                ctx.fill();
                
                // Midpoint orbital ring
                if (seeds.pattern >= 2) {
                    const midR = (innerR + outerR) / 2;
                    ctx.beginPath();
                    ctx.arc(centerX + Math.cos(angle) * midR, centerY + Math.sin(angle) * midR, 5 + seeds.secondary * 5, 0, 2 * Math.PI);
                    ctx.strokeStyle = colorAccent + '80';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
            
            ctx.shadowBlur = 0;
            
            // Inner sacred geometry - star with seed-based points
            const starPoints = symmetryOrder * 2;
            ctx.beginPath();
            for (let i = 0; i < starPoints; i++) {
                const angle = (i / starPoints) * 2 * Math.PI - Math.PI/2 + rotationOffset;
                const outerStarR = moonRadius + 20 + seeds.complexity * 15;
                const innerStarR = moonRadius + 8 + seeds.secondary * 8;
                const r = (i % 2 === 0) ? outerStarR : innerStarR;
                const x = centerX + Math.cos(angle) * r;
                const y = centerY + Math.sin(angle) * r;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            const starGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, moonRadius + 28);
            starGradient.addColorStop(0, colorAccent + 'A0');
            starGradient.addColorStop(0.6, color2 + '60');
            starGradient.addColorStop(1, color1 + '20');
            ctx.fillStyle = starGradient;
            ctx.fill();
            ctx.strokeStyle = color2;
            ctx.lineWidth = baseLineWidth * 0.8;
            ctx.stroke();
            
            // Secondary inner star layer based on pattern
            if (seeds.pattern !== 1) {
                ctx.beginPath();
                for (let i = 0; i < starPoints; i++) {
                    const phaseShift = Math.PI / starPoints + seeds.rotation * 0.2;
                    const angle = (i / starPoints) * 2 * Math.PI - Math.PI/2 + rotationOffset + phaseShift;
                    const outerStarR = moonRadius + 12 + seeds.secondary * 8;
                    const innerStarR = moonRadius + 5;
                    const r = (i % 2 === 0) ? outerStarR : innerStarR;
                    const x = centerX + Math.cos(angle) * r;
                    const y = centerY + Math.sin(angle) * r;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.fillStyle = colorGlow + '40';
                ctx.fill();
                ctx.strokeStyle = colorAccent + '80';
                ctx.lineWidth = 1.5;
                ctx.stroke();
            }
        }

        function drawOrganicStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds) {
            // Use seeds for unique variations
            seeds = seeds || { primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5, symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0 };
            
            const moonRadius = 30 + (moonPhase * 5) + (seeds.primary * 18);
            const baseLineWidth = 3 + seeds.complexity * 2;
            const rotationOffset = seeds.rotation * Math.PI * 2;
            
            // Distinctly GREEN/EARTH palette - forest greens, browns, moss
            const hue = 90 + seeds.colorShift * 50; // 90-140: Yellow-green to deep green
            const saturation = 55 + seeds.primary * 25;
            const color1 = `hsl(${hue}, ${saturation}%, 35%)`;
            const color2 = `hsl(${hue + 20}, ${saturation - 10}%, 50%)`;
            const colorGlow = `hsl(${hue + 10}, ${saturation - 5}%, 65%)`;
            const colorAccent = `hsl(${hue - 30}, 40%, 45%)`; // Brown accent
            
            // Flowing organic center with seed-based shape
            ctx.strokeStyle = color2;
            ctx.fillStyle = color1;
            ctx.lineWidth = baseLineWidth;
            
            const waveFreq1 = 3 + Math.floor(seeds.primary * 5);
            const waveFreq2 = 2 + Math.floor(seeds.secondary * 4);
            const waveAmp1 = 10 + seeds.complexity * 15;
            const waveAmp2 = 8 + seeds.secondary * 12;
            
            ctx.beginPath();
            for (let i = 0; i <= 360; i += 5) {
                const angle = (i / 180) * Math.PI + rotationOffset;
                const radius = moonRadius + Math.sin(angle * waveFreq1) * waveAmp1 + Math.cos(angle * waveFreq2) * waveAmp2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.globalAlpha = 0.3;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.stroke();
            
            // Organic vine-like extensions with seed variation
            const branches = Math.floor(starDensity * 0.5 + seeds.density * 6) + 4;
            for (let i = 0; i < branches; i++) {
                const startAngle = (i / branches) * 2 * Math.PI + rotationOffset;
                const lengthVariation = seededRandom(seeds.primary * 1000 + i);
                const length = 50 + lengthVariation * 50 + seeds.complexity * 30;
                const curveAmount = 0.2 + seededRandom(seeds.secondary * 1000 + i) * 0.4;
                
                ctx.beginPath();
                ctx.moveTo(
                    centerX + Math.cos(startAngle) * moonRadius,
                    centerY + Math.sin(startAngle) * moonRadius
                );
                
                // Curved bezier path with seed-based curve
                const curveDirection = seededRandom(seeds.complexity * 500 + i) > 0.5 ? 1 : -1;
                const cp1x = centerX + Math.cos(startAngle + curveAmount * curveDirection) * (moonRadius + length/2);
                const cp1y = centerY + Math.sin(startAngle + curveAmount * curveDirection) * (moonRadius + length/2);
                const endX = centerX + Math.cos(startAngle) * (moonRadius + length);
                const endY = centerY + Math.sin(startAngle) * (moonRadius + length);
                
                ctx.quadraticCurveTo(cp1x, cp1y, endX, endY);
                ctx.strokeStyle = color2;
                ctx.lineWidth = baseLineWidth * (0.8 - i * 0.05);
                ctx.stroke();
                
                // Leaf at end - size varies
                const leafSize = 4 + seededRandom(seeds.density * 1000 + i) * 6;
                ctx.beginPath();
                ctx.arc(endX, endY, leafSize, 0, 2 * Math.PI);
                ctx.fillStyle = color1;
                ctx.globalAlpha = 0.4 + seededRandom(seeds.colorShift * 1000 + i) * 0.4;
                ctx.fill();
                ctx.globalAlpha = 1;
                
                // Add sub-branches for complexity
                if (seeds.complexity > 0.5 && i % 2 === 0) {
                    const subAngle = startAngle + (curveDirection * 0.5);
                    const subLength = length * 0.4;
                    const subEndX = cp1x + Math.cos(subAngle) * subLength;
                    const subEndY = cp1y + Math.sin(subAngle) * subLength;
                    
                    ctx.beginPath();
                    ctx.moveTo(cp1x, cp1y);
                    ctx.lineTo(subEndX, subEndY);
                    ctx.strokeStyle = colorGlow;
                    ctx.lineWidth = baseLineWidth * 0.5;
                    ctx.globalAlpha = 0.6;
                    ctx.stroke();
                    ctx.globalAlpha = 1;
                }
            }
            
            // Center spiral with seed-based direction and tightness
            const spiralDirection = seeds.pattern >= 2 ? -1 : 1;
            const spiralTightness = 0.02 + seeds.secondary * 0.03;
            ctx.beginPath();
            for (let i = 0; i < 720; i++) {
                const angle = spiralDirection * (i / 180) * Math.PI + rotationOffset;
                const r = 5 + i * spiralTightness;
                if (r > moonRadius - 5) break;
                const x = centerX + Math.cos(angle) * r;
                const y = centerY + Math.sin(angle) * r;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.strokeStyle = color2;
            ctx.lineWidth = baseLineWidth * 0.7;
            ctx.globalAlpha = 0.6;
            ctx.stroke();
            ctx.globalAlpha = 1;
            
            // Add outer organic ring if pattern allows
            if (seeds.pattern >= 3) {
                ctx.beginPath();
                for (let i = 0; i <= 360; i += 10) {
                    const angle = (i / 180) * Math.PI + rotationOffset;
                    const wobble = seededRandom(seeds.primary * 100 + i) * 10;
                    const radius = 120 + Math.sin(angle * (waveFreq1 + 2)) * 8 + wobble;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.strokeStyle = colorGlow;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.4;
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
        }

        function drawGeometricStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds) {
            // Use seeds for unique variations
            seeds = seeds || { primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5, symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0 };
            
            const moonRadius = 30 + (moonPhase * 5) + (seeds.primary * 15);
            const baseLineWidth = 3 + seeds.complexity * 2;
            const rotationOffset = seeds.rotation * Math.PI * 2;
            const polygonSides = seeds.symmetry;
            
            // Distinctly BLUE/CYAN palette - electric, precise, technological
            const hue = 190 + seeds.colorShift * 40; // 190-230: Cyan to blue
            const saturation = 70 + seeds.secondary * 20;
            const color1 = `hsl(${hue}, ${saturation}%, 50%)`;
            const color2 = `hsl(${hue + 15}, ${saturation - 5}%, 60%)`;
            const colorAccent = `hsl(${hue - 10}, ${saturation + 10}%, 70%)`;
            const colorGold = `hsl(45, 80%, 55%)`; // Sacred geometry gold accent
            
            ctx.strokeStyle = color2;
            ctx.fillStyle = color1;
            ctx.lineWidth = baseLineWidth;
            
            // Central polygon with seed-based sides
            ctx.beginPath();
            for (let i = 0; i < polygonSides; i++) {
                const angle = (i / polygonSides) * 2 * Math.PI - Math.PI/2 + rotationOffset;
                const x = centerX + Math.cos(angle) * moonRadius;
                const y = centerY + Math.sin(angle) * moonRadius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.globalAlpha = 0.3;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.stroke();
            
            // Inner rotated polygon
            const innerRotation = Math.PI / polygonSides + seeds.secondary * 0.5;
            const innerRadius = moonRadius * 0.6;
            ctx.beginPath();
            for (let i = 0; i < polygonSides; i++) {
                const angle = (i / polygonSides) * 2 * Math.PI - Math.PI/2 + rotationOffset + innerRotation;
                const x = centerX + Math.cos(angle) * innerRadius;
                const y = centerY + Math.sin(angle) * innerRadius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.strokeStyle = colorAccent;
            ctx.lineWidth = baseLineWidth * 0.7;
            ctx.stroke();
            
            // Outer geometric pattern - lines between points
            const outerPoints = Math.floor(starDensity * 0.5 + seeds.density * 8) + 6;
            const outerRadius = 110 + seeds.primary * 20;
            const skipFactor = Math.floor(seeds.pattern * 3) + 2;
            
            ctx.strokeStyle = color2;
            ctx.lineWidth = baseLineWidth * 0.6;
            
            for (let i = 0; i < outerPoints; i++) {
                const angle1 = (i / outerPoints) * 2 * Math.PI + rotationOffset;
                const connectTo = (i + skipFactor) % outerPoints;
                const angle2 = (connectTo / outerPoints) * 2 * Math.PI + rotationOffset;
                
                ctx.beginPath();
                ctx.moveTo(
                    centerX + Math.cos(angle1) * outerRadius,
                    centerY + Math.sin(angle1) * outerRadius
                );
                ctx.lineTo(
                    centerX + Math.cos(angle2) * outerRadius,
                    centerY + Math.sin(angle2) * outerRadius
                );
                ctx.globalAlpha = 0.5 + seededRandom(seeds.complexity * 100 + i) * 0.3;
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
            
            // Concentric shapes based on pattern
            const concentricCount = 2 + Math.floor(seeds.complexity * 3);
            const concentricType = seeds.pattern;
            
            for (let j = 0; j < concentricCount; j++) {
                const r = moonRadius + 20 + j * (25 + seeds.secondary * 15);
                if (r > 140) break;
                
                ctx.beginPath();
                if (concentricType <= 1) {
                    // Circles
                    ctx.arc(centerX, centerY, r, 0, 2 * Math.PI);
                } else if (concentricType <= 3) {
                    // Polygons matching center
                    for (let i = 0; i < polygonSides; i++) {
                        const angle = (i / polygonSides) * 2 * Math.PI - Math.PI/2 + rotationOffset + (j * 0.1);
                        const x = centerX + Math.cos(angle) * r;
                        const y = centerY + Math.sin(angle) * r;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                } else {
                    // Stars
                    const starPoints = polygonSides * 2;
                    for (let i = 0; i < starPoints; i++) {
                        const angle = (i / starPoints) * 2 * Math.PI - Math.PI/2 + rotationOffset;
                        const starR = (i % 2 === 0) ? r : r - 10 - seeds.secondary * 10;
                        const x = centerX + Math.cos(angle) * starR;
                        const y = centerY + Math.sin(angle) * starR;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                }
                ctx.strokeStyle = colorAccent;
                ctx.lineWidth = 1.5;
                ctx.globalAlpha = 0.3 - j * 0.05;
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
            
            // Corner decorations based on symmetry
            for (let i = 0; i < polygonSides; i++) {
                const angle = (i / polygonSides) * 2 * Math.PI + rotationOffset;
                const distance = 100 + seeds.primary * 20;
                const cx = centerX + Math.cos(angle) * distance;
                const cy = centerY + Math.sin(angle) * distance;
                const size = 8 + seeds.secondary * 8;
                
                // Draw decorative shape based on pattern
                if (seeds.pattern <= 2) {
                    ctx.strokeStyle = color2;
                    ctx.lineWidth = baseLineWidth * 0.5;
                    ctx.strokeRect(cx - size/2, cy - size/2, size, size);
                } else {
                    ctx.beginPath();
                    ctx.arc(cx, cy, size/2, 0, 2 * Math.PI);
                    ctx.strokeStyle = color2;
                    ctx.lineWidth = baseLineWidth * 0.5;
                    ctx.stroke();
                    
                    // Cross inside
                    ctx.beginPath();
                    ctx.moveTo(cx - size/3, cy);
                    ctx.lineTo(cx + size/3, cy);
                    ctx.moveTo(cx, cy - size/3);
                    ctx.lineTo(cx, cy + size/3);
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
        }

        function drawMysticalStyle(ctx, centerX, centerY, moonPhase, starDensity, quadrant, seeds) {
            // Use seeds for unique variations
            seeds = seeds || { primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5, symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0 };
            
            const moonRadius = 30 + (moonPhase * 5) + (seeds.primary * 15);
            const baseLineWidth = 3 + seeds.complexity * 2;
            const rotationOffset = seeds.rotation * Math.PI * 2;
            
            // Distinctly PURPLE/VIOLET palette - mystical, occult, ethereal
            const hue = 270 + seeds.colorShift * 50; // 270-320: Purple to magenta
            const saturation = 60 + seeds.complexity * 25;
            const color1 = `hsl(${hue}, ${saturation}%, 40%)`;
            const color2 = `hsl(${hue + 25}, ${saturation - 5}%, 60%)`;
            const colorGlow = `hsl(${hue + 15}, ${saturation + 10}%, 70%)`;
            const colorSilver = `hsl(240, 10%, 75%)`; // Mystical silver accent
            
            ctx.strokeStyle = color2;
            ctx.fillStyle = color1;
            ctx.lineWidth = baseLineWidth;
            
            // Central sacred shape - varies based on pattern
            const centralSides = 3 + Math.floor(seeds.pattern * 2); // 3 to 7 sides
            ctx.beginPath();
            for (let i = 0; i < centralSides; i++) {
                const angle = (i / centralSides) * 2 * Math.PI - Math.PI/2 + rotationOffset;
                const x = centerX + Math.cos(angle) * moonRadius;
                const y = centerY + Math.sin(angle) * moonRadius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.globalAlpha = 0.3;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.stroke();
            
            // Inverted/interlocking shape - creates sacred geometry effect
            const secondRadius = moonRadius + 10 + seeds.secondary * 15;
            const secondRotation = Math.PI / centralSides + seeds.secondary * 0.3;
            ctx.beginPath();
            for (let i = 0; i < centralSides; i++) {
                const angle = (i / centralSides) * 2 * Math.PI + Math.PI/2 + rotationOffset + secondRotation;
                const x = centerX + Math.cos(angle) * secondRadius;
                const y = centerY + Math.sin(angle) * secondRadius;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.strokeStyle = colorGlow;
            ctx.lineWidth = baseLineWidth * 0.8;
            ctx.stroke();
            
            // Mystical symbols around the circle
            const symbolCount = Math.floor(starDensity * 0.5 + seeds.density * 8) + 4;
            const symbolTypes = ['circle-cross', 'eye', 'crescent', 'star', 'spiral'];
            
            for (let i = 0; i < symbolCount; i++) {
                const angle = (i / symbolCount) * 2 * Math.PI + rotationOffset;
                const distanceVariation = seededRandom(seeds.primary * 1000 + i);
                const distance = 80 + distanceVariation * 35;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                const symbolIndex = Math.floor(seededRandom(seeds.complexity * 500 + i) * symbolTypes.length);
                const symbolSize = 6 + seededRandom(seeds.secondary * 300 + i) * 6;
                
                ctx.strokeStyle = color2;
                ctx.fillStyle = color1;
                ctx.lineWidth = baseLineWidth * 0.5;
                
                switch(symbolTypes[symbolIndex]) {
                    case 'circle-cross':
                        ctx.beginPath();
                        ctx.arc(x, y, symbolSize, 0, 2 * Math.PI);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(x - symbolSize * 0.6, y);
                        ctx.lineTo(x + symbolSize * 0.6, y);
                        ctx.moveTo(x, y - symbolSize * 0.6);
                        ctx.lineTo(x, y + symbolSize * 0.6);
                        ctx.stroke();
                        break;
                    case 'eye':
                        ctx.beginPath();
                        ctx.ellipse(x, y, symbolSize, symbolSize * 0.5, angle, 0, 2 * Math.PI);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(x, y, symbolSize * 0.3, 0, 2 * Math.PI);
                        ctx.globalAlpha = 0.6;
                        ctx.fill();
                        ctx.globalAlpha = 1;
                        break;
                    case 'crescent':
                        ctx.beginPath();
                        ctx.arc(x, y, symbolSize, angle - Math.PI/2, angle + Math.PI/2);
                        ctx.stroke();
                        break;
                    case 'star':
                        ctx.beginPath();
                        for (let j = 0; j < 5; j++) {
                            const starAngle = (j / 5) * 2 * Math.PI - Math.PI/2 + angle;
                            const r = (j % 2 === 0) ? symbolSize : symbolSize * 0.4;
                            const sx = x + Math.cos(starAngle) * r;
                            const sy = y + Math.sin(starAngle) * r;
                            if (j === 0) ctx.moveTo(sx, sy);
                            else ctx.lineTo(sx, sy);
                        }
                        ctx.closePath();
                        ctx.stroke();
                        break;
                    case 'spiral':
                        ctx.beginPath();
                        for (let j = 0; j < 360; j += 20) {
                            const spiralAngle = (j / 180) * Math.PI;
                            const spiralR = j * 0.015 * symbolSize / 5;
                            const sx = x + Math.cos(spiralAngle + angle) * spiralR;
                            const sy = y + Math.sin(spiralAngle + angle) * spiralR;
                            if (j === 0) ctx.moveTo(sx, sy);
                            else ctx.lineTo(sx, sy);
                        }
                        ctx.stroke();
                        break;
                }
            }
            
            // Outer mystical ring with decorations
            const outerRadius = 120 + seeds.primary * 20;
            ctx.beginPath();
            ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
            ctx.strokeStyle = colorGlow;
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.5;
            ctx.stroke();
            ctx.globalAlpha = 1;
            
            // Add rune-like marks on outer ring
            if (seeds.complexity > 0.3) {
                const runeCount = seeds.symmetry;
                for (let i = 0; i < runeCount; i++) {
                    const angle = (i / runeCount) * 2 * Math.PI + rotationOffset;
                    const x1 = centerX + Math.cos(angle) * (outerRadius - 8);
                    const y1 = centerY + Math.sin(angle) * (outerRadius - 8);
                    const x2 = centerX + Math.cos(angle) * (outerRadius + 8);
                    const y2 = centerY + Math.sin(angle) * (outerRadius + 8);
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.strokeStyle = color2;
                    ctx.lineWidth = baseLineWidth * 0.6;
                    ctx.stroke();
                }
            }
            
            // Eye of providence in center - with variation
            const eyeRadius = 6 + seeds.complexity * 6;
            ctx.beginPath();
            ctx.arc(centerX, centerY, eyeRadius, 0, 2 * Math.PI);
            
            const eyeGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, eyeRadius);
            eyeGradient.addColorStop(0, colorGlow);
            eyeGradient.addColorStop(0.7, color2);
            eyeGradient.addColorStop(1, color1);
            ctx.fillStyle = eyeGradient;
            ctx.fill();
            
            // Pupil
            ctx.beginPath();
            ctx.arc(centerX, centerY, eyeRadius * 0.3, 0, 2 * Math.PI);
            ctx.fillStyle = '#1a1a2e';
            ctx.fill();
            
            // Inner connecting lines based on pattern
            if (seeds.pattern >= 2) {
                for (let i = 0; i < centralSides; i++) {
                    const angle = (i / centralSides) * 2 * Math.PI - Math.PI/2 + rotationOffset;
                    const x = centerX + Math.cos(angle) * moonRadius;
                    const y = centerY + Math.sin(angle) * moonRadius;
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.strokeStyle = color2 + '60';
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
        }

        function animateSigil() {
            const canvas = document.getElementById('sigilCanvas');
            if (!canvas) return;
            
            canvas.style.animation = 'sigilPulse 4s ease-in-out infinite';
            
            if (!document.getElementById('sigilPulseStyle')) {
                const style = document.createElement('style');
                style.id = 'sigilPulseStyle';
                style.textContent = `
                    @keyframes sigilPulse {
                        0%, 100% { 
                            transform: scale(1); 
                            filter: drop-shadow(0 0 20px rgba(0, 245, 255, 0.3)); 
                        }
                        50% { 
                            transform: scale(1.02); 
                            filter: drop-shadow(0 0 35px rgba(0, 245, 255, 0.5)); 
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // ==========================================
        // PART 6: Actions & Utilities
        // ==========================================
        
        function saveSigil() {
            const canvas = document.getElementById('sigilCanvas');
            if (!canvas) {
                showNotification('No sigil to save', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.download = `cosmic-birth-sigil-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            showNotification('‚ú® Sigil saved to your device!', 'success');
            
            if (window.trackEvent) {
                trackEvent('birth_sigil', 'save', 'download');
            }
        }
        
        function saveSigilHighRes() {
            if (!currentSigilData) {
                showNotification('No sigil to export', 'error');
                return;
            }
            
            // Create high-res canvas (2000x2000)
            const hiResCanvas = document.createElement('canvas');
            const size = 2000;
            hiResCanvas.width = size;
            hiResCanvas.height = size;
            const ctx = hiResCanvas.getContext('2d');
            
            const centerX = size / 2;
            const centerY = size / 2;
            
            // Scale factor for high-res drawing
            ctx.save();
            ctx.scale(5, 5); // 400 * 5 = 2000
            
            // Draw background
            const bgGradient = ctx.createRadialGradient(80, 80, 0, 80, 80, 200);
            bgGradient.addColorStop(0, 'rgba(20, 20, 50, 1)');
            bgGradient.addColorStop(1, 'rgba(10, 10, 25, 1)');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, 400, 400);
            
            // Extract seeds
            const seeds = currentSigilData.dateTime ? extractSeeds(currentSigilData.dateTime) : {
                primary: 0.5, secondary: 0.5, complexity: 0.5, rotation: 0.5,
                symmetry: 6, density: 0.5, colorShift: 0.5, pattern: 0
            };
            
            // Draw the sigil in high res
            switch(currentSigilData.style) {
                case 'cosmic':
                    drawCosmicStyle(ctx, 200, 200, currentSigilData.moonPhase, currentSigilData.starDensity, currentSigilData.quadrant, seeds);
                    break;
                case 'organic':
                    drawOrganicStyle(ctx, 200, 200, currentSigilData.moonPhase, currentSigilData.starDensity, currentSigilData.quadrant, seeds);
                    break;
                case 'geometric':
                    drawGeometricStyle(ctx, 200, 200, currentSigilData.moonPhase, currentSigilData.starDensity, currentSigilData.quadrant, seeds);
                    break;
                case 'mystical':
                    drawMysticalStyle(ctx, 200, 200, currentSigilData.moonPhase, currentSigilData.starDensity, currentSigilData.quadrant, seeds);
                    break;
                default:
                    drawCosmicStyle(ctx, 200, 200, currentSigilData.moonPhase, currentSigilData.starDensity, currentSigilData.quadrant, seeds);
            }
            
            // Draw constellation overlay
            drawZodiacConstellation(ctx, 200, 200, currentSigilData.dateTime, 0.35);
            
            ctx.restore();
            
            // Download
            const link = document.createElement('a');
            link.download = `cosmic-birth-sigil-highres-${Date.now()}.png`;
            link.href = hiResCanvas.toDataURL('image/png');
            link.click();
            
            showNotification('‚ú® High-resolution sigil (2000x2000) saved!', 'success');
            
            if (window.trackEvent) {
                trackEvent('birth_sigil', 'save', 'highres_download');
            }
        }

        function saveToJukebox() {
            if (!currentSigilData) {
                showNotification('No sigil data to save', 'error');
                return;
            }
            
            const canvas = document.getElementById('sigilCanvas');
            const imageData = canvas ? canvas.toDataURL('image/png') : null;
            
            const jukeboxItem = {
                id: 'sigil_' + Date.now(),
                type: 'birth-sigil',
                title: `Birth Sigil - ${currentSigilData.location.city}`,
                description: `${currentSigilData.moonInfo.name} ‚Ä¢ ${currentSigilData.quadrant} quadrant ‚Ä¢ ${currentSigilData.style} style`,
                data: {
                    location: currentSigilData.location.city,
                    moonPhase: currentSigilData.moonInfo.name,
                    starDensity: currentSigilData.starDensity,
                    quadrant: currentSigilData.quadrant,
                    style: currentSigilData.style,
                    dateTime: currentSigilData.dateTime.toISOString(),
                    imageData: imageData
                },
                savedAt: new Date().toISOString(),
                icon: '‚ú®'
            };
            
            // Get existing jukebox items
            let jukebox = [];
            try {
                jukebox = JSON.parse(localStorage.getItem('quantumJukebox') || '[]');
            } catch(e) {
                jukebox = [];
            }
            
            // Check for duplicate
            const exists = jukebox.some(item => 
                item.type === 'birth-sigil' && 
                item.data.dateTime === jukeboxItem.data.dateTime &&
                item.data.location === jukeboxItem.data.location
            );
            
            if (exists) {
                showNotification('This sigil is already in your library!', 'info');
                return;
            }
            
            jukebox.push(jukeboxItem);
            localStorage.setItem('quantumJukebox', JSON.stringify(jukebox));
            
            showNotification('üìö Sigil added to your library!', 'success');
            
            if (window.trackEvent) {
                trackEvent('birth_sigil', 'save', 'jukebox');
            }
        }

        function shareSocial() {
            if (!currentSigilData) {
                showNotification('No sigil to share', 'error');
                return;
            }
            
            const shareData = {
                title: 'My Cosmic Birth Sigil',
                text: `I just generated my cosmic birth sigil! ${currentSigilData.moonInfo.icon} ${currentSigilData.moonInfo.name} energy from ${currentSigilData.location.city} ‚ú®`,
                url: window.location.href
            };
            
            if (navigator.share) {
                navigator.share(shareData).catch(err => {
                    console.log('Share cancelled');
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`).then(() => {
                    showNotification('üìã Share text copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Could not copy to clipboard', 'error');
                });
            }
            
            if (window.trackEvent) {
                trackEvent('birth_sigil', 'share', 'social');
            }
        }

        function replayAnimation() {
            if (!currentSigilData) {
                showNotification('No sigil to replay', 'error');
                return;
            }
            
            // Re-run the animation with current data
            drawCosmicSigil(
                currentSigilData.moonPhase,
                currentSigilData.starDensity,
                currentSigilData.quadrant,
                currentSigilData.style,
                currentSigilData.dateTime
            );
            
            showNotification('Replaying animation...', 'info');
        }

        function generateNew() {
            // Reset form
            document.getElementById('day').value = '';
            document.getElementById('month').value = '';
            document.getElementById('year').value = '';
            document.getElementById('hour').value = '';
            document.getElementById('minute').value = '';
            document.getElementById('locationSearch').value = '';
            
            // Hide results
            document.getElementById('sigilDisplay').style.display = 'none';
            document.getElementById('regenerateBtn').style.display = 'none';
            
            // Reset state
            selectedLocation = null;
            currentSigilData = null;
            
            // Reset style to cosmic
            selectStyle('cosmic');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Focus on first input
            setTimeout(() => {
                document.getElementById('day').focus();
            }, 300);
        }

        // Load saved sigils on page load
        function loadSavedSigils() {
            let jukebox = [];
            try {
                jukebox = JSON.parse(localStorage.getItem('quantumJukebox') || '[]');
            } catch(e) {
                jukebox = [];
            }

            const birthSigils = jukebox.filter(item => item.type === 'birth-sigil');
            
            if (birthSigils.length > 0) {
                const section = document.getElementById('savedSigilsSection');
                const grid = document.getElementById('savedSigilsGrid');
                
                section.classList.add('has-sigils');
                
                grid.innerHTML = birthSigils.slice(0, 6).map((sigil, index) => {
                    const date = new Date(sigil.data.dateTime).toLocaleDateString();
                    return `
                        <div class="saved-sigil-card" onclick="loadSigil(${index})" title="${sigil.title}">
                            <div class="saved-sigil-thumbnail" style="background-image: url('${sigil.data.imageData}'); background-size: cover;"></div>
                            <div class="saved-sigil-info">
                                ${sigil.data.location}<br>
                                ${date}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function loadSigil(index) {
            try {
                const jukebox = JSON.parse(localStorage.getItem('quantumJukebox') || '[]');
                const birthSigils = jukebox.filter(item => item.type === 'birth-sigil');
                const sigil = birthSigils[index];
                
                if (sigil) {
                    showNotification('üí´ Sigil loaded from your library!', 'info');
                    // You could implement full sigil restoration here
                    document.getElementById('sigilDisplay').style.display = 'block';
                    const canvas = document.getElementById('sigilCanvas');
                    if (canvas && sigil.data.imageData) {
                        const ctx = canvas.getContext('2d');
                        const img = new Image();
                        img.onload = function() {
                            ctx.drawImage(img, 0, 0);
                        };
                        img.src = sigil.data.imageData;
                    }
                }
            } catch(e) {
                console.error('Error loading sigil:', e);
            }
        }
    </script>

    </div><!-- END #app-content -->

    <!-- QUANTUM MERLIN INTRO ANIMATION SCRIPT -->
    <script>
        (function() {
            const canvas = document.getElementById('lines-canvas');
            const ctx = canvas.getContext('2d', { alpha: true });
            const container = document.getElementById('intro-container');
            const appContent = document.getElementById('app-content');

            const quantum = document.getElementById('intro-quantum');
            const wizard = document.getElementById('intro-wizard');
            const rose = document.getElementById('intro-rose');
            const singularity = document.getElementById('singularity');
            const introTitle = document.getElementById('intro-title');

            let width, height, centerX, centerY;
            let time = 0;
            let isRunning = true;
            let wizardOrbitStart = 0;
            let roseOrbitStart = Math.PI;

            const dpr = Math.min(window.devicePixelRatio || 1, 1.5);

            function resize() {
                width = window.innerWidth;
                height = window.innerHeight;
                centerX = width / 2;
                centerY = height / 2;

                canvas.width = width * dpr;
                canvas.height = height * dpr;
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';
                ctx.scale(dpr, dpr);
            }

            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            function clamp(value, min, max) {
                return Math.max(min, Math.min(max, value));
            }

            function updateAnimation() {
                const t = time / 60;

                ctx.clearRect(0, 0, width, height);

                // PHASE 1: Quantum Emergence (0-1s)
                if (t < 1) {
                    const progress = clamp(t / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    quantum.style.left = centerX + 'px';
                    quantum.style.top = centerY + 'px';
                    quantum.style.transform = `translate(-50%, -50%) scale(${ease})`;
                    quantum.style.opacity = ease;
                    
                    wizard.style.opacity = 0;
                    rose.style.opacity = 0;
                }

                // PHASE 2: Wizard & Rose Arrival (1-2s)
                else if (t < 2) {
                    const progress = clamp((t - 1) / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    quantum.style.left = centerX + 'px';
                    quantum.style.top = centerY + 'px';
                    quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    quantum.style.opacity = 1;
                    
                    const wizardX = ease * (centerX - 80);
                    wizard.style.left = wizardX + 'px';
                    wizard.style.top = centerY + 'px';
                    wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    wizard.style.opacity = ease;
                    
                    const roseX = width - ease * (width - centerX - 80);
                    rose.style.left = roseX + 'px';
                    rose.style.top = centerY + 'px';
                    rose.style.transform = 'translate(-50%, -50%) scale(1)';
                    rose.style.opacity = ease;
                }

                // PHASE 3: Quiet Float (2-3s)
                else if (t < 3) {
                    quantum.style.left = centerX + 'px';
                    quantum.style.top = centerY + 'px';
                    quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    
                    wizard.style.left = (centerX - 80) + 'px';
                    wizard.style.top = centerY + 'px';
                    wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    
                    rose.style.left = (centerX + 80) + 'px';
                    rose.style.top = centerY + 'px';
                    rose.style.transform = 'translate(-50%, -50%) scale(1)';
                }

                // PHASE 4: Lines Emerge (3-4.5s)
                else if (t < 4.5) {
                    const progress = clamp((t - 3) / 1.5, 0, 1);
                    const rotation = progress * Math.PI * 2 * 0.5;
                    
                    ctx.strokeStyle = 'rgba(0, 240, 255, ' + (progress * 0.6) + ')';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation, rotation + Math.PI);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(255, 0, 255, ' + (progress * 0.6) + ')';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(157, 0, 255, ' + (progress * 0.6) + ')';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                    ctx.stroke();
                    
                    if (t < 4.51) {
                        wizardOrbitStart = Math.PI;
                        roseOrbitStart = 0;
                    }
                }

                // PHASE 5: Acceleration + Orbit (4.5-6.5s)
                else if (t < 6.5) {
                    const progress = clamp((t - 4.5) / 2, 0, 1);
                    const speedMultiplier = 1 + progress * 8;
                    const rotation = ((t - 3) * speedMultiplier) * Math.PI * 2 * 0.5;
                    
                    ctx.strokeStyle = 'rgba(0, 240, 255, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation, rotation + Math.PI);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(255, 0, 255, 0.6)';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(157, 0, 255, 0.6)';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                    ctx.stroke();
                    
                    quantum.style.left = centerX + 'px';
                    quantum.style.top = centerY + 'px';
                    quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    
                    const orbitProgress = (t - 4.5) * speedMultiplier * 0.5;
                    const orbitRadius = 80;
                    
                    const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                    wizard.style.left = wizardX + 'px';
                    wizard.style.top = wizardY + 'px';
                    wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    
                    const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                    rose.style.left = roseX + 'px';
                    rose.style.top = roseY + 'px';
                    rose.style.transform = 'translate(-50%, -50%) scale(1)';
                }

                // PHASE 6: Quantum Collapse (6.5-7.5s)
                else if (t < 7.5) {
                    const progress = clamp((t - 6.5) / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    const rotation = ((t - 3) * 9) * Math.PI * 2 * 0.5;
                    const lineOpacity = 0.6 * (1 - ease);
                    const lineRadius = 80 * (1 - ease);
                    
                    ctx.strokeStyle = 'rgba(0, 240, 255, ' + lineOpacity + ')';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, lineRadius, rotation, rotation + Math.PI);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(255, 0, 255, ' + lineOpacity + ')';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, lineRadius, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    ctx.stroke();
                    
                    const orbitProgress = (t - 4.5) * 9 * 0.5;
                    const orbitRadius = 80 * (1 - ease);
                    
                    const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                    
                    const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                    
                    const emojiScale = 1 - ease * 0.9;
                    
                    wizard.style.left = wizardX + 'px';
                    wizard.style.top = wizardY + 'px';
                    wizard.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                    wizard.style.opacity = 1 - ease;
                    
                    rose.style.left = roseX + 'px';
                    rose.style.top = roseY + 'px';
                    rose.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                    rose.style.opacity = 1 - ease;
                    
                    const quantumScale = 1 + (ease < 0.3 ? ease * 0.5 : (1 - ease) * 1.5);
                    quantum.style.left = centerX + 'px';
                    quantum.style.top = centerY + 'px';
                    quantum.style.transform = `translate(-50%, -50%) scale(${quantumScale})`;
                    quantum.style.opacity = 1 - ease;
                    
                    singularity.style.transform = `translate(-50%, -50%) scale(${ease})`;
                    singularity.style.opacity = ease;
                }

                // PHASE 7: Singularity Pause (7.5-8s)
                else if (t < 8) {
                    quantum.style.opacity = 0;
                    wizard.style.opacity = 0;
                    rose.style.opacity = 0;
                    
                    const pulse = Math.sin((t - 7.5) * Math.PI * 4) * 0.2 + 1;
                    singularity.style.transform = `translate(-50%, -50%) scale(${pulse})`;
                    singularity.style.opacity = 1;
                }

                // PHASE 8: Title Reveal (8-10s)
                else if (t < 10) {
                    const progress = clamp((t - 8) / 2, 0, 1);
                    const ease = easeInOutCubic(progress);
                    
                    singularity.style.transform = `translate(-50%, -50%) scale(1)`;
                    singularity.style.opacity = 1 - ease;
                    
                    // Responsive font size: fits within 90% of screen width
                    const maxFontSize = Math.min(width * 0.065, 42);
                    const fontSize = ease * maxFontSize;
                    
                    introTitle.style.fontSize = fontSize + 'px';
                    introTitle.style.transform = `translate(-50%, -50%)`;
                    introTitle.style.opacity = ease;
                }

                // PHASE 9: Hold & Fade Out (10-11s)
                else if (t < 11) {
                    singularity.style.opacity = 0;
                    
                    // Responsive font size: fits within 90% of screen width
                    const maxFontSize = Math.min(width * 0.065, 42);
                    introTitle.style.fontSize = maxFontSize + 'px';
                    introTitle.style.opacity = 1;
                    
                    if (t > 10.5) {
                        const fadeProgress = (t - 10.5) / 0.5;
                        container.style.opacity = 1 - fadeProgress;
                    }
                }

                // PHASE 10: Complete (11s+)
                else if (t >= 11) {
                    if (isRunning) {
                        isRunning = false;
                        complete();
                    }
                }

                time++;
                if (isRunning) {
                    requestAnimationFrame(updateAnimation);
                }
            }

            function complete() {
                container.classList.add('fade-out');
                setTimeout(() => {
                    container.style.display = 'none';
                    appContent.classList.add('visible');
                }, 100);
            }

            resize();
            window.addEventListener('resize', resize);
            window.addEventListener('load', () => {
                setTimeout(() => {
                    updateAnimation();
                }, 100);
            });
        })();
    </script>

    <!-- Quantum Profile System -->
    <script src="./shared/js/quantum-profile.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚ú® QRC Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
