<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Forecaster | Your Personalized Cosmic Forecast</title>
    <meta name="description" content="Get your personalized cosmic forecast using astrology, Chinese zodiac, numerology, and gematria. Multi-system forecasting for daily, weekly, monthly, and yearly insights.">
    <meta name="keywords" content="quantum forecaster, daily horoscope, personalized forecast, astrology, numerology, chinese zodiac, gematria, cosmic guidance">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Quantum Forecaster | Multi-System Cosmic Guidance">
    <meta property="og:description" content="The only forecaster that uses 8 mystical systems. From surface to soul: forecasts that go as deep as you want.">
    <meta property="og:url" content="https://quantummerlin.com/forecasts">
    <meta property="og:type" content="website">
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#00f5ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quantum Forecast">
    <link rel="apple-touch-icon" href="/assets/tarot/QMTarot.png">
    <link rel="icon" type="image/png" href="/assets/tarot/QMTarot.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Swiss Ephemeris for accurate astronomical calculations -->
    <script src="https://cdn.jsdelivr.net/npm/swisseph@2.10.3-2/dist/swisseph.min.js"></script>
    
    <style>
        :root {
            --cosmic-bg: #000000;
            --neon-cyan: #00f5ff;
            --neon-purple: #9d00ff;
            --neon-gold: #ffd700;
            --neon-pink: #ff0066;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--cosmic-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Cosmic Background */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(ellipse at center, #1a0033 0%, #000000 100%);
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }

        /* Hero Section - WOW FACTOR */
        .hero {
            text-align: center;
            margin-bottom: 60px;
            padding: 80px 20px 60px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(157, 0, 255, 0.3) 0%, rgba(0, 245, 255, 0.2) 30%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: heroOrb 8s ease-in-out infinite;
            z-index: 0;
        }

        .hero::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 60%);
            transform: translate(-50%, -50%);
            animation: heroOrb 6s ease-in-out infinite reverse;
            z-index: 0;
        }

        @keyframes heroOrb {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-subtitle {
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            color: var(--neon-cyan);
            letter-spacing: 8px;
            text-transform: uppercase;
            margin-bottom: 15px;
            animation: subtitleGlow 2s ease-in-out infinite;
        }

        @keyframes subtitleGlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; text-shadow: 0 0 20px var(--neon-cyan); }
        }

        .hero h1 {
            font-family: 'Orbitron', monospace;
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, var(--neon-cyan) 25%, var(--neon-purple) 50%, var(--neon-gold) 75%, #fff 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            animation: gradientShift 5s ease infinite, titleFloat 3s ease-in-out infinite;
            text-shadow: none;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .tagline {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            position: relative;
        }

        .tagline::after {
            content: '✨';
            position: absolute;
            right: -30px;
            animation: sparkle 1s ease-in-out infinite;
        }

        .tagline::before {
            content: '✨';
            position: absolute;
            left: -30px;
            animation: sparkle 1s ease-in-out infinite 0.5s;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .systems {
            display: block;
            text-align: center;
            margin-top: 25px;
            line-height: 1.8;
        }

        .systems-text {
            font-size: 1rem;
            font-weight: 500;
            background: linear-gradient(135deg, #00f5ff 0%, #9d00ff 50%, #ff0066 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        @keyframes glow-pulse {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 245, 255, 0.4)); }
            50% { filter: drop-shadow(0 0 40px rgba(0, 245, 255, 0.8)); }
        }

        /* Library Button - Top Left Corner */
        .library-floating {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }
        
        /* Buy Me a Coffee - Top Right Corner */
        .coffee-floating {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .library-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(157, 0, 255, 0.9);
            color: #ffffff;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            font-size: 0.85rem;
            padding: 10px 18px;
            border: 2px solid rgba(0, 245, 255, 0.5);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(157, 0, 255, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .library-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(157, 0, 255, 0.5);
            background: rgba(157, 0, 255, 1);
            border-color: rgba(0, 245, 255, 1);
        }
        
        .library-icon {
            font-size: 1.2rem;
            animation: libraryPulse 2s ease-in-out infinite;
        }
        
        @keyframes libraryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .library-counter {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ff0066, #ff3399);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 3px 7px;
            border-radius: 12px;
            border: 2px solid #000;
            min-width: 20px;
            text-align: center;
            display: none;
        }

        .coffee-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 221, 0, 0.9);
            color: #000000;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            font-size: 0.85rem;
            padding: 10px 18px;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 221, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .coffee-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 221, 0, 0.5);
            background: rgba(255, 221, 0, 1);
        }

        .coffee-btn .coffee-icon {
            font-size: 1.2rem;
            animation: coffeeFloat 2s ease-in-out infinite;
        }

        @keyframes coffeeFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            .library-floating {
                top: 10px;
                left: 10px;
            }
            .coffee-floating {
                top: 10px;
                right: 10px;
            }
            .coffee-btn,
            .library-btn {
                padding: 8px 14px;
                font-size: 0.75rem;
            }
            .library-btn span:not(.library-icon):not(.library-counter) {
                display: none;
            }
            .coffee-btn span:not(.coffee-icon) {
                display: none;
            }
            .tagline::before, .tagline::after {
                display: none;
            }
        }

        /* Cosmic Overview Dashboard */
        .cosmic-overview {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.15) 0%, rgba(255, 0, 102, 0.15) 100%);
            border: 3px solid var(--neon-purple);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .cosmic-overview::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(157, 0, 255, 0.1) 0%, transparent 70%);
            animation: rotateGlow 10s linear infinite;
        }

        @keyframes rotateGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .cosmic-overview-content {
            position: relative;
            z-index: 1;
        }

        .cosmic-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--neon-gold), var(--neon-pink), var(--neon-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .cosmic-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 25px;
            letter-spacing: 2px;
        }

        .energy-indicators {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .energy-badge {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid;
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        .energy-badge.peak {
            border-color: var(--neon-gold);
            color: var(--neon-gold);
            animation: peakPulse 1s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .energy-badge.high {
            border-color: var(--neon-gold);
            color: var(--neon-gold);
            animation: highPulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .energy-badge.moderate {
            border-color: var(--neon-purple);
            color: var(--neon-purple);
        }

        .energy-badge.low {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        @keyframes peakPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 50px rgba(255, 215, 0, 0.8); }
        }

        @keyframes highPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.6); }
        }

        .cosmic-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .cosmic-meta-item {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .cosmic-meta-item:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.2);
        }

        .cosmic-meta-item h4 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-cyan);
            font-size: 0.9rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .cosmic-meta-item p {
            font-size: 1.3rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .cosmic-meta-item .meta-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .share-energy-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .share-energy-section h4 {
            color: var(--neon-gold);
            font-family: 'Orbitron', monospace;
            margin-bottom: 15px;
        }

        .share-energy-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-energy-btn {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.3) 0%, rgba(255, 0, 102, 0.3) 100%);
            border: 2px solid var(--neon-purple);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
        }

        .share-energy-btn:hover {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.5) 0%, rgba(255, 0, 102, 0.5) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(157, 0, 255, 0.4);
        }

        .hero .tagline {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .hero .systems {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .system-badge {
            background: rgba(0, 245, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--neon-cyan);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }
        
        .system-badge:nth-child(1) { animation-delay: 0s; }
        .system-badge:nth-child(2) { animation-delay: 0.5s; }
        .system-badge:nth-child(3) { animation-delay: 1s; }
        .system-badge:nth-child(4) { animation-delay: 1.5s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .system-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
            border-color: var(--neon-cyan);
            animation-play-state: paused;
        }

        /* Input Section */
        .input-section {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.08) 0%, rgba(157, 0, 255, 0.08) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 245, 255, 0.4);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 245, 255, 0.2);
            overflow: hidden;
            box-sizing: border-box;
        }

        .input-section h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            color: var(--neon-gold);
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--neon-cyan);
            margin-bottom: 10px;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            max-width: 100%;
            padding: 15px;
            font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            color: white;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .optional-badge {
            display: inline-block;
            font-size: 0.8rem;
            color: rgba(255, 215, 0, 0.7);
            margin-left: 8px;
        }

        .help-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
        }

        /* Expandable Sections */
        .expandable {
            margin-top: 30px;
        }

        .expand-btn {
            background: rgba(157, 0, 255, 0.2);
            border: 2px solid rgba(157, 0, 255, 0.4);
            color: var(--neon-purple);
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(157, 0, 255, 0.3);
            user-select: none;
            -webkit-user-select: none;
            min-height: 48px;
            position: relative;
            z-index: 100;
        }

        .expand-btn:active {
            background: rgba(157, 0, 255, 0.4);
            transform: scale(0.98);
        }

        .expand-btn:hover {
            background: rgba(157, 0, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(157, 0, 255, 0.4);
        }

        .expanded-content {
            display: none;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .expanded-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Accuracy Indicator */
        .accuracy-indicator {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .accuracy-indicator h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            color: var(--neon-gold);
            margin-bottom: 15px;
        }

        .accuracy-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .accuracy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-gold));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .data-checklist {
            list-style: none;
        }

        .data-checklist li {
            padding: 8px 0;
            font-size: 1rem;
        }

        .data-checklist li:before {
            content: "✅ ";
            margin-right: 10px;
        }

        .data-checklist li.missing:before {
            content: "⚠️ ";
        }

        /* Generate Button with magical effects */
        .generate-btn {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border: none;
            color: white;
            padding: 18px 50px;
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.4);
            position: relative;
            overflow: hidden;
            animation: buttonPulse 2s ease-in-out infinite;
        }
        
        @keyframes buttonPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(0, 245, 255, 0.4); }
            50% { box-shadow: 0 0 50px rgba(0, 245, 255, 0.6), 0 0 80px rgba(157, 0, 255, 0.3); }
        }
        
        .generate-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            transform: rotate(45deg);
            animation: buttonShine 3s ease-in-out infinite;
        }
        
        @keyframes buttonShine {
            0% { left: -150%; }
            50%, 100% { left: 150%; }
        }

        .generate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 50px rgba(0, 245, 255, 0.6), 0 0 100px rgba(157, 0, 255, 0.4);
            animation-play-state: paused;
        }

        .generate-btn:active {
            transform: scale(0.98);
        }

        /* Timeframe Selector */
        .timeframe-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .timeframe-btn {
            background: rgba(0, 245, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.3);
            color: var(--neon-cyan);
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeframe-btn:hover,
        .timeframe-btn.active {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.4);
        }

        /* Forecast Output */
        .forecast-output {
            display: none;
        }

        .forecast-output.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ========================================
           MAGICAL ANIMATIONS
           ======================================== */
        
        @keyframes glowPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), 0 0 40px rgba(255, 0, 102, 0.2);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), 0 0 80px rgba(255, 0, 102, 0.4);
            }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        
        @keyframes borderGlow {
            0%, 100% { border-color: rgba(0, 245, 255, 0.4); }
            50% { border-color: rgba(0, 245, 255, 0.8); }
        }
        
        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 10px currentColor; }
            50% { text-shadow: 0 0 20px currentColor, 0 0 40px currentColor; }
        }

        .forecast-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 0, 102, 0.1) 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            animation: glowPulse 3s ease-in-out infinite;
        }

        .forecast-header h2 {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--neon-gold), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            animation: textGlow 2s ease-in-out infinite;
        }

        .forecast-meta {
            font-size: 1.1rem;
            color: var(--text-secondary);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .forecast-meta p {
            margin: 8px 0;
        }
        
        .location-highlight {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5),
                         0 0 20px rgba(0, 255, 136, 0.3);
            font-weight: 600;
        }

        /* Special Date Banner */
        .special-date-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 140, 0, 0.2) 100%);
            border: 3px solid var(--neon-gold);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            animation: glowPulse 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .special-date-banner h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            color: var(--neon-gold);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .special-date-banner p {
            font-size: 1.2rem;
            color: #FFD700;
            line-height: 1.8;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        }

        /* Overview Section with shimmer effect */
        .overview-section {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.15) 0%, rgba(157, 0, 255, 0.15) 100%);
            border: 2px solid var(--neon-cyan);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: borderGlow 4s ease-in-out infinite;
            text-align: center;
        }
        
        .overview-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 8s linear infinite;
            pointer-events: none;
        }

        .overview-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-cyan);
            margin-bottom: 20px;
        }

        .overview-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        /* System Sections with hover magic */
        .system-section {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .system-section:hover {
            border-color: rgba(0, 245, 255, 0.5);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.2), inset 0 0 20px rgba(0, 245, 255, 0.05);
            transform: translateY(-2px);
        }

        .system-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 245, 255, 0.05);
            transition: background 0.3s ease;
        }
        
        .system-header:hover {
            background: rgba(0, 245, 255, 0.1);
        }

        .system-header h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            color: var(--neon-cyan);
            transition: text-shadow 0.3s ease;
        }
        
        .system-header:hover h3 {
            text-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
        }

        .system-toggle {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .system-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.3s ease;
            padding: 0 25px;
        }

        .system-section.expanded .system-content {
            max-height: 10000px;
            padding: 25px;
        }

        .system-section.expanded .system-toggle {
            transform: rotate(180deg);
        }

        .system-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .system-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .system-item h4 {
            color: var(--neon-gold);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .system-item p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Action Item with magic effects */
        .action-section {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 0, 102, 0.15) 100%);
            border: 2px solid var(--neon-gold);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            animation: glowPulse 4s ease-in-out infinite;
            text-align: center;
        }
        
        .action-section::after {
            content: '✨';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            animation: sparkleRotate 3s linear infinite;
            opacity: 0.7;
        }
        
        @keyframes sparkleRotate {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.2); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .action-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-gold);
            margin-bottom: 20px;
        }

        .action-item {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid var(--neon-gold);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            text-align: left;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .action-item:hover {
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            border-left-width: 6px;
        }

        .action-item h4 {
            color: var(--neon-cyan);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .action-item p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Magical Buttons */
        .save-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--neon-gold);
            color: var(--neon-gold);
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            position: relative;
            overflow: hidden;
        }
        
        .save-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .save-btn:hover::before {
            left: 100%;
        }

        .save-btn:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .hero .tagline {
                font-size: 1.1rem;
            }

            .input-section {
                padding: 25px 20px;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .timeframe-selector {
                flex-direction: column;
            }

            .timeframe-btn {
                width: 100%;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid rgba(0, 245, 255, 0.2);
            border-top: 4px solid var(--neon-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========================================
           PHASE 2: Enhanced Forecast Styles
           ======================================== */

        /* Cosmic Timing Section */
        .cosmic-timing-section {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.15) 0%, rgba(255, 0, 102, 0.15) 100%);
            border: 2px solid var(--neon-purple);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .cosmic-timing-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-purple);
            margin-bottom: 20px;
        }

        .timing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .timing-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(157, 0, 255, 0.4);
            border-radius: 15px;
            padding: 20px;
        }

        .timing-item strong {
            display: block;
            color: var(--neon-gold);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .timing-item p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .timing-item em {
            color: var(--neon-cyan);
            font-style: normal;
        }

        /* Reality Codes Section */
        .reality-codes-section {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.15), rgba(255, 0, 255, 0.15));
            border: 2px solid rgba(157, 0, 255, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .reality-codes-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: #9d00ff;
            margin-bottom: 20px;
        }
        
        .reality-code-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .reality-code-card:hover {
            border-color: var(--neon-gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            transform: translateY(-3px);
        }
        
        .reality-statement {
            font-size: 1.3rem;
            font-style: italic;
            color: #fff;
            line-height: 1.8;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(0, 245, 255, 0.1));
            border-radius: 10px;
        }
        
        .reality-why {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #9d00ff;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .reality-match {
            display: inline-block;
            background: linear-gradient(135deg, #9d00ff, #ff00ff);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .reality-code-display {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            color: var(--neon-gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin: 20px 0;
        }
        
        .amplification-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .amp-item {
            text-align: center;
        }
        
        .amp-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .amp-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--neon-cyan);
        }
        
        .reality-code-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .reality-code-btn {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.3), rgba(0, 245, 255, 0.3));
            border: 2px solid #9d00ff;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reality-code-btn:hover {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.5), rgba(0, 245, 255, 0.5));
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(157, 0, 255, 0.4);
        }
        
        .reality-code-btn.primary {
            background: linear-gradient(135deg, #9d00ff, #ff00ff);
            border-color: transparent;
        }
        
        .mersenne-theory {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
        }
        
        .mersenne-theory h4 {
            color: var(--neon-gold);
            margin-bottom: 15px;
        }
        
        .mersenne-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .mersenne-item {
            text-align: center;
            padding: 10px;
            background: rgba(157, 0, 255, 0.1);
            border-radius: 10px;
        }
        
        .mersenne-power {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--neon-cyan);
        }
        
        .mersenne-people {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Bottom Timeframe Toggle */
        .bottom-timeframe-toggle {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.1), rgba(157, 0, 255, 0.1));
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        
        .bottom-timeframe-toggle h4 {
            color: var(--neon-cyan);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .bottom-timeframe-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .bottom-timeframe-btn {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 245, 255, 0.4);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bottom-timeframe-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
        }
        
        .bottom-timeframe-btn.active {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border-color: transparent;
        }
        
        .scroll-top-btn {
            background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan));
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .scroll-top-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(0, 245, 255, 0.4);
        }

        /* Tarot Card Display */
        .tarot-section {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15) 0%, rgba(255, 215, 0, 0.15) 100%);
            border: 2px solid var(--neon-gold);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .tarot-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-gold);
            margin-bottom: 20px;
            text-align: center;
        }

        .tarot-card-display {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Tarot Card Flip Animation */
        .tarot-card-container {
            perspective: 1000px;
            cursor: pointer;
        }

        .tarot-card {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(75, 0, 130, 0.4));
            border: 3px solid var(--neon-gold);
            border-radius: 15px;
            padding: 30px 20px;
            min-width: 200px;
            min-height: 350px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
        }

        .tarot-card.flipped {
            transform: rotateY(180deg);
        }

        .tarot-card-back,
        .tarot-card-front {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .tarot-card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            overflow: hidden;
        }

        .tarot-card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .tarot-card-back .tap-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: var(--neon-gold);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            animation: pulse-hint 2s ease-in-out infinite;
            white-space: nowrap;
        }

        @keyframes pulse-hint {
            0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.7; transform: translateX(-50%) scale(0.95); }
        }

        .tarot-card-front {
            transform: rotateY(180deg);
        }

        .tarot-card:not(.flipped) .tarot-card-front {
            visibility: hidden;
        }

        .tarot-card.flipped .tarot-card-back {
            visibility: hidden;
        }

        .tarot-card:hover:not(.flipped) {
            transform: scale(1.05) rotateY(10deg);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5), 0 0 80px rgba(157, 0, 255, 0.3);
        }

        .tarot-card.flipped:hover {
            transform: rotateY(180deg) scale(1.02);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
        }

        /* Yearly Tarot Cards - Smaller size for 12-month spread */
        .yearly-tarot-grid {
            max-width: 100%;
        }

        .yearly-tarot-card {
            min-width: unset !important;
            min-height: 180px !important;
            padding: 15px 10px !important;
            width: 100%;
        }

        .yearly-tarot-card .tarot-image {
            max-width: 100%;
            width: 80px;
            height: auto;
        }

        .yearly-tarot-card .tarot-name {
            font-size: 0.85rem !important;
        }

        .yearly-tarot-card .tarot-number {
            font-size: 0.9rem !important;
        }

        .yearly-tarot-card .tap-hint {
            font-size: 0.7rem !important;
            padding: 5px 10px !important;
        }

        /* Responsive: 3 columns on medium, 2 on small */
        @media (max-width: 900px) {
            .yearly-tarot-grid {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }

        @media (max-width: 600px) {
            .yearly-tarot-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }
            .yearly-tarot-card {
                min-height: 150px !important;
                padding: 10px 8px !important;
            }
            .yearly-tarot-card .tarot-image {
                width: 60px;
            }
            .yearly-tarot-card .tarot-name {
                font-size: 0.75rem !important;
            }
        }

        /* Magical reveal particles */
        .tarot-card.revealing::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: magic-burst 0.8s ease-out forwards;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes magic-burst {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .tarot-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .tarot-symbol {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .tarot-number {
            color: var(--neon-gold);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .tarot-name {
            color: var(--neon-cyan);
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
        }

        .tarot-meaning {
            flex: 1;
            min-width: 280px;
        }

        .tarot-meaning p {
            margin-bottom: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .tarot-card-front .tarot-meaning {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        .tarot-meaning p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 15px;
        }

        .tarot-meaning strong {
            color: var(--neon-gold);
        }

        /* Frequency Healing Section */
        .frequency-display {
            background: linear-gradient(135deg, rgba(0, 200, 150, 0.15) 0%, rgba(0, 100, 200, 0.15) 100%);
            border: 2px solid rgba(0, 245, 255, 0.6);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .frequency-main {
            margin-bottom: 25px;
        }

        .frequency-hz {
            display: block;
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 700;
            color: var(--neon-gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
        }

        .frequency-name {
            display: block;
            font-size: 1.5rem;
            color: var(--neon-cyan);
            font-weight: 600;
        }

        .frequency-details {
            text-align: left;
            margin-bottom: 25px;
        }

        .frequency-details p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 12px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .frequency-details strong {
            color: var(--neon-cyan);
        }

        .frequency-link {
            display: inline-block;
            background: linear-gradient(135deg, var(--neon-magenta), var(--neon-cyan));
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.4);
            border: none;
            cursor: pointer;
            margin: 5px;
        }

        .frequency-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 40px rgba(255, 0, 128, 0.6);
        }

        .frequency-link.primary {
            background: linear-gradient(135deg, var(--neon-gold), var(--neon-magenta));
            font-size: 1.2rem;
            padding: 18px 35px;
        }

        .frequency-link.secondary {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.3), rgba(157, 0, 255, 0.3));
            border: 2px solid var(--neon-cyan);
            font-size: 1rem;
            padding: 12px 25px;
        }

        .frequency-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }

        .frequency-science {
            margin-top: 30px;
            padding: 20px;
            background: rgba(157, 0, 255, 0.1);
            border-left: 4px solid var(--neon-magenta);
            border-radius: 10px;
            text-align: left;
        }

        .frequency-science h4 {
            color: var(--neon-gold);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .frequency-science p {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        /* Planetary Aspects Section */
        .aspects-section {
            background: linear-gradient(135deg, rgba(0, 100, 255, 0.15) 0%, rgba(138, 43, 226, 0.15) 100%);
            border: 2px solid rgba(0, 245, 255, 0.6);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .aspects-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-cyan);
            margin-bottom: 20px;
        }

        .aspects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .aspect-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            transition: border-color 0.3s ease;
        }

        .aspect-item:hover {
            border-color: var(--neon-cyan);
        }

        .aspect-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .aspect-symbol {
            font-size: 2rem;
            color: var(--neon-gold);
        }

        .aspect-type {
            color: var(--neon-cyan);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .aspect-planets {
            color: var(--neon-purple);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .aspect-meaning {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Best Day Banner */
        .best-day-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 0, 102, 0.2) 100%);
            border: 3px solid var(--neon-gold);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
        }

        .best-day-banner h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.6rem;
            color: var(--neon-gold);
            margin-bottom: 20px;
        }

        .best-day-content {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
        }

        .best-day-name {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--neon-cyan);
            margin-bottom: 15px;
            font-family: 'Orbitron', monospace;
        }

        .best-day-content p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .best-day-content strong {
            color: var(--neon-gold);
        }

        .day-item.best-day {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(0, 245, 255, 0.15));
            border: 2px solid var(--neon-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .best-day-note {
            color: var(--neon-gold);
            font-weight: 600;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
        }

        /* Planetary Houses Section */
        .houses-section {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15) 0%, rgba(0, 100, 255, 0.15) 100%);
            border: 2px solid rgba(138, 43, 226, 0.6);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .houses-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-purple);
            margin-bottom: 20px;
        }

        .houses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .house-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            padding: 20px;
            transition: border-color 0.3s ease, transform 0.2s ease;
        }

        .house-item:hover {
            border-color: var(--neon-purple);
            transform: translateY(-2px);
        }

        .house-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .planet-symbol {
            font-size: 1.8rem;
            color: var(--neon-gold);
        }

        .planet-name {
            color: var(--neon-cyan);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .house-number {
            color: var(--neon-purple);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .house-meaning {
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }

        /* Cross-Reference Sections */
        .cross-reference-section {
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .cross-reference-section.agreement {
            background: linear-gradient(135deg, rgba(0, 255, 100, 0.1) 0%, rgba(0, 245, 255, 0.1) 100%);
            border: 2px solid rgba(0, 255, 100, 0.4);
        }

        .cross-reference-section.tension {
            background: linear-gradient(135deg, rgba(255, 100, 0, 0.1) 0%, rgba(255, 0, 102, 0.1) 100%);
            border: 2px solid rgba(255, 100, 0, 0.4);
        }

        .cross-reference-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            margin-bottom: 20px;
        }

        .cross-reference-section.agreement h3 {
            color: #00ff64;
        }

        .cross-reference-section.tension h3 {
            color: #ff6400;
        }

        .cross-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .cross-item:last-child {
            margin-bottom: 0;
        }

        .system-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .system-badges .badge {
            background: rgba(0, 245, 255, 0.2);
            border: 1px solid rgba(0, 245, 255, 0.5);
            color: var(--neon-cyan);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .system-badges .badge.tension {
            background: rgba(255, 100, 0, 0.2);
            border-color: rgba(255, 100, 0, 0.5);
            color: #ff9040;
        }

        /* Weekly/Monthly/Yearly Breakdowns */
        .weekly-breakdown,
        .monthly-breakdown,
        .yearly-breakdown {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .weekly-breakdown h3,
        .monthly-breakdown h3,
        .yearly-breakdown h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            color: var(--neon-cyan);
            margin-bottom: 25px;
        }

        .days-grid,
        .weeks-grid,
        .quarters-grid {
            display: grid;
            gap: 15px;
        }

        .days-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .weeks-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .quarters-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .day-item,
        .week-item,
        .quarter-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s ease;
        }

        .day-item:hover,
        .week-item:hover,
        .quarter-item:hover {
            border-color: rgba(0, 245, 255, 0.4);
            transform: translateY(-2px);
        }

        .day-item.today {
            border-color: var(--neon-gold);
            background: rgba(255, 215, 0, 0.1);
        }

        .day-item h4,
        .week-item h4,
        .quarter-item h4 {
            color: var(--neon-gold);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .day-item p,
        .week-item p,
        .quarter-item p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        /* Key Dates Section */
        .key-dates-section {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(157, 0, 255, 0.1) 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .key-dates-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            color: var(--neon-gold);
            margin-bottom: 20px;
        }

        .key-dates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .key-date-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
        }

        .key-date-item h4 {
            color: var(--neon-cyan);
            margin-bottom: 12px;
        }

        .key-date-item p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Major Transits Section */
        .major-transits-section {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(157, 0, 255, 0.4);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .major-transits-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            color: var(--neon-purple);
            margin-bottom: 20px;
        }

        .transit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .transit-item {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(157, 0, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .transit-item h4 {
            color: var(--neon-gold);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .transit-item p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Enhanced Action Items */
        .action-item.cosmic-timing {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.2) 0%, rgba(0, 245, 255, 0.2) 100%);
            border-left: 4px solid var(--neon-purple);
        }

        .action-item.challenge {
            background: linear-gradient(135deg, rgba(255, 100, 0, 0.2) 0%, rgba(255, 0, 102, 0.2) 100%);
            border-left: 4px solid #ff6400;
        }

        .action-item.moon-ritual {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.15) 0%, rgba(0, 0, 80, 0.3) 100%);
            border-left: 4px solid #9d00ff;
        }

        /* ========================================
           MONETIZATION FEATURES STYLES
           ======================================== */

        /* Streak Counter */
        /* Share Card Section */
        .share-section {
            background: linear-gradient(135deg, rgba(255, 0, 102, 0.15) 0%, rgba(157, 0, 255, 0.15) 100%);
            border: 2px solid var(--neon-pink);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .share-section h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-pink);
            margin-bottom: 15px;
        }

        .share-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid;
        }

        .share-btn.twitter {
            background: rgba(29, 161, 242, 0.2);
            border-color: #1da1f2;
            color: #1da1f2;
        }

        .share-btn.facebook {
            background: rgba(66, 103, 178, 0.2);
            border-color: #4267B2;
            color: #4267B2;
        }

        .share-btn.copy {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .share-btn.whatsapp {
            background: rgba(37, 211, 102, 0.2);
            border-color: #25d366;
            color: #25d366;
        }

        .share-btn.linkedin {
            background: rgba(0, 119, 181, 0.2);
            border-color: #0077b5;
            color: #0077b5;
        }

        .share-btn.email {
            background: rgba(255, 0, 128, 0.2);
            border-color: var(--neon-magenta);
            color: var(--neon-magenta);
        }

        .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 0, 102, 0.3);
        }

        /* Section Share Button */
        .section-share-btn {
            display: block;
            width: fit-content;
            margin: 15px auto 0 auto;
            padding: 10px 24px;
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            color: var(--neon-cyan);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            text-align: center;
        }

        .section-share-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 245, 255, 0.3);
        }

        /* Share Modal Styles */
        .share-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .share-modal-content {
            position: relative;
            background: linear-gradient(135deg, #1a0033 0%, #0a0a1a 100%);
            margin: 20px auto;
            padding: 25px 20px;
            border: 2px solid var(--neon-cyan);
            border-radius: 20px;
            max-width: 420px;
            width: calc(100% - 30px);
            box-shadow: 0 0 50px rgba(0, 245, 255, 0.3);
            max-height: none;
        }

        .share-modal-close {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 32px;
            font-weight: bold;
            color: var(--neon-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
        }

        .share-modal-close:hover {
            color: #fff;
            background: rgba(255, 0, 102, 0.3);
            transform: scale(1.1);
        }

        .share-modal h3 {
            text-align: center;
            color: var(--neon-gold);
            margin-bottom: 15px;
            font-size: 1.3rem;
            padding-right: 30px;
        }

        .share-options {
            display: grid;
            gap: 10px;
        }

        .share-option-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #fff;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Rajdhani', sans-serif;
        }

        .share-option-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-cyan);
            transform: scale(1.02);
        }

        .share-option-btn:active {
            transform: scale(0.98);
        }

        .share-option-btn .icon {
            font-size: 1.3rem;
            width: 28px;
            text-align: center;
        }

        /* Visual Card Share Button - Make it stand out! */
        .share-option-btn.visual-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(157, 0, 255, 0.2));
            border: 2px solid var(--neon-gold);
            padding: 15px;
        }

        .share-option-btn.visual-card:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(157, 0, 255, 0.3));
            border-color: var(--neon-gold);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
        }

        .share-option-btn.visual-card .icon {
            font-size: 1.8rem;
        }

        .share-option-btn small {
            display: block;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 2px;
        }

        /* WhatsApp button - Green highlight */
        .share-option-btn.whatsapp {
            background: rgba(37, 211, 102, 0.2);
            border: 1px solid rgba(37, 211, 102, 0.5);
        }

        .share-option-btn.whatsapp:hover {
            background: rgba(37, 211, 102, 0.3);
            border-color: #25D366;
        }

        /* Native share button */
        .share-option-btn.native-share {
            background: rgba(157, 0, 255, 0.15);
            border: 1px dashed rgba(157, 0, 255, 0.4);
        }

        .share-option-btn.native-share:hover {
            background: rgba(157, 0, 255, 0.25);
            border-style: solid;
        }
        
        /* Community Share Section - for Reality Codes */
        .community-share-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .community-divider {
            text-align: center;
            color: #d4af37;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .community-text {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            margin-bottom: 10px;
        }
        
        .community-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .community-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.5);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
        }
        
        .community-btn.facebook-group {
            background: linear-gradient(135deg, rgba(66, 103, 178, 0.3), rgba(59, 89, 152, 0.3));
            border-color: rgba(66, 103, 178, 0.6);
        }
        
        .community-btn.facebook-group:hover {
            background: linear-gradient(135deg, rgba(66, 103, 178, 0.5), rgba(59, 89, 152, 0.5));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(66, 103, 178, 0.4);
        }
        
        .community-btn.telegram-group {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.3), rgba(0, 114, 177, 0.3));
            border-color: rgba(0, 136, 204, 0.6);
        }
        
        .community-btn.telegram-group:hover {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.5), rgba(0, 114, 177, 0.5));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.4);
        }
        
        .community-btn .icon {
            font-size: 1.1rem;
        }
        
        /* Community link buttons in Reality Codes section */
        .community-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }
        
        .community-link-btn.facebook {
            background: linear-gradient(135deg, #1877F2, #0d5bbd);
        }
        
        .community-link-btn.facebook:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(24, 119, 242, 0.5);
        }
        
        .community-link-btn.telegram {
            background: linear-gradient(135deg, #0088cc, #006699);
        }
        
        .community-link-btn.telegram:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 136, 204, 0.5);
        }
        
        .community-link-btn img {
            filter: brightness(0) invert(1);
        }

        /* Share options grid - always 2 columns except visual card */
        .share-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .share-option-btn.visual-card {
            grid-column: span 2;
        }

        @media (max-width: 360px) {
            .share-options {
                grid-template-columns: 1fr;
            }
            
            .share-option-btn.visual-card {
                grid-column: span 1;
            }
            
            .community-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* Toast animations */
        @keyframes slideUpToast {
            from {
                transform: translateX(-50%) translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Floating Share Button */
        .floating-share-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 245, 255, 0.5);
            z-index: 9999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .floating-share-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 6px 30px rgba(0, 245, 255, 0.7);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(0, 245, 255, 0.5);
            }
            50% {
                box-shadow: 0 4px 30px rgba(0, 245, 255, 0.8);
            }
        }

        /* Install Prompt Banner */
        .install-prompt {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.95), rgba(0, 245, 255, 0.95));
            padding: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            z-index: 9998;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .install-prompt-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .install-prompt-icon {
            font-size: 2rem;
        }

        .install-prompt-text h4 {
            margin: 0;
            font-size: 1.1rem;
            color: white;
        }

        .install-prompt-text p {
            margin: 5px 0 0 0;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .install-prompt-buttons {
            display: flex;
            gap: 10px;
        }

        .install-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-btn.primary {
            background: white;
            color: var(--neon-purple);
        }

        .install-btn.primary:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .install-btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .install-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .floating-share-btn {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }

            .install-prompt {
                flex-direction: column;
                padding: 15px;
            }

            .install-prompt-content {
                flex-direction: column;
                text-align: center;
            }

            .install-prompt-buttons {
                width: 100%;
                flex-direction: column;
            }

            .install-btn {
                width: 100%;
            }
        }

        /* Email Capture */
        .email-capture {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(0, 245, 255, 0.1) 100%);
            border: 2px solid var(--neon-gold);
            border-radius: 20px;
            padding: 35px;
            margin: 40px 0;
            text-align: center;
        }

        .email-capture h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-gold);
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .email-capture .subtitle {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .email-form {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            max-width: 500px;
            margin: 0 auto;
        }

        .email-form input[type="email"] {
            flex: 1;
            min-width: 250px;
            padding: 15px 20px;
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1rem;
        }

        .email-form input[type="email"]:focus {
            outline: none;
            border-color: var(--neon-cyan);
        }

        .email-form button {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--neon-gold), #ff9500);
            border: none;
            border-radius: 25px;
            color: #000;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .email-form button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .email-benefits {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Ad Placement Containers */
        .ad-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-container.horizontal {
            min-height: 90px;
        }

        .ad-container.square {
            min-height: 250px;
        }

        .ad-placeholder {
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
        }

        /* Compatibility Checker */
        .compatibility-section {
            background: linear-gradient(135deg, rgba(255, 0, 102, 0.1) 0%, rgba(255, 100, 200, 0.1) 100%);
            border: 2px solid var(--neon-pink);
            border-radius: 20px;
            padding: 35px;
            margin: 40px 0;
        }

        .compatibility-section h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-pink);
            margin-bottom: 10px;
            font-size: 1.4rem;
            text-align: center;
        }

        .compatibility-section .subtitle {
            color: var(--text-secondary);
            margin-bottom: 25px;
            text-align: center;
        }

        .compatibility-form {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: end;
            margin-bottom: 25px;
        }

        .compat-person {
            text-align: center;
        }

        .compat-person label {
            display: block;
            color: var(--neon-cyan);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .compat-person input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 0, 102, 0.3);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1rem;
            text-align: center;
        }

        .compat-vs {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            color: var(--neon-pink);
            padding-bottom: 12px;
        }

        .check-compat-btn {
            display: block;
            margin: 0 auto;
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .check-compat-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 102, 0.5);
        }

        .compatibility-result {
            display: none;
            margin-top: 30px;
            text-align: center;
        }

        .compatibility-result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .compat-score {
            font-family: 'Orbitron', monospace;
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .compat-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .compat-detail-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 15px;
        }

        .compat-detail-item h5 {
            color: var(--neon-gold);
            margin-bottom: 8px;
        }

        .compat-detail-item p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Feedback/Rating Section */
        .feedback-section {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }

        .feedback-section h4 {
            color: var(--neon-cyan);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .rating-star {
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.4;
        }

        .rating-star:hover,
        .rating-star.active {
            opacity: 1;
            transform: scale(1.2);
        }

        .feedback-input {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1rem;
            margin-top: 10px;
            display: none;
        }

        .feedback-input.show {
            display: block;
            margin: 10px auto;
        }

        /* Journal Section */
        .journal-section {
            background: linear-gradient(135deg, rgba(157, 0, 255, 0.1) 0%, rgba(0, 100, 255, 0.1) 100%);
            border: 2px solid var(--neon-purple);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .journal-section h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-purple);
            margin-bottom: 15px;
        }

        .journal-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .journal-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid rgba(157, 0, 255, 0.3);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
            resize: vertical;
            margin-bottom: 15px;
        }

        .journal-textarea:focus {
            outline: none;
            border-color: var(--neon-purple);
        }

        .journal-btn {
            background: rgba(157, 0, 255, 0.3);
            border: 2px solid var(--neon-purple);
            color: var(--neon-purple);
            padding: 12px 30px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .journal-btn:hover {
            background: rgba(157, 0, 255, 0.5);
            transform: translateY(-2px);
        }

        /* Explore More Tools */
        .explore-tools {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
        }

        .explore-tools h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-cyan);
            margin-bottom: 20px;
            text-align: center;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tool-card {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-cyan);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.2);
        }

        .tool-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .tool-card h4 {
            color: var(--neon-gold);
            margin-bottom: 5px;
        }

        .tool-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Mobile Responsive Enhancements */
        @media (max-width: 768px) {
            .timing-grid,
            .days-grid,
            .weeks-grid,
            .quarters-grid,
            .transit-grid,
            .key-dates-grid,
            .houses-grid,
            .aspects-grid,
            .cosmic-meta,
            .usage-grid {
                grid-template-columns: 1fr;
            }

            .cosmic-timing-section,
            .cross-reference-section,
            .weekly-breakdown,
            .monthly-breakdown,
            .yearly-breakdown,
            .key-dates-section,
            .major-transits-section,
            .houses-section,
            .aspects-section {
                padding: 20px;
            }

            .system-badges {
                flex-direction: column;
            }

            .day-item,
            .week-item,
            .quarter-item,
            .timing-item,
            .transit-item,
            .key-date-item,
            .house-item,
            .aspect-item {
                padding: 15px;
            }

            /* Planetary Houses Mobile Fixes */
            .house-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .planet-symbol {
                font-size: 1.5rem;
            }

            .planet-name {
                font-size: 1rem;
            }

            .house-number {
                font-size: 0.9rem;
            }

            .house-meaning {
                font-size: 0.9rem;
            }

            /* Aspect Items Mobile Fixes */
            .aspect-header {
                flex-wrap: wrap;
            }

            .aspect-symbol {
                font-size: 1.5rem;
            }

            /* Cross Reference Items */
            .cross-item {
                padding: 15px;
            }

            /* Cosmic Overview Mobile */
            .cosmic-overview {
                padding: 25px 15px;
            }

            .cosmic-title {
                font-size: 1.8rem;
            }

            .energy-indicators {
                gap: 10px;
            }

            .energy-badge {
                padding: 10px 15px;
                font-size: 0.95rem;
            }

            .compatibility-form {
                grid-template-columns: 1fr;
            }

            .compat-vs {
                padding: 10px 0;
            }

            .email-form {
                flex-direction: column;
            }

            .email-form input[type="email"] {
                min-width: auto;
            }

            /* Tarot Card Mobile */
            .tarot-card {
                min-width: 150px;
                padding: 20px 15px;
            }

            .tarot-meaning {
                min-width: 100%;
            }

            .tarot-card-display {
                gap: 20px;
            }

            /* Frequency Display Mobile */
            .frequency-display {
                padding: 20px 15px;
            }

            .frequency-hz {
                font-size: 2.2rem;
            }

            /* Forecast Header Mobile */
            .forecast-header {
                padding: 20px 15px;
            }

            .forecast-header h2 {
                font-size: 1.5rem;
            }

            /* Action Section Mobile */
            .action-section {
                padding: 20px 15px;
            }

            /* System Section Mobile */
            .system-section {
                padding: 15px;
            }

            .system-header {
                padding: 10px;
            }

            /* Share Buttons Mobile */
            .share-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .share-btn {
                width: 100%;
            }

            /* Bottom Timeframe Toggle Mobile */
            .bottom-timeframe-toggle {
                padding: 20px 15px;
            }

            .bottom-timeframe-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .bottom-timeframe-btn {
                width: 100%;
            }
        }

        /* ========================================
           INTRO ANIMATION & LOADING SPINNER
           ======================================== */
        
        .intro-overlay, .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            overflow: hidden;
            transition: opacity 0.5s ease;
        }

        /* Canvas for orbital lines */
        #lines-canvas, #loading-lines-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Emoji layer */
        .emoji-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .emoji {
            position: absolute;
            font-size: 60px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center;
            will-change: transform, opacity;
            opacity: 0;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        #quantum, #loading-quantum {
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        #wizard, #loading-wizard {
            color: #00F0FF;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
        }

        #rose, #loading-rose {
            color: #FF0066;
            text-shadow: 0 0 20px rgba(255, 0, 102, 0.8);
        }

        /* Singularity dot */
        #singularity, #loading-singularity {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #FFD700, #00F0FF, #FF0066);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            z-index: 3;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        /* Title text */
        #title, #loading-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 1px;
            font-weight: 900;
            background: linear-gradient(135deg, #00F0FF 0%, #FFD700 50%, #FF0066 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            white-space: nowrap;
            opacity: 0;
            z-index: 4;
            letter-spacing: 0.05em;
            max-width: 95vw;
            font-family: 'Orbitron', monospace;
        }

        /* Loading animation for forecast generation */
        .loading-animation {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-animation .singularity {
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff 0%, #00f5ff 50%, #9d00ff 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 20px #00f5ff,
                0 0 40px #9d00ff,
                0 0 60px #00f5ff,
                0 0 80px #9d00ff;
            animation: singularityExpandShort 2.5s ease-in-out infinite;
        }

        @keyframes singularityExpandShort {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            25% {
                transform: scale(5);
                box-shadow: 
                    0 0 40px #00f5ff,
                    0 0 80px #9d00ff,
                    0 0 120px #00f5ff;
            }
            50% {
                transform: scale(15);
                opacity: 0.8;
                box-shadow: 
                    0 0 100px #00f5ff,
                    0 0 200px #9d00ff,
                    0 0 300px #ffd700;
            }
            75% {
                transform: scale(30) rotate(180deg);
                opacity: 0.4;
                box-shadow: 
                    0 0 200px #00f5ff,
                    0 0 400px #9d00ff;
            }
            100% {
                transform: scale(1) rotate(360deg);
                opacity: 1;
            }
        }

        /* Loading text below spinner */
        .loading-text {
            margin-top: 40px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Skip Button */
        .skip-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 25px;
            border-radius: 25px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10001;
            pointer-events: all;
        }

        .skip-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #00f5ff;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.5);
        }

        /* Hide intro overlay after animation */
        .intro-overlay.hidden {
            display: none !important;
            opacity: 0;
        }

        @media (max-width: 768px) {
            #title {
                font-size: 1.8rem;
                letter-spacing: 4px;
            }
            
            .skip-btn {
                top: 15px;
                right: 15px;
                padding: 8px 20px;
                font-size: 0.9rem;
            }
        }

        /* ========================================
           INPUT VALIDATION & ERROR MESSAGES
           ======================================== */
        
        .input-error {
            border-color: #ff0066 !important;
            box-shadow: 0 0 10px rgba(255, 0, 102, 0.3) !important;
        }

        .error-message {
            color: #ff0066;
            font-size: 0.9rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: shake 0.3s ease;
        }

        .error-message::before {
            content: '⚠️';
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ========================================
           HOW TO USE SECTION
           ======================================== */
        
        .how-to-use-section {
            background: linear-gradient(135deg, rgba(0, 245, 255, 0.05), rgba(157, 0, 255, 0.05));
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
        }

        .how-to-use-section h3 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            color: var(--neon-gold);
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .usage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .usage-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .usage-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-cyan);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.2);
        }

        .usage-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .usage-card h4 {
            color: var(--neon-cyan);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .usage-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .usage-tips {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
        }

        .usage-tips h4 {
            color: var(--neon-gold);
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .usage-tips ul {
            list-style: none;
            padding: 0;
        }

        .usage-tips li {
            color: var(--text-secondary);
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .usage-tips li::before {
            content: '✨';
            position: absolute;
            left: 0;
        }

        /* Enhanced Confidence Indicator */
        .confidence-breakdown {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .confidence-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .confidence-item.provided {
            border-left: 3px solid #00f5ff;
        }

        .confidence-item.missing {
            border-left: 3px solid rgba(255, 255, 255, 0.2);
            opacity: 0.6;
        }

        .conf-label {
            flex: 1;
            margin-left: 8px;
        }

        .conf-value {
            color: var(--neon-gold);
            font-weight: 600;
        }

        .confidence-note {
            text-align: center;
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--neon-cyan);
        }

        /* ========================================
           LOAD SAVED PROFILE BUTTON
           ======================================== */
        
        .load-profile-btn {
            background: linear-gradient(135deg, #00f5ff, #9d00ff);
            border: 2px solid #00f5ff;
            color: white;
            padding: 15px 35px;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.4);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.5px;
        }

        .load-profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 35px rgba(0, 245, 255, 0.7);
            background: linear-gradient(135deg, #00f5ff, #ff00ff);
        }

        .load-profile-btn:active {
            transform: translateY(-1px);
        }

        /* Success Toast */
        .success-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
        }

        .success-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile responsive for welcome banner */
        @media (max-width: 768px) {
            .welcome-content {
                flex-direction: column;
                text-align: center;
            }
            
            .welcome-actions {
                width: 100%;
                flex-direction: column;
            }
            
            .quick-forecast-btn,
            .update-profile-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Animation Overlay (First Visit) -->
    <div id="introOverlay" class="intro-overlay">
        <canvas id="lines-canvas"></canvas>
        
        <div class="emoji-layer">
            <div class="emoji" id="quantum">⚛️</div>
            <div class="emoji" id="wizard">🧙‍♂️</div>
            <div class="emoji" id="rose">🌹</div>
        </div>

        <div id="singularity"></div>
        <div id="title">QUANTUM MERLIN</div>
        
        <button id="skipIntro" class="skip-btn">Skip →</button>
    </div>

    <!-- Loading Spinner (During Forecast Generation) -->
    <div id="loadingSpinner" class="loading-overlay" style="display: none;">
        <canvas id="loading-lines-canvas"></canvas>
        
        <div class="emoji-layer" id="loadingEmojiLayer">
            <div class="emoji" id="loading-quantum">⚛️</div>
            <div class="emoji" id="loading-wizard">🧙‍♂️</div>
            <div class="emoji" id="loading-rose">🌹</div>
        </div>

        <div id="loading-singularity"></div>
        <div id="loading-title">QUANTUM MERLIN</div>
        
        <div class="loading-wait-message" style="position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); color: rgba(255, 255, 255, 0.9); font-family: 'Rajdhani', sans-serif; font-size: 1.2rem; text-align: center; z-index: 10001; max-width: 90%; line-height: 1.6;">
            <div style="margin-bottom: 10px;">Thank you for your patience!</div>
            <div style="color: rgba(255, 215, 0, 0.9); font-size: 1rem;">Your personalized cosmic forecast is being carefully crafted...</div>
        </div>
    </div>

    <div class="cosmic-bg"></div>
    <div class="stars" id="stars"></div>

    <!-- Welcome Back Banner (hidden by default) -->
    <div id="welcomeBackBanner" class="welcome-back-banner" style="display: none;">
        <div class="welcome-content">
            <div class="welcome-icon">👋</div>
            <div class="welcome-text">
                <h3>Welcome back, <span id="welcomeName">Seeker</span>!</h3>
                <p>Your profile is ready. Generate today's forecast with one click.</p>
            </div>
            <div class="welcome-actions">
                <button class="quick-forecast-btn" onclick="loadSavedProfile()">
                    ⚡ Generate Today's Forecast
                </button>
                <button class="update-profile-btn" onclick="showUpdateProfile()">
                    ✏️ Update Profile
                </button>
            </div>
        </div>
        <button class="close-banner" onclick="closeWelcomeBanner()">✕</button>
    </div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <!-- Library Button - Top Left -->
            <div class="library-floating">
                <button class="library-btn" onclick="viewLibrary()" title="View your saved forecasts">
                    <span class="library-icon">📚</span>
                    <span>Library</span>
                    <span class="library-counter" id="libraryCounter">0</span>
                </button>
            </div>
            <!-- Buy Me a Coffee - Top Right -->
            <div class="coffee-floating">
                <a href="https://buymeacoffee.com/quantummerlin" target="_blank" rel="noopener noreferrer" class="coffee-btn">
                    <span class="coffee-icon">☕</span>
                    <span>Support</span>
                </a>
            </div>
            <div class="hero-content">
                <div class="hero-subtitle">Unlock Your Cosmic Blueprint</div>
                <h1>QUANTUM FORECASTER</h1>
                <p class="tagline">8 Ancient Systems • 1 Powerful Reading • Infinite Insight</p>
                <div class="systems">
                    <span class="systems-text">Western Astrology • Chinese Zodiac • Numerology • Gematria<br>Moon Phases • Tarot • Frequencies • Planetary Hours</span>
                </div>
            </div>
        </div>

        <!-- Ad Container - Top (will be replaced with AdSense) -->
        <div class="ad-container horizontal" id="adTop">
            <span class="ad-placeholder">[ Ad Space - 728x90 ]</span>
        </div>

        <!-- Input Section -->
        <div class="input-section" id="inputSection">
            <h2>Generate Your Forecast</h2>
            
            <!-- Load Saved Profile Button -->
            <div id="loadProfileSection" style="display: none; text-align: center; margin-bottom: 20px;">
                <button class="load-profile-btn" onclick="loadSavedProfile()">
                    📚 Load Your Saved Profile
                </button>
                <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); margin-top: 8px;">You have a saved profile in the library</p>
            </div>

            <!-- Tier 1: Required -->
            <div class="input-group">
                <label for="birthDate">Birth Date *</label>
                <input type="date" id="birthDate" required>
                <p class="help-text">Required - determines your sun sign, life path, and Chinese zodiac</p>
            </div>

            <!-- Tier 2: Enhanced Accuracy -->
            <button class="expand-btn" id="expandEnhanced" onclick="toggleEnhanced()">
                ▼ Add Birth Time & Location for More Accuracy
            </button>
            
            <div class="expanded-content" id="enhancedContent">
                <div class="input-group">
                    <label for="birthTime">Birth Time <span class="optional-badge">(optional)</span></label>
                    <input type="time" id="birthTime">
                    <p class="help-text">Used for rising sign and moon sign calculations</p>
                </div>

                <div class="input-group">
                    <label for="birthLocation">Birth Location <span class="optional-badge">(optional)</span></label>
                    <input type="text" id="birthLocation" placeholder="City, Country">
                    <p class="help-text">Used for birth chart houses and local time calculations</p>
                </div>

                <div class="input-group">
                    <label for="currentLocation">Current Location <span class="optional-badge">(optional)</span></label>
                    <input type="text" id="currentLocation" placeholder="City, Country">
                    <p class="help-text">Used for current transits and local planetary hours</p>
                </div>
            </div>

            <!-- Tier 3: Deep Personalization -->
            <button class="expand-btn" id="expandAdvanced" style="display: none;" onclick="toggleAdvanced()">
                ▼ Add Name for Deep Personalization
            </button>
            
            <div class="expanded-content" id="advancedContent">
                <div class="input-group">
                    <label for="fullName">Full Name <span class="optional-badge">(optional)</span></label>
                    <div class="input-row">
                        <input type="text" id="firstName" placeholder="First">
                        <input type="text" id="middleName" placeholder="Middle">
                        <input type="text" id="lastName" placeholder="Last">
                    </div>
                    <p class="help-text">Used for gematria and name numerology calculations</p>
                </div>
            </div>

            <!-- Generate Button -->
            <button class="generate-btn" id="generateBtn">✨ Generate Forecast</button>
            
            <!-- Accuracy Indicator -->
            <div class="accuracy-indicator" id="accuracyIndicator">
                <h3>Forecast Accuracy</h3>
                <div class="accuracy-bar">
                    <div class="accuracy-fill" id="accuracyFill" style="width: 0%;">0%</div>
                </div>
                <ul class="data-checklist" id="dataChecklist">
                    <li class="missing">⚠️ Birth date not provided</li>
                    <li class="missing">⚠️ Birth time not provided</li>
                    <li class="missing">⚠️ Birth location not provided</li>
                    <li class="missing">⚠️ Name not provided</li>
                </ul>
            </div>
        </div>
        <!-- Timeframe Selector -->
        <div class="timeframe-selector" id="timeframeSelector" style="display: none;">
            <button class="timeframe-btn active" data-timeframe="daily">📅 Daily</button>
            <button class="timeframe-btn" data-timeframe="weekly">📆 Weekly</button>
            <button class="timeframe-btn" data-timeframe="monthly">🗓️ Monthly</button>
            <button class="timeframe-btn" data-timeframe="yearly">📊 Yearly</button>
        </div>

        <!-- Forecast Output -->
        <div class="forecast-output" id="forecastOutput">
            <!-- Content will be dynamically generated -->
        </div>

        <!-- Ad Container - Mid Content -->
        <div class="ad-container horizontal" id="adMid" style="display: none;">
            <span class="ad-placeholder">[ Ad Space - 728x90 ]</span>
        </div>

        <!-- Email Capture Section -->
        <div class="email-capture" id="emailCapture">
            <h3>🔔 Get Updates</h3>
            <p class="subtitle">Join our list to hear about new tools and features</p>
            <form class="email-form" id="emailForm" action="https://formspree.io/f/mgowrolb" method="POST">
                <input type="email" name="email" id="emailInput" placeholder="Enter your email" required>
                <button type="submit">Subscribe</button>
            </form>
            <div class="email-benefits">
                <span>✓ Free</span>
                <span>✓ No Spam</span>
                <span>✓ Unsubscribe Anytime</span>
            </div>
        </div>

        <!-- How to Use This Forecast -->
        <div class="how-to-use-section" id="howToUse" style="display: none;">
            <h3 style="text-align: center;">How to Use Your Forecast</h3>
            
            <div class="usage-grid">
                <div class="usage-card">
                    <div class="usage-icon">📅</div>
                    <h4>Daily Forecast</h4>
                    <p>Check each morning to align your day with cosmic energy. Focus on the "Action Item" for specific guidance.</p>
                </div>
                
                <div class="usage-card">
                    <div class="usage-icon">📆</div>
                    <h4>Weekly Forecast</h4>
                    <p>Review on Sunday to plan your week. Note key themes and schedule important activities accordingly.</p>
                </div>
                
                <div class="usage-card">
                    <div class="usage-icon">🗓️</div>
                    <h4>Monthly Forecast</h4>
                    <p>Read at the start of each month. Mark key dates in your calendar and prepare for major themes.</p>
                </div>
                
                <div class="usage-card">
                    <div class="usage-icon">📊</div>
                    <h4>Yearly Forecast</h4>
                    <p>Review on your birthday or New Year. Use it to set intentions and understand your year's overarching themes.</p>
                </div>
            </div>
            
            <div class="usage-tips">
                <h4>💡 Pro Tips</h4>
                <ul>
                    <li>Save forecasts to track patterns over time</li>
                    <li>Combine with your Birth Sigil for deeper alignment</li>
                    <li>Use Genesis Frequencies to amplify your daily energy</li>
                    <li>Journal about how forecasts resonate with your experience</li>
                    <li>Add birth time & location for maximum accuracy</li>
                </ul>
            </div>
        </div>

        <!-- Ad Container - Mid Content -->
        <div class="ad-container square" id="adBottom">
            <span class="ad-placeholder">[ Ad Space - 300x250 ]</span>
        </div>

        <!-- Explore More Tools -->
        <div class="explore-tools">
            <h3>🔮 Explore More Tools</h3>
            <p style="font-size: 1.2rem; margin-top: 20px;">
                Visit <a href="https://quantummerlin.com" target="_blank" style="color: var(--neon-cyan); text-decoration: none; font-weight: 600;">quantummerlin.com</a> to discover more cosmic tools
            </p>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary); font-size: 0.9rem;">
            <p>© 2025 Quantum Merlin • For entertainment purposes</p>
            <p style="margin-top: 10px;">
                <a href="../genesis/privacy.html" style="color: var(--neon-cyan); text-decoration: none;">Privacy</a> • 
                <a href="../genesis/terms.html" style="color: var(--neon-cyan); text-decoration: none;">Terms</a> • 
                <a href="../genesis/disclaimer.html" style="color: var(--neon-cyan); text-decoration: none;">Disclaimer</a>
            </p>
        </div>
    </div>

    <script>
        // ========================================
        // INTRO ANIMATION & LOADING CONTROL
        // ========================================
        
        // Shared localStorage key for skip functionality across all QM pages
        const STORAGE_KEY = 'qm_intro_watched';
        const hasVisited = localStorage.getItem(STORAGE_KEY) === 'true';
        const introOverlay = document.getElementById('introOverlay');
        const skipBtn = document.getElementById('skipIntro');
        const canvas = document.getElementById('lines-canvas');
        const ctx = canvas ? canvas.getContext('2d', { alpha: true }) : null;
        
        const quantum = document.getElementById('quantum');
        const wizard = document.getElementById('wizard');
        const rose = document.getElementById('rose');
        const singularity = document.getElementById('singularity');
        const title = document.getElementById('title');

        let width, height, centerX, centerY;
        let time = 0;
        let isRunning = false;
        let wizardOrbitStart = 0;
        let roseOrbitStart = Math.PI;
        const dpr = Math.min(window.devicePixelRatio || 1, 1.5);

        function resizeCanvas() {
            if (!canvas) return;
            width = window.innerWidth;
            height = window.innerHeight;
            centerX = width / 2;
            centerY = height / 2;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            ctx.scale(dpr, dpr);
        }

        function easeInOutCubic(t) {
            return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }

        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function updateAnimation() {
            if (!isRunning || !ctx) return;
            
            const t = time / 60;
            ctx.clearRect(0, 0, width, height);

            if (t < 1) {
                const progress = clamp(t / 1, 0, 1);
                const ease = easeInOutCubic(progress);
                quantum.style.left = centerX + 'px';
                quantum.style.top = centerY + 'px';
                quantum.style.transform = `translate(-50%, -50%) scale(${ease})`;
                quantum.style.opacity = ease;
                wizard.style.opacity = 0;
                rose.style.opacity = 0;
            }
            else if (t < 2) {
                const progress = clamp((t - 1) / 1, 0, 1);
                const ease = easeInOutCubic(progress);
                quantum.style.left = centerX + 'px';
                quantum.style.top = centerY + 'px';
                quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                quantum.style.opacity = 1;
                const wizardX = ease * (centerX - 80);
                wizard.style.left = wizardX + 'px';
                wizard.style.top = centerY + 'px';
                wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                wizard.style.opacity = ease;
                const roseX = width - ease * (width - centerX - 80);
                rose.style.left = roseX + 'px';
                rose.style.top = centerY + 'px';
                rose.style.transform = 'translate(-50%, -50%) scale(1)';
                rose.style.opacity = ease;
            }
            else if (t < 3) {
                quantum.style.left = centerX + 'px';
                quantum.style.top = centerY + 'px';
                quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                wizard.style.left = (centerX - 80) + 'px';
                wizard.style.top = centerY + 'px';
                wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                rose.style.left = (centerX + 80) + 'px';
                rose.style.top = centerY + 'px';
                rose.style.transform = 'translate(-50%, -50%) scale(1)';
            }
            else if (t < 4.5) {
                const progress = clamp((t - 3) / 1.5, 0, 1);
                const rotation = progress * Math.PI * 2 * 0.5;
                ctx.strokeStyle = 'rgba(0, 240, 255, ' + (progress * 0.6) + ')';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation, rotation + Math.PI);
                ctx.stroke();
                ctx.strokeStyle = 'rgba(255, 0, 255, ' + (progress * 0.6) + ')';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                ctx.stroke();
                ctx.strokeStyle = 'rgba(157, 0, 255, ' + (progress * 0.6) + ')';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                ctx.stroke();
                if (t < 4.51) {
                    wizardOrbitStart = Math.PI;
                    roseOrbitStart = 0;
                }
            }
            else if (t < 6.5) {
                const progress = clamp((t - 4.5) / 2, 0, 1);
                const speedMultiplier = 1 + progress * 8;
                const rotation = ((t - 3) * speedMultiplier) * Math.PI * 2 * 0.5;
                ctx.strokeStyle = 'rgba(0, 240, 255, 0.6)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation, rotation + Math.PI);
                ctx.stroke();
                ctx.strokeStyle = 'rgba(255, 0, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                ctx.stroke();
                ctx.strokeStyle = 'rgba(157, 0, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                ctx.stroke();
                quantum.style.left = centerX + 'px';
                quantum.style.top = centerY + 'px';
                quantum.style.transform = 'translate(-50%, -50%) scale(1)';
                const orbitProgress = (t - 4.5) * speedMultiplier * 0.5;
                const orbitRadius = 80;
                const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                wizard.style.left = wizardX + 'px';
                wizard.style.top = wizardY + 'px';
                wizard.style.transform = 'translate(-50%, -50%) scale(1)';
                const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                rose.style.left = roseX + 'px';
                rose.style.top = roseY + 'px';
                rose.style.transform = 'translate(-50%, -50%) scale(1)';
            }
            else if (t < 7.5) {
                const progress = clamp((t - 6.5) / 1, 0, 1);
                const ease = easeInOutCubic(progress);
                const rotation = ((t - 3) * 9) * Math.PI * 2 * 0.5;
                const lineOpacity = 0.6 * (1 - ease);
                const lineRadius = 80 * (1 - ease);
                ctx.strokeStyle = 'rgba(0, 240, 255, ' + lineOpacity + ')';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, lineRadius, rotation, rotation + Math.PI);
                ctx.stroke();
                ctx.strokeStyle = 'rgba(255, 0, 255, ' + lineOpacity + ')';
                ctx.beginPath();
                ctx.arc(centerX, centerY, lineRadius, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                ctx.stroke();
                const orbitProgress = (t - 4.5) * 9 * 0.5;
                const orbitRadius = 80 * (1 - ease);
                const wizardAngle = wizardOrbitStart + orbitProgress * Math.PI * 2;
                const wizardX = centerX + Math.cos(wizardAngle) * orbitRadius;
                const wizardY = centerY + Math.sin(wizardAngle) * orbitRadius;
                const roseAngle = roseOrbitStart + orbitProgress * Math.PI * 2;
                const roseX = centerX + Math.cos(roseAngle) * orbitRadius;
                const roseY = centerY + Math.sin(roseAngle) * orbitRadius;
                const emojiScale = 1 - ease * 0.9;
                wizard.style.left = wizardX + 'px';
                wizard.style.top = wizardY + 'px';
                wizard.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                wizard.style.opacity = 1 - ease;
                rose.style.left = roseX + 'px';
                rose.style.top = roseY + 'px';
                rose.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                rose.style.opacity = 1 - ease;
                const quantumScale = 1 + (ease < 0.3 ? ease * 0.5 : (1 - ease) * 1.5);
                quantum.style.left = centerX + 'px';
                quantum.style.top = centerY + 'px';
                quantum.style.transform = `translate(-50%, -50%) scale(${quantumScale})`;
                quantum.style.opacity = 1 - ease;
                singularity.style.transform = `translate(-50%, -50%) scale(${ease})`;
                singularity.style.opacity = ease;
            }
            else if (t < 8) {
                quantum.style.opacity = 0;
                wizard.style.opacity = 0;
                rose.style.opacity = 0;
                const pulse = Math.sin((t - 7.5) * Math.PI * 4) * 0.2 + 1;
                singularity.style.transform = `translate(-50%, -50%) scale(${pulse})`;
                singularity.style.opacity = 1;
            }
            else if (t < 10) {
                const progress = clamp((t - 8) / 2, 0, 1);
                const ease = easeInOutCubic(progress);
                singularity.style.transform = `translate(-50%, -50%) scale(1)`;
                singularity.style.opacity = 1 - ease;
                const maxFontSize = Math.min(width * 0.065, 42);
                const fontSize = ease * maxFontSize;
                title.style.fontSize = fontSize + 'px';
                title.style.transform = `translate(-50%, -50%)`;
                title.style.opacity = ease;
            }
            else if (t < 11) {
                singularity.style.opacity = 0;
                const maxFontSize = Math.min(width * 0.065, 42);
                title.style.fontSize = maxFontSize + 'px';
                title.style.opacity = 1;
                if (t > 10.5) {
                    const fadeProgress = (t - 10.5) / 0.5;
                    introOverlay.style.opacity = 1 - fadeProgress;
                }
            }
            else if (t >= 11) {
                if (isRunning) {
                    isRunning = false;
                    hideIntro();
                    return;
                }
            }

            time++;
            if (isRunning) {
                requestAnimationFrame(updateAnimation);
            }
        }

        function hideIntro() {
            isRunning = false;
            if (introOverlay) {
                introOverlay.classList.add('hidden');
            }
            // Mark as watched in shared localStorage (works across all QM pages)
            localStorage.setItem(STORAGE_KEY, 'true');
            // Initialize user session when intro ends (if not already done)
            if (typeof initializeUserSession === 'function') {
                setTimeout(() => initializeUserSession(), 100);
            }
        }
        
        // Show/hide skip button based on first visit
        if (skipBtn) {
            if (hasVisited) {
                skipBtn.style.display = 'block';
            } else {
                skipBtn.style.display = 'none';
            }
            
            skipBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                hideIntro();
                // Initialize user session immediately when skipping
                setTimeout(() => initializeUserSession(), 500);
            });
        }
        
        // Always run animation
        if (canvas && ctx && introOverlay) {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            setTimeout(() => {
                isRunning = true;
                updateAnimation();
            }, 100);
        } else {
            console.error('Canvas or overlay elements not found');
            hideIntro();
        }
        
        // Loading spinner control - EXACT COPY of intro animation
        let loadingAnimationRunning = false;
        let loadingTime = 0;
        let loadingWizardOrbitStart = 0;
        let loadingRoseOrbitStart = Math.PI;
        
        function showLoadingSpinner() {
            const loadingOverlay = document.getElementById('loadingSpinner');
            const loadingCanvas = document.getElementById('loading-lines-canvas');
            const loadingCtx = loadingCanvas ? loadingCanvas.getContext('2d', { alpha: true }) : null;
            
            if (!loadingOverlay) {
                console.error('Loading overlay not found');
                return;
            }
            
            loadingOverlay.style.display = 'flex';
            loadingOverlay.style.opacity = 1;
            
            if (!loadingCanvas || !loadingCtx) return;
            
            // Setup canvas with DPR
            const dpr = Math.min(window.devicePixelRatio || 1, 1.5);
            const lWidth = window.innerWidth;
            const lHeight = window.innerHeight;
            const lCenterX = lWidth / 2;
            const lCenterY = lHeight / 2;
            
            loadingCanvas.width = lWidth * dpr;
            loadingCanvas.height = lHeight * dpr;
            loadingCanvas.style.width = lWidth + 'px';
            loadingCanvas.style.height = lHeight + 'px';
            loadingCtx.scale(dpr, dpr);
            
            const loadingQuantum = document.getElementById('loading-quantum');
            const loadingWizard = document.getElementById('loading-wizard');
            const loadingRose = document.getElementById('loading-rose');
            const loadingSingularity = document.getElementById('loading-singularity');
            const loadingTitle = document.getElementById('loading-title');
            
            // Check if all required elements exist
            if (!loadingQuantum || !loadingWizard || !loadingRose || !loadingSingularity || !loadingTitle) {
                console.error('Loading animation elements not found');
                return;
            }
            
            // Reset all elements
            [loadingQuantum, loadingWizard, loadingRose, loadingSingularity, loadingTitle].forEach(el => {
                if (el) { el.style.opacity = 0; el.style.transform = 'translate(-50%, -50%)'; }
            });
            
            loadingTime = 0;
            loadingAnimationRunning = true;
            loadingWizardOrbitStart = 0;
            loadingRoseOrbitStart = Math.PI;
            
            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
            
            function clamp(value, min, max) {
                return Math.max(min, Math.min(max, value));
            }
            
            function updateLoadingAnimation() {
                if (!loadingAnimationRunning) return;
                
                const t = loadingTime / 60;
                loadingCtx.clearRect(0, 0, lWidth, lHeight);

                if (t < 1) {
                    const progress = clamp(t / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    loadingQuantum.style.left = lCenterX + 'px';
                    loadingQuantum.style.top = lCenterY + 'px';
                    loadingQuantum.style.transform = `translate(-50%, -50%) scale(${ease})`;
                    loadingQuantum.style.opacity = ease;
                    loadingWizard.style.opacity = 0;
                    loadingRose.style.opacity = 0;
                }
                else if (t < 2) {
                    const progress = clamp((t - 1) / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    loadingQuantum.style.left = lCenterX + 'px';
                    loadingQuantum.style.top = lCenterY + 'px';
                    loadingQuantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    loadingQuantum.style.opacity = 1;
                    const wizardX = ease * (lCenterX - 80);
                    loadingWizard.style.left = wizardX + 'px';
                    loadingWizard.style.top = lCenterY + 'px';
                    loadingWizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    loadingWizard.style.opacity = ease;
                    const roseX = lWidth - ease * (lWidth - lCenterX - 80);
                    loadingRose.style.left = roseX + 'px';
                    loadingRose.style.top = lCenterY + 'px';
                    loadingRose.style.transform = 'translate(-50%, -50%) scale(1)';
                    loadingRose.style.opacity = ease;
                }
                else if (t < 3) {
                    loadingQuantum.style.left = lCenterX + 'px';
                    loadingQuantum.style.top = lCenterY + 'px';
                    loadingQuantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    loadingWizard.style.left = (lCenterX - 80) + 'px';
                    loadingWizard.style.top = lCenterY + 'px';
                    loadingWizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    loadingRose.style.left = (lCenterX + 80) + 'px';
                    loadingRose.style.top = lCenterY + 'px';
                    loadingRose.style.transform = 'translate(-50%, -50%) scale(1)';
                }
                else if (t < 4.5) {
                    const progress = clamp((t - 3) / 1.5, 0, 1);
                    const rotation = progress * Math.PI * 2 * 0.5;
                    loadingCtx.strokeStyle = 'rgba(0, 240, 255, ' + (progress * 0.6) + ')';
                    loadingCtx.lineWidth = 2;
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation, rotation + Math.PI);
                    loadingCtx.stroke();
                    loadingCtx.strokeStyle = 'rgba(255, 0, 255, ' + (progress * 0.6) + ')';
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    loadingCtx.stroke();
                    loadingCtx.strokeStyle = 'rgba(157, 0, 255, ' + (progress * 0.6) + ')';
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                    loadingCtx.stroke();
                    if (t < 4.51) {
                        loadingWizardOrbitStart = Math.PI;
                        loadingRoseOrbitStart = 0;
                    }
                }
                else if (t < 6.5) {
                    const progress = clamp((t - 4.5) / 2, 0, 1);
                    const speedMultiplier = 1 + progress * 8;
                    const rotation = ((t - 3) * speedMultiplier) * Math.PI * 2 * 0.5;
                    loadingCtx.strokeStyle = 'rgba(0, 240, 255, 0.6)';
                    loadingCtx.lineWidth = 2;
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation, rotation + Math.PI);
                    loadingCtx.stroke();
                    loadingCtx.strokeStyle = 'rgba(255, 0, 255, 0.6)';
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    loadingCtx.stroke();
                    loadingCtx.strokeStyle = 'rgba(157, 0, 255, 0.6)';
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, 80, rotation + Math.PI, rotation + Math.PI * 2);
                    loadingCtx.stroke();
                    loadingQuantum.style.left = lCenterX + 'px';
                    loadingQuantum.style.top = lCenterY + 'px';
                    loadingQuantum.style.transform = 'translate(-50%, -50%) scale(1)';
                    const orbitProgress = (t - 4.5) * speedMultiplier * 0.5;
                    const orbitRadius = 80;
                    const wizardAngle = loadingWizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = lCenterX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = lCenterY + Math.sin(wizardAngle) * orbitRadius;
                    loadingWizard.style.left = wizardX + 'px';
                    loadingWizard.style.top = wizardY + 'px';
                    loadingWizard.style.transform = 'translate(-50%, -50%) scale(1)';
                    const roseAngle = loadingRoseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = lCenterX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = lCenterY + Math.sin(roseAngle) * orbitRadius;
                    loadingRose.style.left = roseX + 'px';
                    loadingRose.style.top = roseY + 'px';
                    loadingRose.style.transform = 'translate(-50%, -50%) scale(1)';
                }
                else if (t < 7.5) {
                    const progress = clamp((t - 6.5) / 1, 0, 1);
                    const ease = easeInOutCubic(progress);
                    const rotation = ((t - 3) * 9) * Math.PI * 2 * 0.5;
                    const lineOpacity = 0.6 * (1 - ease);
                    const lineRadius = 80 * (1 - ease);
                    loadingCtx.strokeStyle = 'rgba(0, 240, 255, ' + lineOpacity + ')';
                    loadingCtx.lineWidth = 2;
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, lineRadius, rotation, rotation + Math.PI);
                    loadingCtx.stroke();
                    loadingCtx.strokeStyle = 'rgba(255, 0, 255, ' + lineOpacity + ')';
                    loadingCtx.beginPath();
                    loadingCtx.arc(lCenterX, lCenterY, lineRadius, rotation + Math.PI / 2, rotation + Math.PI * 1.5);
                    loadingCtx.stroke();
                    const orbitProgress = (t - 4.5) * 9 * 0.5;
                    const orbitRadius = 80 * (1 - ease);
                    const wizardAngle = loadingWizardOrbitStart + orbitProgress * Math.PI * 2;
                    const wizardX = lCenterX + Math.cos(wizardAngle) * orbitRadius;
                    const wizardY = lCenterY + Math.sin(wizardAngle) * orbitRadius;
                    const roseAngle = loadingRoseOrbitStart + orbitProgress * Math.PI * 2;
                    const roseX = lCenterX + Math.cos(roseAngle) * orbitRadius;
                    const roseY = lCenterY + Math.sin(roseAngle) * orbitRadius;
                    const emojiScale = 1 - ease * 0.9;
                    loadingWizard.style.left = wizardX + 'px';
                    loadingWizard.style.top = wizardY + 'px';
                    loadingWizard.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                    loadingWizard.style.opacity = 1 - ease;
                    loadingRose.style.left = roseX + 'px';
                    loadingRose.style.top = roseY + 'px';
                    loadingRose.style.transform = `translate(-50%, -50%) scale(${emojiScale})`;
                    loadingRose.style.opacity = 1 - ease;
                    const quantumScale = 1 + (ease < 0.3 ? ease * 0.5 : (1 - ease) * 1.5);
                    loadingQuantum.style.left = lCenterX + 'px';
                    loadingQuantum.style.top = lCenterY + 'px';
                    loadingQuantum.style.transform = `translate(-50%, -50%) scale(${quantumScale})`;
                    loadingQuantum.style.opacity = 1 - ease;
                    loadingSingularity.style.transform = `translate(-50%, -50%) scale(${ease})`;
                    loadingSingularity.style.opacity = ease;
                }
                else if (t < 8) {
                    loadingQuantum.style.opacity = 0;
                    loadingWizard.style.opacity = 0;
                    loadingRose.style.opacity = 0;
                    const pulse = Math.sin((t - 7.5) * Math.PI * 4) * 0.2 + 1;
                    loadingSingularity.style.transform = `translate(-50%, -50%) scale(${pulse})`;
                    loadingSingularity.style.opacity = 1;
                }
                else if (t < 10) {
                    const progress = clamp((t - 8) / 2, 0, 1);
                    const ease = easeInOutCubic(progress);
                    loadingSingularity.style.transform = `translate(-50%, -50%) scale(1)`;
                    loadingSingularity.style.opacity = 1 - ease;
                    const maxFontSize = Math.min(lWidth * 0.065, 42);
                    const fontSize = ease * maxFontSize;
                    loadingTitle.style.fontSize = fontSize + 'px';
                    loadingTitle.style.transform = `translate(-50%, -50%)`;
                    loadingTitle.style.opacity = ease;
                }
                else if (t < 11) {
                    loadingSingularity.style.opacity = 0;
                    const maxFontSize = Math.min(lWidth * 0.065, 42);
                    loadingTitle.style.fontSize = maxFontSize + 'px';
                    loadingTitle.style.opacity = 1;
                }
                else {
                    // Keep title visible with subtle pulse - NO orbital rings
                    loadingSingularity.style.opacity = 0;
                    loadingQuantum.style.opacity = 0;
                    loadingWizard.style.opacity = 0;
                    loadingRose.style.opacity = 0;
                    
                    // Clear canvas - no rings
                    loadingCtx.clearRect(0, 0, lWidth, lHeight);
                    
                    // Keep title visible with subtle glow pulse
                    const maxFontSize = Math.min(lWidth * 0.065, 42);
                    loadingTitle.style.fontSize = maxFontSize + 'px';
                    const pulse = 0.85 + Math.sin((t - 11) * 2) * 0.15;
                    loadingTitle.style.opacity = pulse;
                }

                loadingTime++;
                if (loadingAnimationRunning) {
                    requestAnimationFrame(updateLoadingAnimation);
                }
            }
            
            updateLoadingAnimation();
        }
        
        function hideLoadingSpinner() {
            loadingAnimationRunning = false;
            const loadingOverlay = document.getElementById('loadingSpinner');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        }

        function skipLoadingAnimation() {
            hideLoadingSpinner();
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('timeframeSelector').style.display = 'flex';
            document.getElementById('forecastOutput').classList.add('show');
            document.getElementById('howToUse').style.display = 'block';
            document.getElementById('forecastOutput').scrollIntoView({ behavior: 'smooth' });
        }

        // Scroll to top on page load/refresh
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        };
        
        // Also scroll to top when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            window.scrollTo(0, 0);
            // Small delay to ensure scroll happens after any other scripts
            setTimeout(() => window.scrollTo(0, 0), 100);
        });

        // ========================================
        // REALITY CODE TEMPLATES DATABASE
        // ========================================
        
        const REALITY_TEMPLATES = {
            // Life Path Templates
            lifePath: {
                1: [
                    { statement: "I am confidently leading innovative projects that inspire others and create lasting impact in my field.", category: "career", icon: "💼", why: "Your Life Path 1 indicates natural leadership abilities. This statement aligns with your pioneering energy and need for independence.", keywords: ["leadership", "innovation", "independence"] },
                    { statement: "I am boldly initiating new ventures and opportunities that align with my authentic vision and purpose.", category: "career", icon: "🚀", why: "As a Life Path 1, you're meant to start things. This statement honors your role as an initiator and trailblazer.", keywords: ["new beginnings", "courage", "vision"] }
                ],
                2: [
                    { statement: "I am creating harmonious relationships and partnerships that bring peace, balance, and mutual growth into my life.", category: "love", icon: "❤️", why: "Your Life Path 2 thrives on cooperation and diplomacy. This statement honors your gift for bringing people together.", keywords: ["harmony", "partnership", "balance"] },
                    { statement: "I am the bridge that connects people and ideas, creating beautiful collaborations that benefit everyone involved.", category: "love", icon: "🤝", why: "Life Path 2 is the peacemaker and mediator. This statement celebrates your ability to unite and harmonize.", keywords: ["connection", "collaboration", "unity"] }
                ],
                3: [
                    { statement: "I am expressing my creativity freely and joyfully, inspiring millions through my authentic artistic voice.", category: "creative", icon: "🎨", why: "Your Life Path 3 is the creative communicator. This statement amplifies your natural gift for self-expression.", keywords: ["creativity", "expression", "joy"] },
                    { statement: "I am radiating joy and optimism, uplifting everyone around me with my creative energy and authentic self-expression.", category: "creative", icon: "✨", why: "Life Path 3 brings light and joy to the world. This statement honors your role as an uplifter.", keywords: ["joy", "optimism", "creativity"] }
                ],
                4: [
                    { statement: "I am building solid foundations for lasting success through disciplined action and practical wisdom.", category: "career", icon: "🏗️", why: "Your Life Path 4 excels at creating structure. This statement aligns with your ability to manifest tangible results.", keywords: ["foundation", "discipline", "structure"] },
                    { statement: "I am creating stable, secure systems that support my dreams and provide lasting value to others.", category: "career", icon: "🧱", why: "Life Path 4 is the master builder. This statement celebrates your gift for creating order and stability.", keywords: ["stability", "security", "systems"] }
                ],
                5: [
                    { statement: "I am living in complete freedom, exploring the world and experiencing endless adventure while maintaining perfect balance.", category: "freedom", icon: "🦅", why: "Your Life Path 5 craves freedom and variety. This statement honors your need for adventure.", keywords: ["freedom", "adventure", "exploration"] },
                    { statement: "I am embracing change and new experiences with excitement, knowing each adventure expands my consciousness.", category: "freedom", icon: "🌍", why: "Life Path 5 is the adventurer. This statement celebrates your love of change and new experiences.", keywords: ["change", "excitement", "expansion"] }
                ],
                6: [
                    { statement: "I am nurturing loving relationships and creating a harmonious home filled with beauty, comfort, and unconditional love.", category: "love", icon: "🏡", why: "Your Life Path 6 is the nurturer. This statement aligns with your natural ability to create harmony.", keywords: ["nurturing", "love", "harmony"] },
                    { statement: "I am serving others with love and compassion, creating beauty and harmony in everything I touch.", category: "love", icon: "💕", why: "Life Path 6 is the caretaker. This statement honors your gift for service and creating beautiful environments.", keywords: ["service", "compassion", "beauty"] }
                ],
                7: [
                    { statement: "I am deepening my spiritual wisdom and sharing profound insights that awaken consciousness in others.", category: "spiritual", icon: "🌟", why: "Your Life Path 7 is the seeker of truth. This statement honors your analytical mind and spiritual depth.", keywords: ["wisdom", "spirituality", "insight"] },
                    { statement: "I am trusting my intuition and inner knowing, discovering profound truths that transform my understanding of reality.", category: "spiritual", icon: "🔮", why: "Life Path 7 is the mystic. This statement celebrates your connection to higher wisdom.", keywords: ["intuition", "truth", "transformation"] }
                ],
                8: [
                    { statement: "I am manifesting abundant wealth and using my power to create positive change in the world.", category: "abundance", icon: "💰", why: "Your Life Path 8 is the powerhouse. This statement aligns with your natural ability to manifest success.", keywords: ["abundance", "wealth", "power"] },
                    { statement: "I am stepping into my power as a leader and creator of wealth, achieving success while maintaining integrity.", category: "abundance", icon: "👑", why: "Life Path 8 is the CEO. This statement honors your ability to achieve material success ethically.", keywords: ["power", "leadership", "success"] }
                ],
                9: [
                    { statement: "I am serving humanity with compassion and wisdom, transforming lives through my healing presence and universal love.", category: "spiritual", icon: "🌍", why: "Your Life Path 9 is the humanitarian. This statement honors your gift for compassion.", keywords: ["service", "compassion", "healing"] },
                    { statement: "I am completing old cycles with grace and embracing my role as a lightworker who uplifts and transforms the world.", category: "spiritual", icon: "🌅", why: "Life Path 9 is the old soul. This statement celebrates your wisdom and ability to help others evolve.", keywords: ["completion", "transformation", "lightwork"] }
                ],
                11: [
                    { statement: "I am channeling divine inspiration and illuminating the path for others through my spiritual gifts and intuitive wisdom.", category: "spiritual", icon: "✨", why: "Your Master Number 11 is the spiritual messenger. This statement amplifies your role as a lightworker.", keywords: ["inspiration", "illumination", "intuition"] }
                ],
                22: [
                    { statement: "I am building visionary projects that transform society and leave a lasting legacy for future generations.", category: "career", icon: "🏛️", why: "Your Master Number 22 is the master builder. This statement aligns with your ability to manifest grand visions.", keywords: ["vision", "building", "legacy"] }
                ],
                33: [
                    { statement: "I am embodying unconditional love and teaching others to heal themselves and the world through compassion.", category: "spiritual", icon: "💖", why: "Your Master Number 33 is the master teacher. This statement honors your role as a healer.", keywords: ["love", "teaching", "healing"] }
                ]
            },
            
            // Sun Sign Templates
            sunSign: {
                'Aries': [{ statement: "I am boldly pursuing my passions with courage and enthusiasm, achieving breakthrough success in everything I initiate.", category: "career", icon: "🔥", why: "Your Aries Sun gives you pioneering energy and fearless initiative.", keywords: ["courage", "passion", "initiative"] }],
                'Taurus': [{ statement: "I am enjoying abundant material comfort and sensory pleasures while building lasting wealth and security.", category: "abundance", icon: "💎", why: "Your Taurus Sun values stability and luxury.", keywords: ["abundance", "comfort", "security"] }],
                'Gemini': [{ statement: "I am communicating brilliant ideas that connect people and create exciting opportunities for learning and growth.", category: "creative", icon: "💬", why: "Your Gemini Sun thrives on communication and variety.", keywords: ["communication", "ideas", "connection"] }],
                'Cancer': [{ statement: "I am creating a nurturing sanctuary filled with love, emotional safety, and deep family connections.", category: "love", icon: "🏠", why: "Your Cancer Sun is deeply emotional and nurturing.", keywords: ["nurturing", "love", "safety"] }],
                'Leo': [{ statement: "I am shining my authentic light and inspiring others through my creative self-expression and generous heart.", category: "creative", icon: "👑", why: "Your Leo Sun needs to shine and be seen.", keywords: ["shine", "authenticity", "creativity"] }],
                'Virgo': [{ statement: "I am perfecting my craft and serving others through my meticulous attention to detail and healing abilities.", category: "health", icon: "🌿", why: "Your Virgo Sun excels at refinement and service.", keywords: ["perfection", "service", "healing"] }],
                'Libra': [{ statement: "I am creating beautiful harmony in all my relationships and experiencing perfect balance in every area of life.", category: "love", icon: "⚖️", why: "Your Libra Sun seeks balance and beauty.", keywords: ["harmony", "balance", "beauty"] }],
                'Scorpio': [{ statement: "I am transforming my life through deep emotional healing and emerging more powerful, authentic, and magnetic.", category: "spiritual", icon: "🦂", why: "Your Scorpio Sun is about transformation and depth.", keywords: ["transformation", "healing", "power"] }],
                'Sagittarius': [{ statement: "I am expanding my horizons through adventurous travel and sharing my philosophical wisdom with the world.", category: "freedom", icon: "🏹", why: "Your Sagittarius Sun craves expansion and meaning.", keywords: ["expansion", "adventure", "wisdom"] }],
                'Capricorn': [{ statement: "I am achieving prestigious success and building an empire through disciplined ambition and strategic planning.", category: "career", icon: "🏔️", why: "Your Capricorn Sun is ambitious and disciplined.", keywords: ["success", "ambition", "discipline"] }],
                'Aquarius': [{ statement: "I am revolutionizing my field through innovative ideas and creating a better future for humanity.", category: "career", icon: "⚡", why: "Your Aquarius Sun is the visionary rebel.", keywords: ["innovation", "revolution", "vision"] }],
                'Pisces': [{ statement: "I am flowing with divine inspiration and channeling healing creativity that touches souls and transcends boundaries.", category: "spiritual", icon: "🌊", why: "Your Pisces Sun is deeply spiritual and artistic.", keywords: ["inspiration", "healing", "creativity"] }]
            },
            
            // Personal Year Templates  
            personalYear: {
                1: { statement: "I am embracing this year of new beginnings and planting seeds for my most exciting chapter yet.", category: "other", icon: "🌱", why: "You're in a Personal Year 1 - a time for fresh starts.", keywords: ["new beginnings", "fresh start"] },
                2: { statement: "I am cultivating patience and nurturing the relationships and projects that will bloom in perfect timing.", category: "love", icon: "🤝", why: "You're in a Personal Year 2 - a time for cooperation.", keywords: ["patience", "nurturing", "relationships"] },
                3: { statement: "I am expressing my creativity joyfully and attracting abundant opportunities through my authentic self-expression.", category: "creative", icon: "🎭", why: "You're in a Personal Year 3 - a time for creativity.", keywords: ["creativity", "joy", "expression"] },
                4: { statement: "I am building solid foundations and creating lasting structures that will support my dreams for years to come.", category: "career", icon: "🧱", why: "You're in a Personal Year 4 - a time for building.", keywords: ["foundation", "structure", "building"] },
                5: { statement: "I am embracing change and freedom, welcoming unexpected adventures that expand my life in thrilling ways.", category: "freedom", icon: "🎢", why: "You're in a Personal Year 5 - a time for change.", keywords: ["change", "freedom", "adventure"] },
                6: { statement: "I am deepening my commitments and creating harmony in my home, relationships, and community.", category: "love", icon: "💕", why: "You're in a Personal Year 6 - a time for responsibility.", keywords: ["commitment", "harmony", "home"] },
                7: { statement: "I am going within to discover profound spiritual truths and emerging with wisdom that transforms my path.", category: "spiritual", icon: "🔮", why: "You're in a Personal Year 7 - a time for introspection.", keywords: ["introspection", "wisdom", "spirituality"] },
                8: { statement: "I am manifesting abundant success and stepping into my power as a leader and creator of wealth.", category: "abundance", icon: "💸", why: "You're in a Personal Year 8 - a time for power.", keywords: ["abundance", "success", "power"] },
                9: { statement: "I am releasing what no longer serves me and completing this cycle with grace, wisdom, and gratitude.", category: "spiritual", icon: "🌅", why: "You're in a Personal Year 9 - a time for completion.", keywords: ["release", "completion", "wisdom"] }
            },
            
            // Universal Templates
            universal: [
                { statement: "I am living my most authentic, abundant, and joyful life, aligned with my highest purpose and surrounded by love.", category: "other", icon: "🌟", why: "This universal statement covers all major life areas - abundance, purpose, authenticity, and love.", keywords: ["authenticity", "abundance", "joy"] },
                { statement: "I am a powerful creator of my reality, manifesting miracles and living in perfect alignment with my soul's purpose.", category: "other", icon: "⚡", why: "This statement affirms your creative power and divine alignment.", keywords: ["creator", "manifestation", "miracles"] },
                { statement: "I am grateful for all the blessings flowing into my life, and I am open to receiving even more abundance and joy.", category: "abundance", icon: "🙏", why: "Gratitude amplifies manifestation. This statement opens you to receive.", keywords: ["gratitude", "blessings", "abundance"] }
            ]
        };
        
        // Generate Reality Code suggestions based on reading data
        function generateRealityCodeSuggestions(lifePath, sunSign, personalYear) {
            const suggestions = [];
            
            // Life Path suggestion
            if (lifePath && REALITY_TEMPLATES.lifePath[lifePath]) {
                const templates = REALITY_TEMPLATES.lifePath[lifePath];
                const template = templates[Math.floor(Math.random() * templates.length)];
                suggestions.push({ ...template, match: 95, source: `Life Path ${lifePath} Analysis` });
            }
            
            // Sun Sign suggestion
            if (sunSign && REALITY_TEMPLATES.sunSign[sunSign]) {
                const templates = REALITY_TEMPLATES.sunSign[sunSign];
                const template = templates[0];
                suggestions.push({ ...template, match: 90, source: `${sunSign} Sun Analysis` });
            }
            
            // Personal Year suggestion
            if (personalYear && REALITY_TEMPLATES.personalYear[personalYear]) {
                const template = REALITY_TEMPLATES.personalYear[personalYear];
                suggestions.push({ ...template, match: 88, source: `Personal Year ${personalYear} Forecast` });
            }
            
            // Add universal suggestion
            const universal = REALITY_TEMPLATES.universal[Math.floor(Math.random() * REALITY_TEMPLATES.universal.length)];
            suggestions.push({ ...universal, match: 85, source: "Universal Alignment" });
            
            return suggestions.slice(0, 3);
        }
        
        // Generate unique Reality Code
        function generateRealityCode(statement, userName, birthDate, category) {
            // Calculate English Gematria (A=1, B=2, C=3...Z=26)
            let gematria = 0;
            const cleanStatement = statement.toUpperCase().replace(/[^A-Z]/g, '');
            
            for (let i = 0; i < cleanStatement.length; i++) {
                const charCode = cleanStatement.charCodeAt(i);
                if (charCode >= 65 && charCode <= 90) { // A-Z
                    gematria += (charCode - 64); // A=1, B=2, etc.
                }
            }
            
            return gematria.toString();
        }
        
        // Save Reality Code to storage
        function saveRealityCodeToStorage(code, statement, category) {
            const codeData = {
                code: code,
                statement: statement,
                category: category,
                created: new Date().toISOString(),
                people: 1,
                power: 1
            };
            const codes = JSON.parse(localStorage.getItem('quantumRealityCodes') || '[]');
            codes.push(codeData);
            localStorage.setItem('quantumRealityCodes', JSON.stringify(codes));
        }
        
        // Copy Reality Code to clipboard with viral message
        function copyRealityCode(code, statement) {
            const text = `🌟 QUANTUM REALITY CODE: ${code} 🌟

✨ Comment my code "${code}" below to amplify my manifestation!

🔮 IMPORTANT: By supporting my code, you CLEAR BLOCKAGES in your own manifestation field! When you help me, you help yourself. This is quantum reciprocity in action.

🚀 Drop your code below and I'll support yours too!

Together we manifest faster. The more we support each other, the more powerful we ALL become.`;
            navigator.clipboard.writeText(text).then(() => {
                showShareToast('Copied! Paste into community below 👇');
            });
        }
        
        // Share Reality Code - show special modal with community links
        function shareRealityCode(code, statement) {
            currentShareMessage = `🔮 My Quantum Reality Code: ${code}\n\n"${statement}"\n\n✨ Amplify with me using the Power of Eight! When groups focus on the same intention, manifestation power grows exponentially.\n\nGet your FREE Reality Code:`;
            currentShareTitle = 'My Quantum Reality Code';
            currentShareType = 'reality-code';
            currentShareDetails = code;
            showShareModal();
        }

        // Generate stars background
        function generateStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        generateStars();

        // ========================================
        // USER SESSION & PROFILE MANAGEMENT
        // ========================================

        // Save user profile to localStorage
        function saveUserProfile(profile) {
            localStorage.setItem('quantumMerlin_userProfile', JSON.stringify(profile));
            localStorage.setItem('quantumMerlin_lastActive', new Date().toISOString());
        }

        // Load user profile from localStorage
        function loadUserProfile() {
            const saved = localStorage.getItem('quantumMerlin_userProfile');
            return saved ? JSON.parse(saved) : null;
        }

        // Check if user has profile
        function hasUserProfile() {
            return localStorage.getItem('quantumMerlin_userProfile') !== null;
        }

        // Initialize user session on page load
        function initializeUserSession() {
            const userProfile = loadUserProfile();
            
            if (userProfile) {
                // Returning user - show load profile button
                const loadProfileSection = document.getElementById('loadProfileSection');
                if (loadProfileSection) {
                    loadProfileSection.style.display = 'block';
                }
                window.savedProfile = userProfile;
            }
        }

        // Load saved profile into form (for manual profile load button in input section)
        function loadProfileToForm() {
            const profile = loadUserProfile();
            
            if (!profile) {
                alert('No saved profile found. Please enter your details.');
                return;
            }
            
            // Fill in all saved fields
            if (profile.birthDate) document.getElementById('birthDate').value = profile.birthDate;
            if (profile.birthTime) {
                document.getElementById('birthTime').value = profile.birthTime;
                toggleEnhanced(); // Expand the section
            }
            if (profile.birthLocation) {
                document.getElementById('birthLocation').value = profile.birthLocation;
                if (!document.getElementById('enhancedContent').classList.contains('expanded')) {
                    toggleEnhanced();
                }
            }
            if (profile.currentLocation) {
                document.getElementById('currentLocation').value = profile.currentLocation;
                if (!document.getElementById('enhancedContent').classList.contains('expanded')) {
                    toggleEnhanced();
                }
            }
            if (profile.firstName) {
                document.getElementById('firstName').value = profile.firstName;
                if (!document.getElementById('advancedContent').classList.contains('expanded')) {
                    toggleAdvanced();
                }
            }
            if (profile.middleName) document.getElementById('middleName').value = profile.middleName;
            if (profile.lastName) document.getElementById('lastName').value = profile.lastName;
            
            // Hide the load profile section
            document.getElementById('loadProfileSection').style.display = 'none';
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.style.cssText = 'background: rgba(0, 255, 136, 0.2); border: 2px solid rgba(0, 255, 136, 0.5); padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; color: #00ff88;';
            successMsg.innerHTML = '✅ Profile loaded successfully! Ready to generate your forecast.';
            document.querySelector('.input-section').insertBefore(successMsg, document.querySelector('.input-group'));
            
            // Remove success message after 3 seconds
            setTimeout(() => successMsg.remove(), 3000);
        }

        // Scroll to input section
        function scrollToInput() {
            document.getElementById('inputSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Close welcome banner
        function closeWelcomeBanner() {
            const banner = document.getElementById('welcomeBackBanner');
            if (banner) {
                banner.style.display = 'none';
            }
        }

        // Load saved profile and generate forecast
        function loadSavedProfile() {
            const profile = window.savedProfile || loadUserProfile();
            
            if (!profile) {
                scrollToInput();
                return;
            }
            
            profile.lastUsed = new Date().toISOString();
            saveUserProfile(profile);
            
            // Hide welcome banner
            closeWelcomeBanner();
            
            // Prefill form with saved data (for the generate function to use)
            if (profile.firstName) document.getElementById('firstName').value = profile.firstName;
            if (profile.middleName) document.getElementById('middleName').value = profile.middleName;
            if (profile.lastName) document.getElementById('lastName').value = profile.lastName;
            if (profile.birthDate) document.getElementById('birthDate').value = profile.birthDate;
            if (profile.birthTime) document.getElementById('birthTime').value = profile.birthTime;
            if (profile.birthLocation) document.getElementById('birthLocation').value = profile.birthLocation;
            if (profile.currentLocation) document.getElementById('currentLocation').value = profile.currentLocation;
            
            // Show loading spinner with full animation (same as generate button)
            showLoadingSpinner();
            document.getElementById('inputSection').style.display = 'none';
            
            // Wait for full intro animation (11s) then generate forecast (same as generate button)
            setTimeout(async () => {
                await generateForecast('daily');
                hideLoadingSpinner();
                document.getElementById('timeframeSelector').style.display = 'flex';
                document.getElementById('forecastOutput').classList.add('show');
                document.getElementById('howToUse').style.display = 'block';
                document.getElementById('forecastOutput').scrollIntoView({ behavior: 'smooth' });
            }, 11000);
        }

        // Show update profile form
        function showUpdateProfile() {
            const profile = window.savedProfile || loadUserProfile();
            
            if (!profile) {
                scrollToInput();
                return;
            }
            
            // Scroll to input section
            scrollToInput();
            
            // Fill form fields
            if (profile.firstName) document.getElementById('firstName').value = profile.firstName;
            if (profile.middleName) document.getElementById('middleName').value = profile.middleName;
            if (profile.lastName) document.getElementById('lastName').value = profile.lastName;
            if (profile.birthDate) document.getElementById('birthDate').value = profile.birthDate;
            if (profile.birthTime) document.getElementById('birthTime').value = profile.birthTime;
            if (profile.birthLocation) document.getElementById('birthLocation').value = profile.birthLocation;
            if (profile.currentLocation) document.getElementById('currentLocation').value = profile.currentLocation;
            
            // Expand advanced sections if data exists
            if (profile.birthTime || profile.birthLocation) {
                const enhancedContent = document.getElementById('enhancedContent');
                if (enhancedContent) enhancedContent.style.display = 'block';
            }
            
            // Close welcome banner
            closeWelcomeBanner();
            
            // Show success message
            showSuccessMessage('Profile loaded! Update any fields and generate your forecast.');
        }

        // Save user profile from form (called after generating forecast)
        function saveUserProfileFromForm() {
            const profile = {
                id: window.savedProfile?.id || 'user_' + Date.now(),
                created: window.savedProfile?.created || new Date().toISOString(),
                lastUsed: new Date().toISOString(),
                
                // Get data from form
                firstName: document.getElementById('firstName').value || '',
                middleName: document.getElementById('middleName').value || '',
                lastName: document.getElementById('lastName').value || '',
                birthDate: document.getElementById('birthDate').value || '',
                birthTime: document.getElementById('birthTime').value || '',
                birthLocation: document.getElementById('birthLocation').value || '',
                currentLocation: document.getElementById('currentLocation').value || '',
                
                // Set preferred name
                preferredName: document.getElementById('firstName').value || 'Seeker',
                
                // Store timezone
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            // Only save if we have at least birth date
            if (profile.birthDate) {
                saveUserProfile(profile);
                window.savedProfile = profile;
                
                // Show success message
                showSuccessMessage('✨ Profile saved! Next time, just one click to get your forecast.');
            }
        }

        // Show success toast notification
        function showSuccessMessage(message) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'success-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ========================================
        // MONETIZATION FEATURES
        // ========================================

        // Email Capture System
        document.getElementById('emailForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('emailInput').value;
            const form = this;
            
            try {
                // Submit to Formspree
                const response = await fetch('https://formspree.io/f/mgowrolb', {
                    method: 'POST',
                    body: new FormData(form),
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    // Store locally for tracking
                    let emails = JSON.parse(localStorage.getItem('qm_subscribers') || '[]');
                    if (!emails.includes(email)) {
                        emails.push(email);
                        localStorage.setItem('qm_subscribers', JSON.stringify(emails));
                    }
                    
                    // Show success
                    form.innerHTML = `
                        <div style="color: var(--neon-gold); font-size: 1.2rem; padding: 15px;">
                            ✅ Thanks for subscribing!
                        </div>
                    `;
                    
                    // Track conversion
                    console.log('Email captured:', email);
                } else {
                    throw new Error('Subscription failed');
                }
            } catch (error) {
                console.error('Email signup error:', error);
                alert('There was a problem subscribing. Please try again.');
            }
        });

        // Social Sharing Functions
        function generateShareURL() {
            const birthDate = document.getElementById('birthDate').value;
            if (!birthDate) return window.location.href;
            
            const sign = getZodiacSign(new Date(birthDate).getMonth() + 1, new Date(birthDate).getDate());
            return `${window.location.origin}/forecasts?sign=${sign.name}`;
        }

        function shareToTwitter(text) {
            const url = encodeURIComponent(generateShareURL());
            const tweetText = encodeURIComponent(text || "I just got my Quantum Forecast! 🌌✨ Get your personalized cosmic guidance:");
            window.open(`https://twitter.com/intent/tweet?text=${tweetText}&url=${url}`, '_blank');
        }

        // Section-specific sharing - Always show modal first for maximum control
        let currentShareMessage = '';
        let currentShareTitle = '';
        let currentShareType = '';
        let currentShareDetails = '';
        
        function shareSectionInsight(sectionType, details) {
            const messages = {
                'tarot': `🃏 Just pulled "${details}" in my daily forecast!\n\nThis FREE tool combines 8 mystical systems (Astrology, Tarot, Numerology, Chinese Zodiac, Gematria & more) for scary-accurate cosmic guidance.\n\nGet yours now:`,
                'chinese': `🐉 I'm a ${details}!\n\nJust discovered this with a FREE multi-system forecast tool that combines ancient wisdom from 8 different traditions.\n\nFind your cosmic identity:`,
                'astrology': `⭐ ${details}\n\nThis multi-system forecast tool is INSANELY accurate. It combines Astrology, Tarot, Numerology, Chinese Zodiac, Gematria, Frequencies & more.\n\n100% FREE. Try it:`,
                'numerology': `🔢 My Life Path is ${details}!\n\nCalculate yours with this FREE tool that combines 8 ancient systems for incredibly accurate cosmic guidance.\n\nDiscover your path:`,
                'reality-code': `✨ My Reality Code: ${details}\n\nJoin the quantum manifestation revolution. When multiple people use the same code, manifestation power exponentially amplifies!\n\nGet your code:`,
                'planetary': `🪐 My cosmic timing: ${details}\n\nPerfect timing = maximum manifestation. Get your personalized celestial forecast combining 8 mystical systems.\n\n100% FREE:`,
                'gematria': `📜 My name's gematria value: ${details}\n\nDiscover the hidden code in YOUR name with this FREE multi-system forecast tool.\n\nUnlock your code:`,
                'frequency': `🔊 My healing frequency: ${details}\n\nFind YOUR healing frequency with this free cosmic calculator combining 8 ancient wisdom systems.\n\nGet yours:`
            };
            
            const titles = {
                'tarot': 'My Tarot Card',
                'chinese': 'My Chinese Zodiac',
                'astrology': 'My Cosmic Identity',
                'numerology': 'My Life Path',
                'reality-code': 'My Reality Code',
                'planetary': 'My Cosmic Timing',
                'gematria': 'My Gematria',
                'frequency': 'My Healing Frequency'
            };
            
            currentShareMessage = messages[sectionType] || `✨ Just discovered something amazing about myself with this FREE multi-system forecast tool!`;
            currentShareTitle = titles[sectionType] || 'My Quantum Discovery';
            currentShareType = sectionType;
            currentShareDetails = details;
            
            // Always show modal first - gives user control and shows visual card option
            showShareModal();
        }
        
        // Floating share button - shares general forecast
        function shareGeneralForecast() {
            currentShareMessage = '✨ I just got my FREE personalized Quantum Forecast!\n\nThis tool combines 8 mystical systems (Astrology, Tarot, Numerology, Chinese Zodiac, Gematria, Frequencies & more) for scary-accurate cosmic guidance.\n\nTry it yourself:';
            currentShareTitle = 'My Quantum Forecast';
            currentShareType = 'general';
            currentShareDetails = '';
            showShareModal();
        }
        
        function showShareModal() {
            const modal = document.getElementById('shareModal');
            const communitySection = document.getElementById('communityShareSection');
            
            // Show community section only for reality-code shares
            if (communitySection) {
                communitySection.style.display = currentShareType === 'reality-code' ? 'block' : 'none';
            }
            
            modal.style.display = 'block';
        }
        
        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'none';
        }
        
        // Direct share to community groups
        function shareToFacebookGroup() {
            window.open('https://facebook.com/groups/1950742399049451/', '_blank');
            showShareToast('Opening Facebook Group - paste your code there! 🔮');
            closeShareModal();
        }
        
        function shareToTelegramGroup() {
            window.open('https://t.me/+BIChXgOqFH9iMmU1', '_blank');
            showShareToast('Opening Telegram Group - share your code! ✨');
            closeShareModal();
        }
        
        // Share the community card invite
        function shareCommunityCard() {
            currentShareText = `🌟 QUANTUM REALITY CODES COMMUNITY 🌟

🔮 The Secret to Faster Manifestation:

When you support others' codes, you CLEAR YOUR OWN BLOCKAGES and activate quantum reciprocity. The universe MUST return your energy multiplied!

✨ Share your code
✨ Support others (this helps YOU manifest faster!)
✨ Watch blockages dissolve
✨ Receive multiplied energy back

The more you give, the faster YOUR code manifests. This is quantum law, not philosophy.

📘 Facebook: https://facebook.com/groups/1950742399049451/
🌐 Telegram: https://t.me/+BIChXgOqFH9iMmU1

#QuantumRealityCode #QuantumReciprocity #CollectiveManifestation`;
            currentShareTitle = 'Quantum Reality Codes Community';
            currentShareType = 'community';
            currentShareDetails = '';
            showShareModal();
        }
        
        // Generate visual share card
        async function generateShareCard() {
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 630; // Optimal for social media
            const ctx = canvas.getContext('2d');
            
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, 1200, 630);
            gradient.addColorStop(0, '#1a0033');
            gradient.addColorStop(0.5, '#0d001a');
            gradient.addColorStop(1, '#0a0a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 630);
            
            // Add subtle star pattern
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * 1200;
                const y = Math.random() * 630;
                const r = Math.random() * 2;
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Load appropriate image based on share type
            try {
                const cardImage = new Image();
                cardImage.crossOrigin = 'anonymous';
                
                // For tarot shares, try to load the actual card
                if (currentShareType === 'tarot' && currentShareDetails) {
                    const cardName = currentShareDetails.replace(/ /g, '_');
                    cardImage.src = `../assets/tarot/${cardName}.jpg`;
                } else {
                    cardImage.src = '../assets/tarot/QMTarot.png';
                }
                
                await new Promise((resolve, reject) => {
                    cardImage.onload = resolve;
                    cardImage.onerror = () => {
                        // Fallback to tarot back
                        cardImage.src = '../assets/tarot/QMTarot.png';
                        cardImage.onload = resolve;
                        cardImage.onerror = reject;
                    };
                });
                
                // Draw card with glow effect
                ctx.shadowColor = '#00f5ff';
                ctx.shadowBlur = 30;
                ctx.drawImage(cardImage, 820, 80, 320, 470);
                ctx.shadowBlur = 0;
            } catch (e) {
                console.log('Could not load card image');
            }
            
            // Branding - Top left
            ctx.fillStyle = 'rgba(255, 215, 0, 0.9)';
            ctx.font = 'bold 28px Orbitron, sans-serif';
            ctx.fillText('QUANTUM MERLIN', 60, 50);
            
            // Main Title
            ctx.fillStyle = '#00f5ff';
            ctx.font = 'bold 56px Orbitron, sans-serif';
            ctx.fillText(currentShareTitle, 60, 140);
            
            // Discovery/Details - with glow
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 10;
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 44px Rajdhani, sans-serif';
            const detailsText = currentShareDetails.length > 30 ? currentShareDetails.substring(0, 27) + '...' : currentShareDetails;
            ctx.fillText(detailsText, 60, 210);
            ctx.shadowBlur = 0;
            
            // Divider line
            ctx.strokeStyle = 'rgba(0, 245, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(60, 240);
            ctx.lineTo(700, 240);
            ctx.stroke();
            
            // Short teaser message (not full message)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = '28px Rajdhani, sans-serif';
            const teasers = {
                'tarot': 'Discover what the cards reveal about YOUR path...',
                'chinese': 'Uncover your Chinese Zodiac destiny...',
                'astrology': 'Your cosmic identity awaits...',
                'numerology': 'Decode the numbers guiding your life...',
                'reality-code': 'Manifest with quantum power...',
                'planetary': 'Align with cosmic timing...',
                'gematria': 'Decode the sacred numbers in your name...',
                'frequency': 'Tune into your healing vibration...',
                'general': 'Your personalized cosmic guidance awaits...'
            };
            ctx.fillText(teasers[currentShareType] || teasers['general'], 60, 300);
            
            // Features list
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '24px Rajdhani, sans-serif';
            ctx.fillText('✨ 8 Mystical Systems Combined', 60, 370);
            ctx.fillText('🃏 Tarot • ⭐ Astrology • 🔢 Numerology', 60, 405);
            ctx.fillText('🐉 Chinese Zodiac • 📜 Gematria • 🔊 Frequencies', 60, 440);
            
            // CTA Button
            ctx.fillStyle = '#9d00ff';
            ctx.beginPath();
            ctx.roundRect(60, 490, 350, 60, 30);
            ctx.fill();
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 28px Rajdhani, sans-serif';
            ctx.fillText('Get Your FREE Forecast →', 90, 530);
            
            // URL at bottom
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.font = '20px Rajdhani, sans-serif';
            ctx.fillText('quantummerlin.com/forecasts', 60, 600);
            
            return canvas.toDataURL('image/png');
        }
        
        async function downloadShareCard() {
            try {
                const dataUrl = await generateShareCard();
                const link = document.createElement('a');
                link.download = `quantum-${currentShareType}-${Date.now()}.png`;
                link.href = dataUrl;
                link.click();
                
                // Show success toast instead of alert
                showShareToast('🌟 Card downloaded! Share it on Instagram, Stories, or anywhere!');
                closeShareModal();
            } catch (e) {
                console.error('Error generating card:', e);
                showShareToast('⚠️ Could not generate card. Try another share option!');
            }
        }
        
        function showShareToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #9d00ff, #00f5ff);
                color: white;
                padding: 15px 30px;
                border-radius: 30px;
                font-family: 'Rajdhani', sans-serif;
                font-size: 1rem;
                z-index: 10001;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
                animation: slideUpToast 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function shareToX() {
            const url = encodeURIComponent(generateShareURL());
            const tweetText = encodeURIComponent(currentShareMessage);
            window.open(`https://twitter.com/intent/tweet?text=${tweetText}&url=${url}`, '_blank');
            closeShareModal();
        }
        
        function shareToFacebookModal() {
            const url = encodeURIComponent(generateShareURL());
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
            closeShareModal();
        }
        
        function shareToWhatsAppModal() {
            const url = generateShareURL();
            const message = encodeURIComponent(currentShareMessage + '\n\n' + url);
            window.open(`https://wa.me/?text=${message}`, '_blank');
            closeShareModal();
        }
        
        function shareToTelegram() {
            const url = encodeURIComponent(generateShareURL());
            const text = encodeURIComponent(currentShareMessage);
            window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
            closeShareModal();
        }
        
        function shareViaSMS() {
            const url = generateShareURL();
            const message = encodeURIComponent(currentShareMessage + '\n\n' + url);
            window.location.href = `sms:?&body=${message}`;
            closeShareModal();
        }
        
        function useNativeShare() {
            if (navigator.share) {
                navigator.share({
                    title: currentShareTitle,
                    text: currentShareMessage,
                    url: generateShareURL()
                }).then(() => {
                    closeShareModal();
                }).catch(console.log);
            } else {
                showShareToast('Native share not available on this device');
            }
        }
        
        function copyShareLink() {
            const fullMessage = currentShareMessage + '\n\n' + generateShareURL();
            navigator.clipboard.writeText(fullMessage).then(() => {
                showShareToast('✅ Copied! Paste anywhere to share.');
                closeShareModal();
            });
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('shareModal');
            if (event.target == modal) {
                closeShareModal();
            }
        }

        function shareToFacebook() {
            const url = encodeURIComponent(generateShareURL());
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }

        function shareToWhatsApp(text) {
            const url = generateShareURL();
            const message = encodeURIComponent((text || "Check out my Quantum Forecast! 🌌✨") + "\n\n" + url);
            window.open(`https://wa.me/?text=${message}`, '_blank');
        }

        function shareToLinkedIn() {
            const url = encodeURIComponent(generateShareURL());
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
        }

        function shareViaEmail(subject, body) {
            const url = generateShareURL();
            const emailSubject = encodeURIComponent(subject || "My Quantum Cosmic Forecast 🌌");
            const emailBody = encodeURIComponent((body || "I just got my personalized cosmic guidance! Check it out:") + "\n\n" + url);
            window.location.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;
        }

        function copyForecastLink() {
            navigator.clipboard.writeText(generateShareURL()).then(() => {
                alert('✅ Link copied to clipboard!');
            });
        }

        // Show Ad Container Mid when forecast is generated
        function showMidAd() {
            document.getElementById('adMid').style.display = 'flex';
        }

        // Expandable sections - using global functions for better mobile compatibility
        function toggleEnhanced() {
            const btn = document.getElementById('expandEnhanced');
            const content = document.getElementById('enhancedContent');
            content.classList.toggle('show');
            btn.textContent = content.classList.contains('show') 
                ? '▲ Hide Enhanced Options' 
                : '▼ Add Birth Time & Location for More Accuracy';
            
            if (content.classList.contains('show')) {
                document.getElementById('expandAdvanced').style.display = 'block';
            }
        }

        function toggleAdvanced() {
            const btn = document.getElementById('expandAdvanced');
            const content = document.getElementById('advancedContent');
            content.classList.toggle('show');
            btn.textContent = content.classList.contains('show') 
                ? '▲ Hide Advanced Options' 
                : '▼ Add Name for Deep Personalization';
        }

        // Add touchstart listeners for mobile (more reliable than click on some devices)
        document.addEventListener('DOMContentLoaded', function() {
            const enhancedBtn = document.getElementById('expandEnhanced');
            const advancedBtn = document.getElementById('expandAdvanced');
            
            if (enhancedBtn) {
                enhancedBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleEnhanced();
                }, { passive: false });
            }
            
            if (advancedBtn) {
                advancedBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleAdvanced();
                }, { passive: false });
            }
        });

        // Update accuracy indicator
        function updateAccuracy() {
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            const birthLocation = document.getElementById('birthLocation').value;
            const firstName = document.getElementById('firstName').value;
            
            let accuracy = 0;
            const breakdown = [];
            
            if (birthDate) {
                accuracy += 25;
                breakdown.push({ item: 'Birth Date', status: 'provided', value: 25 });
            } else {
                breakdown.push({ item: 'Birth Date', status: 'missing', value: 25 });
            }
            
            if (birthTime) {
                accuracy += 25;
                breakdown.push({ item: 'Birth Time', status: 'provided', value: 25 });
            } else {
                breakdown.push({ item: 'Birth Time', status: 'missing', value: 25 });
            }
            
            if (birthLocation) {
                accuracy += 25;
                breakdown.push({ item: 'Birth Location', status: 'provided', value: 25 });
            } else {
                breakdown.push({ item: 'Birth Location', status: 'missing', value: 25 });
            }
            
            if (firstName) {
                accuracy += 25;
                breakdown.push({ item: 'Full Name', status: 'provided', value: 25 });
            } else {
                breakdown.push({ item: 'Full Name', status: 'missing', value: 25 });
            }
            
            // Update progress bar with color based on accuracy
            const fill = document.getElementById('accuracyFill');
            fill.style.width = accuracy + '%';
            fill.textContent = accuracy + '%';
            
            if (accuracy >= 75) {
                fill.style.background = 'linear-gradient(90deg, #00f5ff, #9d00ff)';
            } else if (accuracy >= 50) {
                fill.style.background = 'linear-gradient(90deg, #ffd700, #00f5ff)';
            } else {
                fill.style.background = 'linear-gradient(90deg, #ff0066, #ffd700)';
            }
            
            // Enhanced breakdown display
            const checklistHTML = breakdown.map(item => `
                <div class="confidence-item ${item.status}">
                    <span class="conf-icon">${item.status === 'provided' ? '✅' : '⚠️'}</span>
                    <span class="conf-label">${item.item}</span>
                    <span class="conf-value">+${item.value}%</span>
                </div>
            `).join('');
            
            const noteHTML = accuracy < 100 
                ? '<p class="confidence-note">💡 Add missing data to increase forecast accuracy</p>'
                : '<p class="confidence-note">✨ Maximum accuracy achieved!</p>';
            
            document.getElementById('dataChecklist').innerHTML = checklistHTML + noteHTML;
        }

        // Listen for input changes
        ['birthDate', 'birthTime', 'birthLocation', 'firstName'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateAccuracy);
        });

        // ========================================
        // TAROT CARD SYSTEM - Full 78 Card Deck
        // ========================================
        
        function getTarotDeck() {
            return [
                // MAJOR ARCANA (22 cards)
                { id: '00-fool', suit: 'major', number: 0, name: 'The Fool', meaning: 'New beginnings, innocence, spontaneity, free spirit', guidance: 'Embrace the unknown. Take a leap of faith.', symbol: '🃏', image: '../assets/tarot/The_Fool.jpg' },
                { id: '01-magician', suit: 'major', number: 1, name: 'The Magician', meaning: 'Manifestation, resourcefulness, power, inspired action', guidance: 'You have all the tools you need. Act with intention.', symbol: '🎩', image: '../assets/tarot/The_Magician.jpg' },
                { id: '02-high-priestess', suit: 'major', number: 2, name: 'The High Priestess', meaning: 'Intuition, sacred knowledge, divine feminine, subconscious', guidance: 'Trust your inner voice. Look beyond the surface.', symbol: '🔮', image: '../assets/tarot/The_High_Priestess.jpg' },
                { id: '03-empress', suit: 'major', number: 3, name: 'The Empress', meaning: 'Femininity, beauty, nature, nurturing, abundance', guidance: 'Create and nurture. Beauty surrounds you.', symbol: '👑', image: '../assets/tarot/The_Empress.jpg' },
                { id: '04-emperor', suit: 'major', number: 4, name: 'The Emperor', meaning: 'Authority, establishment, structure, father figure', guidance: 'Take control. Build solid foundations.', symbol: '⚔️', image: '../assets/tarot/The_Emperor.jpg' },
                { id: '05-hierophant', suit: 'major', number: 5, name: 'The Hierophant', meaning: 'Spiritual wisdom, tradition, conformity, institutions', guidance: 'Seek wisdom from tradition. Honor what works.', symbol: '🏛️', image: '../assets/tarot/The_Hierophant.jpg' },
                { id: '06-lovers', suit: 'major', number: 6, name: 'The Lovers', meaning: 'Love, harmony, relationships, values alignment', guidance: 'Choose with your heart. Align your values.', symbol: '💕', image: '../assets/tarot/The_Lovers.jpg' },
                { id: '07-chariot', suit: 'major', number: 7, name: 'The Chariot', meaning: 'Control, willpower, success, determination', guidance: 'Move forward with confidence. Victory is yours.', symbol: '🏇', image: '../assets/tarot/The_Chariot.jpg' },
                { id: '08-strength', suit: 'major', number: 8, name: 'Strength', meaning: 'Strength, courage, patience, compassion', guidance: 'Inner strength conquers all. Be gentle yet firm.', symbol: '🦁', image: '../assets/tarot/Strength.jpg' },
                { id: '09-hermit', suit: 'major', number: 9, name: 'The Hermit', meaning: 'Soul searching, introspection, inner guidance', guidance: 'Go within. Your answers are there.', symbol: '🕯️', image: '../assets/tarot/The_Hermit.jpg' },
                { id: '10-wheel-of-fortune', suit: 'major', number: 10, name: 'Wheel of Fortune', meaning: 'Good luck, karma, life cycles, destiny', guidance: 'Fate is turning. Embrace the change.', symbol: '☸️', image: '../assets/tarot/Wheel_of_Fortune.jpg' },
                { id: '11-justice', suit: 'major', number: 11, name: 'Justice', meaning: 'Justice, fairness, truth, cause and effect', guidance: 'Seek truth and balance. Karma is active.', symbol: '⚖️', image: '../assets/tarot/Justice.jpg' },
                { id: '12-hanged-man', suit: 'major', number: 12, name: 'The Hanged Man', meaning: 'Pause, surrender, letting go, new perspective', guidance: 'Release control. See from a new angle.', symbol: '🙃', image: '../assets/tarot/The_Hanged_Man.jpg' },
                { id: '13-death', suit: 'major', number: 13, name: 'Death', meaning: 'Endings, transformation, transition, rebirth', guidance: 'Let go of the old. Transformation awaits.', symbol: '🦋', image: '../assets/tarot/Death.jpg' },
                { id: '14-temperance', suit: 'major', number: 14, name: 'Temperance', meaning: 'Balance, moderation, patience, purpose', guidance: 'Find the middle way. Blend opposing forces.', symbol: '🌊', image: '../assets/tarot/Temperance.jpg' },
                { id: '15-devil', suit: 'major', number: 15, name: 'The Devil', meaning: 'Shadow self, attachment, addiction, materialism', guidance: 'Break free from chains. Face your shadows.', symbol: '😈', image: '../assets/tarot/The_Devil.jpg' },
                { id: '16-tower', suit: 'major', number: 16, name: 'The Tower', meaning: 'Sudden change, upheaval, chaos, revelation', guidance: 'Breakdown leads to breakthrough. Trust the process.', symbol: '⚡', image: '../assets/tarot/The_Tower.jpg' },
                { id: '17-star', suit: 'major', number: 17, name: 'The Star', meaning: 'Hope, faith, purpose, renewal, spirituality', guidance: 'Hope shines bright. Your wishes are heard.', symbol: '⭐', image: '../assets/tarot/The_Star.jpg' },
                { id: '18-moon', suit: 'major', number: 18, name: 'The Moon', meaning: 'Illusion, fear, anxiety, subconscious, intuition', guidance: 'Not all is as it seems. Trust your intuition.', symbol: '🌙', image: '../assets/tarot/The_Moon.jpg' },
                { id: '19-sun', suit: 'major', number: 19, name: 'The Sun', meaning: 'Positivity, fun, warmth, success, vitality', guidance: 'Success and joy are yours. Shine brightly.', symbol: '☀️', image: '../assets/tarot/The_Sun.jpg' },
                { id: '20-judgment', suit: 'major', number: 20, name: 'Judgment', meaning: 'Judgment, rebirth, inner calling, absolution', guidance: 'Answer your calling. Forgive and be reborn.', symbol: '📯', image: '../assets/tarot/Judgement.jpg' },
                { id: '21-world', suit: 'major', number: 21, name: 'The World', meaning: 'Completion, integration, accomplishment, travel', guidance: 'You\'ve come full circle. Celebrate completion.', symbol: '🌍', image: '../assets/tarot/The_World.jpg' },

                // WANDS - Fire element, passion, creativity, action
                { id: 'wands-ace', suit: 'wands', number: 1, name: 'Ace of Wands', meaning: 'Inspiration, new opportunities, creative spark', guidance: 'Seize the moment. New creative ventures await.', symbol: '🔥', image: '../assets/tarot/Ace_of_Wands.jpg' },
                { id: 'wands-2', suit: 'wands', number: 2, name: 'Two of Wands', meaning: 'Planning, making decisions, leaving comfort', guidance: 'The world is yours. Make your choice.', symbol: '🗺️', image: '../assets/tarot/Two_of_Wands.jpg' },
                { id: 'wands-3', suit: 'wands', number: 3, name: 'Three of Wands', meaning: 'Expansion, foresight, leadership', guidance: 'Your plans are manifesting. Look ahead.', symbol: '🚢', image: '../assets/tarot/Three_of_Wands.jpg' },
                { id: 'wands-4', suit: 'wands', number: 4, name: 'Four of Wands', meaning: 'Celebration, harmony, home, community', guidance: 'Celebrate your achievements. You deserve it.', symbol: '🎉', image: '../assets/tarot/Four_of_Wands.jpg' },
                { id: 'wands-5', suit: 'wands', number: 5, name: 'Five of Wands', meaning: 'Competition, conflict, disagreements', guidance: 'Channel competitive energy productively.', symbol: '⚔️', image: '../assets/tarot/Five_of_Wands.jpg' },
                { id: 'wands-6', suit: 'wands', number: 6, name: 'Six of Wands', meaning: 'Victory, success, public recognition', guidance: 'You are winning. Accept the accolades.', symbol: '🏆', image: '../assets/tarot/Six_of_Wands.jpg' },
                { id: 'wands-7', suit: 'wands', number: 7, name: 'Seven of Wands', meaning: 'Perseverance, defensive, maintaining control', guidance: 'Stand your ground. You have the advantage.', symbol: '🛡️', image: '../assets/tarot/Seven_of_Wands.jpg' },
                { id: 'wands-8', suit: 'wands', number: 8, name: 'Eight of Wands', meaning: 'Speed, action, air travel, movement', guidance: 'Things are moving fast. Go with the flow.', symbol: '✈️', image: '../assets/tarot/Eight_of_Wands.jpg' },
                { id: 'wands-9', suit: 'wands', number: 9, name: 'Nine of Wands', meaning: 'Resilience, courage, persistence', guidance: 'Almost there. One more push to victory.', symbol: '💪', image: '../assets/tarot/Nine_of_Wands.jpg' },
                { id: 'wands-10', suit: 'wands', number: 10, name: 'Ten of Wands', meaning: 'Burden, responsibility, hard work', guidance: 'Delegate or release. Don\'t carry it all alone.', symbol: '🎒', image: '../assets/tarot/Ten_of_Wands.jpg' },
                { id: 'wands-page', suit: 'wands', number: 11, name: 'Page of Wands', meaning: 'Enthusiasm, exploration, discovery', guidance: 'Be curious. Adventure calls.', symbol: '🧭', image: '../assets/tarot/Page_of_Wands.jpg' },
                { id: 'wands-knight', suit: 'wands', number: 12, name: 'Knight of Wands', meaning: 'Energy, passion, adventure, impulsiveness', guidance: 'Take bold action. Move with confidence.', symbol: '🏇', image: '../assets/tarot/Knight_of_Wands.jpg' },
                { id: 'wands-queen', suit: 'wands', number: 13, name: 'Queen of Wands', meaning: 'Confidence, independence, determination', guidance: 'Own your power. Lead with charisma.', symbol: '👑', image: '../assets/tarot/Queen_of_Wands.jpg' },
                { id: 'wands-king', suit: 'wands', number: 14, name: 'King of Wands', meaning: 'Leadership, vision, entrepreneurial', guidance: 'Lead with vision. Inspire others.', symbol: '🦁', image: '../assets/tarot/King_of_Wands.jpg' },

                // CUPS - Water element, emotions, relationships, intuition
                { id: 'cups-ace', suit: 'cups', number: 1, name: 'Ace of Cups', meaning: 'Love, new relationships, emotional awakening', guidance: 'Open your heart. Love flows in.', symbol: '💖', image: '../assets/tarot/Ace_of_Cups.jpg' },
                { id: 'cups-2', suit: 'cups', number: 2, name: 'Two of Cups', meaning: 'Partnership, unity, attraction', guidance: 'Connection deepens. Unity forms.', symbol: '💑', image: '../assets/tarot/Two_of_Cups.jpg' },
                { id: 'cups-3', suit: 'cups', number: 3, name: 'Three of Cups', meaning: 'Celebration, friendship, community', guidance: 'Celebrate with loved ones. Joy multiplies.', symbol: '🥂', image: '../assets/tarot/Three_of_Cups.jpg' },
                { id: 'cups-4', suit: 'cups', number: 4, name: 'Four of Cups', meaning: 'Apathy, contemplation, reevaluation', guidance: 'Look beyond disappointment. New gifts await.', symbol: '🤔', image: '../assets/tarot/Four_of_Cups.jpg' },
                { id: 'cups-5', suit: 'cups', number: 5, name: 'Five of Cups', meaning: 'Loss, grief, disappointment', guidance: 'Acknowledge loss, but see what remains.', symbol: '😢', image: '../assets/tarot/Five_of_Cups.jpg' },
                { id: 'cups-6', suit: 'cups', number: 6, name: 'Six of Cups', meaning: 'Nostalgia, childhood memories, innocence', guidance: 'Reconnect with your inner child. Simple joys.', symbol: '🌈', image: '../assets/tarot/Six_of_Cups.jpg' },
                { id: 'cups-7', suit: 'cups', number: 7, name: 'Seven of Cups', meaning: 'Choices, illusion, fantasy, wishful thinking', guidance: 'Choose wisely. Not all that glitters is gold.', symbol: '✨', image: '../assets/tarot/Seven_of_Cups.jpg' },
                { id: 'cups-8', suit: 'cups', number: 8, name: 'Eight of Cups', meaning: 'Walking away, seeking deeper meaning', guidance: 'Leave behind what no longer serves you.', symbol: '🚶', image: '../assets/tarot/Eight_of_Cups.jpg' },
                { id: 'cups-9', suit: 'cups', number: 9, name: 'Nine of Cups', meaning: 'Satisfaction, contentment, wishes fulfilled', guidance: 'Your wish is granted. Savor the moment.', symbol: '🌟', image: '../assets/tarot/Nine_of_Cups.jpg' },
                { id: 'cups-10', suit: 'cups', number: 10, name: 'Ten of Cups', meaning: 'Harmony, family, emotional fulfillment', guidance: 'Domestic bliss. Happiness at home.', symbol: '🏡', image: '../assets/tarot/Ten_of_Cups.jpg' },
                { id: 'cups-page', suit: 'cups', number: 11, name: 'Page of Cups', meaning: 'Creative opportunities, intuitive messages', guidance: 'Follow your heart. Creative inspiration flows.', symbol: '🎨', image: '../assets/tarot/Page_of_Cups.jpg' },
                { id: 'cups-knight', suit: 'cups', number: 12, name: 'Knight of Cups', meaning: 'Romance, charm, imagination', guidance: 'Follow your dreams. Romance beckons.', symbol: '💐', image: '../assets/tarot/Knight_of_Cups.jpg' },
                { id: 'cups-queen', suit: 'cups', number: 13, name: 'Queen of Cups', meaning: 'Compassion, intuition, emotional security', guidance: 'Trust your intuition. Nurture with love.', symbol: '🧜‍♀️', image: '../assets/tarot/Queen_of_Cups.jpg' },
                { id: 'cups-king', suit: 'cups', number: 14, name: 'King of Cups', meaning: 'Emotional balance, diplomacy, compassion', guidance: 'Lead with empathy. Balance head and heart.', symbol: '🌊', image: '../assets/tarot/King_of_Cups.jpg' },

                // SWORDS - Air element, intellect, communication, conflict
                { id: 'swords-ace', suit: 'swords', number: 1, name: 'Ace of Swords', meaning: 'Breakthrough, clarity, new ideas', guidance: 'Truth cuts through. Clarity emerges.', symbol: '⚡', image: '../assets/tarot/Aces_of_Swords.jpg' },
                { id: 'swords-2', suit: 'swords', number: 2, name: 'Two of Swords', meaning: 'Difficult decisions, stalemate, avoidance', guidance: 'Remove the blindfold. Make a choice.', symbol: '⚖️', image: '../assets/tarot/Two_of_Swords.jpg' },
                { id: 'swords-3', suit: 'swords', number: 3, name: 'Three of Swords', meaning: 'Heartbreak, emotional pain, sorrow', guidance: 'Feel the pain. Healing follows.', symbol: '💔', image: '../assets/tarot/Three_of_Swords.jpg' },
                { id: 'swords-4', suit: 'swords', number: 4, name: 'Four of Swords', meaning: 'Rest, recovery, contemplation', guidance: 'Rest now. Recharge your batteries.', symbol: '🧘', image: '../assets/tarot/Four_of_Swords.jpg' },
                { id: 'swords-5', suit: 'swords', number: 5, name: 'Five of Swords', meaning: 'Conflict, tension, loss', guidance: 'Choose your battles. Some wins aren\'t worth it.', symbol: '⚔️', image: '../assets/tarot/Five_of_Swords.jpg' },
                { id: 'swords-6', suit: 'swords', number: 6, name: 'Six of Swords', meaning: 'Transition, change, moving on', guidance: 'Rough waters behind you. Calmer ahead.', symbol: '⛵', image: '../assets/tarot/Six_of_Swords.jpg' },
                { id: 'swords-7', suit: 'swords', number: 7, name: 'Seven of Swords', meaning: 'Deception, trickery, strategy', guidance: 'Be strategic. Watch for hidden agendas.', symbol: '🎭', image: '../assets/tarot/Seven_of_Swords.jpg' },
                { id: 'swords-8', suit: 'swords', number: 8, name: 'Eight of Swords', meaning: 'Restriction, imprisonment, self-imposed limits', guidance: 'You\'re freer than you think. Remove the blindfold.', symbol: '🔒', image: '../assets/tarot/Eight_of_Swords.jpg' },
                { id: 'swords-9', suit: 'swords', number: 9, name: 'Nine of Swords', meaning: 'Anxiety, worry, nightmares', guidance: 'Your fears are exaggerated. Dawn comes.', symbol: '😰', image: '../assets/tarot/Nine_of_Swords.jpg' },
                { id: 'swords-10', suit: 'swords', number: 10, name: 'Ten of Swords', meaning: 'Painful endings, rock bottom, betrayal', guidance: 'It\'s over. Only up from here.', symbol: '🗡️', image: '../assets/tarot/Ten_of_Swords.jpg' },
                { id: 'swords-page', suit: 'swords', number: 11, name: 'Page of Swords', meaning: 'Curiosity, mental energy, new ideas', guidance: 'Ask questions. Investigate thoroughly.', symbol: '🔍', image: '../assets/tarot/Page_of_Swords.jpg' },
                { id: 'swords-knight', suit: 'swords', number: 12, name: 'Knight of Swords', meaning: 'Ambition, action, driven to succeed', guidance: 'Act decisively. Cut through obstacles.', symbol: '🏃', image: '../assets/tarot/Knight_of_Swords.jpg' },
                { id: 'swords-queen', suit: 'swords', number: 13, name: 'Queen of Swords', meaning: 'Independent, clear thinking, direct', guidance: 'Speak truth. Think clearly. Decide wisely.', symbol: '🦅', image: '../assets/tarot/Queen_of_Swords.jpg' },
                { id: 'swords-king', suit: 'swords', number: 14, name: 'King of Swords', meaning: 'Authority, truth, intellectual power', guidance: 'Use intellect and ethics. Judge fairly.', symbol: '⚖️', image: '../assets/tarot/King_of_Swords.jpg' },

                // PENTACLES - Earth element, material world, finances, career
                { id: 'pentacles-ace', suit: 'pentacles', number: 1, name: 'Ace of Pentacles', meaning: 'New financial opportunity, prosperity, manifestation', guidance: 'Plant seeds now. Abundance grows.', symbol: '💰', image: '../assets/tarot/Ace_of_Pentacles.jpg' },
                { id: 'pentacles-2', suit: 'pentacles', number: 2, name: 'Two of Pentacles', meaning: 'Balance, adaptability, time management', guidance: 'Juggle with grace. Stay flexible.', symbol: '🤹', image: '../assets/tarot/Two_of_Pentacles.jpg' },
                { id: 'pentacles-3', suit: 'pentacles', number: 3, name: 'Three of Pentacles', meaning: 'Teamwork, collaboration, learning', guidance: 'Work together. Master your craft.', symbol: '🔨', image: '../assets/tarot/Three_of_Pentacles.jpg' },
                { id: 'pentacles-4', suit: 'pentacles', number: 4, name: 'Four of Pentacles', meaning: 'Security, control, conservation', guidance: 'Hold on, but not too tight. Balance security and flow.', symbol: '🏦', image: '../assets/tarot/Four_of_Pentacles.jpg' },
                { id: 'pentacles-5', suit: 'pentacles', number: 5, name: 'Five of Pentacles', meaning: 'Financial loss, poverty, isolation', guidance: 'Help is available. Look for the light.', symbol: '🌨️', image: '../assets/tarot/Five_of_Pentacles.jpg' },
                { id: 'pentacles-6', suit: 'pentacles', number: 6, name: 'Six of Pentacles', meaning: 'Generosity, charity, sharing wealth', guidance: 'Give and receive. Balance the flow.', symbol: '🎁', image: '../assets/tarot/Six_of_Pentacles.jpg' },
                { id: 'pentacles-7', suit: 'pentacles', number: 7, name: 'Seven of Pentacles', meaning: 'Patience, long-term view, perseverance', guidance: 'Assess progress. Harvest is coming.', symbol: '🌱', image: '../assets/tarot/Seven_of_Pentacles.jpg' },
                { id: 'pentacles-8', suit: 'pentacles', number: 8, name: 'Eight of Pentacles', meaning: 'Skill development, craftsmanship, diligence', guidance: 'Master your craft. Practice makes perfect.', symbol: '🔧', image: '../assets/tarot/Eight_of_Pentacles.jpg' },
                { id: 'pentacles-9', suit: 'pentacles', number: 9, name: 'Nine of Pentacles', meaning: 'Abundance, luxury, self-sufficiency', guidance: 'Enjoy your success. You\'ve earned it.', symbol: '🦚', image: '../assets/tarot/Nine_of_Pentacles.jpg' },
                { id: 'pentacles-10', suit: 'pentacles', number: 10, name: 'Ten of Pentacles', meaning: 'Wealth, legacy, family, long-term success', guidance: 'Build lasting wealth. Create a legacy.', symbol: '🏰', image: '../assets/tarot/Ten_of_Pentacles.jpg' },
                { id: 'pentacles-page', suit: 'pentacles', number: 11, name: 'Page of Pentacles', meaning: 'Ambition, desire to learn, new venture', guidance: 'Study and prepare. Opportunity knocks.', symbol: '📚', image: '../assets/tarot/Page_of_Pentacles.jpg' },
                { id: 'pentacles-knight', suit: 'pentacles', number: 12, name: 'Knight of Pentacles', meaning: 'Efficiency, routine, hard work', guidance: 'Stay the course. Consistent effort pays.', symbol: '🐂', image: '../assets/tarot/Knight_of_Pentacles.jpg' },
                { id: 'pentacles-queen', suit: 'pentacles', number: 13, name: 'Queen of Pentacles', meaning: 'Practical, nurturing, providing financially', guidance: 'Nurture abundance. Create comfort and security.', symbol: '🌿', image: '../assets/tarot/Queen_of_Pentacles.jpg' },
                { id: 'pentacles-king', suit: 'pentacles', number: 14, name: 'King of Pentacles', meaning: 'Wealth, business success, leadership', guidance: 'Build your empire. Lead with wisdom.', symbol: '👑', image: '../assets/tarot/King_of_Pentacles.jpg' }
            ];
        }

        function getTarotCard(birthDate, timeframe = 'daily') {
            const deck = getTarotDeck();
            
            // Determine how many cards based on timeframe
            let numCards = 1;
            if (timeframe === 'weekly') numCards = 3; // Past, Present, Future
            else if (timeframe === 'monthly') numCards = 4; // Week 1-4
            else if (timeframe === 'yearly') numCards = 12; // Month 1-12
            
            const cards = [];
            const usedIndices = new Set();
            
            for (let i = 0; i < numCards; i++) {
                // Truly random selection
                let index;
                let attempts = 0;
                do {
                    index = Math.floor(Math.random() * deck.length);
                    attempts++;
                } while (usedIndices.has(index) && attempts < deck.length * 2);
                
                usedIndices.add(index);
                const card = { ...deck[index] };
                
                // Add position-specific meaning for multi-card spreads
                if (timeframe === 'weekly') {
                    card.position = ['Past Week', 'This Week', 'Week Ahead'][i];
                } else if (timeframe === 'monthly') {
                    card.position = `Week ${i + 1}`;
                } else if (timeframe === 'yearly') {
                    const today = new Date();
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const monthIndex = (today.getMonth() + i) % 12;
                    card.position = monthNames[monthIndex];
                }
                
                cards.push(card);
            }
            
            return timeframe === 'daily' ? cards[0] : cards;
        }

        // ========================================
        // PLANETARY ASPECTS (Simplified)
        // ========================================
        
        function getPlanetaryAspects(birthDate) {
            const birth = new Date(birthDate);
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            
            // Simplified aspect calculation based on day of year
            const aspects = [];
            
            // Sun aspects (changes daily)
            if (dayOfYear % 30 < 10) {
                aspects.push({ 
                    type: 'Conjunction', 
                    planets: 'Sun ☉ conjunct Mercury ☿', 
                    meaning: 'Clear communication, mental clarity, important messages',
                    symbol: '☌'
                });
            } else if (dayOfYear % 30 < 20) {
                aspects.push({ 
                    type: 'Trine', 
                    planets: 'Sun ☉ trine Jupiter ♃', 
                    meaning: 'Opportunity, expansion, good fortune, optimism',
                    symbol: '△'
                });
            } else {
                aspects.push({ 
                    type: 'Square', 
                    planets: 'Sun ☉ square Saturn ♄', 
                    meaning: 'Challenges requiring discipline, patience, and hard work',
                    symbol: '□'
                });
            }
            
            // Venus aspects (changes every 3 days)
            if (Math.floor(dayOfYear / 3) % 2 === 0) {
                aspects.push({ 
                    type: 'Sextile', 
                    planets: 'Venus ♀ sextile Mars ♂', 
                    meaning: 'Attraction, passion, creative energy, social connections',
                    symbol: '⚹'
                });
            }
            
            return aspects;
        }

        // ========================================
        // BEST DAY CALCULATOR
        // ========================================
        
        function getBestDayOfWeek(zodiac, chinese, lifePath) {
            const today = new Date();
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayEmojis = ['☀️', '🌙', '♂️', '☿', '♃', '♀', '♄'];
            
            // Calculate based on life path
            const bestDayIndex = (lifePath + today.getDate()) % 7;
            const bestDay = daysOfWeek[bestDayIndex];
            const emoji = dayEmojis[bestDayIndex];
            
            const energies = {
                0: 'Spiritual connection and rest',
                1: 'Intuition and emotions',
                2: 'Action and courage',
                3: 'Communication and learning',
                4: 'Growth and abundance',
                5: 'Love and harmony',
                6: 'Structure and discipline'
            };
            
            return {
                day: bestDay,
                emoji: emoji,
                energy: energies[bestDayIndex],
                action: `Schedule important activities on ${bestDay} this week for best results.`
            };
        }

        // ========================================
        // PLANETARY HOUSES - Where Planets Reside
        // ========================================
        
        async function getPlanetaryHouses(birthDate, birthTime, birthLocation) {
            // If no location, return simplified house placements
            if (!birthLocation) {
                return getSimplifiedHouses();
            }
            
            const coords = await getCoordinates(birthLocation.toLowerCase().trim());
            if (!coords) {
                return getSimplifiedHouses();
            }
            
            // Use Swiss Ephemeris if available
            if (typeof swisseph !== 'undefined') {
                try {
                    const birth = new Date(birthDate + (birthTime ? 'T' + birthTime : 'T12:00:00'));
                    const year = birth.getFullYear();
                    const month = birth.getMonth() + 1;
                    const day = birth.getDate();
                    const hour = birth.getHours() + (birth.getMinutes() / 60);
                    
                    const jd = swisseph.swe_julday(year, month, day, hour, swisseph.SE_GREG_CAL);
                    const houses = swisseph.swe_houses(jd, coords.lat, coords.lon, 'P');
                    
                    // Calculate planet positions
                    const planets = [
                        { name: 'Sun', symbol: '☉', id: swisseph.SE_SUN },
                        { name: 'Moon', symbol: '☽', id: swisseph.SE_MOON },
                        { name: 'Mercury', symbol: '☿', id: swisseph.SE_MERCURY },
                        { name: 'Venus', symbol: '♀', id: swisseph.SE_VENUS },
                        { name: 'Mars', symbol: '♂', id: swisseph.SE_MARS },
                        { name: 'Jupiter', symbol: '♃', id: swisseph.SE_JUPITER },
                        { name: 'Saturn', symbol: '♄', id: swisseph.SE_SATURN }
                    ];
                    
                    const placements = planets.map(planet => {
                        const pos = swisseph.swe_calc_ut(jd, planet.id, swisseph.SEFLG_SWIEPH);
                        const longitude = pos.longitude;
                        
                        // Determine which house (1-12) the planet is in
                        let houseNum = 1;
                        for (let i = 0; i < 12; i++) {
                            const currentCusp = houses.cusps[i];
                            const nextCusp = houses.cusps[(i + 1) % 12];
                            
                            if (nextCusp > currentCusp) {
                                if (longitude >= currentCusp && longitude < nextCusp) {
                                    houseNum = i + 1;
                                    break;
                                }
                            } else {
                                if (longitude >= currentCusp || longitude < nextCusp) {
                                    houseNum = i + 1;
                                    break;
                                }
                            }
                        }
                        
                        return {
                            planet: planet.name,
                            symbol: planet.symbol,
                            house: houseNum,
                            meaning: getHouseMeaning(planet.name, houseNum)
                        };
                    });
                    
                    return placements;
                } catch (e) {
                    console.error('Swiss Ephemeris calculation error:', e);
                    return getSimplifiedHouses();
                }
            }
            
            return getSimplifiedHouses();
        }

        function getSimplifiedHouses() {
            // Simplified house placements based on current date
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            
            return [
                { planet: 'Sun', symbol: '☉', house: ((dayOfYear % 12) + 1), meaning: getHouseMeaning('Sun', ((dayOfYear % 12) + 1)) },
                { planet: 'Moon', symbol: '☽', house: (((dayOfYear * 2) % 12) + 1), meaning: getHouseMeaning('Moon', (((dayOfYear * 2) % 12) + 1)) },
                { planet: 'Mercury', symbol: '☿', house: (((dayOfYear + 1) % 12) + 1), meaning: getHouseMeaning('Mercury', (((dayOfYear + 1) % 12) + 1)) },
                { planet: 'Venus', symbol: '♀', house: (((dayOfYear + 3) % 12) + 1), meaning: getHouseMeaning('Venus', (((dayOfYear + 3) % 12) + 1)) },
                { planet: 'Mars', symbol: '♂', house: (((dayOfYear + 5) % 12) + 1), meaning: getHouseMeaning('Mars', (((dayOfYear + 5) % 12) + 1)) }
            ];
        }

        function getHouseMeaning(planet, house) {
            const houseMeanings = {
                1: 'Self, identity, appearance, first impressions',
                2: 'Money, possessions, values, self-worth',
                3: 'Communication, siblings, short trips, learning',
                4: 'Home, family, roots, emotional foundation',
                5: 'Creativity, romance, children, pleasure',
                6: 'Health, work, daily routines, service',
                7: 'Partnerships, marriage, relationships, contracts',
                8: 'Transformation, shared resources, intimacy',
                9: 'Higher learning, travel, philosophy, expansion',
                10: 'Career, public image, ambition, achievements',
                11: 'Friendship, groups, hopes, social causes',
                12: 'Spirituality, subconscious, hidden matters, solitude'
            };
            
            const planetInterpretations = {
                'Sun': {
                    1: 'Strong sense of self. Natural leadership.',
                    2: 'Focus on building wealth and values.',
                    3: 'Communication is key. Share your ideas.',
                    4: 'Family and home are central to identity.',
                    5: 'Creative self-expression shines.',
                    6: 'Health and service bring fulfillment.',
                    7: 'Partnerships define you. Collaborate.',
                    8: 'Transformative power. Deep changes.',
                    9: 'Seek wisdom and adventure.',
                    10: 'Career success and public recognition.',
                    11: 'Community involvement. Group leadership.',
                    12: 'Inner work and spiritual growth.'
                },
                'Moon': {
                    1: 'Emotions show outwardly. Sensitive.',
                    2: 'Emotional security through resources.',
                    3: 'Need to communicate feelings.',
                    4: 'Strong attachment to home and family.',
                    5: 'Emotional through creativity and romance.',
                    6: 'Nurture through service and routine.',
                    7: 'Emotional fulfillment through partnership.',
                    8: 'Deep emotional transformations.',
                    9: 'Emotional expansion through learning.',
                    10: 'Public image affects emotions.',
                    11: 'Find emotional support in groups.',
                    12: 'Private emotional world. Intuitive.'
                },
                'Mercury': {
                    1: 'Quick thinker. Communicative persona.',
                    2: 'Practical thinking about money.',
                    3: 'Natural communicator and learner.',
                    4: 'Think about family and home matters.',
                    5: 'Creative and playful communication.',
                    6: 'Analytical about health and work.',
                    7: 'Partnership communication is key.',
                    8: 'Deep research and investigation.',
                    9: 'Philosophical mind. Love learning.',
                    10: 'Career involves communication.',
                    11: 'Network and exchange ideas.',
                    12: 'Intuitive thinking. Private thoughts.'
                },
                'Venus': {
                    1: 'Charming and attractive.',
                    2: 'Values beauty and comfort.',
                    3: 'Social and friendly locally.',
                    4: 'Beautiful home. Family harmony.',
                    5: 'Romance and creative pleasures.',
                    6: 'Beauty in daily work.',
                    7: 'Harmonious partnerships.',
                    8: 'Deep intimate connections.',
                    9: 'Love of travel and culture.',
                    10: 'Career in beauty or arts.',
                    11: 'Friendship and social causes.',
                    12: 'Secret admirers. Private love.'
                },
                'Mars': {
                    1: 'Assertive and energetic.',
                    2: 'Driven to earn and possess.',
                    3: 'Direct communication. Active mind.',
                    4: 'Protective of home and family.',
                    5: 'Passionate romance and creativity.',
                    6: 'Energetic work ethic.',
                    7: 'Passionate partnerships. Possible conflicts.',
                    8: 'Intense transformations.',
                    9: 'Adventure and competition.',
                    10: 'Ambitious career drive.',
                    11: 'Fight for causes. Active socially.',
                    12: 'Hidden anger. Private battles.'
                },
                'Jupiter': {
                    1: 'Optimistic and expansive.',
                    2: 'Financial growth and abundance.',
                    3: 'Expands knowledge and connections.',
                    4: 'Large or fortunate family.',
                    5: 'Luck in romance and creativity.',
                    6: 'Growth through service and health.',
                    7: 'Fortunate partnerships.',
                    8: 'Transformative wisdom.',
                    9: 'Travel and higher education.',
                    10: 'Career success and recognition.',
                    11: 'Beneficial friendships.',
                    12: 'Spiritual growth and faith.'
                },
                'Saturn': {
                    1: 'Serious demeanor. Mature.',
                    2: 'Financial discipline needed.',
                    3: 'Serious communication.',
                    4: 'Family responsibilities.',
                    5: 'Disciplined creativity.',
                    6: 'Hard work and health focus.',
                    7: 'Serious committed partnerships.',
                    8: 'Karmic debts and lessons.',
                    9: 'Structured learning.',
                    10: 'Career authority and achievement.',
                    11: 'Responsible friendships.',
                    12: 'Solitude and inner work.'
                }
            };
            
            return planetInterpretations[planet]?.[house] || houseMeanings[house];
        }

        // Calculation functions
        function getZodiacSign(month, day) {
            const signs = [
                { name: 'Capricorn', symbol: '♑', dates: [[12, 22], [1, 19]] },
                { name: 'Aquarius', symbol: '♒', dates: [[1, 20], [2, 18]] },
                { name: 'Pisces', symbol: '♓', dates: [[2, 19], [3, 20]] },
                { name: 'Aries', symbol: '♈', dates: [[3, 21], [4, 19]] },
                { name: 'Taurus', symbol: '♉', dates: [[4, 20], [5, 20]] },
                { name: 'Gemini', symbol: '♊', dates: [[5, 21], [6, 20]] },
                { name: 'Cancer', symbol: '♋', dates: [[6, 21], [7, 22]] },
                { name: 'Leo', symbol: '♌', dates: [[7, 23], [8, 22]] },
                { name: 'Virgo', symbol: '♍', dates: [[8, 23], [9, 22]] },
                { name: 'Libra', symbol: '♎', dates: [[9, 23], [10, 22]] },
                { name: 'Scorpio', symbol: '♏', dates: [[10, 23], [11, 21]] },
                { name: 'Sagittarius', symbol: '♐', dates: [[11, 22], [12, 21]] }
            ];
            
            for (let sign of signs) {
                const [[m1, d1], [m2, d2]] = sign.dates;
                if ((month === m1 && day >= d1) || (month === m2 && day <= d2)) {
                    return sign;
                }
            }
            return signs[0];
        }

        function getChineseZodiac(birthYear, birthMonth, birthDay) {
            const animals = [
                'Rat', 'Ox', 'Tiger', 'Rabbit', 'Dragon', 'Snake',
                'Horse', 'Goat', 'Monkey', 'Rooster', 'Dog', 'Pig'
            ];
            
            // Correct element based on last digit of year (Heavenly Stems)
            // 0-1: Metal, 2-3: Water, 4-5: Wood, 6-7: Fire, 8-9: Earth
            const elements = ['Metal', 'Metal', 'Water', 'Water', 'Wood', 'Wood', 'Fire', 'Fire', 'Earth', 'Earth'];
            
            // Chinese New Year dates for accurate calculation
            const cnyDates = {
                1980: [2, 16], 1981: [2, 5], 1982: [1, 25], 1983: [2, 13], 1984: [2, 2],
                1985: [2, 20], 1986: [2, 9], 1987: [1, 29], 1988: [2, 17], 1989: [2, 6],
                1990: [1, 27], 1991: [2, 15], 1992: [2, 4], 1993: [1, 23], 1994: [2, 10],
                1995: [1, 31], 1996: [2, 19], 1997: [2, 7], 1998: [1, 28], 1999: [2, 16],
                2000: [2, 5], 2001: [1, 24], 2002: [2, 12], 2003: [2, 1], 2004: [1, 22],
                2005: [2, 9], 2006: [1, 29], 2007: [2, 18], 2008: [2, 7], 2009: [1, 26],
                2010: [2, 14], 2011: [2, 3], 2012: [1, 23], 2013: [2, 10], 2014: [1, 31],
                2015: [2, 19], 2016: [2, 8], 2017: [1, 28], 2018: [2, 16], 2019: [2, 5],
                2020: [1, 25], 2021: [2, 12], 2022: [2, 1], 2023: [1, 22], 2024: [2, 10],
                2025: [1, 29], 2026: [2, 17], 2027: [2, 6], 2028: [1, 26], 2029: [2, 13],
                2030: [2, 3]
            };
            
            // Adjust year if born before Chinese New Year
            let year = birthYear;
            if (cnyDates[birthYear]) {
                const [cnyMonth, cnyDay] = cnyDates[birthYear];
                if (birthMonth < cnyMonth || (birthMonth === cnyMonth && birthDay < cnyDay)) {
                    year = birthYear - 1;
                }
            }
            
            // Animal calculation (12-year cycle, 1924 = Rat year 0)
            const animalIndex = (year - 1924) % 12;
            // Element calculation (10-year cycle based on year's last digit)
            const elementIndex = year % 10;
            
            return {
                animal: animals[animalIndex],
                element: elements[elementIndex],
                year: year
            };
        }

        function getLifePathNumber(birthDate) {
            const dateStr = birthDate.replace(/-/g, '');
            let sum = 0;
            for (let char of dateStr) {
                sum += parseInt(char);
            }
            while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            return sum;
        }

        function getPersonalYear(birthDate) {
            const birth = new Date(birthDate);
            const today = new Date();
            const month = birth.getMonth() + 1;
            const day = birth.getDate();
            
            // Check if birthday has passed this year
            const birthdayThisYear = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
            const hasBirthdayPassed = today >= birthdayThisYear;
            
            // Use current year if birthday passed, otherwise use last year
            const year = hasBirthdayPassed ? today.getFullYear() : today.getFullYear() - 1;
            
            let sum = month + day + year;
            while (sum > 9) {
                sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            return sum;
        }

        function calculateGematria(name) {
            if (!name) return 0;
            let sum = 0;
            for (let char of name.toUpperCase()) {
                if (char >= 'A' && char <= 'Z') {
                    sum += char.charCodeAt(0) - 64;
                }
            }
            return sum;
        }

        function getSpecialDateInfo(birthDate, coords = null) {
            const today = new Date();
            const birth = new Date(birthDate);
            const month = today.getMonth() + 1;
            const day = today.getDate();
            const year = today.getFullYear();
            
            // Determine if southern hemisphere (negative latitude)
            const isSouthernHemisphere = coords && coords.lat < 0;
            
            let special = [];
            
            // Birthday
            if (month === birth.getMonth() + 1 && day === birth.getDate()) {
                special.push({ type: 'birthday', message: '🎂 Today is YOUR BIRTHDAY! This is the start of your new personal year. A powerful day for setting intentions and manifesting your desires.' });
            }
            
            // Christmas
            if (month === 12 && day === 25) {
                special.push({ type: 'christmas', message: '🎄 Christmas Day - A time of joy, giving, and spiritual renewal. The cosmic energy supports miracles and heart-opening.' });
            }
            
            // Christmas Eve
            if (month === 12 && day === 24) {
                special.push({ type: 'christmas-eve', message: '🌟 Christmas Eve - The night before Christmas carries magical anticipation energy. Perfect for manifestation and wonder.' });
            }
            
            // New Year's Day
            if (month === 1 && day === 1) {
                special.push({ type: 'new-year', message: '✨ New Year\'s Day - The beginning of a fresh calendar cycle. Set your intentions for the year ahead with clarity and purpose.' });
            }
            
            // New Year's Eve
            if (month === 12 && day === 31) {
                special.push({ type: 'new-year-eve', message: '🎊 New Year\'s Eve - The threshold between years. Perfect for releasing the old and welcoming the new with gratitude.' });
            }
            
            // Valentine's Day
            if (month === 2 && day === 14) {
                special.push({ type: 'valentines', message: '💕 Valentine\'s Day - The cosmic energy amplifies love, romance, and heart connections. Open yourself to giving and receiving affection.' });
            }
            
            // Leap Day
            if (month === 2 && day === 29) {
                special.push({ type: 'leap-day', message: '🌀 February 29th - A rare portal day that only appears every 4 years. Use this extraordinary energy for quantum leaps and breakthroughs.' });
            }
            
            // April Fools (Old New Year - Julian Calendar)
            if (month === 4 && day === 1) {
                special.push({ type: 'april-fools', message: '🃏 April 1st - The "Old New Year" from the Julian calendar. A day of trickster energy, playfulness, and seeing through illusions to truth.' });
            }
            
            // Halloween/Samhain
            if (month === 10 && day === 31) {
                special.push({ type: 'halloween', message: '🎃 Halloween/Samhain - The veil between worlds is thinnest. Perfect for divination, ancestor work, and spiritual connection.' });
            }
            
            // Spring Equinox (adjust for hemisphere)
            if (month === 3 && day >= 19 && day <= 21) {
                if (isSouthernHemisphere) {
                    special.push({ type: 'autumn-equinox', message: '🍂 Autumn Equinox - Balance returns. Time for harvest, gratitude, and preparing for the inward season.' });
                } else {
                    special.push({ type: 'spring-equinox', message: '🌸 Spring Equinox - Balance of light and dark. New beginnings, growth, and planting seeds for the coming season.' });
                }
            }
            
            // Summer/Winter Solstice (adjust for hemisphere)
            if (month === 6 && day >= 20 && day <= 22) {
                if (isSouthernHemisphere) {
                    special.push({ type: 'winter-solstice', message: '❄️ Winter Solstice - Longest night of the year. Deepest introspection, rest, and the return of the light begins.' });
                } else {
                    special.push({ type: 'summer-solstice', message: '☀️ Summer Solstice - Longest day of the year. Peak solar energy, vitality, and outward expression reach their zenith.' });
                }
            }
            
            // Fall/Spring Equinox (adjust for hemisphere)
            if (month === 9 && day >= 21 && day <= 23) {
                if (isSouthernHemisphere) {
                    special.push({ type: 'spring-equinox', message: '🌸 Spring Equinox - Balance of light and dark. New beginnings, growth, and planting seeds for the coming season.' });
                } else {
                    special.push({ type: 'fall-equinox', message: '🍂 Autumn Equinox - Balance returns. Time for harvest, gratitude, and preparing for the inward season.' });
                }
            }
            
            // Winter/Summer Solstice (adjust for hemisphere)
            if (month === 12 && day >= 20 && day <= 22) {
                if (isSouthernHemisphere) {
                    special.push({ type: 'summer-solstice', message: '☀️ Summer Solstice - Longest day of the year. Peak solar energy, vitality, and outward expression reach their zenith.' });
                } else {
                    special.push({ type: 'winter-solstice', message: '❄️ Winter Solstice - Longest night of the year. Deepest introspection, rest, and the return of the light begins.' });
                }
            }
            
            return special;
        }

        // Geocoding cache to avoid repeated API calls
        const geocodingCache = {};

        // Geocoding helper - converts ANY location to coordinates using OpenStreetMap API
        async function getCoordinates(location) {
            if (!location) return { lat: 0, lon: 0 };
            
            // Check cache first
            const cacheKey = location.toLowerCase().trim();
            if (geocodingCache[cacheKey]) {
                return geocodingCache[cacheKey];
            }
            
            try {
                // Use OpenStreetMap Nominatim API (free, no API key required)
                const encodedLocation = encodeURIComponent(location);
                const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodedLocation}&format=json&limit=1`);
                
                if (!response.ok) {
                    console.log('Geocoding API error:', response.status);
                    return { lat: 0, lon: 0 };
                }
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const coords = {
                        lat: parseFloat(data[0].lat),
                        lon: parseFloat(data[0].lon),
                        displayName: data[0].display_name || location
                    };
                    
                    // Cache the result
                    geocodingCache[cacheKey] = coords;
                    
                    console.log(`Geocoded "${location}" to:`, coords);
                    return coords;
                } else {
                    console.log(`No results found for location: ${location}`);
                    return { lat: 0, lon: 0 };
                }
            } catch (error) {
                console.error('Geocoding error:', error);
                return { lat: 0, lon: 0 };
            }
        }

        // PHASE 2: Rising Sign Calculator with Swiss Ephemeris
        // PHASE 2: Rising Sign Calculator with Swiss Ephemeris
        async function getRisingSign(birthDate, birthTime, birthLocation) {
            if (!birthTime) return null;
            
            // Try Swiss Ephemeris for maximum accuracy
            if (typeof swisseph !== 'undefined' && birthLocation) {
                try {
                    const coords = await getCoordinates(birthLocation);
                    const birth = new Date(birthDate + ' ' + birthTime);
                    
                    // Calculate Julian Day
                    const year = birth.getFullYear();
                    const month = birth.getMonth() + 1;
                    const day = birth.getDate();
                    const hour = birth.getHours() + birth.getMinutes() / 60;
                    
                    const jd = swisseph.swe_julday(year, month, day, hour, swisseph.SE_GREG_CAL);
                    
                    // Calculate houses (Placidus system)
                    const houses = swisseph.swe_houses(jd, coords.lat, coords.lon, 'P');
                    
                    if (houses && houses.ascendant) {
                        // Convert ascendant degree to zodiac sign
                        const ascDegree = houses.ascendant;
                        const signIndex = Math.floor(ascDegree / 30);
                        
                        const signs = [
                            { name: 'Aries', symbol: '♈' },
                            { name: 'Taurus', symbol: '♉' },
                            { name: 'Gemini', symbol: '♊' },
                            { name: 'Cancer', symbol: '♋' },
                            { name: 'Leo', symbol: '♌' },
                            { name: 'Virgo', symbol: '♍' },
                            { name: 'Libra', symbol: '♎' },
                            { name: 'Scorpio', symbol: '♏' },
                            { name: 'Sagittarius', symbol: '♐' },
                            { name: 'Capricorn', symbol: '♑' },
                            { name: 'Aquarius', symbol: '♒' },
                            { name: 'Pisces', symbol: '♓' }
                        ];
                        
                        return signs[signIndex % 12];
                    }
                } catch (e) {
                    console.log('Swiss Ephemeris calculation failed, using fallback:', e);
                }
            }
            
            // Fallback: Simplified calculation
            const birth = new Date(birthDate);
            const month = birth.getMonth() + 1;
            const day = birth.getDate();
            const sunSign = getZodiacSign(month, day);
            const sunSignIndex = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 
                                  'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'].indexOf(sunSign.name);
            
            const [hours, minutes] = birthTime.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes;
            
            let sunriseMinutes = 6 * 60;
            if (birthLocation) {
                const location = birthLocation.toLowerCase();
                if (location.includes('uk') || location.includes('london')) sunriseMinutes = 7 * 60;
                else if (location.includes('australia') || location.includes('sydney')) sunriseMinutes = 6.5 * 60;
                else if (location.includes('india') || location.includes('mumbai')) sunriseMinutes = 6 * 60;
                else if (location.includes('japan') || location.includes('tokyo')) sunriseMinutes = 6 * 60;
                else if (location.includes('california') || location.includes('los angeles')) sunriseMinutes = 6.5 * 60;
                else if (location.includes('new york') || location.includes('boston')) sunriseMinutes = 6.5 * 60;
            }
            
            const minutesSinceSunrise = (totalMinutes - sunriseMinutes + 1440) % 1440;
            const risingOffset = Math.floor(minutesSinceSunrise / 120);
            const risingIndex = (sunSignIndex + risingOffset) % 12;
            
            const signs = [
                { name: 'Aries', symbol: '♈' },
                { name: 'Taurus', symbol: '♉' },
                { name: 'Gemini', symbol: '♊' },
                { name: 'Cancer', symbol: '♋' },
                { name: 'Leo', symbol: '♌' },
                { name: 'Virgo', symbol: '♍' },
                { name: 'Libra', symbol: '♎' },
                { name: 'Scorpio', symbol: '♏' },
                { name: 'Sagittarius', symbol: '♐' },
                { name: 'Capricorn', symbol: '♑' },
                { name: 'Aquarius', symbol: '♒' },
                { name: 'Pisces', symbol: '♓' }
            ];
            return signs[risingIndex];
        }

        // PHASE 2: Moon Sign Calculator with Swiss Ephemeris
        async function getMoonSign(birthDate, birthTime, birthLocation) {
            // Try Swiss Ephemeris for maximum accuracy
            if (typeof swisseph !== 'undefined' && birthTime && birthLocation) {
                try {
                    const coords = await getCoordinates(birthLocation);
                    const birth = new Date(birthDate + ' ' + birthTime);
                    
                    // Calculate Julian Day
                    const year = birth.getFullYear();
                    const month = birth.getMonth() + 1;
                    const day = birth.getDate();
                    const hour = birth.getHours() + birth.getMinutes() / 60;
                    
                    const jd = swisseph.swe_julday(year, month, day, hour, swisseph.SE_GREG_CAL);
                    
                    // Calculate Moon position
                    const moonPos = swisseph.swe_calc_ut(jd, swisseph.SE_MOON, swisseph.SEFLG_SWIEPH);
                    
                    if (moonPos && moonPos.longitude !== undefined) {
                        // Convert moon longitude to zodiac sign
                        const moonDegree = moonPos.longitude;
                        const signIndex = Math.floor(moonDegree / 30);
                        
                        const signs = [
                            { name: 'Aries', symbol: '♈', element: 'Fire' },
                            { name: 'Taurus', symbol: '♉', element: 'Earth' },
                            { name: 'Gemini', symbol: '♊', element: 'Air' },
                            { name: 'Cancer', symbol: '♋', element: 'Water' },
                            { name: 'Leo', symbol: '♌', element: 'Fire' },
                            { name: 'Virgo', symbol: '♍', element: 'Earth' },
                            { name: 'Libra', symbol: '♎', element: 'Air' },
                            { name: 'Scorpio', symbol: '♏', element: 'Water' },
                            { name: 'Sagittarius', symbol: '♐', element: 'Fire' },
                            { name: 'Capricorn', symbol: '♑', element: 'Earth' },
                            { name: 'Aquarius', symbol: '♒', element: 'Air' },
                            { name: 'Pisces', symbol: '♓', element: 'Water' }
                        ];
                        
                        return signs[signIndex % 12];
                    }
                } catch (e) {
                    console.log('Swiss Ephemeris moon calculation failed, using fallback:', e);
                }
            }
            
            // Fallback: Simplified calculation
            const birth = new Date(birthDate);
            const epoch = new Date('2000-01-06');
            const daysSinceEpoch = Math.floor((birth - epoch) / (1000 * 60 * 60 * 24));
            
            let hourOffset = 0;
            if (birthTime) {
                const [hours] = birthTime.split(':').map(Number);
                hourOffset = hours / 24;
                
                if (birthLocation) {
                    const location = birthLocation.toLowerCase();
                    if (location.includes('uk') || location.includes('london')) hourOffset += 0;
                    else if (location.includes('india') || location.includes('mumbai')) hourOffset += 5.5/24;
                    else if (location.includes('australia') || location.includes('sydney')) hourOffset += 10/24;
                    else if (location.includes('japan') || location.includes('tokyo')) hourOffset += 9/24;
                    else if (location.includes('los angeles') || location.includes('california')) hourOffset -= 8/24;
                    else if (location.includes('new york') || location.includes('boston')) hourOffset -= 5/24;
                }
            }
            
            const moonCyclePosition = (daysSinceEpoch + hourOffset) % 29.5;
            const moonSignIndex = Math.floor((moonCyclePosition / 29.5) * 12) % 12;
            
            const signs = [
                { name: 'Capricorn', symbol: '♑', element: 'Earth' },
                { name: 'Aquarius', symbol: '♒', element: 'Air' },
                { name: 'Pisces', symbol: '♓', element: 'Water' },
                { name: 'Aries', symbol: '♈', element: 'Fire' },
                { name: 'Taurus', symbol: '♉', element: 'Earth' },
                { name: 'Gemini', symbol: '♊', element: 'Air' },
                { name: 'Cancer', symbol: '♋', element: 'Water' },
                { name: 'Leo', symbol: '♌', element: 'Fire' },
                { name: 'Virgo', symbol: '♍', element: 'Earth' },
                { name: 'Libra', symbol: '♎', element: 'Air' },
                { name: 'Scorpio', symbol: '♏', element: 'Water' },
                { name: 'Sagittarius', symbol: '♐', element: 'Fire' }
            ];
            return signs[moonSignIndex];
        }

        // PHASE 2: Planetary Hour Calculator
        function getPlanetaryHour() {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0=Sunday, 1=Monday...
            const hour = now.getHours();
            
            // Chaldean order of planets
            const planets = ['Saturn', 'Jupiter', 'Mars', 'Sun', 'Venus', 'Mercury', 'Moon'];
            // Day rulers
            const dayRulers = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn'];
            
            const dayRulerIndex = planets.indexOf(dayRulers[dayOfWeek]);
            // Sunrise assumed at 6 AM for simplicity
            const hoursFromSunrise = (hour - 6 + 24) % 24;
            const planetaryHourIndex = (dayRulerIndex + hoursFromSunrise) % 7;
            
            const planetData = {
                'Saturn': { symbol: '♄', energy: 'discipline, structure, karmic lessons', color: 'Black/Gray', activity: 'organization, boundary-setting, long-term planning' },
                'Jupiter': { symbol: '♃', energy: 'expansion, luck, wisdom', color: 'Blue/Purple', activity: 'learning, travel planning, abundance work' },
                'Mars': { symbol: '♂', energy: 'action, courage, initiative', color: 'Red', activity: 'physical exercise, assertive conversations, starting projects' },
                'Sun': { symbol: '☉', energy: 'vitality, creativity, self-expression', color: 'Gold/Yellow', activity: 'creative work, leadership, visibility' },
                'Venus': { symbol: '♀', energy: 'love, beauty, harmony', color: 'Green/Pink', activity: 'art, relationships, self-care, beautification' },
                'Mercury': { symbol: '☿', energy: 'communication, intellect, travel', color: 'Orange', activity: 'writing, studying, conversations, commerce' },
                'Moon': { symbol: '☽', energy: 'intuition, emotions, nurturing', color: 'Silver/White', activity: 'rest, reflection, family, psychic work' }
            };
            
            return { planet: planets[planetaryHourIndex], ...planetData[planets[planetaryHourIndex]] };
        }

        // PHASE 2: Cross-System Analysis
        function getCrossSystemAnalysis(zodiac, rising, moon, chinese, lifePath, personalYear) {
            let agreements = [];
            let tensions = [];
            let badges = [];
            
            // Element mapping for Western signs
            const fireSignals = ['Aries', 'Leo', 'Sagittarius'];
            const earthSigns = ['Taurus', 'Virgo', 'Capricorn'];
            const airSigns = ['Gemini', 'Libra', 'Aquarius'];
            const waterSigns = ['Cancer', 'Scorpio', 'Pisces'];
            
            function getWesternElement(sign) {
                if (fireSignals.includes(sign)) return 'Fire';
                if (earthSigns.includes(sign)) return 'Earth';
                if (airSigns.includes(sign)) return 'Air';
                if (waterSigns.includes(sign)) return 'Water';
                return 'Unknown';
            }
            
            const sunElement = getWesternElement(zodiac.name);
            const moonElement = moon ? getWesternElement(moon.name) : null;
            const risingElement = rising ? getWesternElement(rising.name) : null;
            
            // Chinese element compatibility with Western element
            const elementHarmony = {
                'Fire': ['Fire', 'Wood'],
                'Earth': ['Earth', 'Metal'],
                'Air': ['Metal', 'Water'],
                'Water': ['Water', 'Wood']
            };
            
            // Check Western-Chinese element harmony
            if (elementHarmony[sunElement] && elementHarmony[sunElement].includes(chinese.element)) {
                agreements.push({
                    systems: ['Astrology', 'Chinese Zodiac'],
                    insight: `Your ${zodiac.name} ${sunElement} energy harmonizes beautifully with your ${chinese.element} ${chinese.animal}. Both systems point toward ${sunElement === 'Fire' ? 'passionate action and leadership' : sunElement === 'Earth' ? 'stability and manifestation' : sunElement === 'Air' ? 'intellectual pursuits and communication' : 'emotional depth and intuition'}.`
                });
                badges.push('⭐🐉');
            } else {
                tensions.push({
                    systems: ['Astrology', 'Chinese Zodiac'],
                    insight: `Your ${zodiac.name} ${sunElement} energy creates dynamic tension with your ${chinese.element} ${chinese.animal}. This isn't negative—it provides depth and complexity, pushing you to integrate seemingly opposing forces.`
                });
            }
            
            // Life Path alignment with Sun Sign
            const leaderPaths = [1, 8];
            const creativePaths = [3, 6];
            const seekerPaths = [7, 11];
            const builderPaths = [4, 22];
            
            const leaderSigns = ['Aries', 'Leo', 'Capricorn'];
            const creativeSigns = ['Taurus', 'Leo', 'Libra', 'Pisces'];
            const seekerSigns = ['Sagittarius', 'Aquarius', 'Pisces', 'Scorpio'];
            const builderSigns = ['Taurus', 'Virgo', 'Capricorn'];
            
            if ((leaderPaths.includes(lifePath) && leaderSigns.includes(zodiac.name)) ||
                (creativePaths.includes(lifePath) && creativeSigns.includes(zodiac.name)) ||
                (seekerPaths.includes(lifePath) && seekerSigns.includes(zodiac.name)) ||
                (builderPaths.includes(lifePath) && builderSigns.includes(zodiac.name))) {
                agreements.push({
                    systems: ['Astrology', 'Numerology'],
                    insight: `Your Life Path ${lifePath} amplifies your ${zodiac.name} nature—both systems confirm your core purpose. This alignment gives you natural confidence in your path.`
                });
                badges.push('⭐🔢');
            }
            
            // Moon and Chinese element harmony (emotional depth)
            if (moon && moonElement) {
                if ((moonElement === 'Water' && ['Water', 'Wood'].includes(chinese.element)) ||
                    (moonElement === 'Fire' && ['Fire', 'Wood'].includes(chinese.element)) ||
                    (moonElement === 'Earth' && ['Earth', 'Metal'].includes(chinese.element)) ||
                    (moonElement === 'Air' && ['Metal', 'Water'].includes(chinese.element))) {
                    agreements.push({
                        systems: ['Moon Sign', 'Chinese Zodiac'],
                        insight: `Your ${moon.name} Moon resonates with your ${chinese.element} element, suggesting deep emotional alignment with your ancestral wisdom. Your intuitive responses are trustworthy.`
                    });
                }
            }
            
            // Personal Year and Chinese Year harmony
            const currentYear = new Date().getFullYear();
            const today = new Date();
            const currentChinese = getChineseZodiac(currentYear, today.getMonth() + 1, today.getDate());
            if (chinese.element === currentChinese.element) {
                agreements.push({
                    systems: ['Chinese Zodiac', 'Temporal'],
                    insight: `This is your element year! Your ${chinese.element} energy is amplified by the current ${currentChinese.element} ${currentChinese.animal} year—opportunities align more easily.`
                });
                badges.push('🐉⏰');
            }
            
            return { agreements, tensions, badges };
        }

        // PHASE 2: Moon Phase Calculator
        function getCurrentMoonPhase() {
            const now = new Date();
            const epoch = new Date('2000-01-06'); // Known new moon
            const daysSince = (now - epoch) / (1000 * 60 * 60 * 24);
            const lunation = daysSince % 29.53;
            
            if (lunation < 1.85) return { phase: 'New Moon', symbol: '🌑', energy: 'New beginnings, setting intentions, planting seeds', action: 'Meditate on new goals and write detailed intentions' };
            if (lunation < 7.38) return { phase: 'Waxing Crescent', symbol: '🌒', energy: 'Taking first steps, courage, commitment', action: 'Take the first concrete action toward your intentions' };
            if (lunation < 9.23) return { phase: 'First Quarter', symbol: '🌓', energy: 'Decision time, overcoming obstacles, momentum', action: 'Push through resistance and commit to your path' };
            if (lunation < 14.77) return { phase: 'Waxing Gibbous', symbol: '🌔', energy: 'Refinement, patience, trust the process', action: 'Fine-tune your approach and stay the course' };
            if (lunation < 16.62) return { phase: 'Full Moon', symbol: '🌕', energy: 'Manifestation, clarity, celebration, release', action: 'Celebrate progress and release what no longer serves' };
            if (lunation < 22.15) return { phase: 'Waning Gibbous', symbol: '🌖', energy: 'Gratitude, sharing wisdom, giving back', action: 'Share what you\'ve learned and express gratitude' };
            if (lunation < 23.99) return { phase: 'Last Quarter', symbol: '🌗', energy: 'Release, forgiveness, letting go', action: 'Release old patterns and forgive past mistakes' };
            return { phase: 'Waning Crescent', symbol: '🌘', energy: 'Rest, surrender, preparation for renewal', action: 'Rest deeply and prepare for the new cycle' };
        }

        // Get New Moon and Full Moon dates within a period
        function getMoonPhasesForPeriod(startDate, days) {
            const moonEvents = [];
            const epoch = new Date('2000-01-06'); // Known new moon
            const lunarCycle = 29.53;
            
            for (let i = 0; i < days; i++) {
                const checkDate = new Date(startDate);
                checkDate.setDate(startDate.getDate() + i);
                
                const daysSince = (checkDate - epoch) / (1000 * 60 * 60 * 24);
                const lunation = daysSince % lunarCycle;
                
                // Check for New Moon (within ~1 day of exact)
                if (lunation < 1 || lunation > 28.53) {
                    const dateStr = checkDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    // Avoid duplicates (check if we already have this date)
                    if (!moonEvents.find(e => e.date === dateStr && e.phase === 'New Moon')) {
                        moonEvents.push({
                            phase: 'New Moon',
                            emoji: '🌑',
                            date: dateStr,
                            meaning: 'Set intentions & plant seeds'
                        });
                    }
                }
                
                // Check for Full Moon (around day 14.77 of cycle, within ~1 day)
                if (lunation > 13.77 && lunation < 15.77) {
                    const dateStr = checkDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    if (!moonEvents.find(e => e.date === dateStr && e.phase === 'Full Moon')) {
                        moonEvents.push({
                            phase: 'Full Moon',
                            emoji: '🌕',
                            date: dateStr,
                            meaning: 'Manifestation & release'
                        });
                    }
                }
            }
            
            return moonEvents;
        }

        // Generate forecast
        document.getElementById('generateBtn').addEventListener('click', async function() {
            const birthDate = document.getElementById('birthDate').value;
            
            // Validate inputs
            if (!validateInputs()) {
                return;
            }
            
            // Show loading spinner with animation
            showLoadingSpinner();
            document.getElementById('inputSection').style.display = 'none';
            
            // Simulate calculation time (11s to match full intro animation)
            setTimeout(async () => {
                await generateForecast();
                hideLoadingSpinner();
                document.getElementById('timeframeSelector').style.display = 'flex';
                document.getElementById('forecastOutput').classList.add('show');
                document.getElementById('howToUse').style.display = 'block';
                document.getElementById('forecastOutput').scrollIntoView({ behavior: 'smooth' });
                
                // Save user profile to localStorage for next visit
                saveUserProfileFromForm();
            }, 11000);
        });

        // Input Validation
        function validateInputs() {
            clearErrors();
            const errors = [];
            
            const birthDate = document.getElementById('birthDate').value;
            if (!birthDate) {
                errors.push({ field: 'birthDate', message: 'Please enter your birth date' });
            }
            
            const birthTime = document.getElementById('birthTime').value;
            if (birthTime && !isValidTime(birthTime)) {
                errors.push({ field: 'birthTime', message: 'Please enter time in HH:MM format' });
            }
            
            if (errors.length > 0) {
                showErrors(errors);
                return false;
            }
            
            return true;
        }

        function isValidTime(time) {
            return /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(time);
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
        }

        function showErrors(errors) {
            errors.forEach(error => {
                const field = document.getElementById(error.field);
                field.classList.add('input-error');
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = error.message;
                field.parentNode.appendChild(errorDiv);
                
                // Scroll to first error
                if (errors[0] === error) {
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        }

        async function generateForecast(timeframe = 'daily') {
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            const birthLocation = document.getElementById('birthLocation').value;
            const currentLocation = document.getElementById('currentLocation').value;
            const firstName = document.getElementById('firstName').value;
            const middleName = document.getElementById('middleName').value;
            const lastName = document.getElementById('lastName').value;
            
            const birth = new Date(birthDate);
            const month = birth.getMonth() + 1;
            const day = birth.getDate();
            const year = birth.getFullYear();
            
            // Calculate all systems
            const zodiac = getZodiacSign(month, day);
            const chinese = getChineseZodiac(year, month, day);
            const lifePath = getLifePathNumber(birthDate);
            const personalYear = getPersonalYear(birthDate);
            const fullName = [firstName, middleName, lastName].filter(n => n).join(' ');
            const gematria = calculateGematria(fullName);
            
            // PHASE 2: Advanced calculations (await async location-based functions)
            const risingSign = await getRisingSign(birthDate, birthTime, birthLocation);
            const moonSign = await getMoonSign(birthDate, birthTime, birthLocation);
            const planetaryHour = getPlanetaryHour();
            const moonPhase = getCurrentMoonPhase();
            const crossAnalysis = getCrossSystemAnalysis(zodiac, risingSign, moonSign, chinese, lifePath, personalYear);
            
            // Get coordinates for hemisphere detection - use current location first, fall back to birth location
            let coords = null;
            const locationForHemisphere = currentLocation || birthLocation;
            if (locationForHemisphere) {
                coords = await getCoordinates(locationForHemisphere.toLowerCase().trim());
            }
            
            // PHASE 3: New features - Tarot, Aspects, Best Day, Houses
            const tarotCard = getTarotCard(birthDate, timeframe);
            const planetaryAspects = getPlanetaryAspects(birthDate);
            const bestDay = getBestDayOfWeek(zodiac, chinese, lifePath);
            const planetaryHouses = await getPlanetaryHouses(birthDate, birthTime, birthLocation);
            
            // Get today's date and check for special dates (pass coords for hemisphere detection)
            const today = new Date();
            const todayStr = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const specialDates = getSpecialDateInfo(birthDate, coords);
            
            // Generate forecast content based on timeframe
            let forecastHTML = '';
            
            if (timeframe === 'daily') {
                forecastHTML = generateDailyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear, 
                    gematria, fullName, birthTime, birthLocation, planetaryHour, moonPhase, crossAnalysis, 
                    birth, todayStr, tarotCard, planetaryAspects, planetaryHouses, specialDates, coords, currentLocation, locationForHemisphere);
            } else if (timeframe === 'weekly') {
                forecastHTML = generateWeeklyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
                    gematria, fullName, birthTime, moonPhase, crossAnalysis, birth, tarotCard, bestDay);
            } else if (timeframe === 'monthly') {
                forecastHTML = generateMonthlyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
                    gematria, fullName, crossAnalysis, birth, tarotCard);
            } else {
                forecastHTML = generateYearlyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
                    gematria, fullName, crossAnalysis, birth, tarotCard);
            }
            
            document.getElementById('forecastOutput').innerHTML = forecastHTML;
            
            // Scroll to Cosmic Overview section
            setTimeout(() => {
                const cosmicSection = document.getElementById('cosmic-overview');
                if (cosmicSection) {
                    cosmicSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // PHASE 2: Daily Forecast Generator
        function generateDailyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear, 
            gematria, fullName, birthTime, birthLocation, planetaryHour, moonPhase, crossAnalysis, 
            birth, todayStr, tarotCard, planetaryAspects, planetaryHouses, specialDates, coords, currentLocation, locationForHemisphere) {
            
            // Get frequency recommendation
            const frequencyData = getDailyFrequency(zodiac, moonPhase);
            
            // Check if location-based calculations are active
            const locationActive = birthLocation && birthTime;
            const locationNote = locationActive 
                ? `📍 Location-based calculations ACTIVE for ${birthLocation} - Rising sign, Moon sign, and Planetary Houses are personalized to your exact birth coordinates.`
                : `⚠️ Add birth time & location for personalized Rising sign, Moon sign, and accurate Planetary House placements.`;
            
            // Calculate cosmic overview values
            const energyLevel = getCosmicEnergyLevel(moonPhase, zodiac, chinese, personalYear, birth);
            const manifestationFocus = getManifestationFocus(moonPhase);
            const portalTimes = getPortalTimes();
            const elementOfDay = getElementOfDay(zodiac);
            
            return `
                <div class="forecast-header" id="cosmic-overview">
                    <h2>YOUR QUANTUM FORECAST</h2>
                    <div class="forecast-meta">
                        <p>Generated for: ${fullName || 'Seeker'}</p>
                        <p>☉ Sun: ${zodiac.name} ${zodiac.symbol} ${risingSign ? `| ↑ Rising: ${risingSign.name} ${risingSign.symbol}` : ''} ${moonSign ? `| ☽ Moon: ${moonSign.name} ${moonSign.symbol}` : ''}</p>
                        <p>🐉 ${chinese.element} ${chinese.animal} | 🔢 Life Path ${lifePath} | Personal Year ${personalYear}</p>
                        <p>Timeframe: Daily | ${todayStr}</p>
                        ${locationForHemisphere ? `<p style="font-size: 0.95rem; margin-top: 10px;">📍 ${currentLocation ? 'Current' : 'Birth'} Location: <span style="color: #00ff88; text-shadow: 0 0 10px rgba(0, 255, 136, 0.5); font-weight: 600;">${locationForHemisphere}</span> ${coords && coords.lat < 0 ? '(Southern Hemisphere)' : '(Northern Hemisphere)'}</span></p>` : ''}
                        <p style="font-size: 0.9rem; color: ${locationActive ? '#00ff88' : '#ff8800'}; margin-top: 10px;">${locationNote}</p>
                    </div>
                </div>

                <div class="cosmic-overview">
                    <div class="cosmic-header">
                        <h2>✨ TODAY'S COSMIC SNAPSHOT ✨</h2>
                        <p class="cosmic-subtitle">Your personalized energy blueprint for ${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                    </div>
                    
                    <div class="energy-status">
                        <div class="energy-badge ${energyLevel.level}">
                            <div class="energy-label">${energyLevel.label}</div>
                            <div class="energy-description">${energyLevel.description}</div>
                        </div>
                    </div>
                    
                    <div class="cosmic-meta">
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎯</div>
                            <div class="meta-content">
                                <div class="meta-label">Manifestation Focus</div>
                                <div class="meta-value">${manifestationFocus}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">⏰</div>
                            <div class="meta-content">
                                <div class="meta-label">Next Portal Time</div>
                                <div class="meta-value">${portalTimes.time}</div>
                                <div class="meta-description">${portalTimes.description}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">${elementOfDay.element.split(' ')[0]}</div>
                            <div class="meta-content">
                                <div class="meta-label">Element of the Day</div>
                                <div class="meta-value" style="color: ${elementOfDay.color}">${elementOfDay.element}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎵</div>
                            <div class="meta-content">
                                <div class="meta-label">Frequency of the Day</div>
                                <div class="meta-value">${frequencyData.frequency}</div>
                                <div class="meta-description">${frequencyData.category}</div>
                            </div>
                        </div>
                    </div>
                </div>

                ${specialDates.length > 0 ? `
                <div class="special-date-banner">
                    <h3>SPECIAL COSMIC ALIGNMENT</h3>
                    ${specialDates.map(date => `<p>${date.message}</p>`).join('')}
                </div>
                ` : ''}

                <div class="overview-section">
                    <h3 style="text-align: center;">TODAY'S OVERVIEW</h3>
                    <div class="overview-content">
                        <p><strong>Core Energy:</strong> ${getEnhancedOverviewEnergy(zodiac, risingSign, moonSign, chinese, personalYear, moonPhase)}</p>
                        <p><strong>Primary Focus:</strong> ${getEnhancedOverviewFocus(lifePath, personalYear, moonPhase)}</p>
                        <p><strong>Shadow Work:</strong> ${getEnhancedOverviewCaution(zodiac, moonSign, chinese)}</p>
                    </div>
                </div>

                <div class="action-section">
                    <h3 style="text-align: center;">YOUR DAILY ACTION PLAN</h3>
                    ${getEnhancedActionItems(zodiac, risingSign, moonSign, chinese, lifePath, personalYear, planetaryHour, moonPhase)}
                </div>

                ${crossAnalysis.agreements.length > 0 ? `
                <div class="cross-reference-section agreement">
                    <h3 style="text-align: center;">SYSTEM AGREEMENTS - Where Your Cosmic DNA Aligns</h3>
                    ${crossAnalysis.agreements.map(a => `
                        <div class="cross-item">
                            <div class="system-badges">${a.systems.map(s => `<span class="badge">${s}</span>`).join(' + ')}</div>
                            <p>${a.insight}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                ${crossAnalysis.tensions.length > 0 ? `
                <div class="cross-reference-section tension">
                    <h3>⚡ DYNAMIC TENSIONS - Your Growth Edges</h3>
                    ${crossAnalysis.tensions.map(t => `
                        <div class="cross-item">
                            <div class="system-badges">${t.systems.map(s => `<span class="badge tension">${s}</span>`).join(' ⟷ ')}</div>
                            <p>${t.insight}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>⭐ ASTROLOGY</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedWesternAstrologyForecast(zodiac, risingSign, moonSign, birthTime, birthLocation, moonPhase)}
                        <button class="section-share-btn" onclick="shareSectionInsight('astrology', '${zodiac.name}${risingSign ? ' Rising ' + risingSign.name : ''}')">
                            Share My Cosmic Identity
                        </button>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🐉 CHINESE ZODIAC</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedChineseZodiacForecast(chinese, moonPhase)}
                        <button class="section-share-btn" onclick="shareSectionInsight('chinese', '${chinese.element} ${chinese.animal}')">
                            Share My Zodiac Discovery
                        </button>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔢 NUMEROLOGY</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedNumerologyForecast(lifePath, personalYear, birth)}
                        <button class="section-share-btn" onclick="shareSectionInsight('numerology', 'Life Path ${lifePath}')">
                            Share My Life Path
                        </button>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🪐 PLANETARY INFLUENCES</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div class="cosmic-timing-section">
                            <h4>⏰ COSMIC TIMING - Right Now</h4>
                            <div class="timing-grid">
                                <div class="timing-item">
                                    <strong>${moonPhase.symbol} ${moonPhase.phase}</strong>
                                    <p>${moonPhase.energy}</p>
                                    <p><em>Action: ${moonPhase.action}</em></p>
                                </div>
                                <div class="timing-item">
                                    <strong>${planetaryHour.symbol} Hour of ${planetaryHour.planet}</strong>
                                    <p>Energy: ${planetaryHour.energy}</p>
                                    <p><em>Best for: ${planetaryHour.activity}</em></p>
                                </div>
                            </div>
                        </div>

                        ${planetaryAspects.length > 0 ? `
                        <div class="aspects-section" style="margin-top: 25px;">
                            <h4>🌌 PLANETARY ASPECTS - Today's Celestial Geometry</h4>
                            <div class="aspects-grid">
                                ${planetaryAspects.map(aspect => `
                                    <div class="aspect-item">
                                        <div class="aspect-header">
                                            <span class="aspect-symbol">${aspect.symbol}</span>
                                            <span class="aspect-type">${aspect.type}</span>
                                        </div>
                                        <p class="aspect-planets">${aspect.planets}</p>
                                        <p class="aspect-meaning">${aspect.meaning}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${planetaryHouses.length > 0 ? `
                        <div class="houses-section" style="margin-top: 25px;">
                            <h4>🏛️ PLANETARY HOUSES - Where Cosmic Forces Focus</h4>
                            <div class="houses-grid">
                                ${planetaryHouses.map(placement => `
                                    <div class="house-item">
                                        <div class="house-header">
                                            <span class="planet-symbol">${placement.symbol}</span>
                                            <span class="planet-name">${placement.planet}</span>
                                            <span class="house-number">in House ${placement.house}</span>
                                        </div>
                                        <p class="house-meaning">${placement.meaning}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        <button class="section-share-btn" onclick="shareSectionInsight('planetary', '${moonPhase.phase} & ${planetaryHour.planet} Hour')">
                            Share My Cosmic Timing
                        </button>
                    </div>
                </div>

                ${fullName ? `
                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>📜 GEMATRIA</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedGematriaForecast(fullName, gematria, birth)}
                        <button class="section-share-btn" onclick="shareSectionInsight('gematria', '${gematria}')">
                            Share My Gematria
                        </button>
                    </div>
                </div>
                ` : ''}

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔊 FREQUENCY HEALING - Enhanced</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div class="frequency-display">
                            <div class="frequency-main">
                                <span class="frequency-hz">${frequencyData.hz} Hz</span>
                                <span class="frequency-name">${frequencyData.name}</span>
                            </div>
                            <div class="frequency-details">
                                <p><strong>🎯 Primary Effect:</strong> ${frequencyData.category}</p>
                                <p><strong>🌟 Cosmic Alignment:</strong> ${frequencyData.alignment}</p>
                                <p><strong>✨ Benefits:</strong> ${frequencyData.benefits}</p>
                                <p><strong>🎧 How to Use:</strong> ${frequencyData.usage}</p>
                                <p><strong>⏰ Best Time:</strong> ${frequencyData.bestTime}</p>
                                <p><strong>🧘 Meditation Duration:</strong> Minimum 15 minutes, optimal 30-60 minutes for deep healing</p>
                                <p><strong>🔄 Frequency Pairing:</strong> ${getFrequencyPairing(frequencyData.hz)}</p>
                                <p><strong>💎 Crystals to Amplify:</strong> ${getCrystalPairing(frequencyData.category)}</p>
                            </div>
                            
                            <div class="frequency-actions" style="display: none;">
                                <a href="../genesis/index-enhanced.html?freq=${frequencyData.hz}" class="frequency-link primary" target="_blank">
                                    🎵 Play This Frequency in Quantum Genesis
                                </a>
                                <button class="frequency-link secondary" onclick="setFrequencyReminder('${frequencyData.hz}', '${portalTimes.time}')">
                                    ⏰ Set Reminder for Portal Time
                                </button>
                                <button class="frequency-link secondary" onclick="addFrequencyToCalendar('${frequencyData.name}', '${frequencyData.hz}')">
                                    📅 Add to Daily Practice
                                </button>
                            </div>

                            <div class="coming-soon-banner" style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(0, 255, 136, 0.2)); border: 2px solid var(--neon-gold); border-radius: 15px; padding: 20px; text-align: center; margin: 20px 0;">
                                <h4 style="color: var(--neon-gold); margin-bottom: 10px; font-size: 1.2rem;">🎵 Frequency Generator Coming Soon! 🎵</h4>
                                <p style="color: rgba(255, 255, 255, 0.9); margin: 0;">We're building a powerful frequency healing player right into your forecasts. Stay tuned for this cosmic upgrade! ✨</p>
                            </div>
                            
                            <div class="frequency-science">
                                <h4>📊 The Science Behind ${frequencyData.hz} Hz</h4>
                                <p>${getFrequencyScience(frequencyData.hz)}</p>
                            </div>
                        </div>
                        <button class="section-share-btn" onclick="shareSectionInsight('frequency', '${frequencyData.hz} Hz')">
                            Share My Healing Frequency
                        </button>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>⚡ REALITY CODES</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div class="reality-codes-section" style="border: none; background: transparent; padding: 0;">
                            <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 25px; line-height: 1.8;">
                                Your Reality Code is the <strong style="color: var(--neon-gold);">English Gematria</strong> of your intention (A=1, B=2...Z=26). Use this number as your <strong style="color: var(--neon-cyan);">phone PIN, passwords, or passcodes</strong> to constantly reinforce your intention into reality. When multiple people use the same code, manifestation power <strong style="color: #9d00ff;">exponentially amplifies</strong>: 2 people = 3x, 3 people = 7x, 33 people = 8.58 billion, 111 people = 2.4 decillion!
                            </p>
                            
                            ${(() => {
                                const suggestions = generateRealityCodeSuggestions(lifePath, zodiac.name, personalYear);
                                const primarySuggestion = suggestions[0];
                                const code = generateRealityCode(primarySuggestion.statement, fullName, birthDate, primarySuggestion.category);
                                
                                return `
                                    <div class="reality-code-card">
                                        <div class="reality-match">${primarySuggestion.icon} ${primarySuggestion.match}% Match - ${primarySuggestion.source}</div>
                                        <div class="reality-statement">"${primarySuggestion.statement}"</div>
                                        <div class="reality-why"><strong>Why this works for you:</strong> ${primarySuggestion.why}</div>
                                        <div class="reality-code-display">${code}</div>
                                        
                                        <div class="amplification-info">
                                            <div class="amp-item">
                                                <div class="amp-value">1x</div>
                                                <div class="amp-label">Solo Intention</div>
                                            </div>
                                            <div class="amp-item">
                                                <div class="amp-value">31x</div>
                                                <div class="amp-label">Support 5 Codes</div>
                                            </div>
                                            <div class="amp-item">
                                                <div class="amp-value">∞</div>
                                                <div class="amp-label">Daily Practice</div>
                                            </div>
                                        </div>
                                        
                                        <button class="reality-code-btn primary" onclick="copyRealityCode('${code}', \`${primarySuggestion.statement.replace(/'/g, "\\'")}\`)" style="width: 100%; margin-top: 15px; padding: 15px; font-size: 1.1rem;">
                                            📋 Copy Code & Message - Paste into Community Below 👇
                                        </button>

                                    </div>
                                    
                                    ${suggestions.slice(1).map((s, i) => {
                                        const altCode = generateRealityCode(s.statement, fullName, birthDate, s.category);
                                        return `
                                            <div class="reality-code-card" style="opacity: 0.85;">
                                                <div class="reality-match">${s.icon} ${s.match}% Match - ${s.source}</div>
                                                <div class="reality-statement" style="font-size: 1.1rem;">"${s.statement}"</div>
                                                <div class="reality-code-display" style="font-size: 1.3rem;">${altCode}</div>
                                                <button class="reality-code-btn" onclick="copyRealityCode('${altCode}', \`${s.statement.replace(/'/g, "\\'")}\`)" style="width: 100%; margin-top: 10px;">
                                                    📋 Copy & Paste into Community
                                                </button>
                                            </div>
                                        `;
                                    }).join('')}
                                `;
                            })()}
                            
                            <div class="mersenne-theory">
                                <h4>🌌 Quantum Reciprocity: The More You Give, The More You Receive</h4>
                                <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.95rem;">Supporting others' codes clears YOUR blockages. Each observer you become for others activates reciprocity in your favor:</p>
                                <div class="mersenne-grid">
                                    <div class="mersenne-item"><div class="mersenne-power">1x</div><div class="mersenne-people">1 observer</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">3x</div><div class="mersenne-people">2 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">7x</div><div class="mersenne-people">3 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">15x</div><div class="mersenne-people">4 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">31x</div><div class="mersenne-people">5 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">1,023x</div><div class="mersenne-people">10 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">8.58B</div><div class="mersenne-people">33 observers</div></div>
                                    <div class="mersenne-item"><div class="mersenne-power">∞</div><div class="mersenne-people">111+ observers</div></div>
                                </div>
                            </div>
                            
                            <div class="community-amplify" id="communityCard" style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(0, 245, 255, 0.2)); border: 2px solid var(--neon-gold); border-radius: 20px; padding: 25px; margin-top: 25px; text-align: center;">
                                <h4 style="color: var(--neon-gold); font-size: 1.3rem; margin-bottom: 15px;">🔮 Quantum Reality Codes Community</h4>
                                <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 15px; line-height: 1.7;">
                                    <strong style="color: var(--neon-cyan);">The Secret:</strong> Supporting others' codes <strong style="color: var(--neon-gold);">clears YOUR blockages</strong> and activates quantum reciprocity. The universe MUST return your energy multiplied!
                                </p>
                                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px; line-height: 1.6; font-size: 0.95rem;">
                                    When you comment someone's code, you open your receiving channels and prove your belief in manifestation. <em>The more you give, the faster YOUR code manifests.</em> This is quantum law.
                                </p>
                                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                                    <a href="https://facebook.com/groups/1950742399049451/" target="_blank" class="community-link-btn facebook">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                        <span>Facebook Group</span>
                                    </a>
                                    <a href="https://t.me/+BIChXgOqFH9iMmU1" target="_blank" class="community-link-btn telegram">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                                        <span>Telegram Group</span>
                                    </a>
                                </div>
                                <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-bottom: 15px;">
                                    ✨ Share Your Code • Support Others • Clear Your Blockages • Manifest Faster ✨
                                </p>
                                <button class="section-share-btn" onclick="shareCommunityCard()" style="margin-top: 10px;">
                                    Share Community Invite
                                </button>
                            </div>
                            
                            <div class="custom-code-coming-soon" style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(157, 0, 255, 0.15)); border: 2px dashed var(--neon-gold); border-radius: 15px; padding: 20px; margin-top: 25px; text-align: center;">
                                <a href="https://quantumrealitycodes.com" target="_blank" style="display: block; background: linear-gradient(135deg, var(--neon-gold), #b8860b); color: #000; border: none; padding: 15px 30px; border-radius: 30px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; width: 100%; text-decoration: none; box-sizing: border-box;">
                                    ✨ Click Here to Generate Custom Quantum Reality Codes ✨
                                </a>
                                <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-top: 12px; margin-bottom: 0;">
                                    Create codes for ANY intention you choose!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🃏 TAROT READING - Card of the Day</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p style="text-align: center; color: var(--neon-gold); margin-bottom: 20px; font-style: italic;">✨ Click the card to reveal your daily guidance ✨</p>
                        <div class="tarot-card-display" style="display: flex; flex-direction: column; align-items: center; gap: 25px;">
                            <div class="tarot-card-container" onclick="flipTarotCard(this)" style="max-width: 280px;">
                                <div class="tarot-card">
                                    <div class="tarot-card-back">
                                        <img src="../assets/tarot/QMTarot.png" alt="Tarot Card Back">
                                        <div class="tap-hint">🔮 Tap to Reveal</div>
                                    </div>
                                    <div class="tarot-card-front">
                                        <img src="${tarotCard.image}" alt="${tarotCard.name}" class="tarot-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                        <div class="tarot-symbol" style="display:none;">${tarotCard.symbol}</div>
                                        <div class="tarot-number">${tarotCard.suit === 'major' ? (tarotCard.number === 0 ? '0' : tarotCard.number) : tarotCard.suit.toUpperCase()}</div>
                                        <div class="tarot-name">${tarotCard.name}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="tarot-meaning" style="opacity: 0; transition: opacity 0.5s ease 0.4s; max-width: 600px; width: 100%;" id="tarot-meaning-daily">
                                <div style="background: rgba(255, 215, 0, 0.1); border-left: 4px solid var(--neon-gold); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="color: var(--neon-gold); margin-bottom: 10px; font-size: 1.1rem;">🌟 Core Meaning</h4>
                                    <p style="line-height: 1.8;">${tarotCard.meaning}</p>
                                </div>
                                <div style="background: rgba(157, 0, 255, 0.1); border-left: 4px solid var(--neon-purple); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                    <h4 style="color: var(--neon-purple); margin-bottom: 10px; font-size: 1.1rem;">🧘 Today's Guidance</h4>
                                    <p style="line-height: 1.8;">${tarotCard.guidance}</p>
                                </div>
                                <div style="background: rgba(0, 245, 255, 0.1); border-left: 4px solid var(--neon-cyan); padding: 20px; border-radius: 8px;">
                                    <h4 style="color: var(--neon-cyan); margin-bottom: 10px; font-size: 1.1rem;">🎯 Action Steps for Today</h4>
                                    <p style="line-height: 1.8;">Focus on embodying ${tarotCard.name}'s energy throughout your day. ${tarotCard.suit === 'major' ? 'This Major Arcana card signals a significant theme in your daily journey.' : 'This card encourages you to work with ' + tarotCard.suit + ' energy.'} Meditate on this message during your most powerful hours - pay attention to portal times like 11:11, 2:22, or your personal power number ${lifePath}.</p>
                                </div>
                            </div>
                            <button class="section-share-btn" onclick="shareSectionInsight('tarot', '${tarotCard.name}')">
                                Share My Tarot Card
                            </button>
                        </div>
                    </div>
                </div>

                <button class="save-btn" onclick="saveForecast()">📥 Save to Library</button>
                
                <div class="bottom-timeframe-toggle">
                    <h4>Have you read the extended readings? Click here to view them or save to library to read them later</h4>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px;">🔮 Generate Another Forecast - Switch to a different timeframe without scrolling back up</p>
                    <div class="bottom-timeframe-buttons">
                        <button class="bottom-timeframe-btn active" onclick="generateForecast('daily')">📅 Daily</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('weekly')">📆 Weekly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('monthly')">🗓️ Monthly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('yearly')">📊 Yearly</button>
                    </div>
                    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">⬆️ Back to Top</button>
                    <button class="generate-btn" onclick="location.reload()" style="margin-top: 15px; width: 100%;">🔄 Generate New Forecast</button>
                </div>
            `;
            showMidAd();
            
            // Show floating share button after forecast is generated
            const floatingBtn = document.getElementById('floatingShareBtn');
            if (floatingBtn) {
                floatingBtn.style.display = 'flex';
            }
        }

        // PHASE 2: Weekly Forecast Generator
        function generateWeeklyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
            gematria, fullName, birthTime, moonPhase, crossAnalysis, birth, tarotCard, bestDay) {
            
            const today = new Date();
            const weekStart = new Date(today); // Start from today
            const weekEnd = new Date(today);
            weekEnd.setDate(today.getDate() + 6); // 7 days total (today + 6)
            
            const weekStartStr = weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const weekEndStr = weekEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            
            // Calculate cosmic overview values for weekly
            const energyLevel = getCosmicEnergyLevel(moonPhase, zodiac, chinese, personalYear, birth);
            const manifestationFocus = getManifestationFocus(moonPhase);
            const elementOfDay = getElementOfDay(zodiac);
            const frequencyData = getDailyFrequency(zodiac, moonPhase);
            
            // Generate 7-day breakdown starting from today
            let dailyBreakdown = '';
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayEnergies = ['reflection & rest', 'initiative & new beginnings', 'assertive action', 'communication & learning', 'expansion & opportunity', 'love & harmony', 'discipline & structure'];
            const planetRulers = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn'];
            
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(today);
                dayDate.setDate(today.getDate() + i);
                const dayOfWeek = dayDate.getDay();
                const isToday = i === 0;
                const isBestDay = dayNames[dayOfWeek] === bestDay.day;
                
                dailyBreakdown += `
                    <div class="day-item ${isToday ? 'today' : ''} ${isBestDay ? 'best-day' : ''}">
                        <h4>${dayNames[dayOfWeek]}${isToday ? ' (Today)' : ''}${isBestDay ? ` ${bestDay.emoji} BEST DAY` : ''} - ${dayDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</h4>
                        <p><strong>Ruler:</strong> ${planetRulers[dayOfWeek]} | <strong>Energy:</strong> ${dayEnergies[dayOfWeek]}</p>
                        ${isBestDay ? `<p class="best-day-note">✨ <strong>${bestDay.energy}</strong> - ${bestDay.action}</p>` : ''}
                        <p>${getDaySpecificGuidance(zodiac, chinese, lifePath, dayOfWeek)}</p>
                    </div>
                `;
            }
            
            return `
                <div class="forecast-header" id="cosmic-overview">
                    <h2>YOUR WEEKLY QUANTUM FORECAST</h2>
                    <div class="forecast-meta">
                        <p>Generated for: ${fullName || 'Seeker'}</p>
                        <p>☉ Sun: ${zodiac.name} ${zodiac.symbol} ${risingSign ? `| ↑ Rising: ${risingSign.name} ${risingSign.symbol}` : ''}</p>
                        <p>🐉 ${chinese.element} ${chinese.animal} | 🔢 Life Path ${lifePath} | Personal Year ${personalYear}</p>
                        <p>Week: ${weekStartStr} - ${weekEndStr}</p>
                    </div>
                </div>

                <div class="cosmic-overview">
                    <div class="cosmic-header">
                        <h2>✨ THIS WEEK'S COSMIC SNAPSHOT ✨</h2>
                        <p class="cosmic-subtitle">Your personalized energy blueprint for ${weekStartStr} - ${weekEndStr}</p>
                    </div>
                    
                    <div class="energy-status">
                        <div class="energy-badge ${energyLevel.level}">
                            <div class="energy-label">${energyLevel.label}</div>
                            <div class="energy-description">${energyLevel.description}</div>
                        </div>
                    </div>
                    
                    <div class="cosmic-meta">
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎯</div>
                            <div class="meta-content">
                                <div class="meta-label">Week's Manifestation Focus</div>
                                <div class="meta-value">${manifestationFocus}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">⏰</div>
                            <div class="meta-content">
                                <div class="meta-label">Strongest Portal Day</div>
                                <div class="meta-value">${bestDay.day}</div>
                                <div class="meta-description">${bestDay.energy}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">${elementOfDay.element.split(' ')[0]}</div>
                            <div class="meta-content">
                                <div class="meta-label">Dominant Element</div>
                                <div class="meta-value" style="color: ${elementOfDay.color}">${elementOfDay.element}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎵</div>
                            <div class="meta-content">
                                <div class="meta-label">Week's Frequency</div>
                                <div class="meta-value">${frequencyData.frequency}</div>
                                <div class="meta-description">${frequencyData.category}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="share-energy-buttons">
                        <button onclick="shareEnergy('twitter')" class="share-btn twitter-btn">
                            📱 Share This Week's Energy
                        </button>
                        <button onclick="downloadEnergyCard()" class="share-btn download-btn">
                            💾 Save Energy Card
                        </button>
                    </div>
                </div>

                <div class="overview-section">
                    <h3 id="quantum-insight" style="text-align: center;">🔮 QUANTUM INSIGHT</h3>
                    <div class="overview-content">
                        <p><strong>Theme:</strong> ${getWeeklyTheme(zodiac, chinese, personalYear, moonPhase)}</p>
                        <p><strong>Opportunity:</strong> ${getWeeklyOpportunity(lifePath, personalYear)}</p>
                        <p><strong>Challenge:</strong> ${getWeeklyChallenge(zodiac, chinese)}</p>
                        <p><strong>Power Day:</strong> ${bestDay.emoji} ${bestDay.day} - ${bestDay.energy}</p>
                    </div>
                </div>

                <div class="best-day-banner">
                    <h3>🌟 YOUR POWER DAY THIS WEEK</h3>
                    <div class="best-day-content">
                        <div class="best-day-name">${bestDay.emoji} ${bestDay.day}</div>
                        <p><strong>${bestDay.energy}</strong></p>
                        <p>${bestDay.action}</p>
                    </div>
                </div>

                ${crossAnalysis.agreements.length > 0 ? `
                <div class="cross-reference-section agreement">
                    <h3>✨ THIS WEEK'S COSMIC ALIGNMENTS</h3>
                    ${crossAnalysis.agreements.slice(0, 2).map(a => `
                        <div class="cross-item">
                            <div class="system-badges">${a.systems.map(s => `<span class="badge">${s}</span>`).join(' + ')}</div>
                            <p>${a.insight}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="weekly-breakdown">
                    <h3>📅 7-DAY BREAKDOWN</h3>
                    <div class="days-grid">
                        ${dailyBreakdown}
                    </div>
                </div>

                <div class="system-section expanded">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>⭐ ASTROLOGY - Weekly Transits</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getWeeklyWesternForecast(zodiac, risingSign, moonSign)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🐉 CHINESE ZODIAC</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedChineseZodiacForecast(chinese, moonPhase)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔢 NUMEROLOGY - Weekly Vibration</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getWeeklyNumerologyForecast(lifePath, personalYear, weekStart)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🃏 TAROT READING - Past, Present, Future Spread</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p style="text-align: center; color: var(--neon-gold); margin-bottom: 25px; font-style: italic;">✨ Click each card to reveal your week's journey ✨</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                            ${(Array.isArray(tarotCard) ? tarotCard : []).map((card, index) => `
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="tarot-card-container" onclick="flipTarotCard(this)">
                                        <div class="tarot-card">
                                            <div class="tarot-card-back">
                                                <img src="../assets/tarot/QMTarot.png" alt="Tarot Card Back">
                                                <div class="tap-hint">🔮 ${card.position}</div>
                                            </div>
                                            <div class="tarot-card-front">
                                                <img src="${card.image}" alt="${card.name}" class="tarot-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                                <div class="tarot-symbol" style="display:none;">${card.symbol}</div>
                                                <div class="tarot-number">${card.suit === 'major' ? (card.number === 0 ? '0' : card.number) : card.suit.toUpperCase()}</div>
                                                <div class="tarot-name">${card.name}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="background: rgba(255, 215, 0, 0.05); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 12px; padding: 15px;">
                                        <h4 style="color: var(--neon-gold); margin-bottom: 8px; font-size: 1rem;">${card.position}</h4>
                                        <div style="margin-bottom: 10px;">
                                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;"><strong style="color: var(--neon-cyan);">Theme:</strong> ${card.meaning}</p>
                                        </div>
                                        <div>
                                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);"><strong style="color: var(--neon-purple);">Guidance:</strong> ${card.guidance}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(0, 245, 255, 0.1)); border: 2px solid rgba(157, 0, 255, 0.4); border-radius: 12px; padding: 20px; text-align: center;">
                            <h4 style="color: var(--neon-gold); margin-bottom: 12px;">🌀 Weekly Integration</h4>
                            <p style="line-height: 1.7;">These three cards reveal your week's arc: where you've been, where you are, and where you're heading. Notice the narrative they create together. Each card's energy builds upon the last, guiding you through this week's lessons and opportunities.</p>
                        </div>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🪐 PLANETARY INFLUENCES - This Week</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div style="background: rgba(0, 245, 255, 0.1); border-left: 4px solid var(--neon-cyan); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: var(--neon-cyan); margin-bottom: 10px;">🌙 Current Moon Phase</h4>
                            <p style="margin-bottom: 8px;"><strong>Phase:</strong> ${moonPhase.symbol} ${moonPhase.phase}</p>
                            <p style="margin-bottom: 8px;"><strong>Weekly Energy:</strong> ${moonPhase.energy}</p>
                            <p><strong>This Week's Action:</strong> ${moonPhase.action}</p>
                        </div>
                        <div style="background: rgba(157, 0, 255, 0.1); border-left: 4px solid var(--neon-purple); padding: 20px; border-radius: 8px;">
                            <h4 style="color: var(--neon-purple); margin-bottom: 10px;">✨ Weekly Cosmic Rhythm</h4>
                            <p style="line-height: 1.7;">The ${moonPhase.phase} Moon guides your week's tempo. As a ${zodiac.name}, you'll feel this lunar energy ${zodiac.element === 'Water' ? 'especially deeply' : zodiac.element === 'Earth' ? 'in practical matters' : zodiac.element === 'Fire' ? 'as creative fuel' : 'through connections'}. Align your most important tasks with this week's natural flow.</p>
                        </div>
                    </div>
                </div>

                ${fullName ? `
                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>📜 GEMATRIA</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedGematriaForecast(fullName, gematria, birth)}
                    </div>
                </div>
                ` : ''}

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔊 FREQUENCY HEALING</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p><strong>Recommended Frequency:</strong> ${frequencyData.frequency}</p>
                        <p><strong>Effect:</strong> ${frequencyData.category}</p>
                        <div class="coming-soon-banner" style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(0, 255, 136, 0.2)); border: 2px solid var(--neon-gold); border-radius: 15px; padding: 15px; text-align: center; margin-top: 15px;">
                            <p style="color: var(--neon-gold); margin: 0;">🎵 Frequency Generator Coming Soon! 🎵</p>
                        </div>
                    </div>
                </div>

                <div class="action-section">
                    <h3>💡 WEEKLY PRIORITIES</h3>
                    ${getWeeklyActionItems(zodiac, chinese, lifePath)}
                </div>

                <button class="save-btn" onclick="saveForecast()">📥 Save to Library</button>

                <div class="share-section">
                    <h4>✨ Share Your Cosmic Journey</h4>
                    <p>Your friends deserve this magic too! 💫</p>
                    <div class="share-buttons">
                        <button class="share-btn twitter" onclick="shareToTwitter('This WEEKLY cosmic forecast just predicted things about my week that haven\'t even happened yet! 🤯 ${zodiac.name} energy + Chinese zodiac + numerology = pure magic. Try it FREE:')">
                            <span>𝕏</span> Tweet
                        </button>
                        <button class="share-btn facebook" onclick="shareToFacebook()">
                            <span>f</span> Share
                        </button>
                        <button class="share-btn whatsapp" onclick="shareToWhatsApp('You won\'t BELIEVE how accurate this is!! 🌟 Just got my ${zodiac.name} weekly forecast and it literally described my exact situation... The algorithm is INSANE (and it\'s free!):')">
                            <span>💬</span> WhatsApp
                        </button>
                        <button class="share-btn copy" onclick="copyForecastLink()">
                            <span>📋</span> Copy Link
                        </button>
                    </div>
                </div>

                <div class="bottom-timeframe-toggle">
                    <h4>Have you read the extended readings? Click here to view them or save to library to read them later</h4>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px;">🔮 Generate Another Forecast - Switch to a different timeframe without scrolling back up</p>
                    <div class="bottom-timeframe-buttons">
                        <button class="bottom-timeframe-btn" onclick="generateForecast('daily')">📅 Daily</button>
                        <button class="bottom-timeframe-btn active" onclick="generateForecast('weekly')">📆 Weekly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('monthly')">🗓️ Monthly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('yearly')">📊 Yearly</button>
                    </div>
                    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">⬆️ Back to Top</button>
                    <button class="generate-btn" onclick="location.reload()" style="margin-top: 15px; width: 100%;">🔄 Generate New Forecast</button>
                </div>
            `;
            showMidAd();
        }

        // PHASE 2: Monthly Forecast Generator
        function generateMonthlyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
            gematria, fullName, crossAnalysis, birth, tarotCard) {
            
            const today = new Date();
            const monthEnd = new Date(today);
            monthEnd.setDate(today.getDate() + 27); // 28 days total (today + 27)
            
            const monthStartStr = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const monthEndStr = monthEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const monthName = `${monthStartStr} - ${monthEndStr}`;
            
            // Calculate personal month
            const personalMonth = ((today.getMonth() + 1) + personalYear) % 9 || 9;
            
            // Get moon phases for next 28 days
            const moonPhases = getMoonPhasesForPeriod(today, 28);
            
            // Four week themes
            const weekThemes = getMonthlyWeekThemes(zodiac, chinese, personalMonth);
            
            // Generate data for cosmic overview (using existing functions)
            const moonPhase = getCurrentMoonPhase();
            const energyLevel = getCosmicEnergyLevel(moonPhase, zodiac, chinese, personalYear, birth);
            const manifestationFocus = getManifestationFocus(moonPhase);
            const elementOfMonth = getElementOfDay(zodiac);
            const frequencyData = getDailyFrequency(zodiac, moonPhase);
            
            return `
                <div class="forecast-header" id="cosmic-overview">
                    <h2>YOUR MONTHLY QUANTUM FORECAST</h2>
                    <div class="forecast-meta">
                        <p>Generated for: ${fullName || 'Seeker'}</p>
                        <p>☉ Sun: ${zodiac.name} ${zodiac.symbol} ${risingSign ? `| ↑ Rising: ${risingSign.name} ${risingSign.symbol}` : ''}</p>
                        <p>🐉 ${chinese.element} ${chinese.animal} | 🔢 Life Path ${lifePath} | Personal Year ${personalYear}</p>
                        <p style="font-size: 0.95rem; color: var(--neon-cyan);">Forecast Period: ${monthName}</p>
                        <p>Personal Month: ${personalMonth}</p>
                        ${moonPhases.length > 0 ? `<p style="margin-top: 10px;">🌙 <strong>Moon Events:</strong> ${moonPhases.map(m => `${m.emoji} ${m.phase} on ${m.date}`).join(' | ')}</p>` : ''}
                    </div>
                </div>

                <div class="cosmic-overview">
                    <div class="cosmic-header">
                        <h2>✨ THIS MONTH'S COSMIC SNAPSHOT ✨</h2>
                        <p class="cosmic-subtitle">Your personalized energy blueprint for ${monthName}</p>
                    </div>
                    
                    <div class="energy-status">
                        <div class="energy-badge ${energyLevel.level}">
                            <div class="energy-label">${energyLevel.label}</div>
                            <div class="energy-description">${energyLevel.description}</div>
                        </div>
                    </div>
                    
                    <div class="cosmic-meta">
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎯</div>
                            <div class="meta-content">
                                <div class="meta-label">Month's Manifestation Focus</div>
                                <div class="meta-value">${manifestationFocus}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🌙</div>
                            <div class="meta-content">
                                <div class="meta-label">Key Lunar Phase</div>
                                <div class="meta-value">${moonPhases.length > 0 ? moonPhases[0].phase : moonPhase.phase}</div>
                                <div class="meta-description">${moonPhases.length > 0 ? moonPhases[0].date : 'This month'}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">${elementOfMonth.element.split(' ')[0]}</div>
                            <div class="meta-content">
                                <div class="meta-label">Dominant Element</div>
                                <div class="meta-value" style="color: ${elementOfMonth.color}">${elementOfMonth.element}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎵</div>
                            <div class="meta-content">
                                <div class="meta-label">Month's Frequency</div>
                                <div class="meta-value">${frequencyData.frequency}</div>
                                <div class="meta-description">${frequencyData.category}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="share-energy-buttons">
                        <button onclick="shareEnergy('twitter')" class="share-btn twitter-btn">
                            📱 Share This Month's Energy
                        </button>
                        <button onclick="downloadEnergyCard()" class="share-btn download-btn">
                            💾 Save Energy Card
                        </button>
                    </div>
                </div>

                <div class="overview-section">
                    <h3 id="quantum-insight" style="text-align: center;">🔮 QUANTUM INSIGHT</h3>
                    <div class="overview-content">
                        <p><strong>Month Theme:</strong> ${getMonthlyTheme(personalMonth, zodiac, chinese)}</p>
                        <p><strong>Primary Energy:</strong> ${getMonthlyEnergy(zodiac, chinese, personalMonth)}</p>
                        <p><strong>Growth Area:</strong> ${getMonthlyGrowth(lifePath, personalMonth)}</p>
                        <p><strong>Watch For:</strong> ${getMonthlyCaution(zodiac, moonSign, personalMonth)}</p>
                    </div>
                </div>

                ${crossAnalysis.agreements.length > 0 ? `
                <div class="cross-reference-section agreement">
                    <h3>✨ MONTHLY COSMIC ALIGNMENTS</h3>
                    ${crossAnalysis.agreements.map(a => `
                        <div class="cross-item">
                            <div class="system-badges">${a.systems.map(s => `<span class="badge">${s}</span>`).join(' + ')}</div>
                            <p>${a.insight}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="monthly-breakdown">
                    <h3>📅 4-WEEK BREAKDOWN</h3>
                    <div class="weeks-grid">
                        ${weekThemes.map((theme, i) => `
                            <div class="week-item">
                                <h4>Week ${i + 1}: ${theme.title}</h4>
                                <p><strong>Focus:</strong> ${theme.focus}</p>
                                <p><strong>Action:</strong> ${theme.action}</p>
                                <p><strong>Key Days:</strong> ${theme.keyDays}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="key-dates-section">
                    <h3>🔑 KEY DATES THIS MONTH</h3>
                    ${getMonthlyKeyDates(zodiac, chinese, lifePath, today)}
                </div>

                <div class="system-section expanded">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>⭐ ASTROLOGICAL TRANSITS</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getMonthlyWesternForecast(zodiac, risingSign, moonSign, today)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>� CHINESE ZODIAC - Monthly</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p><strong>Your Animal:</strong> ${chinese.element} ${chinese.animal}</p>
                        <p><strong>Monthly Energy:</strong> Your ${chinese.element} nature harmonizes with the lunar cycles this month.</p>
                        <p><strong>Key Days:</strong> ${moonPhases.map(m => m.emoji + ' ' + m.phase + ' on ' + m.date).join(' | ')}</p>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔢 NUMEROLOGY - Personal Month ${personalMonth}</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getMonthlyNumerologyForecast(lifePath, personalYear, personalMonth)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🪐 PLANETARY INFLUENCES - This Month</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div style="background: rgba(0, 245, 255, 0.1); border-left: 4px solid var(--neon-cyan); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: var(--neon-cyan); margin-bottom: 10px;">🌙 Current Moon Phase</h4>
                            <p style="margin-bottom: 8px;"><strong>Phase:</strong> ${moonPhase.symbol} ${moonPhase.phase}</p>
                            <p style="margin-bottom: 8px;"><strong>Monthly Energy:</strong> ${moonPhase.energy}</p>
                            <p><strong>This Month's Action:</strong> ${moonPhase.action}</p>
                        </div>
                        <div style="background: rgba(157, 0, 255, 0.1); border-left: 4px solid var(--neon-purple); padding: 20px; border-radius: 8px;">
                            <h4 style="color: var(--neon-purple); margin-bottom: 10px;">✨ Monthly Cosmic Rhythm</h4>
                            <p style="line-height: 1.7; margin-bottom: 10px;">The ${moonPhase.phase} Moon sets the tone for your month. As a ${zodiac.name}, you'll navigate these 28 days with ${zodiac.element === 'Water' ? 'emotional depth and intuitive wisdom' : zodiac.element === 'Earth' ? 'practical manifestation and steady progress' : zodiac.element === 'Fire' ? 'passionate action and creative breakthroughs' : 'intellectual clarity and social connections'}.</p>
                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);"><strong>Key Lunar Moments:</strong> ${moonPhases.map(m => m.emoji + ' ' + m.phase).join(' → ')}</p>
                        </div>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🃏 TAROT READING - 4-CARD SPREAD</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p style="text-align: center; color: var(--neon-gold); margin-bottom: 25px; font-style: italic;">✨ Click each card to reveal your monthly reading ✨</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                            ${(Array.isArray(tarotCard) ? tarotCard : []).map((card, index) => `
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="tarot-card-container" onclick="flipTarotCard(this)">
                                        <div class="tarot-card">
                                            <div class="tarot-card-back">
                                                <img src="../assets/tarot/QMTarot.png" alt="Tarot Card Back">
                                                <div class="tap-hint">🔮 ${card.position}</div>
                                            </div>
                                            <div class="tarot-card-front">
                                                <img src="${card.image}" alt="${card.name}" class="tarot-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                                <div class="tarot-symbol" style="display:none;">${card.symbol}</div>
                                                <div class="tarot-number">${card.suit === 'major' ? (card.number === 0 ? '0' : card.number) : card.suit.toUpperCase()}</div>
                                                <div class="tarot-name">${card.name}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="background: rgba(255, 215, 0, 0.05); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 12px; padding: 15px;">
                                        <h4 style="color: var(--neon-gold); margin-bottom: 8px; font-size: 1rem;">${card.position}</h4>
                                        <div style="margin-bottom: 10px;">
                                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 8px;"><strong style="color: var(--neon-cyan);">Theme:</strong> ${card.meaning}</p>
                                        </div>
                                        <div>
                                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);"><strong style="color: var(--neon-purple);">Guidance:</strong> ${card.guidance}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(0, 245, 255, 0.1)); border: 2px solid rgba(157, 0, 255, 0.4); border-radius: 12px; padding: 20px; text-align: center;">
                            <h4 style="color: var(--neon-gold); margin-bottom: 12px;">🌙 Monthly Integration</h4>
                            <p style="line-height: 1.7;">These four cards map your month's journey across key life areas. Each position reveals specific guidance for navigating the weeks ahead. Notice how they work together to create your complete monthly blueprint.</p>
                        </div>
                    </div>
                </div>

                ${fullName ? `
                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>📜 GEMATRIA</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedGematriaForecast(fullName, gematria, birth)}
                    </div>
                </div>
                ` : ''}

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔊 FREQUENCY HEALING</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p><strong>Recommended Frequency:</strong> ${frequencyData.frequency}</p>
                        <p><strong>Effect:</strong> ${frequencyData.category}</p>
                        <div class="coming-soon-banner" style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(0, 255, 136, 0.2)); border: 2px solid var(--neon-gold); border-radius: 15px; padding: 15px; text-align: center; margin-top: 15px;">
                            <p style="color: var(--neon-gold); margin: 0;">🎵 Frequency Generator Coming Soon! 🎵</p>
                        </div>
                    </div>
                </div>

                <div class="action-section">
                    <h3>💡 MONTHLY INTENTIONS</h3>
                    ${getMonthlyActionItems(zodiac, chinese, lifePath, personalMonth)}
                </div>

                <button class="save-btn" onclick="saveForecast()">📥 Save to Library</button>

                <div class="share-section">
                    <h4>✨ Share Your Cosmic Journey</h4>
                    <p>Your friends deserve this magic too! 💫</p>
                    <div class="share-buttons">
                        <button class="share-btn twitter" onclick="shareToTwitter('I\'m SHOOK! 😱 This monthly forecast combined my ${zodiac.name} sun, Chinese zodiac, life path number & more... The insights are DEEPLY personal and 100% accurate. Get yours FREE:')">
                            <span>𝕏</span> Tweet
                        </button>
                        <button class="share-btn facebook" onclick="shareToFacebook()">
                            <span>f</span> Share
                        </button>
                        <button class="share-btn whatsapp" onclick="shareToWhatsApp('STOP what you\'re doing!! 🛑✨ I just found the most INCREDIBLE cosmic forecast tool... It analyzes 8 different mystical systems and gave me a MONTHLY roadmap that feels like it was written specifically for my soul. Try it:')">
                            <span>💬</span> WhatsApp
                        </button>
                        <button class="share-btn copy" onclick="copyForecastLink()">
                            <span>📋</span> Copy Link
                        </button>
                    </div>
                </div>

                <div class="bottom-timeframe-toggle">
                    <h4>Have you read the extended readings? Click here to view them or save to library to read them later</h4>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px;">🔮 Generate Another Forecast - Switch to a different timeframe without scrolling back up</p>
                    <div class="bottom-timeframe-buttons">
                        <button class="bottom-timeframe-btn" onclick="generateForecast('daily')">📅 Daily</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('weekly')">📆 Weekly</button>
                        <button class="bottom-timeframe-btn active" onclick="generateForecast('monthly')">🗓️ Monthly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('yearly')">📊 Yearly</button>
                    </div>
                    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">⬆️ Back to Top</button>
                    <button class="generate-btn" onclick="location.reload()" style="margin-top: 15px; width: 100%;">🔄 Generate New Forecast</button>
                </div>
            `;
            showMidAd();
        }

        // PHASE 2: Yearly Forecast Generator  
        function generateYearlyForecast(zodiac, risingSign, moonSign, chinese, lifePath, personalYear,
            gematria, fullName, crossAnalysis, birth, tarotCard) {
            
            const today = new Date();
            const nextYear = new Date(today);
            nextYear.setFullYear(today.getFullYear() + 1);
            
            const startMonth = today.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            const endMonth = nextYear.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const currentYear = today.getFullYear();
            const nextYearNum = nextYear.getFullYear();
            const yearLabel = currentYear === nextYearNum ? `${currentYear}` : `${currentYear}-${nextYearNum}`;
            
            const currentChinese = getChineseZodiac(currentYear, today.getMonth() + 1, today.getDate());
            
            // Quarterly breakdown
            const quarters = getYearlyQuarters(zodiac, chinese, lifePath, personalYear, today);
            
            // Generate data for cosmic overview (using existing functions)
            const moonPhase = getCurrentMoonPhase();
            const energyLevel = getCosmicEnergyLevel(moonPhase, zodiac, chinese, personalYear, birth);
            const manifestationFocus = getManifestationFocus(moonPhase);
            const elementOfYear = getElementOfDay(zodiac);
            const frequencyData = getDailyFrequency(zodiac, moonPhase);
            
            return `
                <div class="forecast-header" id="cosmic-overview">
                    <h2>YOUR YEARLY QUANTUM FORECAST</h2>
                    <div class="forecast-meta">
                        <p>Generated for: ${fullName || 'Seeker'}</p>
                        <p>☉ Sun: ${zodiac.name} ${zodiac.symbol} ${risingSign ? `| ↑ Rising: ${risingSign.name} ${risingSign.symbol}` : ''}</p>
                        <p>🐉 ${chinese.element} ${chinese.animal} in Year of ${currentChinese.element} ${currentChinese.animal}</p>
                        <p>🔢 Life Path ${lifePath} | Personal Year ${personalYear}</p>
                        <p style="font-size: 0.95rem; color: var(--neon-cyan); margin-top: 10px;">Forecast Period: ${startMonth} - ${endMonth}</p>
                    </div>
                </div>

                <div class="cosmic-overview">
                    <div class="cosmic-header">
                        <h2>✨ THIS YEAR'S COSMIC SNAPSHOT ✨</h2>
                        <p class="cosmic-subtitle">Your personalized energy blueprint for ${startMonth} - ${endMonth}</p>
                    </div>
                    
                    <div class="energy-status">
                        <div class="energy-badge ${energyLevel.level}">
                            <div class="energy-label">${energyLevel.label}</div>
                            <div class="energy-description">${energyLevel.description}</div>
                        </div>
                    </div>
                    
                    <div class="cosmic-meta">
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎯</div>
                            <div class="meta-content">
                                <div class="meta-label">Year's Manifestation Focus</div>
                                <div class="meta-value">${manifestationFocus}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">📅</div>
                            <div class="meta-content">
                                <div class="meta-label">Personal Year Number</div>
                                <div class="meta-value">${personalYear}</div>
                                <div class="meta-description">${getYearlyTheme(personalYear, zodiac, chinese)}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">${elementOfYear.element.split(' ')[0]}</div>
                            <div class="meta-content">
                                <div class="meta-label">Dominant Element</div>
                                <div class="meta-value" style="color: ${elementOfYear.color}">${elementOfYear.element}</div>
                            </div>
                        </div>
                        
                        <div class="cosmic-meta-item">
                            <div class="meta-icon">🎵</div>
                            <div class="meta-content">
                                <div class="meta-label">Year's Frequency</div>
                                <div class="meta-value">${frequencyData.frequency}</div>
                                <div class="meta-description">${frequencyData.category}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="share-energy-buttons">
                        <button onclick="shareEnergy('twitter')" class="share-btn twitter-btn">
                            📱 Share This Year's Energy
                        </button>
                        <button onclick="downloadEnergyCard()" class="share-btn download-btn">
                            💾 Save Energy Card
                        </button>
                    </div>
                </div>

                <div class="overview-section">
                    <h3 id="quantum-insight" style="text-align: center;">🔮 QUANTUM INSIGHT</h3>
                    <div class="overview-content">
                        <p><strong>Year Theme:</strong> ${getYearlyTheme(personalYear, zodiac, chinese)}</p>
                        <p><strong>Core Lesson:</strong> ${getYearlyLesson(lifePath, personalYear)}</p>
                        <p><strong>Major Opportunity:</strong> ${getYearlyOpportunity(zodiac, chinese, personalYear)}</p>
                        <p><strong>Growth Edge:</strong> ${getYearlyChallenge(zodiac, moonSign, lifePath)}</p>
                    </div>
                </div>

                ${crossAnalysis.agreements.length > 0 ? `
                <div class="cross-reference-section agreement">
                    <h3>✨ 12-MONTH COSMIC ALIGNMENTS</h3>
                    ${crossAnalysis.agreements.map(a => `
                        <div class="cross-item">
                            <div class="system-badges">${a.systems.map(s => `<span class="badge">${s}</span>`).join(' + ')}</div>
                            <p>${a.insight}</p>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="yearly-breakdown">
                    <h3>📅 QUARTERLY ROADMAP</h3>
                    <div class="quarters-grid">
                        ${quarters.map((q, i) => `
                            <div class="quarter-item">
                                <h4>Q${i + 1}: ${q.title}</h4>
                                <p><strong>Months:</strong> ${q.months}</p>
                                <p><strong>Theme:</strong> ${q.theme}</p>
                                <p><strong>Focus:</strong> ${q.focus}</p>
                                <p><strong>Peak Time:</strong> ${q.peak}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="major-transits-section">
                    <h3>🪐 MAJOR TRANSITS & EVENTS</h3>
                    ${getYearlyTransits(zodiac, currentYear)}
                </div>

                <div class="system-section expanded">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>⭐ ASTROLOGY - 12-Month Overview</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getYearlyWesternForecast(zodiac, risingSign, moonSign, yearLabel)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🐉 CHINESE ZODIAC - Year of ${currentChinese.element} ${currentChinese.animal}</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getYearlyChineseForecast(chinese, currentChinese)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔢 NUMEROLOGY - Personal Year ${personalYear}</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getYearlyNumerologyForecast(lifePath, personalYear)}
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🪐 PLANETARY INFLUENCES - This Year</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <div style="background: rgba(0, 245, 255, 0.1); border-left: 4px solid var(--neon-cyan); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: var(--neon-cyan); margin-bottom: 10px;">🌏 Year of the ${currentChinese.element} ${currentChinese.animal}</h4>
                            <p style="margin-bottom: 8px;"><strong>Current Moon Phase:</strong> ${moonPhase.symbol} ${moonPhase.phase}</p>
                            <p><strong>Annual Cosmic Signature:</strong> This year unfolds under the wisdom of the ${currentChinese.element} ${currentChinese.animal}, bringing ${currentChinese.element === 'Wood' ? 'growth and expansion' : currentChinese.element === 'Fire' ? 'passion and transformation' : currentChinese.element === 'Earth' ? 'stability and manifestation' : currentChinese.element === 'Metal' ? 'precision and refinement' : 'flow and intuition'} to your 12-month journey.</p>
                        </div>
                        <div style="background: rgba(157, 0, 255, 0.1); border-left: 4px solid var(--neon-purple); padding: 20px; border-radius: 8px;">
                            <h4 style="color: var(--neon-purple); margin-bottom: 10px;">✨ Your ${zodiac.name} Year Ahead</h4>
                            <p style="line-height: 1.7; margin-bottom: 10px;">As a ${zodiac.name} navigating Personal Year ${personalYear}, this year brings transformative energy perfectly suited to your soul's evolution. Your ${zodiac.element} nature will ${zodiac.element === 'Water' ? 'flow with emotional wisdom through' : zodiac.element === 'Earth' ? 'ground and manifest' : zodiac.element === 'Fire' ? 'ignite and transform' : 'illuminate and connect'} the 12 months ahead.</p>
                            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);"><strong>Key Theme:</strong> The convergence of ${currentChinese.animal} year energy with your Life Path ${lifePath} creates unique opportunities for soul-level growth and manifestation.</p>
                        </div>
                    </div>
                </div>

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🃏 TAROT READING - 12-MONTH SPREAD</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p style="text-align: center; color: var(--neon-gold); margin-bottom: 25px; font-style: italic;">✨ Click each card to reveal your yearly reading ✨</p>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 25px;" class="yearly-tarot-grid">
                            ${(Array.isArray(tarotCard) ? tarotCard : []).map((card, index) => `
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <div class="tarot-card-container yearly-card" onclick="flipTarotCard(this)">
                                        <div class="tarot-card yearly-tarot-card">
                                            <div class="tarot-card-back">
                                                <img src="../assets/tarot/QMTarot.png" alt="Tarot Card Back">
                                                <div class="tap-hint">🔮 ${card.position}</div>
                                            </div>
                                            <div class="tarot-card-front">
                                                <img src="${card.image}" alt="${card.name}" class="tarot-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                                <div class="tarot-symbol" style="display:none;">${card.symbol}</div>
                                                <div class="tarot-number">${card.suit === 'major' ? (card.number === 0 ? '0' : card.number) : card.suit.toUpperCase()}</div>
                                                <div class="tarot-name">${card.name}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="background: rgba(255, 215, 0, 0.05); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 10px;">
                                        <h4 style="color: var(--neon-gold); margin-bottom: 5px; font-size: 0.85rem;">${card.position}</h4>
                                        <div style="margin-bottom: 6px;">
                                            <p style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 5px;"><strong style="color: var(--neon-cyan);">Theme:</strong> ${card.meaning}</p>
                                        </div>
                                        <div>
                                            <p style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.8);"><strong style="color: var(--neon-purple);">Guidance:</strong> ${card.guidance}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.1), rgba(0, 245, 255, 0.1)); border: 2px solid rgba(157, 0, 255, 0.4); border-radius: 12px; padding: 20px; text-align: center;">
                            <h4 style="color: var(--neon-gold); margin-bottom: 12px;">⭐ Annual Integration</h4>
                            <p style="line-height: 1.7;">These twelve cards form your complete yearly map, with each month holding unique energy and lessons. Read them as a cohesive story of your soul's journey through the seasons. Together they reveal the full arc of your transformation this year.</p>
                        </div>
                    </div>
                </div>

                ${fullName ? `
                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>📜 GEMATRIA</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        ${getEnhancedGematriaForecast(fullName, gematria, birth)}
                    </div>
                </div>
                ` : ''}

                <div class="system-section">
                    <div class="system-header" onclick="toggleSystem(this)">
                        <h3>🔊 FREQUENCY HEALING</h3>
                        <span class="system-toggle">▼</span>
                    </div>
                    <div class="system-content">
                        <p><strong>Recommended Frequency:</strong> ${frequencyData.frequency}</p>
                        <p><strong>Effect:</strong> ${frequencyData.category}</p>
                        <div class="coming-soon-banner" style="background: linear-gradient(135deg, rgba(157, 0, 255, 0.2), rgba(0, 255, 136, 0.2)); border: 2px solid var(--neon-gold); border-radius: 15px; padding: 15px; text-align: center; margin-top: 15px;">
                            <p style="color: var(--neon-gold); margin: 0;">🎵 Frequency Generator Coming Soon! 🎵</p>
                        </div>
                    </div>
                </div>

                <div class="action-section">
                    <h3>💡 YOUR 12-MONTH STRATEGIC PRIORITIES</h3>
                    ${getYearlyActionItems(zodiac, chinese, lifePath, personalYear)}
                </div>

                <button class="save-btn" onclick="saveForecast()">📥 Save to Library</button>

                <div class="share-section">
                    <h4>✨ Share Your Cosmic Journey</h4>
                    <p>Your friends deserve this magic too! 💫</p>
                    <div class="share-buttons">
                        <button class="share-btn twitter" onclick="shareToTwitter('Just got my 12-MONTH cosmic blueprint! 🌟 Personal Year ${personalYear} + ${zodiac.name} energy + planetary transits = the most comprehensive life roadmap I\'ve ever seen. This is NEXT LEVEL (and FREE):')">
                            <span>𝕏</span> Tweet
                        </button>
                        <button class="share-btn facebook" onclick="shareToFacebook()">
                            <span>f</span> Share
                        </button>
                        <button class="share-btn whatsapp" onclick="shareToWhatsApp('Holy COSMIC MAGIC!! ✨🌌 I just got my NEXT 12 MONTHS mapped out using astrology, numerology, Chinese zodiac, planetary houses & MORE... The quarterly breakdown alone is worth gold. You HAVE to experience this (FREE!):')">
                            <span>💬</span> WhatsApp
                        </button>
                        <button class="share-btn email" onclick="shareViaEmail('My 12-Month Cosmic Blueprint 🌟', 'I discovered the most INCREDIBLE forecast tool! It combines 8 mystical systems and gave me a complete roadmap for the next year. You need to see this!')">
                            <span>✉️</span> Email
                        </button>
                        <button class="share-btn copy" onclick="copyForecastLink()">
                            <span>📋</span> Copy Link
                        </button>
                    </div>
                </div>

                <div class="bottom-timeframe-toggle">
                    <h4>Have you read the extended readings? Click here to view them or save to library to read them later</h4>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px;">🔮 Generate Another Forecast - Switch to a different timeframe without scrolling back up</p>
                    <div class="bottom-timeframe-buttons">
                        <button class="bottom-timeframe-btn" onclick="generateForecast('daily')">📅 Daily</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('weekly')">📆 Weekly</button>
                        <button class="bottom-timeframe-btn" onclick="generateForecast('monthly')">🗓️ Monthly</button>
                        <button class="bottom-timeframe-btn active" onclick="generateForecast('yearly')">📊 Yearly</button>
                    </div>
                    <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">⬆️ Back to Top</button>
                    <button class="generate-btn" onclick="location.reload()" style="margin-top: 15px; width: 100%;">🔄 Generate New Forecast</button>
                </div>
            `;
            showMidAd();
        }

        function toggleSystem(header) {
            const section = header.parentElement;
            section.classList.toggle('expanded');
        }

        // Tarot Card Flip Animation
        function flipTarotCard(container) {
            const card = container.querySelector('.tarot-card');
            
            // If already flipped, don't do anything
            if (card.classList.contains('flipped')) return;
            
            // Add revealing class for magic burst effect
            card.classList.add('revealing');
            
            // Play a mystical sound if available
            try {
                const flipSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJirrJuEg4OLnKSmloJ9f42coaCXioOCjZyhn5WIgH+LmZ+flIqDgYuYnZ2Uh4GBipadnZSIgoCJlZublYmCgYmVm5qVioOCiZSam5WLhISKlJqalYuFhYuUmZmVi4aGjJWZmJWMh4eNlZiYlY2IiI6VmJeUjomKj5WYl5SNiouQlZeXlI6LjJCVl5aTj4yNkZWWlpOQjY6RlJaVkpCOjpGUlZWSkY+PkpSVlJKRkJCSlJSUkpGQkJKTlJOSkZGRkpOTk5KRkZGSk5OTkpGRkpKTk5OSkZGSk5OTkpKRkpKTk5KSkpKSkpOTkpKSkpKTk5KSkpKSkpKTkpKSkpKTk5KSkpKSkpKSkpKSkpKSkpKS');
                flipSound.volume = 0.3;
                flipSound.play().catch(() => {});
            } catch (e) {}
            
            // Flip the card
            setTimeout(() => {
                card.classList.add('flipped');
                
                // Show meaning if it's the daily single card
                const meaningSection = container.closest('.tarot-card-display')?.querySelector('#tarot-meaning-daily');
                if (meaningSection) {
                    meaningSection.style.opacity = '1';
                }
            }, 100);
            
            // Remove revealing class after animation
            setTimeout(() => {
                card.classList.remove('revealing');
            }, 900);
        }

        // Reveal all tarot cards at once
        function revealAllTarotCards() {
            const cards = document.querySelectorAll('.tarot-card-container');
            cards.forEach((container, index) => {
                setTimeout(() => {
                    flipTarotCard(container);
                }, index * 200); // Stagger the reveals
            });
        }

        // PHASE 2: Enhanced Forecast Content Generators
        function getEnhancedOverviewEnergy(zodiac, risingSign, moonSign, chinese, personalYear, moonPhase) {
            const baseEnergy = `${zodiac.name} determination meets ${chinese.element} ${chinese.animal} wisdom`;
            const moonInfluence = moonSign ? `, filtered through ${moonSign.name} emotional lens` : '';
            const risingInfluence = risingSign ? `. Your ${risingSign.name} rising presents this energy to the world with characteristic ${getRisingStyle(risingSign.name)}` : '';
            const phaseInfluence = `. The ${moonPhase.phase} amplifies ${moonPhase.energy.split(',')[0].toLowerCase()}`;
            return baseEnergy + moonInfluence + risingInfluence + phaseInfluence + '.';
        }

        function getRisingStyle(sign) {
            const styles = {
                'Aries': 'boldness and directness',
                'Taurus': 'steadiness and sensuality',
                'Gemini': 'wit and adaptability',
                'Cancer': 'nurturing warmth',
                'Leo': 'charisma and presence',
                'Virgo': 'precision and helpfulness',
                'Libra': 'grace and diplomacy',
                'Scorpio': 'intensity and mystery',
                'Sagittarius': 'optimism and adventure',
                'Capricorn': 'authority and composure',
                'Aquarius': 'uniqueness and vision',
                'Pisces': 'empathy and dreaminess'
            };
            return styles[sign] || 'unique expression';
        }

        function getEnhancedOverviewFocus(lifePath, personalYear, moonPhase) {
            const lifePathFocus = getLifePathFocus(lifePath);
            const yearFocus = getPersonalYearFocus(personalYear);
            const phaseFocus = moonPhase.action;
            
            return `${lifePathFocus}. ${yearFocus} Action: ${phaseFocus}`;
        }

        function getLifePathFocus(lifePath) {
            const focuses = {
                1: 'pioneering innovation and independent leadership',
                2: 'collaborative partnerships and diplomatic balance',
                3: 'creative expression and inspiring communication',
                4: 'building solid foundations and practical systems',
                5: 'embracing change and freedom-seeking exploration',
                6: 'nurturing responsibility and service to community',
                7: 'deep analysis and spiritual understanding',
                8: 'material mastery and authoritative achievement',
                9: 'humanitarian vision and compassionate completion',
                11: 'intuitive illumination and inspirational guidance',
                22: 'visionary building and large-scale manifestation',
                33: 'master teaching and healing transformation'
            };
            return focuses[lifePath] || 'purposeful growth';
        }

        function getPersonalYearFocus(personalYear) {
            const focuses = {
                1: 'This is your year to initiate—plant seeds boldly.',
                2: 'Patience and partnership are your tools—cultivate relationships.',
                3: 'Express yourself creatively—your voice matters now.',
                4: 'Build systematically—foundations created now last.',
                5: 'Embrace transformation—freedom awaits the adaptable.',
                6: 'Nurture what matters—home and heart call.',
                7: 'Go within—spiritual depth is available.',
                8: 'Manifest materially—your power is visible.',
                9: 'Complete and release—clearing creates space.'
            };
            return focuses[personalYear] || 'Transformative growth unfolds.';
        }

        function getEnhancedOverviewCaution(zodiac, moonSign, chinese) {
            const sunShadow = getZodiacShadow(zodiac.name);
            const moonShadow = moonSign ? getZodiacShadow(moonSign.name) : '';
            const chineseShadow = getChineseShadow(chinese.animal);
            
            return `Watch for ${sunShadow} (sun shadow)${moonSign ? ` and ${moonShadow} (emotional trigger)` : ''}. Your ${chinese.animal} nature may amplify ${chineseShadow}. Awareness transforms shadow into strength.`;
        }

        function getZodiacShadow(sign) {
            const shadows = {
                'Aries': 'impatience and impulsive reactions',
                'Taurus': 'stubbornness and resistance to change',
                'Gemini': 'scattered focus and superficiality',
                'Cancer': 'emotional overwhelm and clinginess',
                'Leo': 'ego attachment and need for validation',
                'Virgo': 'perfectionism and self-criticism',
                'Libra': 'people-pleasing and indecision',
                'Scorpio': 'obsessive control and jealousy',
                'Sagittarius': 'overcommitment and restlessness',
                'Capricorn': 'workaholism and emotional suppression',
                'Aquarius': 'detachment and rebelliousness',
                'Pisces': 'escapism and boundary dissolution'
            };
            return shadows[sign] || 'unconscious patterns';
        }

        function getChineseShadow(animal) {
            const shadows = {
                'Rat': 'anxiety about resources',
                'Ox': 'inflexibility under pressure',
                'Tiger': 'reckless aggression',
                'Rabbit': 'avoidance of conflict',
                'Dragon': 'arrogance and overreach',
                'Snake': 'manipulation tendencies',
                'Horse': 'commitment fears',
                'Goat': 'dependency patterns',
                'Monkey': 'trickster energy',
                'Rooster': 'critical perfectionism',
                'Dog': 'pessimistic worry',
                'Pig': 'overindulgence'
            };
            return shadows[animal] || 'habitual reactions';
        }

        // PHASE 2: Enhanced Western Astrology Forecast
        function getEnhancedWesternAstrologyForecast(zodiac, risingSign, moonSign, birthTime, birthLocation, moonPhase) {
            let html = `
                <div class="system-item">
                    <h4>☉ Sun in ${zodiac.name} ${zodiac.symbol}</h4>
                    <p>${getDetailedZodiacDescription(zodiac.name)}</p>
                    <p><strong>Today's Solar Activation:</strong> ${getSolarActivation(zodiac.name)}</p>
                </div>
            `;
            
            if (risingSign) {
                html += `
                    <div class="system-item">
                        <h4>↑ Rising Sign: ${risingSign.name} ${risingSign.symbol}</h4>
                        <p>${getRisingSignDescription(risingSign.name)}</p>
                        <p><strong>Public Presence Today:</strong> ${getRisingActivation(risingSign.name)}</p>
                    </div>
                `;
            }
            
            if (moonSign) {
                html += `
                    <div class="system-item">
                        <h4>☽ Moon Sign: ${moonSign.name} ${moonSign.symbol}</h4>
                        <p>${getMoonSignDescription(moonSign.name)}</p>
                        <p><strong>Emotional Navigation:</strong> ${getMoonActivation(moonSign.name, moonPhase)}</p>
                    </div>
                `;
            }
            
            html += `
                <div class="system-item">
                    <h4>🌙 Current Moon Phase: ${moonPhase.symbol} ${moonPhase.phase}</h4>
                    <p>${moonPhase.energy}</p>
                    <p><strong>Moon Phase Guidance:</strong> ${moonPhase.action}</p>
                </div>
                <div class="system-item">
                    <h4>🪐 Planetary Transits</h4>
                    <p>${getTransitForecast(zodiac.name)}</p>
                </div>
            `;
            
            return html;
        }

        function getDetailedZodiacDescription(sign) {
            const descriptions = {
                'Aries': 'As a Cardinal Fire sign ruled by Mars, you carry the spark of initiation and the courage to begin. Your soul\'s purpose involves pioneering new territory and inspiring others through bold action. Today, your natural leadership is activated.',
                'Taurus': 'As a Fixed Earth sign ruled by Venus, you embody stability, sensuality, and the art of building lasting value. Your soul\'s purpose involves creating beauty and security. Today, your grounding energy provides anchor for others.',
                'Gemini': 'As a Mutable Air sign ruled by Mercury, you are the cosmic messenger—curious, adaptable, and intellectually vibrant. Your soul\'s purpose involves connecting ideas and people. Today, your communication gifts shine.',
                'Cancer': 'As a Cardinal Water sign ruled by the Moon, you carry deep emotional intelligence and nurturing wisdom. Your soul\'s purpose involves creating emotional safety and honoring the past. Today, your intuition speaks clearly.',
                'Leo': 'As a Fixed Fire sign ruled by the Sun, you radiate creative life force and natural authority. Your soul\'s purpose involves authentic self-expression and generous heart-leadership. Today, your light inspires others.',
                'Virgo': 'As a Mutable Earth sign ruled by Mercury, you hold the gift of discernment, service, and practical wisdom. Your soul\'s purpose involves healing through attention to detail. Today, your analytical gifts are needed.',
                'Libra': 'As a Cardinal Air sign ruled by Venus, you carry the scales of justice, beauty, and relational harmony. Your soul\'s purpose involves creating balance and beauty in the world. Today, your diplomatic skills mediate.',
                'Scorpio': 'As a Fixed Water sign ruled by Pluto and Mars, you hold transformative power and psychological depth. Your soul\'s purpose involves healing through facing shadow. Today, your intensity transforms.',
                'Sagittarius': 'As a Mutable Fire sign ruled by Jupiter, you carry the archer\'s vision—philosophical, adventurous, and truth-seeking. Your soul\'s purpose involves expanding understanding. Today, your optimism lifts spirits.',
                'Capricorn': 'As a Cardinal Earth sign ruled by Saturn, you embody ambition, discipline, and mastery through time. Your soul\'s purpose involves building structures that serve the collective. Today, your authority is respected.',
                'Aquarius': 'As a Fixed Air sign ruled by Uranus and Saturn, you are the visionary revolutionary—innovative, humanitarian, and future-oriented. Your soul\'s purpose involves awakening collective consciousness. Today, your uniqueness inspires.',
                'Pisces': 'As a Mutable Water sign ruled by Neptune and Jupiter, you hold the ocean of collective consciousness—mystical, compassionate, and boundless. Your soul\'s purpose involves channeling divine love. Today, your spiritual sensitivity peaks.'
            };
            return descriptions[sign] || 'Your unique cosmic signature speaks today.';
        }

        function getSolarActivation(sign) {
            const activations = {
                'Aries': 'Your initiative and courage are amplified. Take that first step you\'ve been contemplating. Leadership opportunities present themselves—step forward with confidence.',
                'Taurus': 'Your senses are heightened. Pay attention to physical comfort, financial matters, and anything related to beauty or nature. Steady progress yields results today.',
                'Gemini': 'Your mind is electric. Conversations flow easily, ideas spark, and connections form naturally. Share your thoughts—they carry more weight than usual.',
                'Cancer': 'Your emotional radar is finely tuned. Home and family matters take priority. Trust your gut feelings—they\'re carrying important information today.',
                'Leo': 'Your creative heart opens wide. Express yourself boldly. Romance and creative projects flourish under today\'s energy. You\'re more magnetic than usual.',
                'Virgo': 'Your analytical abilities peak. Details that others miss are crystal clear to you. Health routines and organizational tasks flow with unusual ease.',
                'Libra': 'Your social grace is enhanced. Partnerships and negotiations favor you. Beauty matters more today—surround yourself with aesthetically pleasing environments.',
                'Scorpio': 'Your transformative power intensifies. Deep conversations, research, and psychological insights come naturally. Trust your instincts about hidden matters.',
                'Sagittarius': 'Your adventurous spirit soars. Learning, travel planning, and philosophical discussions energize you. Your optimism is contagious—spread it generously.',
                'Capricorn': 'Your ambition finds clear expression. Career moves and long-term planning favor you. Your natural authority commands respect—use it wisely.',
                'Aquarius': 'Your innovative mind activates. Original ideas flow, and group activities energize you. Your uniqueness is your superpower today—don\'t dim it.',
                'Pisces': 'Your spiritual channels open wide. Intuitive downloads, creative inspiration, and compassionate connections define your day. Trust the mystical.'
            };
            return activations[sign] || 'Your unique gifts activate today.';
        }

        function getRisingSignDescription(sign) {
            return `Your ${sign} Rising shapes how you meet the world and how others first perceive you. This is your social armor and your automatic response system—it colors every first impression and every new situation.`;
        }

        function getRisingActivation(sign) {
            const activations = {
                'Aries': 'You appear more dynamic and assertive today. First impressions favor bold introductions. People see your courage clearly.',
                'Taurus': 'You radiate calm stability. Others seek your grounding presence. Your physical presence carries weight.',
                'Gemini': 'Your wit and adaptability shine in social situations. Networking flows naturally. Quick thinking impresses.',
                'Cancer': 'Your nurturing energy is visible. Others feel safe with you. Emotional availability opens doors.',
                'Leo': 'Your charisma is undeniable. You naturally command attention. Creative self-expression attracts opportunity.',
                'Virgo': 'Your competence is evident. Others trust your attention to detail. Helpful suggestions are well-received.',
                'Libra': 'Your charm and grace smooth every interaction. Partnership opportunities arise. Beauty and diplomacy win.',
                'Scorpio': 'Your intensity creates intrigue. Others sense your depth. Powerful presence commands respect.',
                'Sagittarius': 'Your optimism is infectious. Adventure calls and others want to follow. Enthusiasm opens doors.',
                'Capricorn': 'Your professionalism shines. Career-related first impressions succeed. Authority is recognized.',
                'Aquarius': 'Your uniqueness attracts the right people. Innovative ideas are welcomed. Originality distinguishes you.',
                'Pisces': 'Your empathy draws others in. Creative and spiritual connections form easily. Compassion is visible.'
            };
            return activations[sign] || 'Your presentation aligns with your authentic self.';
        }

        function getMoonSignDescription(sign) {
            return `Your ${sign} Moon governs your emotional nature, instinctive reactions, and innermost needs. This is your private self—how you feel, what makes you secure, and how you nurture yourself and others.`;
        }

        function getMoonActivation(sign, moonPhase) {
            const baseActivation = {
                'Aries': 'Emotional energy runs high and fast. Process feelings through action. Don\'t let irritation fester—address it directly but kindly.',
                'Taurus': 'Seek comfort and security. Emotional stability comes through sensory pleasure. Take time for self-care rituals.',
                'Gemini': 'Talk through your feelings. Writing, conversations, and mental stimulation help process emotions. Avoid overthinking.',
                'Cancer': 'Emotions run deep and strong. Honor your need for nurturing—give and receive. Home is your sanctuary.',
                'Leo': 'Express your feelings creatively. Recognition and appreciation feed your emotional well-being. Share your heart.',
                'Virgo': 'Organize your way to emotional clarity. Practical tasks soothe anxiety. Helpful service lifts your mood.',
                'Libra': 'Seek balance in relationships. Harmony in your environment supports emotional peace. Beautiful surroundings help.',
                'Scorpio': 'Emotional intensity needs healthy outlets. Deep conversations, creative expression, or physical release help. Transform feelings into power.',
                'Sagittarius': 'Optimism is your emotional default. Freedom and adventure lift your spirits. Don\'t let others limit your joy.',
                'Capricorn': 'Emotional strength comes through achievement. Structure supports your feelings. Allow yourself to feel beneath the composure.',
                'Aquarius': 'Process emotions through intellectual understanding. Space and freedom matter. Connect with friends who understand.',
                'Pisces': 'Emotional sensitivity is heightened. Boundaries matter. Creative and spiritual practices channel overwhelming feelings.'
            };
            return (baseActivation[sign] || 'Honor your emotional needs.') + ` The ${moonPhase.phase} especially supports ${moonPhase.energy.split(',')[0].toLowerCase()}.`;
        }

        function getTransitForecast(sign) {
            const today = new Date();
            const dayOfMonth = today.getDate();
            const month = today.getMonth();
            
            // Get current planetary positions (approximate based on date)
            const sunSign = getSunSignFromDate(today);
            const mercurySign = getMercurySign(today);
            const venusSign = getVenusSign(today);
            
            // Get aspect relationship to birth sign
            const sunAspect = getAspectBetweenSigns(sign, sunSign);
            const mercuryAspect = getAspectBetweenSigns(sign, mercurySign);
            const venusAspect = getAspectBetweenSigns(sign, venusSign);
            
            let forecast = `<strong>☉ Sun in ${sunSign}:</strong> ${getSunTransitMeaning(sunAspect, sign)}`;
            forecast += `<br><br><strong>☿ Mercury in ${mercurySign}:</strong> ${getMercuryTransitMeaning(mercuryAspect, sign)}`;
            forecast += `<br><br><strong>♀ Venus in ${venusSign}:</strong> ${getVenusTransitMeaning(venusAspect, sign)}`;
            forecast += `<br><br><strong>🌟 Current Cosmic Theme:</strong> ${getCosmicTheme(dayOfMonth)}`;
            
            return forecast;
        }
        
        function getSunSignFromDate(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const sign = getZodiacSign(month, day);
            return sign.name;
        }
        
        function getMercurySign(date) {
            // Mercury is typically within 28° of the Sun, so approximate
            const month = date.getMonth() + 1;
            const day = date.getDate();
            // Mercury shifts slightly from Sun position based on date
            const offset = (date.getDate() % 10) - 5;
            const adjustedDay = Math.max(1, Math.min(28, day + offset));
            const sign = getZodiacSign(month, adjustedDay);
            return sign.name;
        }
        
        function getVenusSign(date) {
            // Venus is typically within 47° of the Sun
            const month = date.getMonth() + 1;
            const day = date.getDate();
            // Venus moves slower, offset by ~1 sign ahead or behind
            const offset = (date.getMonth() % 3) * 10 - 10;
            let adjustedMonth = month;
            let adjustedDay = day + offset;
            if (adjustedDay > 30) { adjustedMonth++; adjustedDay -= 30; }
            if (adjustedDay < 1) { adjustedMonth--; adjustedDay += 30; }
            if (adjustedMonth > 12) adjustedMonth = 1;
            if (adjustedMonth < 1) adjustedMonth = 12;
            const sign = getZodiacSign(adjustedMonth, Math.max(1, Math.min(28, adjustedDay)));
            return sign.name;
        }
        
        function getAspectBetweenSigns(sign1, sign2) {
            const signs = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];
            const i1 = signs.indexOf(sign1);
            const i2 = signs.indexOf(sign2);
            if (i1 === -1 || i2 === -1) return 'neutral';
            
            const diff = Math.abs(i1 - i2);
            const aspect = Math.min(diff, 12 - diff);
            
            if (aspect === 0) return 'conjunction'; // Same sign - intensified
            if (aspect === 1) return 'semi-sextile'; // Adjacent - adjustment
            if (aspect === 2) return 'sextile'; // 60° - harmonious opportunity
            if (aspect === 3) return 'square'; // 90° - tension/action
            if (aspect === 4) return 'trine'; // 120° - easy flow
            if (aspect === 5) return 'quincunx'; // 150° - adjustment needed
            if (aspect === 6) return 'opposition'; // 180° - awareness/balance
            return 'neutral';
        }
        
        function getSunTransitMeaning(aspect, birthSign) {
            const meanings = {
                'conjunction': `The Sun illuminates your sign directly! Peak vitality and visibility. Your authentic self shines brightly. This is YOUR time.`,
                'trine': `Harmonious energy flows to ${birthSign}. Creative expression and confidence are enhanced. Opportunities arise naturally.`,
                'sextile': `Pleasant aspects support ${birthSign}. Favorable conditions for communication and short trips. Social connections thrive.`,
                'square': `Dynamic tension activates growth for ${birthSign}. Challenges become catalysts. Take decisive action where needed.`,
                'opposition': `Awareness through relationship is the theme. Others mirror important lessons. Balance self with others.`,
                'semi-sextile': `Subtle adjustments required. Fine-tune your approach. Small changes yield big results.`,
                'quincunx': `Recalibration energy. Something needs adjustment—health, routines, or perspectives. Flexibility is key.`
            };
            return meanings[aspect] || `Current solar energy supports ${birthSign}'s natural expression.`;
        }
        
        function getMercuryTransitMeaning(aspect, birthSign) {
            const meanings = {
                'conjunction': `Mental clarity peaks! Communication, writing, and learning are supercharged. Your words carry extra weight.`,
                'trine': `Smooth mental flow for ${birthSign}. Ideas come easily, conversations are productive, and learning accelerates.`,
                'sextile': `Favorable for networking and information exchange. Good news may arrive. Curiosity leads to discovery.`,
                'square': `Mental restlessness drives innovation. Channel nervous energy into problem-solving. Speak thoughtfully.`,
                'opposition': `Others' perspectives inform your thinking. Dialogue leads to understanding. Listen as much as you speak.`,
                'semi-sextile': `Minor adjustments in communication style improve outcomes. Pay attention to details.`,
                'quincunx': `Review and revise. Something in your thinking or communication needs updating.`
            };
            return meanings[aspect] || `Mercury supports ${birthSign}'s intellectual endeavors today.`;
        }
        
        function getVenusTransitMeaning(aspect, birthSign) {
            const meanings = {
                'conjunction': `Love and beauty highlight ${birthSign}! Attraction power increases. Aesthetic sensibilities peak. Romance favored.`,
                'trine': `Pleasure and harmony flow easily. Relationships smooth, finances stable, creativity inspired.`,
                'sextile': `Social charm is enhanced. Pleasant encounters and small luxuries brighten the day.`,
                'square': `Desires create motivation. What you want may require effort—but the pursuit has value.`,
                'opposition': `Relationship dynamics come into focus. Balance giving and receiving. Negotiate with grace.`,
                'semi-sextile': `Small pleasures bring joy. Minor adjustments improve relationships.`,
                'quincunx': `Values may need reconsideration. What brings true satisfaction? Align actions with authentic desires.`
            };
            return meanings[aspect] || `Venus graces ${birthSign} with harmony and attraction.`;
        }
        
        function getCosmicTheme(dayOfMonth) {
            const themes = [
                'New beginnings and fresh intentions are cosmically supported.',
                'Building momentum—consistent effort creates lasting results.',
                'Communication channels open. Express what matters most.',
                'Foundations matter. Strengthen what supports your growth.',
                'Dynamic energy—embrace healthy competition and ambition.',
                'Beauty and connection are emphasized. Appreciate the aesthetic.',
                'Inner wisdom speaks clearly. Trust your deeper knowing.',
                'Transformation is possible. Release what no longer serves.',
                'Expansion beckons. Think bigger and aim higher.',
                'Structure and discipline yield achievement. Focus matters.',
                'Innovation and originality are rewarded. Break from routine.',
                'Spiritual sensitivity heightens. Honor the mystical.',
                'Leadership opportunities arise. Step into your authority.',
                'Partnership energy flows. Collaborate and co-create.',
                'The halfway point invites reflection. Assess and adjust.',
                'Creativity and self-expression demand attention.',
                'Balance is the lesson. Weigh opposing forces.',
                'Depth and intensity reveal hidden truths.',
                'Adventure calls. Explore new territory.',
                'Achievement focus. Climb toward your goals.',
                'Community matters. Your tribe supports you.',
                'Dreams and visions carry important messages.',
                'Initiative and courage are your allies.',
                'Stability and comfort deserve attention.',
                'Ideas flow freely. Capture and share them.',
                'Emotional intelligence guides decisions.',
                'Confidence radiates naturally. Own your light.',
                'Details matter. Precision creates excellence.',
                'Harmony in relationships brings peace.',
                'Power and regeneration are themes.',
                'Closing cycles—completion before new beginnings.'
            ];
            return themes[(dayOfMonth - 1) % themes.length];
        }

        // PHASE 2: Enhanced Chinese Zodiac Forecast
        function getEnhancedChineseZodiacForecast(chinese, moonPhase) {
            return `
                <div class="system-item">
                    <h4>Your Animal: ${chinese.animal}</h4>
                    <p>${getDetailedChineseDescription(chinese.animal)}</p>
                </div>
                <div class="system-item">
                    <h4>Your Element: ${chinese.element}</h4>
                    <p>${getDetailedElementDescription(chinese.element)}</p>
                </div>
                <div class="system-item">
                    <h4>Today's Animal Energy</h4>
                    <p>${getDailyAnimalEnergy(chinese.animal)}</p>
                </div>
                <div class="system-item">
                    <h4>Elemental Harmony</h4>
                    <p>${getElementalHarmony(chinese.element)}</p>
                </div>
                <div class="system-item">
                    <h4>Auspicious Directions & Colors</h4>
                    <p><strong>Lucky Direction:</strong> ${getLuckyDirection(chinese.animal)}<br>
                    <strong>Lucky Colors:</strong> ${getChineseColor(chinese.element)}<br>
                    <strong>Lucky Numbers:</strong> ${getLuckyNumbers(chinese.animal)}<br>
                    <strong>Avoid:</strong> ${getUnluckyElements(chinese.animal)}</p>
                </div>
            `;
        }

        function getDetailedChineseDescription(animal) {
            const descriptions = {
                'Rat': 'The Rat is first in the zodiac—clever, quick-witted, and resourceful. You possess natural charm and the ability to turn any situation to your advantage. Your instincts for opportunity are finely honed, and your social intelligence opens doors others don\'t even see.',
                'Ox': 'The Ox embodies diligence, dependability, and quiet strength. You are the foundation upon which great things are built. Your patience and persistence are legendary—you accomplish through steady effort what others cannot achieve through force.',
                'Tiger': 'The Tiger is brave, competitive, and unpredictable. You are a natural leader who inspires others through sheer presence and courage. Your protective instincts are fierce, and your confidence can move mountains.',
                'Rabbit': 'The Rabbit brings elegance, sensitivity, and diplomatic skill. You navigate social situations with grace and possess artistic sensibility that enriches everything you touch. Your gentle strength should not be underestimated.',
                'Dragon': 'The Dragon is the most powerful and auspicious sign—ambitious, energetic, and natural leaders. You carry imperial energy and the expectation of greatness. Your charisma is magnetic and your potential limitless.',
                'Snake': 'The Snake is wise, intuitive, and enigmatic. You possess deep intelligence and the patience to wait for perfect timing. Your insight into human nature and strategic mind make you formidable in any arena.',
                'Horse': 'The Horse embodies freedom, energy, and passionate independence. You need room to run and causes to champion. Your enthusiasm is infectious and your work ethic impressive when inspired.',
                'Goat': 'The Goat (or Sheep) brings creativity, gentleness, and artistic vision. You are the aesthetic heart of the zodiac—sensitive to beauty and harmony. Your compassion and imagination enrich the world.',
                'Monkey': 'The Monkey is clever, curious, and endlessly entertaining. You solve problems through wit and innovation, always finding the creative angle. Your intelligence is versatile and your charm disarming.',
                'Rooster': 'The Rooster is observant, hardworking, and confident. You speak your truth and honor your word. Your attention to detail and organizational skills are unmatched when focused.',
                'Dog': 'The Dog embodies loyalty, honesty, and a strong moral compass. You are the protector and the truth-teller—fiercely devoted to those you love. Your integrity is your greatest asset.',
                'Pig': 'The Pig brings generosity, sincerity, and good fortune. You enjoy life\'s pleasures without apology and share your abundance freely. Your kind heart and genuine nature attract lasting relationships.'
            };
            return descriptions[animal] || 'Your animal spirit carries unique wisdom.';
        }

        function getDetailedElementDescription(element) {
            const descriptions = {
                'Metal': 'Metal element brings determination, focus, and righteousness. You have strong will, clear values, and the ability to cut through confusion. Your precision and persistence make you formidable in achieving goals.',
                'Water': 'Water element brings wisdom, flexibility, and deep intuition. You adapt to circumstances while maintaining your essential nature. Your emotional intelligence and ability to flow around obstacles are your strengths.',
                'Wood': 'Wood element brings growth, creativity, and expansive vision. You are naturally optimistic and ethical, with a drive toward progress. Your generosity and idealism inspire others to reach higher.',
                'Fire': 'Fire element brings passion, charisma, and dynamic energy. You light up any room and inspire action in others. Your enthusiasm is contagious and your courage admirable.',
                'Earth': 'Earth element brings stability, patience, and practical wisdom. You are the reliable center around which others orbit. Your grounding presence and nurturing nature support everyone around you.'
            };
            return descriptions[element] || 'Your element adds unique qualities to your nature.';
        }

        function getDailyAnimalEnergy(animal) {
            const today = new Date();
            const dailyAnimals = ['Rat', 'Ox', 'Tiger', 'Rabbit', 'Dragon', 'Snake', 'Horse', 'Goat', 'Monkey', 'Rooster', 'Dog', 'Pig'];
            const todayAnimal = dailyAnimals[today.getDate() % 12];
            
            const compatibility = getAnimalCompatibility(animal, todayAnimal);
            return `Today carries ${todayAnimal} energy. ${compatibility} Your ${animal} wisdom ${getAnimalAdvice(animal, todayAnimal)}.`;
        }

        function getAnimalCompatibility(sign1, sign2) {
            // Simplified compatibility
            const allies = {
                'Rat': ['Dragon', 'Monkey'],
                'Ox': ['Snake', 'Rooster'],
                'Tiger': ['Horse', 'Dog'],
                'Rabbit': ['Goat', 'Pig'],
                'Dragon': ['Rat', 'Monkey'],
                'Snake': ['Ox', 'Rooster'],
                'Horse': ['Tiger', 'Dog'],
                'Goat': ['Rabbit', 'Pig'],
                'Monkey': ['Rat', 'Dragon'],
                'Rooster': ['Ox', 'Snake'],
                'Dog': ['Tiger', 'Horse'],
                'Pig': ['Rabbit', 'Goat']
            };
            
            if (sign1 === sign2) return 'This is a same-sign day—your energy is doubled and amplified.';
            if (allies[sign1]?.includes(sign2)) return `This is a highly auspicious day for you—${sign2} energy harmonizes beautifully with your ${sign1} nature.`;
            return `Moderate energy blend—${sign2}\'s influence offers complementary lessons for your ${sign1} path.`;
        }

        function getAnimalAdvice(yourAnimal, todayAnimal) {
            return `suggests balancing ${yourAnimal} strengths with ${todayAnimal} qualities today`;
        }

        function getElementalHarmony(element) {
            const cycle = {
                'Metal': { generates: 'Water', generated: 'Earth', controls: 'Wood', controlled: 'Fire' },
                'Water': { generates: 'Wood', generated: 'Metal', controls: 'Fire', controlled: 'Earth' },
                'Wood': { generates: 'Fire', generated: 'Water', controls: 'Earth', controlled: 'Metal' },
                'Fire': { generates: 'Earth', generated: 'Wood', controls: 'Metal', controlled: 'Water' },
                'Earth': { generates: 'Metal', generated: 'Fire', controls: 'Water', controlled: 'Wood' }
            };
            
            const c = cycle[element];
            return `Your ${element} element generates ${c.generates} (supportive energy) and is generated by ${c.generated} (receiving energy). You naturally control ${c.controls} and are controlled by ${c.controlled}. Today, lean into ${c.generates} activities for flowing creation.`;
        }

        function getLuckyDirection(animal) {
            const directions = {
                'Rat': 'North, Northwest',
                'Ox': 'Southeast, North',
                'Tiger': 'South, East',
                'Rabbit': 'East, Southeast, South',
                'Dragon': 'North, West, Northwest',
                'Snake': 'South, Southwest',
                'Horse': 'South, East',
                'Goat': 'East, Southeast',
                'Monkey': 'North, West',
                'Rooster': 'West, Southwest',
                'Dog': 'East, South',
                'Pig': 'Southeast, Northeast'
            };
            return directions[animal] || 'All directions hold potential';
        }

        function getLuckyNumbers(animal) {
            const numbers = {
                'Rat': '2, 3, 7',
                'Ox': '1, 4, 9',
                'Tiger': '1, 3, 4',
                'Rabbit': '3, 4, 9',
                'Dragon': '1, 6, 7',
                'Snake': '2, 8, 9',
                'Horse': '2, 3, 7',
                'Goat': '2, 7, 8',
                'Monkey': '4, 9',
                'Rooster': '5, 7, 8',
                'Dog': '3, 4, 9',
                'Pig': '2, 5, 8'
            };
            return numbers[animal] || '1, 8, 9';
        }

        function getUnluckyElements(animal) {
            const avoid = {
                'Rat': 'Horse direction (South), number 5, yellow/brown colors',
                'Ox': 'Goat direction, number 6, green colors when in conflict',
                'Tiger': 'Monkey energy, Southwest direction',
                'Rabbit': 'Rooster energy, West direction',
                'Dragon': 'Dog energy, Southeast direction when in conflict',
                'Snake': 'Pig energy, Northwest direction',
                'Horse': 'Rat energy, North direction',
                'Goat': 'Ox energy, Northeast direction',
                'Monkey': 'Tiger energy, Northeast direction',
                'Rooster': 'Rabbit energy, East direction',
                'Dog': 'Dragon energy, Southeast direction',
                'Pig': 'Snake energy, Southeast direction'
            };
            return avoid[animal] || 'Nothing specific—remain balanced';
        }

        // PHASE 2: Enhanced Numerology Forecast
        function getEnhancedNumerologyForecast(lifePath, personalYear, birth) {
            const today = new Date();
            const personalMonth = ((today.getMonth() + 1) + personalYear) % 9 || 9;
            const personalDay = (birth.getDate() + today.getDate() + (today.getMonth() + 1)) % 9 || 9;
            
            return `
                <div class="system-item">
                    <h4>Life Path ${lifePath}</h4>
                    <p>${getDetailedLifePathDescription(lifePath)}</p>
                </div>
                <div class="system-item">
                    <h4>Personal Year ${personalYear}</h4>
                    <p>${getDetailedPersonalYearDescription(personalYear)}</p>
                </div>
                <div class="system-item">
                    <h4>Personal Month ${personalMonth}</h4>
                    <p>${getPersonalMonthDescription(personalMonth, personalYear)}</p>
                </div>
                <div class="system-item">
                    <h4>Personal Day ${personalDay}</h4>
                    <p>${getDetailedPersonalDayDescription(personalDay)}</p>
                </div>
                <div class="system-item">
                    <h4>Today's Universal Number</h4>
                    <p>${getUniversalDayGuidance(today)}</p>
                </div>
            `;
        }

        function getDetailedLifePathDescription(number) {
            const descriptions = {
                1: '<strong>The Pioneer & Leader</strong> - You are here to develop independence, individuality, and leadership. Your soul chose this path to learn self-reliance and to inspire others through original action. You are meant to be first—first to try, first to lead, first to stand alone when necessary. Success comes when you trust your innovative ideas and have the courage to implement them.',
                2: '<strong>The Diplomat & Peacemaker</strong> - You are here to develop cooperation, sensitivity, and harmony. Your soul chose this path to learn the art of partnership and the power of patience. You are meant to bring balance—to situations, relationships, and groups. Success comes when you trust your intuition and allow your natural healing presence to work.',
                3: '<strong>The Communicator & Creator</strong> - You are here to develop self-expression, creativity, and joy. Your soul chose this path to learn that your voice matters and your artistic vision enriches the world. You are meant to inspire—through words, art, performance, or simple presence. Success comes when you share your gifts without fear.',
                4: '<strong>The Builder & Organizer</strong> - You are here to develop discipline, stability, and practical mastery. Your soul chose this path to learn that lasting value is built step by step. You are meant to create foundations—systems, structures, traditions that serve others. Success comes when you honor the process over the shortcut.',
                5: '<strong>The Freedom Seeker & Adventurer</strong> - You are here to develop versatility, freedom, and constructive change. Your soul chose this path to learn that variety is indeed the spice of life and stagnation is the enemy. You are meant to experience—travel, taste, try everything. Success comes when you embrace change as the only constant.',
                6: '<strong>The Nurturer & Healer</strong> - You are here to develop responsibility, love, and service. Your soul chose this path to learn that home, family, and community are sacred. You are meant to nurture—people, places, beauty, harmony. Success comes when you balance giving with receiving.',
                7: '<strong>The Seeker & Mystic</strong> - You are here to develop wisdom, spirituality, and analytical depth. Your soul chose this path to look beneath the surface and trust the invisible. You are meant to understand—life\'s mysteries, human nature, spiritual truth. Success comes when you trust your inner knowing over external validation.',
                8: '<strong>The Powerhouse & Manifestor</strong> - You are here to develop material mastery, authority, and abundance. Your soul chose this path to learn that power is responsibility and abundance is meant to be shared. You are meant to build empires—business, financial, structural. Success comes when you use power for collective benefit.',
                9: '<strong>The Humanitarian & Wise One</strong> - You are here to develop universal love, completion, and letting go. Your soul chose this path to learn that giving without attachment is the highest form of receiving. You are meant to serve—causes larger than yourself. Success comes when you release what has ended and trust the new.',
                11: '<strong>The Illuminator & Inspirational Leader</strong> - Master Number. You are here to channel higher wisdom and inspire through example. Your intuition is a direct line to spiritual truth. You are meant to light the way for others while managing heightened sensitivity. Success comes when you trust your visions and share them courageously.',
                22: '<strong>The Master Builder & Visionary</strong> - Master Number. You are here to turn dreams into reality on a grand scale. You combine the intuition of 11 with the practical power of 4. You are meant to build structures that serve humanity. Success comes when you think big while attending to details.',
                33: '<strong>The Master Teacher & Healer</strong> - Master Number. You are here to heal and teach through love. You combine the higher octaves of 6\'s nurturing with spiritual mastery. You are meant to be a channel for cosmic compassion. Success comes when you embody the love you teach.'
            };
            return descriptions[number] || 'Your life path carries unique purpose and lessons.';
        }

        function getDetailedPersonalYearDescription(number) {
            const descriptions = {
                1: '<strong>Year of New Beginnings</strong> - This is your launch year. Seeds planted now set the tone for the next 9-year cycle. Initiative is rewarded. Independence is necessary. It\'s time to start that project, make that change, step into that new identity. Don\'t wait for permission—pioneer forward.',
                2: '<strong>Year of Partnership</strong> - This is your year of patience, cooperation, and relationship focus. Growth comes through others. Rushing defeats you; waiting rewards you. Pay attention to the details and the partnerships—both hold your keys.',
                3: '<strong>Year of Expression</strong> - This is your year to speak, create, and share. Your voice carries extra weight. Creative projects flourish. Joy is not optional—it\'s necessary medicine. Express yourself in every possible way.',
                4: '<strong>Year of Foundation</strong> - This is your year to build, organize, and establish. Hard work pays off. Structure matters. Create the systems and foundations that will support future dreams. This is a working year—embrace it.',
                5: '<strong>Year of Change</strong> - This is your year of freedom, adventure, and transformation. Expect the unexpected. Flexibility is survival. Travel, variety, and new experiences call. Don\'t cling to what needs to change.',
                6: '<strong>Year of Responsibility</strong> - This is your year of home, family, and service. Relationships demand attention. Beautify your environment. Take responsibility for what\'s yours. Love in action is your theme.',
                7: '<strong>Year of Inner Work</strong> - This is your year of reflection, study, and spiritual deepening. Solitude is productive. Analysis yields insight. Trust your inner wisdom over external advice. Rest is not laziness—it\'s essential.',
                8: '<strong>Year of Abundance</strong> - This is your year of power, manifestation, and material success. Financial and career opportunities peak. Authority increases. Use your power wisely—karma is immediate this year.',
                9: '<strong>Year of Completion</strong> - This is your year of endings, release, and humanitarian service. Let go of what\'s finished. Clear the decks. Serve causes larger than yourself. What you release makes room for Year 1\'s new beginnings.'
            };
            return descriptions[number] || 'This year carries transformative potential.';
        }

        function getPersonalMonthDescription(month, year) {
            const base = month + year;
            const reduced = base > 9 ? (base.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0)) : base;
            
            const themes = {
                1: 'Initiation energy peaks this month. Start projects, assert yourself, lead.',
                2: 'Patience and partnership are this month\'s teachers. Collaborate, wait, receive.',
                3: 'Express and create this month. Your voice and vision matter now.',
                4: 'Build and organize this month. Structure supports your dreams.',
                5: 'Change accelerates this month. Adapt, explore, embrace variety.',
                6: 'Home and relationships need attention this month. Nurture what matters.',
                7: 'Go within this month. Study, reflect, trust your intuition.',
                8: 'Manifestation power peaks this month. Focus on career and finances.',
                9: 'Complete and release this month. Clear space for the new.'
            };
            
            return themes[reduced] || 'This month brings unique lessons and opportunities.';
        }

        function getDetailedPersonalDayDescription(number) {
            const descriptions = {
                1: '<strong>Initiative Day</strong> - Today favors bold action, new starts, and independent thinking. Lead with your ideas. Don\'t wait for group consensus—move first.',
                2: '<strong>Partnership Day</strong> - Today favors cooperation, patience, and attention to others. Listen more than you speak. Relationships progress through small gestures.',
                3: '<strong>Expression Day</strong> - Today favors creativity, communication, and social activity. Share your ideas. Write, speak, create. Joy is productive today.',
                4: '<strong>Work Day</strong> - Today favors practical tasks, organization, and steady progress. Get things done. Details matter. Build systematically.',
                5: '<strong>Change Day</strong> - Today favors flexibility, variety, and embracing the unexpected. Routine is your enemy. Adventure calls. Adapt quickly.',
                6: '<strong>Service Day</strong> - Today favors helping others, beautifying spaces, and nurturing connections. Home and family take priority. Love in action.',
                7: '<strong>Reflection Day</strong> - Today favors solitude, study, and inner work. Quiet productivity beats social noise. Trust your intuition.',
                8: '<strong>Power Day</strong> - Today favors career moves, financial decisions, and authoritative action. Your influence is magnified. Use it wisely.',
                9: '<strong>Completion Day</strong> - Today favors finishing projects, releasing what\'s done, and humanitarian thinking. Clear the old to welcome the new.'
            };
            return descriptions[number] || 'Today brings unique numerological energy.';
        }

        function getUniversalDayGuidance(today) {
            const universalDay = (today.getDate() + (today.getMonth() + 1) + today.getFullYear()) % 9 || 9;
            const guidance = {
                1: `Universal Day ${universalDay}: Collective energy supports new beginnings and leadership. The world is ready for pioneers today.`,
                2: `Universal Day ${universalDay}: Collective energy supports partnership and peace. Diplomacy succeeds globally today.`,
                3: `Universal Day ${universalDay}: Collective energy supports expression and creativity. Communication flows worldwide today.`,
                4: `Universal Day ${universalDay}: Collective energy supports building and structure. Practical progress is favored today.`,
                5: `Universal Day ${universalDay}: Collective energy supports change and freedom. Expect surprises globally today.`,
                6: `Universal Day ${universalDay}: Collective energy supports service and family. Community matters today.`,
                7: `Universal Day ${universalDay}: Collective energy supports reflection and spirituality. Wisdom surfaces today.`,
                8: `Universal Day ${universalDay}: Collective energy supports power and abundance. Material matters progress today.`,
                9: `Universal Day ${universalDay}: Collective energy supports completion and compassion. Endings and humanitarian focus today.`
            };
            return guidance[universalDay] || 'Today carries unique universal energy.';
        }

        // PHASE 2: Enhanced Gematria Forecast
        function getEnhancedGematriaForecast(name, value, birth) {
            const today = new Date();
            const dateValue = today.getFullYear() + (today.getMonth() + 1) + today.getDate();
            const resonance = (value + dateValue) % 999;
            const reducedName = reduceToSingleDigit(value);
            const reducedDate = reduceToSingleDigit(dateValue);
            const combinedReduced = reduceToSingleDigit(resonance);
            
            return `
                <div class="system-item">
                    <h4>Your Name Value: ${value} (reduces to ${reducedName})</h4>
                    <p>${getNameValueInterpretation(value, reducedName, name)}</p>
                </div>
                <div class="system-item">
                    <h4>Today's Date Value: ${dateValue} (reduces to ${reducedDate})</h4>
                    <p>${getDateValueInterpretation(dateValue, reducedDate)}</p>
                </div>
                <div class="system-item">
                    <h4>Name + Date Resonance: ${resonance} (reduces to ${combinedReduced})</h4>
                    <p>${getResonanceInterpretation(resonance, combinedReduced)}</p>
                </div>
                <div class="system-item">
                    <h4>Today's Gematria Guidance</h4>
                    <p>${getGematriaGuidance(reducedName, reducedDate, combinedReduced)}</p>
                </div>
            `;
        }

        function reduceToSingleDigit(num) {
            while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
                num = num.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            return num;
        }

        function getNameValueInterpretation(value, reduced, name) {
            const themes = {
                1: 'leadership, independence, and pioneering spirit',
                2: 'partnership, diplomacy, and receptive energy',
                3: 'creativity, expression, and joyful communication',
                4: 'stability, structure, and practical foundation',
                5: 'freedom, change, and dynamic experience',
                6: 'nurturing, responsibility, and harmonious service',
                7: 'wisdom, spirituality, and analytical depth',
                8: 'power, abundance, and material mastery',
                9: 'completion, humanitarianism, and universal love',
                11: 'illumination, intuition, and inspirational leadership',
                22: 'master building, practical vision, and large-scale impact',
                33: 'master teaching, healing presence, and cosmic love'
            };
            return `The name "${name}" carries a vibrational signature of ${themes[reduced] || 'unique purpose'}. This frequency is your energetic calling card—it influences how others perceive you and what you naturally attract.`;
        }

        function getDateValueInterpretation(value, reduced) {
            const themes = {
                1: 'initiation and new beginning energy',
                2: 'partnership and patience vibration',
                3: 'creative expression and communication flow',
                4: 'building and organization frequency',
                5: 'change and freedom vibration',
                6: 'service and harmony energy',
                7: 'reflection and spiritual depth',
                8: 'manifestation and power frequency',
                9: 'completion and release energy'
            };
            return `Today's date creates a field of ${themes[reduced] || 'transformative energy'}. This universal vibration colors everything that happens today—work with it rather than against it.`;
        }

        function getResonanceInterpretation(resonance, reduced) {
            const quality = resonance % 7 === 0 ? 'exceptionally harmonious' : 
                           resonance % 3 === 0 ? 'creatively flowing' :
                           resonance % 2 === 0 ? 'balanced and receptive' : 'dynamically charged';
            return `Your name frequency meeting today's date frequency creates a ${quality} resonance field. This ${reduced}-energy combination supports activities aligned with ${getReducedTheme(reduced)}.`;
        }

        function getReducedTheme(num) {
            const themes = {
                1: 'leadership, starting projects, and individual initiative',
                2: 'teamwork, patience, and relational harmony',
                3: 'creative expression, communication, and joyful sharing',
                4: 'practical work, organization, and foundation building',
                5: 'adventure, flexibility, and embracing change',
                6: 'service, home, family, and nurturing connections',
                7: 'study, reflection, and spiritual development',
                8: 'career advancement, financial decisions, and manifestation',
                9: 'completion, generosity, and humanitarian service'
            };
            return themes[num] || 'transformative growth';
        }

        function getGematriaGuidance(nameNum, dateNum, combinedNum) {
            if (nameNum === dateNum) {
                return `Your name frequency perfectly matches today's date frequency—this is an amplification day. Your natural gifts are doubled. Lean into your strengths with confidence.`;
            }
            if (combinedNum === 1) {
                return `Combined resonance points to initiation. Today is excellent for beginning new projects or asserting your leadership.`;
            }
            return `Today's combined ${combinedNum}-frequency suggests focusing on ${getReducedTheme(combinedNum)}. Let your natural ${getReducedTheme(nameNum)} meet the day's ${getReducedTheme(dateNum)} energy.`;
        }

        // Calculate cosmic energy level for the day
        function getCosmicEnergyLevel(moonPhase, zodiac, chinese, personalYear, birth) {
            let energyScore = 0;
            
            // Moon phase contribution (0-40 points)
            const moonScores = {
                'Full Moon': 40,
                'New Moon': 35,
                'Waxing Gibbous': 30,
                'First Quarter': 28,
                'Waxing Crescent': 25,
                'Last Quarter': 20,
                'Waning Gibbous': 18,
                'Waning Crescent': 15
            };
            energyScore += moonScores[moonPhase.phase] || 20;
            
            // Personal year alignment (0-30 points)
            const today = new Date();
            const birthdayThisYear = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
            const daysSinceBirthday = Math.abs(today - birthdayThisYear) / (1000 * 60 * 60 * 24);
            
            // Higher energy right after birthday
            if (daysSinceBirthday < 30) {
                energyScore += 30;
            } else if (daysSinceBirthday < 90) {
                energyScore += 25;
            } else {
                energyScore += 15;
            }
            
            // Day of week energy (0-15 points)
            const dayOfWeek = today.getDay();
            const dayScores = [10, 15, 12, 13, 14, 12, 8]; // Sun-Sat
            energyScore += dayScores[dayOfWeek];
            
            // Number synchronicity (0-15 points)
            const hour = today.getHours();
            const minute = today.getMinutes();
            if (hour === 11 && minute === 11) energyScore += 15;
            else if (hour === minute) energyScore += 10;
            else if (hour % 3 === 0) energyScore += 5;
            
            // Total: 0-100 scale
            if (energyScore >= 85) return { level: 'peak', label: '⚡ PEAK COSMIC DAY', description: 'Maximum manifestation power!' };
            if (energyScore >= 70) return { level: 'high', label: '⚡ HIGH ENERGY DAY', description: 'Excellent for action & creation' };
            if (energyScore >= 50) return { level: 'moderate', label: '🌟 MODERATE ENERGY', description: 'Balanced cosmic forces' };
            return { level: 'low', label: '🌙 REST & REFLECTION', description: 'Time for inner work' };
        }

        // Get manifestation focus for the day
        function getManifestationFocus(moonPhase) {
            const moonFocus = {
                'New Moon': '🌱 New Beginnings',
                'Waxing Crescent': '📈 Building Momentum',
                'First Quarter': '💪 Overcoming Obstacles',
                'Waxing Gibbous': '🎯 Refinement',
                'Full Moon': '✨ Manifestation',
                'Waning Gibbous': '🙏 Gratitude',
                'Last Quarter': '🔓 Release',
                'Waning Crescent': '🧘 Surrender'
            };
            
            return moonFocus[moonPhase.phase] || '🎯 Manifestation';
        }

        // Get optimal portal times
        function getPortalTimes() {
            const now = new Date();
            const hour = now.getHours();
            
            // Find next portal time (11:11, 12:12, 1:11, 2:22, 3:33, etc.)
            const portalHours = [
                { time: '11:11 AM', hour: 11, minute: 11, description: 'Master Number Portal - Peak manifestation' },
                { time: '12:12 PM', hour: 12, minute: 12, description: 'Completion Portal - Finish what you started' },
                { time: '1:11 PM', hour: 13, minute: 11, description: 'New Beginning Portal - Fresh starts' },
                { time: '2:22 PM', hour: 14, minute: 22, description: 'Balance Portal - Harmony & partnership' },
                { time: '3:33 PM', hour: 15, minute: 33, description: 'Ascended Master Portal - Divine guidance' },
                { time: '4:44 PM', hour: 16, minute: 44, description: 'Angel Portal - Protection & support' },
                { time: '5:55 PM', hour: 17, minute: 55, description: 'Change Portal - Transformation time' }
            ];
            
            // Find next upcoming portal
            for (let portal of portalHours) {
                const portalDate = new Date(now);
                portalDate.setHours(portal.hour, portal.minute, 0, 0);
                if (portalDate > now) {
                    return portal;
                }
            }
            
            // If past all portals, return tomorrow's 11:11
            return portalHours[0];
        }

        // Get element of the day
        function getElementOfDay(zodiac) {
            const fireSign = ['Aries', 'Leo', 'Sagittarius'].includes(zodiac.name);
            const earthSign = ['Taurus', 'Virgo', 'Capricorn'].includes(zodiac.name);
            const airSign = ['Gemini', 'Libra', 'Aquarius'].includes(zodiac.name);
            const waterSign = ['Cancer', 'Scorpio', 'Pisces'].includes(zodiac.name);
            
            if (fireSign) return { element: '🔥 Fire', color: '#FF6B35' };
            if (earthSign) return { element: '🌍 Earth', color: '#8B4513' };
            if (airSign) return { element: '💨 Air', color: '#87CEEB' };
            if (waterSign) return { element: '💧 Water', color: '#4A90E2' };
            
            return { element: '⚡ Ether', color: '#9D00FF' };
        }

        // PHASE 2: Daily Frequency Recommendation
        function getDailyFrequency(zodiac, moonPhase) {
            // Frequencies mapped to zodiac elements
            const elementFrequencies = {
                'Fire': { hz: 528, name: 'Love & Transformation', element: 'Fire signs resonate with transformation frequencies' },
                'Earth': { hz: 396, name: 'Liberation & Grounding', element: 'Earth signs benefit from grounding liberation frequencies' },
                'Air': { hz: 741, name: 'Awakening & Expression', element: 'Air signs amplify with expression frequencies' },
                'Water': { hz: 639, name: 'Connection & Healing', element: 'Water signs harmonize with heart connection frequencies' }
            };
            
            // Moon phase frequency modifiers
            const moonFrequencies = {
                'New Moon': { hz: 174, name: 'Foundation', modifier: 'New Moon amplifies foundation frequencies for new beginnings' },
                'Waxing Crescent': { hz: 285, name: 'Quantum Cognition', modifier: 'Waxing energy supports mental expansion' },
                'First Quarter': { hz: 396, name: 'Liberation', modifier: 'First Quarter releases blockages' },
                'Waxing Gibbous': { hz: 417, name: 'Change', modifier: 'Building energy facilitates transformation' },
                'Full Moon': { hz: 528, name: 'Miracle Tone', modifier: 'Full Moon maximizes manifestation power' },
                'Waning Gibbous': { hz: 639, name: 'Relationships', modifier: 'Gratitude phase deepens connections' },
                'Last Quarter': { hz: 741, name: 'Awakening', modifier: 'Release phase opens intuition' },
                'Waning Crescent': { hz: 852, name: 'Intuition', modifier: 'Dark moon heightens spiritual perception' }
            };
            
            // Get element from zodiac
            const fireSign = ['Aries', 'Leo', 'Sagittarius'].includes(zodiac.name);
            const earthSigns = ['Taurus', 'Virgo', 'Capricorn'].includes(zodiac.name);
            const airSigns = ['Gemini', 'Libra', 'Aquarius'].includes(zodiac.name);
            const waterSigns = ['Cancer', 'Scorpio', 'Pisces'].includes(zodiac.name);
            
            let element = 'Fire';
            if (earthSigns) element = 'Earth';
            if (airSigns) element = 'Air';
            if (waterSigns) element = 'Water';
            
            const elementFreq = elementFrequencies[element];
            const moonFreq = moonFrequencies[moonPhase.phase] || moonFrequencies['Full Moon'];
            
            // Choose primary frequency based on moon phase (most immediate influence)
            const primaryHz = moonFreq.hz;
            const primaryName = moonFreq.name;
            
            return {
                hz: primaryHz,
                name: primaryName,
                frequency: `${primaryHz} Hz`,
                category: primaryName,
                alignment: `${moonPhase.phase} energy combined with ${zodiac.name}'s ${element} nature suggests ${primaryHz} Hz for optimal resonance today.`,
                benefits: `This frequency supports spiritual growth. Combined with your ${element} element, it ${elementFreq.element.toLowerCase()}.`,
                usage: `Listen for 11-22 minutes during meditation, work, or sleep. Use headphones for best results. Combine with deep breathing.`,
                bestTime: `${moonPhase.phase === 'Full Moon' ? 'Evening meditation under moonlight' : moonPhase.phase.includes('Waxing') ? 'Morning activation sessions' : 'Evening release rituals'}`
            };
        }

        // Get complementary frequency for pairing
        function getFrequencyPairing(hz) {
            const pairings = {
                174: '285 Hz (Quantum Cognition) - Together they create foundation + awareness',
                285: '396 Hz (Liberation) - Combines mental clarity with emotional freedom',
                396: '417 Hz (Change) - Amplifies transformation through grounding',
                417: '528 Hz (Miracle Tone) - Change + love = powerful manifestation',
                528: '639 Hz (Connection) - Love self + love others = complete healing',
                639: '741 Hz (Expression) - Heart wisdom + throat expression = authentic communication',
                741: '852 Hz (Intuition) - Awakening + spiritual insight = divine knowing',
                852: '963 Hz (Unity) - Intuition + oneness = enlightenment',
                888: '528 Hz (Love) - Abundance rooted in love consciousness',
                963: '174 Hz (Foundation) - Divine connection grounds through earth'
            };
            return pairings[hz] || '528 Hz (Universal Love Frequency) - Pairs with all frequencies';
        }

        // Get crystal recommendations based on frequency category
        function getCrystalPairing(category) {
            const crystals = {
                'Foundation': 'Red Jasper, Black Tourmaline, Hematite - Ground your new beginnings',
                'Quantum Cognition': 'Clear Quartz, Fluorite, Lapis Lazuli - Amplify mental powers',
                'Liberation': 'Black Obsidian, Smoky Quartz, Apache Tear - Release old patterns',
                'Change': 'Malachite, Labradorite, Citrine - Navigate transformation gracefully',
                'Miracle Tone': 'Rose Quartz, Emerald, Pink Tourmaline - Magnetize miracles',
                'Love & Transformation': 'Rose Quartz, Rhodonite, Kunzite - Open heart chakra',
                'Connection': 'Rose Quartz, Green Aventurine, Jade - Deepen all relationships',
                'Heart Connection': 'Rose Quartz, Amazonite, Chrysocolla - Heart-centered bonds',
                'Relationships': 'Rose Quartz, Rhodochrosite, Pink Opal - Attract soul connections',
                'Harmony': 'Amethyst, Lepidolite, Blue Lace Agate - Family peace & unity',
                'Awakening': 'Amethyst, Azurite, Sodalite - Activate third eye',
                'Expression': 'Blue Lace Agate, Aquamarine, Turquoise - Clear throat chakra',
                'Intuition': 'Moonstone, Labradorite, Selenite - Heighten psychic abilities',
                'Spiritual Order': 'Amethyst, Sugilite, Lepidolite - Divine alignment',
                'Divine Connection': 'Clear Quartz, Selenite, Apophyllite - Crown chakra activation',
                'Unity': 'Clear Quartz, Diamond, Phenacite - Oneness consciousness',
                'Abundance': 'Citrine, Pyrite, Green Aventurine - Prosperity magnetism',
                'DNA Repair': 'Moldavite, Shungite, Clear Quartz - Cellular regeneration',
                'Cognition': 'Fluorite, Sodalite, Azurite - Mental clarity & focus'
            };
            return crystals[category] || 'Clear Quartz - Universal amplifier for any intention';
        }

        // Get scientific explanation for frequency
        function getFrequencyScience(hz) {
            const science = {
                174: 'The foundational frequency reduces physical and energetic pain. Studies show it helps cells return to original state through resonance.',
                285: 'Influences energy fields and cellular regeneration. Research in quantum biology suggests it enhances neural connectivity.',
                396: 'Liberates from guilt and fear by influencing the root chakra. Biofield studies show it breaks down crystallized emotional patterns.',
                417: 'Facilitates change by clearing negative energy. Sound therapy research indicates it helps reprogram DNA from limiting beliefs.',
                528: 'The "Miracle" tone used by biochemists for DNA repair. Scientific studies show it increases cell life by 20% and repairs genetic damage.',
                639: 'Creates harmonious relationships and balances emotions. Heart coherence research shows it synchronizes heart-brain communication.',
                741: 'Awakens intuition and cleans cells from toxins. Detox studies indicate sound at this frequency enhances cellular cleansing.',
                852: 'Raises awareness and returns to spiritual order. Neuroscience shows it activates pineal gland and increases melatonin production.',
                888: 'The abundance frequency aligns with infinite prosperity. Quantum physics suggests it resonates with the universal flow of energy.',
                963: 'Connects to divine consciousness and unity. Studies in consciousness research show it facilitates transcendent states and non-dual awareness.'
            };
            return science[hz] || 'Solfeggio frequencies have been used for centuries to promote healing, balance, and spiritual awakening through harmonic resonance.';
        }

        // Set frequency reminder for optimal portal time
        function setFrequencyReminder(hz, portalTime) {
            alert(`⏰ Frequency Reminder Set!\n\n${hz} Hz meditation scheduled for ${portalTime}\n\nWe'll remind you to:\n• Play your frequency in Quantum Genesis\n• Meditate for 15-30 minutes\n• Use recommended crystals\n\nReminder feature coming soon! For now, set a manual alarm on your device.`);
        }

        // Add frequency to daily practice calendar
        function addFrequencyToCalendar(frequencyName, hz) {
            alert(`📅 Daily Practice Calendar\n\nAdding ${frequencyName} (${hz} Hz) to your sacred routine!\n\nSuggested daily schedule:\n• Morning (7-9 AM): 15 min activation\n• Portal Time (11:11 AM): 5 min boost\n• Evening (7-9 PM): 30 min integration\n\nCalendar integration coming soon! For now, create recurring reminders in your phone.`);
        }

        // PHASE 2: Enhanced Action Items
        function getEnhancedActionItems(zodiac, risingSign, moonSign, chinese, lifePath, personalYear, planetaryHour, moonPhase) {
            let items = [];
            
            items.push(`
                <div class="action-item cosmic-timing">
                    <h4>⏰ Right Now: Hour of ${planetaryHour.planet} ${planetaryHour.symbol}</h4>
                    <p><strong>Best for:</strong> ${planetaryHour.activity}</p>
                    <p><strong>Energy:</strong> ${planetaryHour.energy}</p>
                    <p><strong>Wear/Use:</strong> ${planetaryHour.color} colors</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item">
                    <h4>🌅 Morning Power Hour (6-9 AM)</h4>
                    <p>${getEnhancedMorningAction(zodiac.name, risingSign, lifePath)}</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item">
                    <h4>☀️ Peak Productivity (10 AM - 2 PM)</h4>
                    <p>${getEnhancedAfternoonAction(zodiac.name, chinese, personalYear)}</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item">
                    <h4>🌙 Evening Integration (6-9 PM)</h4>
                    <p>${getEnhancedEveningAction(moonSign, moonPhase, lifePath)}</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item moon-ritual">
                    <h4>${moonPhase.symbol} Moon Phase Ritual</h4>
                    <p><strong>Phase:</strong> ${moonPhase.phase}</p>
                    <p><strong>Action:</strong> ${moonPhase.action}</p>
                </div>
            `);
            
            return items.join('');
        }

        function getEnhancedMorningAction(sun, rising, lifePath) {
            const sunAction = {
                'Aries': 'Start with physical movement—even 10 minutes activates your fire',
                'Taurus': 'Begin with sensory pleasure—quality coffee, comfortable clothing, beauty',
                'Gemini': 'Read or journal first thing—your mind needs morning stimulation',
                'Cancer': 'Check in emotionally—how do you feel? Honor it before moving',
                'Leo': 'Set creative intentions—what do you want to express today?',
                'Virgo': 'Review your plan—organization in the morning creates afternoon freedom',
                'Libra': 'Create beauty in your space—aesthetics affect your energy',
                'Scorpio': 'Deep meditation or shadow journaling—access your depths',
                'Sagittarius': 'Read something inspiring—philosophy, adventure, wisdom',
                'Capricorn': 'Review goals and priorities—strategic morning sets up success',
                'Aquarius': 'Brainstorm innovation—your morning mind is most original',
                'Pisces': 'Spiritual practice or creativity—connect to source first'
            };
            
            const risingBoost = rising ? ` Your ${rising.name} rising adds ${getRisingStyle(rising.name)} to how you present this energy.` : '';
            const lifePathBoost = ` Life Path ${lifePath} suggests focusing on ${getLifePathFocus(lifePath).split(' and ')[0]}.`;
            
            return (sunAction[sun] || 'Begin with centering practices') + risingBoost + lifePathBoost;
        }

        function getEnhancedAfternoonAction(sun, chinese, personalYear) {
            let baseAction = `Peak ${sun} energy combines with ${chinese.element} ${chinese.animal} persistence. `;
            
            baseAction += 'Your most important work belongs here—give it your peak energy.';
            
            baseAction += ` Personal Year ${personalYear} energy: ${getPersonalYearFocus(personalYear)}`;
            return baseAction;
        }

        function getEnhancedEveningAction(moonSign, moonPhase, lifePath) {
            const moonAction = moonSign ? `Your ${moonSign.name} Moon needs ${getMoonNeed(moonSign.name)} in the evening. ` : '';
            return moonAction + `The ${moonPhase.phase} supports ${moonPhase.energy.split(',')[0].toLowerCase()}. Life Path ${lifePath} benefits from evening reflection on ${getLifePathFocus(lifePath).split(' and ')[0]}.`;
        }

        function getMoonNeed(sign) {
            const needs = {
                'Aries': 'active unwinding—exercise or energetic activity',
                'Taurus': 'comfort rituals—good food, soft textures, beauty',
                'Gemini': 'conversation or reading—mental processing time',
                'Cancer': 'nurturing environment—home, family, emotional safety',
                'Leo': 'creative expression or appreciation—feel special',
                'Virgo': 'organization and closure—tie up loose ends',
                'Libra': 'harmony and beauty—peaceful environment',
                'Scorpio': 'depth and intimacy—meaningful connection',
                'Sagittarius': 'inspiration and adventure—even if just in books or plans',
                'Capricorn': 'achievement review—acknowledge what you accomplished',
                'Aquarius': 'freedom and friendship—social connection on your terms',
                'Pisces': 'creative or spiritual practice—transcendence'
            };
            return needs[sign] || 'rest and integration';
        }

        function getEnhancedChallengeGuidance(zodiac, chinese, moonSign, lifePath, moonPhase, challenge) {
            return `Your ${zodiac.name} determination and ${chinese.animal} wisdom suggest approaching "${challenge}" through strategic patience rather than force. ` +
                   `${moonSign ? `Your ${moonSign.name} Moon may create emotional reactions—acknowledge them, then choose response over reaction. ` : ''}` +
                   `Life Path ${lifePath} indicates this challenge is teaching you something essential about ${getLifePathFocus(lifePath)}. ` +
                   `The ${moonPhase.phase} specifically supports ${moonPhase.action.toLowerCase()} as your approach.`;
        }

        function getNumerologyForecast(lifePath, personalYear, birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            const personalDay = (birth.getDate() + today.getDate() + (today.getMonth() + 1)) % 9 || 9;
            
            return `
                <div class="system-item">
                    <h4>Life Path ${lifePath}</h4>
                    <p>${getLifePathDescription(lifePath)} This is your soul's purpose and natural operating frequency.</p>
                </div>
                <div class="system-item">
                    <h4>Personal Year ${personalYear}</h4>
                    <p>${getPersonalYearDescription(personalYear)} This year's theme shapes how today's energy manifests for you.</p>
                </div>
                <div class="system-item">
                    <h4>Personal Day ${personalDay}</h4>
                    <p>${getPersonalDayDescription(personalDay)} Today's specific vibration guides your actions and decisions.</p>
                </div>
            `;
        }

        function getGematriaForecast(name, value, birthDate) {
            const today = new Date();
            const dateValue = today.getFullYear() + (today.getMonth() + 1) + today.getDate();
            const resonance = (value + dateValue) % 999;
            
            return `
                <div class="system-item">
                    <h4>Your Name Value: ${value}</h4>
                    <p>The gematria value of "${name}" carries the frequency of ${getGematriaTheme(value)}. This is your vibrational signature.</p>
                </div>
                <div class="system-item">
                    <h4>Today's Date Value: ${dateValue}</h4>
                    <p>Today carries the frequency of ${getGematriaTheme(dateValue)}, creating a specific energetic field for manifestation.</p>
                </div>
                <div class="system-item">
                    <h4>Name + Date Resonance: ${resonance}</h4>
                    <p>The interaction between your name and today creates a ${resonance % 7 === 0 ? 'highly favorable' : 'supportive'} resonance field. This amplifies your natural abilities in ${getGematriaApplication(resonance % 7)}.</p>
                </div>
            `;
        }

        function getActionItems(zodiac, chinese, lifePath, personalYear, focus, challenge) {
            let items = [];
            
            items.push(`
                <div class="action-item">
                    <h4>Morning (6-9 AM)</h4>
                    <p>Begin with ${getMorningAction(zodiac.name, lifePath)}. Your ${zodiac.name} sun and Life Path ${lifePath} are most aligned during early hours.</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item">
                    <h4>Afternoon (12-3 PM)</h4>
                    <p>${getAfternoonAction(chinese.animal, personalYear, focus)}. This is your peak creative/productive window.</p>
                </div>
            `);
            
            items.push(`
                <div class="action-item">
                    <h4>Evening (6-9 PM)</h4>
                    <p>${getEveningAction(zodiac.name, lifePath)}. Use this time for integration and reflection.</p>
                </div>
            `);
            
            if (challenge) {
                items.push(`
                    <div class="action-item">
                        <h4>Challenge-Specific Guidance</h4>
                        <p>Regarding "${challenge}": ${getChallengeGuidance(zodiac.name, chinese.animal, lifePath)}</p>
                    </div>
                `);
            }
            
            return items.join('');
        }

        // Helper functions for descriptions
        function getZodiacDescription(sign) {
            const descriptions = {
                'Aries': 'Bold and pioneering,',
                'Taurus': 'Grounded and persistent,',
                'Gemini': 'Curious and adaptable,',
                'Cancer': 'Nurturing and intuitive,',
                'Leo': 'Creative and confident,',
                'Virgo': 'Analytical and detail-oriented,',
                'Libra': 'Harmonious and diplomatic,',
                'Scorpio': 'Intense and transformative,',
                'Sagittarius': 'Philosophical and adventurous,',
                'Capricorn': 'Ambitious and disciplined,',
                'Aquarius': 'Innovative and humanitarian,',
                'Pisces': 'Compassionate and mystical,'
            };
            return descriptions[sign] || '';
        }

        function getZodiacTrait(sign) {
            const traits = {
                'Aries': 'bold action and leadership',
                'Taurus': 'stability and sensory pleasure',
                'Gemini': 'communication and learning',
                'Cancer': 'emotional depth and nurturing',
                'Leo': 'creative expression and recognition',
                'Virgo': 'service and practical improvement',
                'Libra': 'balance and partnership',
                'Scorpio': 'depth and transformation',
                'Sagittarius': 'expansion and wisdom-seeking',
                'Capricorn': 'achievement and structure',
                'Aquarius': 'innovation and collective progress',
                'Pisces': 'spirituality and compassion'
            };
            return traits[sign] || 'growth';
        }

        function getChineseDescription(animal) {
            const descriptions = {
                'Rat': 'Clever and resourceful,',
                'Ox': 'Diligent and dependable,',
                'Tiger': 'Brave and confident,',
                'Rabbit': 'Gentle and compassionate,',
                'Dragon': 'Ambitious and charismatic,',
                'Snake': 'Wise and intuitive,',
                'Horse': 'Energetic and free-spirited,',
                'Goat': 'Creative and gentle,',
                'Monkey': 'Intelligent and playful,',
                'Rooster': 'Confident and organized,',
                'Dog': 'Loyal and honest,',
                'Pig': 'Generous and sincere,'
            };
            return descriptions[animal] || '';
        }

        function getElementQuality(element) {
            const qualities = {
                'Metal': 'structure and precision',
                'Water': 'adaptability and depth',
                'Wood': 'growth and expansion',
                'Fire': 'passion and transformation',
                'Earth': 'stability and grounding'
            };
            return qualities[element] || 'balance';
        }

        function getChineseColor(element) {
            const colors = {
                'Metal': 'White, Gold, Silver',
                'Water': 'Black, Blue, Purple',
                'Wood': 'Green, Teal',
                'Fire': 'Red, Orange, Pink',
                'Earth': 'Yellow, Brown, Beige'
            };
            return colors[element] || 'Rainbow';
        }

        function getChineseActivity(animal) {
            const activities = {
                'Rat': 'networking and strategic planning',
                'Ox': 'focused work and building foundations',
                'Tiger': 'taking bold action and leadership',
                'Rabbit': 'creative projects and social connections',
                'Dragon': 'ambitious pursuits and public visibility',
                'Snake': 'deep thinking and strategic moves',
                'Horse': 'travel and freedom-seeking',
                'Goat': 'artistic expression and collaboration',
                'Monkey': 'problem-solving and innovation',
                'Rooster': 'organization and communication',
                'Dog': 'loyalty-building and community service',
                'Pig': 'generosity and celebration'
            };
            return activities[animal] || 'purposeful action';
        }

        function getLifePathDescription(number) {
            const descriptions = {
                1: 'The Leader - Independent and pioneering.',
                2: 'The Diplomat - Cooperative and harmonious.',
                3: 'The Communicator - Creative and expressive.',
                4: 'The Builder - Practical and grounded.',
                5: 'The Freedom Seeker - Adventurous and dynamic.',
                6: 'The Nurturer - Responsible and caring.',
                7: 'The Seeker - Analytical and spiritual.',
                8: 'The Powerhouse - Ambitious and authoritative.',
                9: 'The Humanitarian - Compassionate and wise.',
                11: 'The Illuminator - Intuitive and inspirational.',
                22: 'The Master Builder - Visionary and powerful.',
                33: 'The Master Teacher - Compassionate healer.'
            };
            return descriptions[number] || 'The Seeker';
        }

        function getPersonalYearDescription(number) {
            const descriptions = {
                1: 'New Beginnings - This is a year of fresh starts and initiative.',
                2: 'Partnership - Focus on cooperation and relationships.',
                3: 'Creative Expression - Time for communication and creativity.',
                4: 'Foundation Building - Establish stability and structure.',
                5: 'Change and Freedom - Embrace transformation and adventure.',
                6: 'Responsibility - Focus on home, family, and service.',
                7: 'Spiritual Growth - Deepen inner knowledge and reflection.',
                8: 'Power and Abundance - Manifest material success.',
                9: 'Completion - Release the old and prepare for new cycles.'
            };
            return descriptions[number] || 'Transformation';
        }

        function getPersonalDayDescription(number) {
            const descriptions = {
                1: 'Initiative and Leadership - Take charge of your day.',
                2: 'Cooperation - Work with others harmoniously.',
                3: 'Expression - Communicate your ideas creatively.',
                4: 'Organization - Focus on practical tasks.',
                5: 'Flexibility - Adapt to changing circumstances.',
                6: 'Service - Help others and nurture relationships.',
                7: 'Reflection - Spend time in contemplation.',
                8: 'Achievement - Focus on tangible results.',
                9: 'Completion - Finish what you started.'
            };
            return descriptions[number] || 'Balance';
        }

        function getGematriaTheme(value) {
            const reduced = value.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0) % 9 || 9;
            const themes = [
                '', 'leadership and new beginnings', 'partnership and balance', 
                'creative expression', 'stability and foundation', 'change and freedom',
                'nurturing and responsibility', 'wisdom and spirituality', 
                'power and manifestation', 'completion and humanitarianism'
            ];
            return themes[reduced] || 'transformation';
        }

        function getGematriaApplication(value) {
            const applications = [
                'manifesting new opportunities', 'building partnerships',
                'creative communication', 'establishing foundations',
                'embracing change', 'service to others',
                'spiritual insight', 'material success'
            ];
            return applications[value % applications.length];
        }

        function getMorningAction(sign, lifePath) {
            const morning = {
                'Aries': 'physical exercise or energetic movement',
                'Taurus': 'grounding meditation or sensory ritual',
                'Gemini': 'journaling or learning something new',
                'Cancer': 'emotional check-in or creative visualization',
                'Leo': 'affirmations or creative planning',
                'Virgo': 'organization or detailed planning',
                'Libra': 'beauty ritual or harmonizing your space',
                'Scorpio': 'deep meditation or shadow work',
                'Sagittarius': 'inspirational reading or goal-setting',
                'Capricorn': 'strategic planning or reviewing goals',
                'Aquarius': 'innovation brainstorming or future visioning',
                'Pisces': 'spiritual practice or artistic expression'
            };
            return morning[sign] || 'mindful meditation';
        }

        function getAfternoonAction(animal, personalYear, focus) {
            if (focus === 'career') return 'Focus on your most important work task or have that crucial conversation';
            if (focus === 'love') return 'Reach out to someone you care about with authentic vulnerability';
            if (focus === 'health') return 'Take a mindful movement break or prepare a nourishing meal';
            if (focus === 'spiritual') return 'Practice presence or study spiritual teachings';
            return 'Work on your highest priority project with focused energy';
        }

        function getEveningAction(sign, lifePath) {
            return 'Journal about today\'s insights and set intentions for tomorrow. Your ' + sign + ' nature benefits from reflection and conscious closure.';
        }

        function getChallengeGuidance(sign, animal, lifePath) {
            return 'Your ' + sign + ' determination combined with ' + animal + ' wisdom suggests approaching this challenge through patience and strategic action rather than force. Life Path ' + lifePath + ' indicates this obstacle is teaching you a specific soul lesson about your purpose.';
        }

        // ========================================
        // PHASE 2: WEEKLY/MONTHLY/YEARLY HELPERS
        // ========================================

        // Weekly Helpers
        function getWeeklyTheme(zodiac, chinese, personalYear, moonPhase) {
            return `Your ${zodiac.name} drive meets ${chinese.element} ${chinese.animal} persistence this week. Personal Year ${personalYear} energy shapes opportunities. The ${moonPhase.phase} sets the emotional tone for the week's beginning.`;
        }

        function getWeeklyOpportunity(lifePath, personalYear) {
            return 'Multi-dimensional growth across life areas' + `. Life Path ${lifePath} in Year ${personalYear} creates momentum for ${getLifePathFocus(lifePath)}.`;
        }

        function getWeeklyChallenge(zodiac, chinese) {
            const base = `${zodiac.name} impatience meeting ${chinese.animal} intensity may create friction.`;
            return base;
        }

        function getKeyDayOfWeek(zodiac, lifePath) {
            const signDays = {
                'Aries': 'Tuesday (Mars day)', 'Taurus': 'Friday (Venus day)', 'Gemini': 'Wednesday (Mercury day)',
                'Cancer': 'Monday (Moon day)', 'Leo': 'Sunday (Sun day)', 'Virgo': 'Wednesday (Mercury day)',
                'Libra': 'Friday (Venus day)', 'Scorpio': 'Tuesday (Mars day)', 'Sagittarius': 'Thursday (Jupiter day)',
                'Capricorn': 'Saturday (Saturn day)', 'Aquarius': 'Saturday (Saturn day)', 'Pisces': 'Thursday (Jupiter day)'
            };
            return `${signDays[zodiac.name] || 'Wednesday'} - Your ${zodiac.name} energy peaks. Schedule important matters here.`;
        }

        function getDaySpecificGuidance(zodiac, chinese, lifePath, dayIndex) {
            const dayGuidance = [
                // Sunday
                `Rest and reflect. ${zodiac.name} energy recharges through intentional pause. Set intentions for the week ahead.`,
                // Monday
                `New week energy. ${zodiac.name} initiative meets ${chinese.animal} determination. Launch new efforts.`,
                // Tuesday
                `Mars energy amplifies action. ${zodiac.name} assertiveness is supported. Address challenging tasks.`,
                // Wednesday
                `Mercury enhances communication. ${zodiac.name} ideas flow easily. Schedule important conversations.`,
                // Thursday
                `Jupiter expands opportunity. ${zodiac.name} optimism attracts luck. Think bigger today.`,
                // Friday
                `Venus brings harmony. ${zodiac.name} relationships are favored. Celebrate connections.`,
                // Saturday
                `Saturn rewards discipline. ${zodiac.name} structure-building succeeds. Handle responsibilities.`
            ];
            
            return dayGuidance[dayIndex];
        }

        function getWeeklyWesternForecast(zodiac, risingSign, moonSign) {
            return `
                <div class="system-item">
                    <h4>☉ ${zodiac.name} Sun - Weekly Activation</h4>
                    <p>This week emphasizes ${getZodiacTrait(zodiac.name)}. Your ${zodiac.name} energy is particularly strong mid-week when planetary alignments favor your natural tendencies.</p>
                </div>
                ${risingSign ? `
                <div class="system-item">
                    <h4>↑ ${risingSign.name} Rising - Social Dynamics</h4>
                    <p>Your public presentation carries extra ${getRisingStyle(risingSign.name)} this week. First impressions are impactful—use this for important meetings or introductions.</p>
                </div>
                ` : ''}
                ${moonSign ? `
                <div class="system-item">
                    <h4>☽ ${moonSign.name} Moon - Emotional Themes</h4>
                    <p>Your emotional landscape this week involves ${getMoonNeed(moonSign.name)}. Mood fluctuations are normal—honor your inner rhythms.</p>
                </div>
                ` : ''}
            `;
        }

        function getWeeklyNumerologyForecast(lifePath, personalYear, weekStart) {
            const weekNum = Math.ceil((weekStart.getDate() + weekStart.getMonth() * 31) / 7) % 9 || 9;
            return `
                <div class="system-item">
                    <h4>Weekly Vibration: ${weekNum}</h4>
                    <p>This week carries ${weekNum}-energy: ${getReducedTheme(weekNum)}. Combined with your Life Path ${lifePath} and Personal Year ${personalYear}, this creates conditions for ${getLifePathFocus(lifePath)}.</p>
                </div>
            `;
        }

        function getWeeklyActionItems(zodiac, chinese, lifePath) {
            return `
                <div class="action-item">
                    <h4>Priority 1: Early Week (Mon-Tue)</h4>
                    <p>Launch initiatives. Your ${zodiac.name} pioneering energy is strongest. Set the week's trajectory through bold action.</p>
                </div>
                <div class="action-item">
                    <h4>Priority 2: Mid-Week (Wed-Thu)</h4>
                    <p>Communicate and expand. Mercury and Jupiter days favor ${chinese.animal} wisdom in conversations and growth opportunities.</p>
                </div>
                <div class="action-item">
                    <h4>Priority 3: Late Week (Fri-Sat)</h4>
                    <p>Harmonize and structure. Venus and Saturn days support relationship building and completing what you started.</p>
                </div>
                <div class="action-item">
                    <h4>Weekly Intention</h4>
                    <p>By week's end, aim to have made tangible progress in ${getLifePathFocus(lifePath)}. Your Life Path ${lifePath} is activated when you ${getLifePathAction(lifePath)}.</p>
                </div>
            `;
        }

        function getLifePathAction(lifePath) {
            const actions = {
                1: 'take independent initiative without waiting for permission',
                2: 'nurture partnerships and practice patience',
                3: 'express yourself creatively and share your joy',
                4: 'build systematic structures and complete practical tasks',
                5: 'embrace change and try something completely new',
                6: 'serve others and beautify your environment',
                7: 'spend time in contemplation and trust your intuition',
                8: 'make power moves and focus on material manifestation',
                9: 'give generously and release what\'s complete'
            };
            return actions[lifePath] || 'align with your authentic purpose';
        }

        // Monthly Helpers
        function getMonthlyTheme(personalMonth, zodiac, chinese) {
            const themes = {
                1: 'New Beginnings & Initiative',
                2: 'Partnership & Patience',
                3: 'Expression & Creativity',
                4: 'Foundation & Structure',
                5: 'Change & Freedom',
                6: 'Responsibility & Service',
                7: 'Reflection & Spirituality',
                8: 'Power & Manifestation',
                9: 'Completion & Release'
            };
            return `Personal Month ${personalMonth}: ${themes[personalMonth] || 'Transformation'}. Your ${zodiac.name} sun and ${chinese.element} ${chinese.animal} nature color how this theme manifests for you specifically.`;
        }

        function getMonthlyEnergy(zodiac, chinese, personalMonth) {
            return `${zodiac.name} determination meets ${chinese.animal} wisdom in a ${personalMonth}-month context. This creates ${personalMonth <= 3 ? 'initiating' : personalMonth <= 6 ? 'building' : 'completing'} energy for the weeks ahead.`;
        }

        function getMonthlyGrowth(lifePath, personalMonth) {
            const growth = 'Primary development through ';
            return growth + getReducedTheme(personalMonth) + `. Life Path ${lifePath} finds expression through ${getLifePathFocus(lifePath).split(' and ')[0]}.`;
        }

        function getMonthlyCaution(zodiac, moonSign, personalMonth) {
            const caution = `Month ${personalMonth} tendency: ${personalMonth % 2 === 0 ? 'over-patience leading to stagnation' : 'over-initiative leading to burnout'}. `;
            return caution + `Your ${zodiac.name} nature${moonSign ? ` combined with ${moonSign.name} Moon emotions` : ''} may amplify this—stay aware.`;
        }

        function getMonthlyWeekThemes(zodiac, chinese, personalMonth) {
            return [
                {
                    title: 'Initiation',
                    focus: `Launch this month's primary growth projects`,
                    action: `Set clear intentions aligned with ${zodiac.name} nature`,
                    keyDays: 'Days 1-3 and 7 are most auspicious'
                },
                {
                    title: 'Development',
                    focus: `Build momentum in started projects`,
                    action: `Apply ${chinese.animal} patience to growing efforts`,
                    keyDays: 'Mid-week days favor expansion'
                },
                {
                    title: 'Cultivation',
                    focus: `Refine and adjust based on feedback`,
                    action: `Use ${chinese.element} wisdom for course corrections`,
                    keyDays: 'New Moon or Full Moon window'
                },
                {
                    title: 'Harvest & Preparation',
                    focus: `Complete what's ready, prepare for next month`,
                    action: `${zodiac.name} reflection on progress made`,
                    keyDays: 'Final 3 days for completion energy'
                }
            ];
        }

        function getMonthlyKeyDates(zodiac, chinese, lifePath, today) {
            const year = today.getFullYear();
            const month = today.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Find key numerological dates
            const powerDays = [];
            for (let d = 1; d <= daysInMonth; d++) {
                const dayEnergy = (d + (month + 1) + year) % 9 || 9;
                if (dayEnergy === lifePath || dayEnergy === 1 || dayEnergy === 8) {
                    powerDays.push({ day: d, energy: dayEnergy });
                }
            }
            
            const powerDaysStr = powerDays.slice(0, 5).map(p => 
                `<strong>${p.day}:</strong> Day ${p.energy} energy (${p.energy === lifePath ? 'Life Path alignment' : p.energy === 1 ? 'initiative' : 'manifestation'})`
            ).join('<br>');
            
            return `
                <div class="key-dates-grid">
                    <div class="key-date-item">
                        <h4>Power Days</h4>
                        <p>${powerDaysStr}</p>
                    </div>
                    <div class="key-date-item">
                        <h4>Your ${zodiac.name} Power Windows</h4>
                        <p>Early morning and late afternoon favor ${zodiac.name} initiatives. Schedule important decisions during your peak hours.</p>
                    </div>
                </div>
            `;
        }

        function getMonthlyWesternForecast(zodiac, risingSign, moonSign, today) {
            const monthName = today.toLocaleDateString('en-US', { month: 'long' });
            return `
                <div class="system-item">
                    <h4>☉ ${zodiac.name} Sun - ${monthName} Transits</h4>
                    <p>The Sun's current position activates themes of ${getZodiacTrait(zodiac.name)} throughout ${monthName}. Key planetary aspects support your natural ${zodiac.name} expression mid-month.</p>
                </div>
                ${risingSign ? `
                <div class="system-item">
                    <h4>↑ ${risingSign.name} Rising - Monthly Public Theme</h4>
                    <p>This month emphasizes your ${getRisingStyle(risingSign.name)} in public settings. Career and social opportunities align with authentic self-presentation.</p>
                </div>
                ` : ''}
            `;
        }

        function getMonthlyNumerologyForecast(lifePath, personalYear, personalMonth) {
            return `
                <div class="system-item">
                    <h4>Personal Month ${personalMonth} within Personal Year ${personalYear}</h4>
                    <p>${getPersonalMonthDescription(personalMonth, personalYear)}</p>
                    <p>This month's ${personalMonth}-energy combines with your Year ${personalYear} themes to create specific conditions for growth in ${getReducedTheme(personalMonth)}.</p>
                </div>
                <div class="system-item">
                    <h4>Life Path ${lifePath} Monthly Expression</h4>
                    <p>Your Life Path ${lifePath} finds this month's expression through ${getLifePathFocus(lifePath)}. Look for opportunities that align with your core purpose.</p>
                </div>
            `;
        }

        function getMonthlyActionItems(zodiac, chinese, lifePath, personalMonth) {
            return `
                <div class="action-item">
                    <h4>Week 1 Intention</h4>
                    <p>Launch: Set clear goals for personal growth this month. Your ${zodiac.name} initiative is supported.</p>
                </div>
                <div class="action-item">
                    <h4>Week 2 Intention</h4>
                    <p>Build: Apply ${chinese.element} ${chinese.animal} persistence to growing your initiatives. Patience pays off.</p>
                </div>
                <div class="action-item">
                    <h4>Week 3 Intention</h4>
                    <p>Refine: Make adjustments based on what's working. Life Path ${lifePath} wisdom guides decisions.</p>
                </div>
                <div class="action-item">
                    <h4>Week 4 Intention</h4>
                    <p>Complete: Harvest what's ready and prepare for next month. Personal Month ${personalMonth} energy supports ${personalMonth <= 4 ? 'initiating new cycles' : personalMonth <= 7 ? 'cultivating growth' : 'completing and releasing'}.</p>
                </div>
            `;
        }

        // Yearly Helpers
        function getYearlyThemeTitle(personalYear) {
            const titles = {
                1: 'New Beginnings', 2: 'Partnership', 3: 'Expression',
                4: 'Foundation', 5: 'Change', 6: 'Responsibility',
                7: 'Spirituality', 8: 'Manifestation', 9: 'Completion'
            };
            return titles[personalYear] || 'Transformation';
        }

        function getYearlyTheme(personalYear, zodiac, chinese) {
            return `Personal Year ${personalYear} activates ${getYearlyThemeTitle(personalYear).toLowerCase()} energy for you. Your ${zodiac.name} sun nature and ${chinese.element} ${chinese.animal} wisdom shape how this year unfolds. This is ${personalYear <= 3 ? 'a building phase' : personalYear <= 6 ? 'a development phase' : 'a completion phase'} in your 9-year cycle.`;
        }

        function getYearlyLesson(lifePath, personalYear) {
            return `Life Path ${lifePath} meeting Personal Year ${personalYear} creates specific soul curriculum around ${getLifePathFocus(lifePath)}. This year teaches you to ${getLifePathAction(lifePath)} with ${personalYear <= 5 ? 'active' : 'receptive'} energy.`;
        }

        function getYearlyOpportunity(zodiac, chinese, personalYear) {
            const base = `Your ${zodiac.name} drive combined with ${chinese.animal} intuition in Year ${personalYear} creates unprecedented opportunity for `;
            return base + 'multi-dimensional life transformation.';
        }

        function getYearlyChallenge(zodiac, moonSign, lifePath) {
            return `Your growth edge this year: integrating ${getZodiacShadow(zodiac.name)}${moonSign ? ` while managing ${getZodiacShadow(moonSign.name)} emotional patterns` : ''}. Life Path ${lifePath} asks you to ${getLifePathAction(lifePath)} even when it feels uncomfortable.`;
        }

        function getYearlyQuarters(zodiac, chinese, lifePath, personalYear, startDate = new Date()) {
            const today = new Date(startDate);
            const currentMonth = today.getMonth();
            
            // Calculate quarters from current month
            const q1Start = new Date(today);
            const q1End = new Date(today);
            q1End.setMonth(currentMonth + 3);
            
            const q2Start = new Date(q1End);
            const q2End = new Date(q2Start);
            q2End.setMonth(q2Start.getMonth() + 3);
            
            const q3Start = new Date(q2End);
            const q3End = new Date(q3Start);
            q3End.setMonth(q3Start.getMonth() + 3);
            
            const q4Start = new Date(q3End);
            const q4End = new Date(q4Start);
            q4End.setMonth(q4Start.getMonth() + 3);
            
            const formatMonth = (date) => date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            return [
                {
                    title: 'Foundation',
                    months: `${formatMonth(q1Start)} - ${formatMonth(q1End)}`,
                    theme: `Plant seeds for Personal Year ${personalYear} themes`,
                    focus: `${zodiac.name} initiative launches new cycles`,
                    peak: `Peak energy: ${formatMonth(new Date(q1Start.getTime() + (q1End - q1Start) / 2))}`
                },
                {
                    title: 'Growth',
                    months: `${formatMonth(q2Start)} - ${formatMonth(q2End)}`,
                    theme: 'Develop what was initiated in Q1',
                    focus: `${chinese.animal} persistence builds momentum`,
                    peak: `Peak energy: ${formatMonth(new Date(q2Start.getTime() + (q2End - q2Start) / 2))}`
                },
                {
                    title: 'Harvest',
                    months: `${formatMonth(q3Start)} - ${formatMonth(q3End)}`,
                    theme: 'Reap results from H1 efforts',
                    focus: `Life Path ${lifePath} purpose becomes visible`,
                    peak: `Peak energy: ${formatMonth(new Date(q3Start.getTime() + (q3End - q3Start) / 2))}`
                },
                {
                    title: 'Integration',
                    months: `${formatMonth(q4Start)} - ${formatMonth(q4End)}`,
                    theme: 'Complete cycle and prepare for next',
                    focus: `Personal Year ${personalYear} lessons crystallize`,
                    peak: `Peak energy: ${formatMonth(new Date(q4Start.getTime() + (q4End - q4Start) / 2))}`
                }
            ];
        }

        function getYearlyTransits(zodiac, currentYear) {
            return `
                <div class="transit-grid">
                    <div class="transit-item">
                        <h4>Mercury Retrogrades (${currentYear})</h4>
                        <p>Three periods of review and revision. For ${zodiac.name}, these times favor completing old projects over starting new ones. Communication and technology need extra attention.</p>
                    </div>
                    <div class="transit-item">
                        <h4>Eclipse Season</h4>
                        <p>Two eclipse seasons bring powerful change. Watch for major life shifts during these windows. ${zodiac.name} experiences these as catalysts for authentic expression.</p>
                    </div>
                    <div class="transit-item">
                        <h4>Jupiter's Blessing</h4>
                        <p>Jupiter's position this year expands opportunity in specific life areas. For ${zodiac.name}, this brings growth through ${getZodiacTrait(zodiac.name)}.</p>
                    </div>
                    <div class="transit-item">
                        <h4>Saturn's Lessons</h4>
                        <p>Saturn demands maturity and responsibility. For ${zodiac.name}, this means developing discipline around your natural ${getZodiacTrait(zodiac.name)} tendencies.</p>
                    </div>
                </div>
            `;
        }

        function getYearlyWesternForecast(zodiac, risingSign, moonSign, currentYear) {
            return `
                <div class="system-item">
                    <h4>☉ ${zodiac.name} Sun - ${currentYear} Overview</h4>
                    <p>${getDetailedZodiacDescription(zodiac.name)}</p>
                    <p>This year's planetary configurations particularly support your ${getZodiacTrait(zodiac.name)}. Key windows of opportunity occur when planets transit compatible signs.</p>
                </div>
                ${risingSign ? `
                <div class="system-item">
                    <h4>↑ ${risingSign.name} Rising - Yearly Evolution</h4>
                    <p>Your public evolution this year involves refining your ${getRisingStyle(risingSign.name)}. Career and social positioning improve through authentic self-presentation.</p>
                </div>
                ` : ''}
                ${moonSign ? `
                <div class="system-item">
                    <h4>☽ ${moonSign.name} Moon - Emotional Journey</h4>
                    <p>Your emotional landscape this year explores themes of ${getMoonNeed(moonSign.name)}. Monthly lunar cycles highlight different aspects of your inner world.</p>
                </div>
                ` : ''}
            `;
        }

        function getYearlyChineseForecast(yourChinese, currentChinese) {
            const isElementMatch = yourChinese.element === currentChinese.element;
            const compatibility = isElementMatch ? 'highly favorable—your element is amplified!' : 'dynamic—blending your natural element with the year\'s energy.';
            
            return `
                <div class="system-item">
                    <h4>Your Sign in the Year of ${currentChinese.element} ${currentChinese.animal}</h4>
                    <p>As a ${yourChinese.element} ${yourChinese.animal}, this year's energy is ${compatibility}</p>
                    <p>${isElementMatch ? 'This is a power year for you—your natural abilities are doubled.' : `Learn to integrate ${currentChinese.element} qualities with your ${yourChinese.element} nature for optimal results.`}</p>
                </div>
                <div class="system-item">
                    <h4>Year Animal Relationship</h4>
                    <p>${getAnimalCompatibility(yourChinese.animal, currentChinese.animal)}</p>
                </div>
                <div class="system-item">
                    <h4>Yearly Lucky Elements</h4>
                    <p><strong>Colors:</strong> ${getChineseColor(yourChinese.element)} (always), ${getChineseColor(currentChinese.element)} (this year)<br>
                    <strong>Numbers:</strong> ${getLuckyNumbers(yourChinese.animal)}<br>
                    <strong>Directions:</strong> ${getLuckyDirection(yourChinese.animal)}</p>
                </div>
            `;
        }

        function getYearlyNumerologyForecast(lifePath, personalYear) {
            return `
                <div class="system-item">
                    <h4>Life Path ${lifePath} - Core Purpose</h4>
                    <p>${getDetailedLifePathDescription(lifePath)}</p>
                </div>
                <div class="system-item">
                    <h4>Personal Year ${personalYear} - Annual Theme</h4>
                    <p>${getDetailedPersonalYearDescription(personalYear)}</p>
                </div>
                <div class="system-item">
                    <h4>Yearly Numerological Guidance</h4>
                    <p>Life Path ${lifePath} meeting Personal Year ${personalYear} creates a year focused on ${getReducedTheme(personalYear)}. Your purpose (${getLifePathFocus(lifePath)}) finds expression through this year's themes.</p>
                </div>
            `;
        }

        function getYearlyActionItems(zodiac, chinese, lifePath, personalYear) {
            return `
                <div class="action-item">
                    <h4>Q1 Priority (Jan-Mar)</h4>
                    <p><strong>Theme:</strong> Plant Seeds<br>
                    Initiate key life projects. Your ${zodiac.name} energy supports bold beginnings. Life Path ${lifePath} opens doors through ${getLifePathAction(lifePath)}.</p>
                </div>
                <div class="action-item">
                    <h4>Q2 Priority (Apr-Jun)</h4>
                    <p><strong>Theme:</strong> Cultivate Growth<br>
                    Nurture Q1 seeds with ${chinese.animal} patience. Avoid starting too many new things—depth over breadth.</p>
                </div>
                <div class="action-item">
                    <h4>Q3 Priority (Jul-Sep)</h4>
                    <p><strong>Theme:</strong> Harvest Results<br>
                    Collect fruits of H1 labor. Year ${personalYear} rewards become visible. Celebrate progress while maintaining momentum.</p>
                </div>
                <div class="action-item">
                    <h4>Q4 Priority (Oct-Dec)</h4>
                    <p><strong>Theme:</strong> Complete & Prepare<br>
                    Finish Year ${personalYear} lessons. Clear space for next year's Year ${(personalYear % 9) + 1} themes. Honor what you've learned.</p>
                </div>
                <div class="action-item">
                    <h4>Year-Long Intention</h4>
                    <p>Personal Year ${personalYear} asks you to master ${getYearlyThemeTitle(personalYear).toLowerCase()}. Your ${zodiac.name} nature, ${chinese.element} ${chinese.animal} wisdom, and Life Path ${lifePath} purpose all converge this year. Trust the process.</p>
                </div>
            `;
        }

        // Timeframe switcher
        document.addEventListener('click', async function(e) {
            if (e.target.classList.contains('timeframe-btn')) {
                document.querySelectorAll('.timeframe-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                const timeframe = e.target.dataset.timeframe;
                
                // No animation - just regenerate instantly
                await generateForecast(timeframe);
            }
        });

        // Share today's energy on social media
        function shareEnergy(platform) {
            const energyElements = document.querySelectorAll('.cosmic-overview');
            if (!energyElements || energyElements.length === 0) return;
            
            const energyBadge = document.querySelector('.energy-badge');
            const manifestation = document.querySelector('.cosmic-meta-item:nth-child(1) .meta-value');
            const portalTime = document.querySelector('.cosmic-meta-item:nth-child(2) .meta-value');
            
            const energyLabel = energyBadge ? energyBadge.querySelector('.energy-label').textContent : 'HIGH ENERGY DAY';
            const focusText = manifestation ? manifestation.textContent : 'Manifestation';
            const portal = portalTime ? portalTime.textContent : '11:11 AM';
            
            const shareText = `🌟 TODAY'S COSMIC ENERGY 🌟\n\n${energyLabel}\nFocus: ${focusText}\nNext Portal: ${portal}\n\nGet YOUR personalized cosmic forecast at`;
            const shareUrl = window.location.href;
            
            if (platform === 'twitter') {
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
            } else if (platform === 'facebook') {
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`, '_blank');
            }
        }

        // Download today's energy as an image card
        function downloadEnergyCard() {
            alert('📸 Energy Card Download\n\nThis feature will create a beautiful shareable image card with:\n• Your energy level\n• Portal times\n• Element & frequency\n• Manifestation focus\n\nComing soon! For now, use the Share button or screenshot.');
        }

        // Save forecast to library
        function saveForecast() {
            const forecastOutput = document.getElementById('forecastOutput');
            if (!forecastOutput || !forecastOutput.innerHTML.trim()) {
                alert('❌ Please generate a forecast first before saving.');
                return;
            }
            
            // Get current forecast data
            const forecastData = {
                id: 'forecast_' + Date.now(),
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
                timeframe: getCurrentTimeframe(),
                content: forecastOutput.innerHTML,
                profile: {
                    name: document.getElementById('firstName')?.value || 'Seeker',
                    birthDate: document.getElementById('birthDate')?.value || ''
                }
            };
            
            // Load existing library
            let library = JSON.parse(localStorage.getItem('quantumMerlin_forecastLibrary') || '[]');
            
            // Add new forecast to beginning of array
            library.unshift(forecastData);
            
            // Keep only last 50 forecasts to prevent storage bloat
            if (library.length > 50) {
                library = library.slice(0, 50);
            }
            
            // Save to localStorage
            localStorage.setItem('quantumMerlin_forecastLibrary', JSON.stringify(library));
            
            // Update counter
            updateLibraryCounter();
            
            // Show success message
            showSuccessMessage(`✅ ${forecastData.timeframe} forecast saved! Library: ${library.length} reading${library.length !== 1 ? 's' : ''}`);
        }
        
        // Get current timeframe from active button
        function getCurrentTimeframe() {
            const activeBtn = document.querySelector('.timeframe-btn.active') || 
                             document.querySelector('.bottom-timeframe-btn.active');
            if (activeBtn) {
                const text = activeBtn.textContent.trim();
                if (text.includes('Daily')) return 'Daily';
                if (text.includes('Weekly')) return 'Weekly';
                if (text.includes('Monthly')) return 'Monthly';
                if (text.includes('Yearly')) return 'Yearly';
            }
            return 'Daily';
        }
        
        // Update library counter
        function updateLibraryCounter() {
            const library = JSON.parse(localStorage.getItem('quantumMerlin_forecastLibrary') || '[]');
            const counter = document.getElementById('libraryCounter');
            if (counter) {
                counter.textContent = library.length;
                counter.style.display = library.length > 0 ? 'inline-block' : 'none';
            }
        }
        
        // View library
        function viewLibrary() {
            const library = JSON.parse(localStorage.getItem('quantumMerlin_forecastLibrary') || '[]');
            
            if (library.length === 0) {
                alert('📚 Your library is empty.\n\nGenerate and save forecasts to build your personal cosmic archive!');
                return;
            }
            
            // Create library modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                z-index: 10000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; position: sticky; top: 0; background: rgba(0, 0, 0, 0.95); padding: 20px 0; z-index: 10001;">
                        <h2 style="font-family: 'Orbitron', monospace; font-size: 2rem; background: linear-gradient(135deg, #00f5ff, #9d00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            📚 Your Forecast Library (${library.length})
                        </h2>
                        <button onclick="this.closest('[style*=fixed]').remove()" style="background: rgba(255, 0, 102, 0.2); border: 2px solid #ff0066; color: #ff0066; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ✕ Close
                        </button>
                    </div>
                    <div style="display: grid; gap: 20px;">
                        ${library.map((forecast, index) => `
                            <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(0, 245, 255, 0.3); border-radius: 16px; padding: 20px; position: relative;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h3 style="color: #00f5ff; font-size: 1.3rem; margin-bottom: 5px;">
                                            ${forecast.timeframe} Forecast
                                        </h3>
                                        <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">
                                            ${forecast.date}
                                        </p>
                                        <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.85rem;">
                                            For: ${forecast.profile.name}
                                        </p>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button onclick="viewForecastDetails(${index})" style="background: linear-gradient(135deg, #00f5ff, #9d00ff); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            👁️ View
                                        </button>
                                        <button onclick="deleteForecast(${index})" style="background: rgba(255, 0, 102, 0.2); border: 2px solid #ff0066; color: #ff0066; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            🗑️ Delete
                                        </button>
                                    </div>
                                </div>
                                <div style="max-height: 200px; overflow: hidden; position: relative;">
                                    <div style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
                                        ${forecast.content.substring(0, 500)}...
                                    </div>
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 60px; background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 30px; padding: 20px;">
                        <button onclick="clearLibrary()" style="background: rgba(255, 0, 102, 0.1); border: 2px solid rgba(255, 0, 102, 0.5); color: #ff0066; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🗑️ Clear All Forecasts
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // View forecast details in modal
        function viewForecastDetails(index) {
            const library = JSON.parse(localStorage.getItem('quantumMerlin_forecastLibrary') || '[]');
            const forecast = library[index];
            
            if (!forecast) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.98);
                z-index: 10002;
                overflow-y: auto;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: sticky; top: 0; background: rgba(0, 0, 0, 0.98); padding: 20px 0; z-index: 10003;">
                        <div>
                            <h2 style="font-family: 'Orbitron', monospace; font-size: 1.8rem; color: #00f5ff;">
                                ${forecast.timeframe} Forecast
                            </h2>
                            <p style="color: rgba(255, 255, 255, 0.6);">${forecast.date}</p>
                        </div>
                        <button onclick="this.closest('[style*=fixed]').remove()" style="background: rgba(255, 0, 102, 0.2); border: 2px solid #ff0066; color: #ff0066; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ✕ Close
                        </button>
                    </div>
                    <div>
                        ${forecast.content}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Delete single forecast
        function deleteForecast(index) {
            if (!confirm('Are you sure you want to delete this forecast?')) return;
            
            let library = JSON.parse(localStorage.getItem('quantumMerlin_forecastLibrary') || '[]');
            library.splice(index, 1);
            localStorage.setItem('quantumMerlin_forecastLibrary', JSON.stringify(library));
            
            updateLibraryCounter();
            
            // Close and reopen library to refresh
            document.querySelectorAll('[style*="position: fixed"]').forEach(el => el.remove());
            viewLibrary();
        }
        
        // Clear entire library
        function clearLibrary() {
            if (!confirm('⚠️ Are you sure you want to delete ALL saved forecasts?\n\nThis cannot be undone!')) return;
            
            localStorage.removeItem('quantumMerlin_forecastLibrary');
            updateLibraryCounter();
            
            // Close library modal
            document.querySelectorAll('[style*="position: fixed"]').forEach(el => el.remove());
            
            alert('✅ Library cleared successfully!');
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after 30 seconds if not already dismissed
            if (!localStorage.getItem('installPromptDismissed')) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 30000);
            }
        });
        
        function showInstallPrompt() {
            const prompt = document.getElementById('installPrompt');
            if (prompt) {
                prompt.style.display = 'flex';
            }
        }
        
        function installApp() {
            const prompt = document.getElementById('installPrompt');
            if (prompt) {
                prompt.style.display = 'none';
            }
            
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        function dismissInstallPrompt() {
            const prompt = document.getElementById('installPrompt');
            if (prompt) {
                prompt.style.display = 'none';
            }
            localStorage.setItem('installPromptDismissed', 'true');
        }
        
        // Track when app is installed
        window.addEventListener('appinstalled', () => {
            console.log('App installed successfully');
            localStorage.setItem('appInstalled', 'true');
        });
        
        // Initialize library counter on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateLibraryCounter();
        });
    </script>

    <!-- Floating Share Button -->
    <button class="floating-share-btn" onclick="shareGeneralForecast()" title="Share your forecast" style="display: none;" id="floatingShareBtn">
        ✨
    </button>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div class="install-prompt-content">
            <div class="install-prompt-icon">📱</div>
            <div class="install-prompt-text">
                <h4>Add to Home Screen</h4>
                <p>Get instant access to your cosmic guidance anytime!</p>
            </div>
        </div>
        <div class="install-prompt-buttons">
            <button class="install-btn primary" onclick="installApp()">Install</button>
            <button class="install-btn secondary" onclick="dismissInstallPrompt()">Maybe Later</button>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="share-modal">
        <div class="share-modal-content">
            <span class="share-modal-close" onclick="closeShareModal()">&times;</span>
            <h3>✨ Share Your Discovery</h3>
            <div class="share-options">
                <button class="share-option-btn visual-card" onclick="downloadShareCard()">
                    <span class="icon">🎴</span>
                    <span><strong>Download Image</strong><br><small>For Instagram, Stories, TikTok</small></span>
                </button>
                <button class="share-option-btn whatsapp" onclick="shareToWhatsAppModal()">
                    <span class="icon">💬</span>
                    <span>WhatsApp</span>
                </button>
                <button class="share-option-btn" onclick="shareToX()">
                    <span class="icon">𝕏</span>
                    <span>X / Twitter</span>
                </button>
                <button class="share-option-btn" onclick="shareToFacebookModal()">
                    <span class="icon">📘</span>
                    <span>Facebook</span>
                </button>
                <button class="share-option-btn" onclick="shareToTelegram()">
                    <span class="icon">✈️</span>
                    <span>Telegram</span>
                </button>
                <button class="share-option-btn" onclick="shareViaSMS()">
                    <span class="icon">📱</span>
                    <span>Text</span>
                </button>
                <button class="share-option-btn" onclick="copyShareLink()">
                    <span class="icon">📋</span>
                    <span>Copy</span>
                </button>
                <button class="share-option-btn native-share" onclick="useNativeShare()">
                    <span class="icon">🚀</span>
                    <span>More...</span>
                </button>
            </div>
            
            <!-- Community Section - Only shows for Reality Codes -->
            <div id="communityShareSection" class="community-share-section" style="display: none;">
                <div class="community-divider">
                    <span>✨ QUANTUM RECIPROCITY ✨</span>
                </div>
                <p class="community-text">Post your code & support others to clear YOUR blockages!</p>
                <div class="community-buttons">
                    <button class="community-btn facebook-group" onclick="shareToFacebookGroup()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        <span>Facebook Group</span>
                    </button>
                    <button class="community-btn telegram-group" onclick="shareToTelegramGroup()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                        <span>Telegram Group</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
